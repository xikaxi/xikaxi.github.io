<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>ä¸ºä»€ä¹ˆä¹Œé¸¦åƒå†™å­—å°</title>
    <link href="/2021/05/10/%E4%B8%BA%E4%BB%80%E4%B9%88%E4%B9%8C%E9%B8%A6%E5%83%8F%E5%86%99%E5%AD%97%E5%8F%B0/"/>
    <url>/2021/05/10/%E4%B8%BA%E4%BB%80%E4%B9%88%E4%B9%8C%E9%B8%A6%E5%83%8F%E5%86%99%E5%AD%97%E5%8F%B0/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h2 id="ä¸ºä»€ä¹ˆä¹Œé¸¦åƒå†™å­—å°"><a href="#ä¸ºä»€ä¹ˆä¹Œé¸¦åƒå†™å­—å°" class="headerlink" title="ä¸ºä»€ä¹ˆä¹Œé¸¦åƒå†™å­—å°"></a><font color=" #008080">ä¸ºä»€ä¹ˆä¹Œé¸¦åƒå†™å­—å°</font></h2><figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">because there is a B <span class="hljs-keyword">in</span> both and an N <span class="hljs-keyword">in</span> neither.<br>because I ğŸ’• U<br></code></pre></div></td></tr></table></figure><blockquote><p><font color=" #008080">æ­£æ–‡</font></p></blockquote><p><img src="https://qiniu.bree.vip/f4IwB7Wgcjuio8pGeERlyTrMtVdm2YCN.png"></p><figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html">ä»Šå¤©çš„æ™šéœæ˜¯ç²‰çº¢è‰²çš„ å¤§ç‰‡å¤§ç‰‡åœ¨å¤©è¾¹æ™•å¼€ã€‚<br>æ™´æœ—å¤©æ°”çš„å‚æ™šçœŸå¥½çœ‹å•Šã€‚<br>å…”å­ç«™åœ¨ç”°è¾¹æŠ–æŠ–å¥¹æ¯›èŒ¸èŒ¸çš„é•¿è€³æœµ ä»°ç€è„‘è¢‹æƒ³ç€ã€‚<br>â€œä¸ºä»€ä¹ˆä»Šå¤©çš„å¤©æ˜¯ç²‰çº¢è‰²çš„å‘¢ã€‚â€<br>è¿™æ—¶å€™åœ°é‡Œå—–åœ°é’»å‡ºä¸€åªåœŸæ‹¨é¼ ã€‚<br>ç™½è‰²çš„ è„‘è¢‹ä¸ŠæŠ–è½äº†ä¸€å †åœŸå±‘ã€‚<br>å®ƒå—·çš„ä¸€å—“å­å–Šå‡ºæ¥ã€‚<br>â€œæˆ‘çŸ¥é“å•Šâ€”â€”â€<br>â€œä¸ºä»€ä¹ˆå•Šä¸ºä»€ä¹ˆå•Š??â€<br>â€œä½ æŠŠæ‰‹ä¸Šçš„èƒ¡èåœç»™æˆ‘æˆ‘å°±å‘Šè¯‰ä½ ã€‚â€<br>åœŸæ‹¨é¼ ç‹¡é» åœ°è½¬è½¬ä»–çš„çœ¼ç  æ‚„æ‚„åœ¨å¿ƒé‡Œåäº†å£å£æ°´ã€‚<br>å•Šå‘€ é¦™é¦™ç”œç”œçš„èƒ¡èåœä¸€å®šæœ‰ä»€ä¹ˆé­”æ³•ã€‚<br>å…”å­çŠ¹è±«ä¸€ä¸‹ ä½å¤´çœ‹ç€æ€€é‡Œçš„èƒ¡èåœã€‚<br>åˆšåˆšæ‹”å‡ºæ¥çš„ æ©™çº¢è‰²ã€‚<br>åœ¨ç²‰è‰²çš„å¤•é˜³ä¸‹å¥½åƒåœ¨é—ªé—ªå‘äº®!!<br>â€œå¥½â€¦å¥½å§ã€‚â€ä½†æ˜¯å¥¹è¿˜æ˜¯æŠŠèåœé€’ç»™åœŸæ‹¨é¼ ã€‚<br>å› ä¸ºç²‰çº¢è‰²æ™šéœçœŸçš„å¤ªå¤ªå¤ªå¤ªå¥½çœ‹äº†ã€‚ç®€ç›´æ¯”æ—©ä¸Šæ²¾ç€éœ²ç çš„èƒ¡èåœè¿˜å¥½çœ‹ã€‚<br>å¥¹å®åœ¨æ˜¯å¤ªæƒ³çŸ¥é“ä¸ºä»€ä¹ˆä»Šå¤©çš„æ™šéœæ˜¯ç²‰çº¢è‰²çš„äº†ã€‚<br><br>åœŸæ‹¨é¼ æ¥è¿‡èƒ¡èåœ æœ‰ä¸€ç‚¹ç‚¹æ„å¤–ã€‚<br>ä»–æ—©å°±çŸ¥é“å…”å­è¶…çº§å–œæ¬¢èƒ¡èåœ æ²¡æƒ³åˆ°è¿™ä¹ˆå®¹æ˜“ã€‚<br>äºæ˜¯ä»–åè€Œæœ‰ç‚¹ååååèµ·æ¥ã€‚<br>â€œå› â€¦å› ä¸ºâ€¦â€¦â€<br>è¿™æ˜¯ä¸€åªèªæ˜çš„åœŸæ‹¨é¼ ã€‚<br>â€œç°åœ¨è¿˜ä¸èƒ½å‘Šè¯‰ä½  è¿™æ˜¯æ™šéœçš„ç§˜å¯†ã€‚è¦æ˜¯ç²‰è‰²çš„æ™šéœçŸ¥é“æˆ‘ä»¬çŸ¥é“äº†å®ƒçš„ç§˜å¯†ï¼Œ<br>å®ƒå°±å†ä¹Ÿä¸ä¼šå‡ºç°äº†ã€‚ç­‰å®ƒæ¶ˆå¤±äº† æˆ‘å†æ‚„æ‚„ æ‚„æ‚„ æ‚„æ‚„åœ°å‘Šè¯‰ä½ ã€‚â€<br>å…”å­ä¸€å‰¯æç„¶å¤§æ‚Ÿçš„æ ·å­ è€³æœµä¹Ÿå°å¿ƒç¿¼ç¿¼åœ°å‚ä¸‹æ¥ å‡‘è¿‘åœŸæ‹¨é¼  ç”¨çˆªå­æ‚ä½è‡ªå·±çš„ä¸‰ç“£å˜´å°å£°åœ°è¯´ã€‚<br>â€œé‚£â€¦é‚£ä½ æ™šä¸Šè¦å‘Šè¯‰æˆ‘å“¦ã€‚â€<br>åœŸæ‹¨é¼ ç‚¹å¤´å¦‚æ£è’œã€‚æ²¡å…³ç³» æ—¶é—´é‚£ä¹ˆå¤š æˆ‘å¯ä»¥æ…¢æ…¢æƒ³ã€‚ä¸è¡Œçš„è¯æºœèµ°å°±å¥½ è¿™åªå…”å­çœ‹èµ·æ¥å‚»ä¹ä¹çš„ã€‚<br>ä»–èƒ¸æœ‰æˆç«¹ã€‚è¿˜æœ‰ä¸€ç‚¹å„¿æ—¶é—´æ‰å¤©é»‘ äºæ˜¯ä»–ä»¬å¹¶æ’åç€ ä¸€èµ·ä»°ç€è„‘è¢‹çœ‹å¤©ä¸Šç²‰çº¢è‰²çš„æ™šéœã€‚<br>â€œæˆ‘çœŸç¾¡æ…•ä½ å•Šâ€¦ç™½è‰²çœŸå¥½çœ‹ã€‚â€æ£•è‰²çš„å…”å­çªç„¶è¯´é“ å£°éŸ³é‡ŒæŸ“ä¸Šä¸€ç‚¹ç‚¹å¯‚å¯ã€‚<br>â€œæ€ä¹ˆä¼š æ£•è‰²æ‰æ˜¯å¥½çœ‹çš„é¢œè‰²å•Šã€‚â€ç™½è‰²çš„åœŸæ‹¨é¼ æ¥ä¸€ä¸‹ã€‚æ•›å»äº†ä¸€å‘ä¸å±‘çš„ç¥è‰² ä½å£°åé©³é“ã€‚<br><br>è¿™æ˜¯ä¸€åªåœ¨ç™½è‰²å…”å­ç¾¤é‡Œè¢«å†·è½çš„æ£•è‰²å…”å­ã€‚<br>è¿™æ˜¯ä¸€åªåœ¨æ£•è‰²åœŸæ‹¨é¼ ç¾¤é‡Œè¢«å†·è½çš„ç™½è‰²åœŸæ‹¨é¼ ã€‚<br><br>ä»–ä»¬æ­¤æ—¶å°±è¿™æ ·é™é™åœ°å¹¶æ’åç€ ä»€ä¹ˆéƒ½æ²¡æœ‰è¯´ å¯æ˜¯å½¼æ­¤éƒ½è§‰å¾—å¿ƒçŸ¥è‚šæ˜ã€‚<br>ä»–ä»¬ä¸€èµ·ä»°ç€è„‘è¢‹çœ‹å¤©ã€‚ç´«è‰²æ…¢æ…¢è”“å»¶ä¸Šæ¥ åˆè¿ç€ä¸€ç‚¹ç‚¹å¢¨è“ æ¸©æŸ”åœ°ç›–ä½ç²‰è‰²çš„æ™šéœã€‚<br>é™æ‚„æ‚„çš„åŸé‡åªæœ‰é£æ…¢æ…¢å¹è¿‡æ¥çš„å£°éŸ³ã€‚<br>â€œâ€¦é¢œè‰²çœŸçš„é‚£ä¹ˆé‡è¦å—ã€‚å¤§å®¶éƒ½è¯´æˆ‘åˆä¸‘åˆå¦ç±»ã€‚â€<br>æ£•è‰²çš„å…”å­çªç„¶å¸¦ç€å“­è…”è¯¢é—®é“ å§”å±ˆåœ¨å¥¹æ¹¿æ¼‰æ¼‰çš„çœ¼çœ¶é‡Œé¢è½¬å•Šè½¬ã€‚<br>â€œæˆ‘å’Œå¤§å®¶æ²¡æœ‰åŒºåˆ«å•Šã€‚æˆ‘ä¹Ÿå–œæ¬¢åƒèƒ¡èåœ èµ°è·¯çš„æ—¶å€™ä¼šä¸€è¹¦ä¸€è·³ æˆ‘çš„å°¾å·´ä¹Ÿå¯ä»¥èœ·ç¼©èµ·æ¥ <br>æˆ‘çš„åè…¿å’Œå¤§å®¶ä¸€æ ·æœ‰åŠ› è·³èµ·æ¥å¯ä»¥è·³å¥½é«˜å¥½é«˜å¥½é«˜å‘¢â€¦â€¦å‘œâ€¦â€¦â€<br>â€œå•Šâ€¦å¥½å•¦å¥½å•¦åˆ«å“­äº†å•Š!!â€ç™½è‰²çš„åœŸæ‹¨é¼ æ…Œæ…Œå¼ å¼  ä»–ç«‹èµ·ä»–å°å°çš„èº«å­ <br>ç”¨å¸¦ç€æ³¥åœŸå‘³é“çš„æ¯›èŒ¸èŒ¸çš„å°çˆªå­å°å¿ƒç¿¼ç¿¼è¹­å»å…”å­ä¸åœæ»šè½çš„æ³ªç ã€‚<br>â€œæˆ‘ä¸è¦èåœäº† èåœä¹Ÿç»™ä½ åƒ ç§˜å¯†ä¹Ÿå‘Šè¯‰ä½ ã€‚â€<br>â€œå°‘å¬ä»–ä»¬ä»–å¦ˆçš„èƒ¡è¯´å…«é“äº† ä½ æ˜¯å…¨å®‡å®™æœ€å¥½çœ‹çš„å…”å­ã€‚â€<br>â€œæ£•è‰²çœ‹èµ·æ¥æš–æš–çš„ åƒæäº†æˆ‘æœ€å–œæ¬¢çš„é‚£ä¸ªæ ‘å¢©ã€‚è®©æˆ‘å¿ä¸ä½æƒ³æŠŠè„‘è¢‹åŸ‹è¿›å»ã€‚â€<br>â€œä½ çš„çœ¼ç›é»‘å¹½å¹½çš„åˆäº®æ™¶æ™¶çš„ å¥½åƒç››äº†æ•´ä¸ªå®‡å®™ã€‚â€<br>â€œä½ çš„è€³æœµåƒåœ¨é£ä¸­æ‘‡æ™ƒçš„èŠ¦è‹‡ æ˜¯æ•…ä¹¡æˆ‘æœ€å–œæ¬¢çš„é‚£ä¸¤æ ªã€‚â€<br>â€œä½ çš„å°¾å·´è®©æˆ‘æƒ³åˆ°å†¬å¤©çš„å°æŸ´ç«å †ã€‚â€<br>â€œçœ‹åˆ°ä½ å“­æˆ‘çš„å¿ƒå°±å¿ä¸ä½ä¸€æ™ƒä¸€æ™ƒ å¥½åƒå¿«èåŒ–ã€‚â€<br>åŸé‡ä¸Šé™æ‚„æ‚„çš„ åªæœ‰é£è½»è½»å“¼çš„æ­Œå£°å’Œå…”å­ä½ä½çš„æŠ½æ³£å£°ã€‚<br>ç„¶åå¢¨è“è‰²çš„é¢œæ–™åœ¨ä¸€ç‰‡å¯‚é™é‡Œæ‰“ç¿»äºå¤©é™… åå™¬äº†æ‰€æœ‰æš§æ˜§åˆå¯çˆ±çš„ç²‰è‰²ã€‚<br>æ˜Ÿæ˜Ÿå°±äº®èµ·æ¥äº†ã€‚å¤œæ™šåˆ°äº†ã€‚å…”å­çš„å“½å’½å£°ä¸€ç‚¹ç‚¹ä½ä¸‹å»ã€‚<br>â€œä½ ç°åœ¨è¿˜æƒ³çŸ¥é“ä»Šå¤©æ™šéœä¸ºä»€ä¹ˆæ˜¯ç²‰çº¢è‰²çš„å—?â€<br>åœŸæ‹¨é¼ çš„å°çˆªå­æ’©å¼€å…”å­ä½å‚ç€çš„é•¿è€³æœµ è¶´ä¸Šå»å¯¹ç€å¥¹è€³è¯­ã€‚<br>â€œä»Šå¤©çš„æ™šéœä¸ºä»€ä¹ˆæ˜¯ç²‰çº¢è‰²?â€<br>â€œå› ä¸ºæˆ‘å–œæ¬¢ä½ ã€‚â€<br></code></pre></div></td></tr></table></figure><blockquote><p><font color=" #008080">æ˜¯å•Š å› ä¸ºæˆ‘å–œæ¬¢ä½  æ‰€ä»¥æ²¡æœ‰ä»»ä½•ç†ç”±</font></p></blockquote><p><img src="https://qiniu.bree.vip/4gGrqyQXtxY0asSpICoMwkbV31jBRLDf.png"></p>]]></content>
    
    
    <categories>
      
      <category>life</category>
      
    </categories>
    
    
    <tags>
      
      <tag>æ²»æ„ˆ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>è¯æ ¹çŸ©é˜µpost</title>
    <link href="/2021/05/07/%E8%AF%8D%E6%A0%B9%E7%9F%A9%E9%98%B5post/"/>
    <url>/2021/05/07/%E8%AF%8D%E6%A0%B9%E7%9F%A9%E9%98%B5post/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h2 id="è¯æ ¹çŸ©é˜µ"><a href="#è¯æ ¹çŸ©é˜µ" class="headerlink" title="è¯æ ¹çŸ©é˜µ"></a><font color="#5e45a5">è¯æ ¹çŸ©é˜µ</font></h2><ul><li><p>è¯·æ±‚æ–¹æ³•ï¼šPOST</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">post</span>(<span class="hljs-params">self, request</span>):</span><br>    <span class="hljs-keyword">try</span>:<br>        data_list = json.loads(request.POST.get(<span class="hljs-string">&#x27;roots&#x27;</span>))<br>        pid = request.POST.get(<span class="hljs-string">&#x27;pid&#x27;</span>)<br>        <span class="hljs-keyword">except</span>:<br>            <span class="hljs-keyword">return</span> Response(&#123;<span class="hljs-string">&#x27;code&#x27;</span>: RET.DBERR, <span class="hljs-string">&#x27;message&#x27;</span>: <span class="hljs-string">&#x27;å‚æ•°ä¸æ­£ç¡®&#x27;</span>&#125;)<br>        user = is_master(request.user)<br>        <span class="hljs-keyword">try</span>:<br>            AffirmCategory.objects.get(<span class="hljs-built_in">id</span>=pid, user_foreign=user.<span class="hljs-built_in">id</span>)<br>            <span class="hljs-keyword">except</span>:<br>                <span class="hljs-keyword">return</span> Response(&#123;<span class="hljs-string">&#x27;code&#x27;</span>: RET.DBERR, <span class="hljs-string">&#x27;message&#x27;</span>: <span class="hljs-string">&#x27;åˆ†ç±»ä¸å­˜åœ¨ è¯·æ£€æŸ¥æ˜¯å¦å·²åˆ é™¤&#x27;</span>&#125;)<br>            root_lists = [data.get(<span class="hljs-string">&#x27;root&#x27;</span>) <span class="hljs-keyword">for</span> data <span class="hljs-keyword">in</span> data_list]<br>            <span class="hljs-keyword">try</span>:<br>                PositiveCk.objects.<span class="hljs-built_in">filter</span>(positive_name__in=root_lists).<span class="hljs-built_in">filter</span>(pid=pid).delete()<br>                root_dict_list = get_root_dict_list(data_list, pid)<br>                res = delete_positive(pid)<br>                <span class="hljs-keyword">if</span> res == <span class="hljs-number">1</span>:  <span class="hljs-comment"># TODO 12</span><br>                    <span class="hljs-keyword">return</span> Response(&#123;<span class="hljs-string">&#x27;code&#x27;</span>: RET.DBERR, <span class="hljs-string">&#x27;message&#x27;</span>: <span class="hljs-string">&#x27;Internal de duplication error in Positive ROOT&#x27;</span>&#125;)<br>                data_list = get_ring_data(root_dict_list)<br>                res = save_positive_ck(data_list, <span class="hljs-built_in">int</span>(pid))<br>                <span class="hljs-keyword">if</span> res == <span class="hljs-number">1</span>:  <span class="hljs-comment"># TODO 13</span><br>                    <span class="hljs-keyword">return</span> Response(&#123;<span class="hljs-string">&#x27;code&#x27;</span>: RET.DBERR, <span class="hljs-string">&#x27;message&#x27;</span>: <span class="hljs-string">&#x27;è‚¯å®šè¯çŸ©é˜µè¯æ ¹ä¿å­˜å¤±è´¥ è¯·åˆ·æ–°åé‡æ–°è¯·æ±‚&#x27;</span>&#125;)<br>                <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>                    <span class="hljs-keyword">return</span> Response(&#123;<span class="hljs-string">&#x27;code&#x27;</span>: RET.DBERR, <span class="hljs-string">&#x27;message&#x27;</span>: <span class="hljs-string">&#x27;ä¿å­˜å¤±è´¥,è¯·é‡æ–°è¯·æ±‚&#x27;</span>&#125;)<br>                <span class="hljs-keyword">return</span> Response(&#123;<span class="hljs-string">&#x27;code&#x27;</span>: RET.OK&#125;)<br></code></pre></div></td></tr></table></figure></li><li><p>get_root_dict_listæ–¹æ³•</p><figure class="highlight"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs json">def get_root_dict_list(data_list, pid):<br>    # ä»å°åˆ°å¤§æ’åº<br>    positiveck = PositiveCk.objects.filter(pid=pid, is_delete=0).order_by(&#x27;is_positive_ring_number&#x27;)<br><br>    root_dict = &#123;&#125;<br>    root_dict_list = []<br>    for p in positiveck:<br>        root_dict[&#x27;rootfrequency&#x27;] = p.positive_frequirency<br>        root_dict[&#x27;root&#x27;] = p.positive_name<br>        root_dict[&#x27;ring&#x27;] = p.is_positive_ring_number<br>        root_dict_list.append(root_dict)<br>        root_dict = &#123;&#125;<br>    # å®ç°åé¢æ·»åŠ çš„æ•°æ®æ”¾åœ¨æœ€åé¢<br>    root_dict_list.extend(data_list)<br>    return root_dict_list<br></code></pre></div></td></tr></table></figure></li><li><p>get_ring_dataæ–¹æ³•</p><figure class="highlight"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs json"># æ·»åŠ ç¯æ•°(å®Œç¾)<br>def get_ring_data(data_list):<br>    # å¯¹åº”ç¯çš„æœ€åä¸€ä¸ªä¸‹æ ‡<br>    # sum å½“å‰pidçš„è¯æ ¹æ•°é‡æ€»å’Œ<br>    ring_l = 25<br>    i = 0<br>    # ç¯æ•°<br>    ring_n = 3<br>    for ring in range(16, 16000, 8):<br>        if ring == 16:<br>            while i &lt;= len(data_list):<br>                # ç¬¬ä¸€ç¯<br>                if 0 &lt;= i &lt; 9:<br>                    try:<br>                        data_list[i][&quot;ring&quot;] = 1<br>                    except Exception as e:<br>                        i += 1<br>                        break<br>                    i += 1<br>                # ç¬¬äºŒç¯<br>                elif 9 &lt;= i &lt; ring_l:<br>                    try:<br>                        data_list[i][&quot;ring&quot;] = 2<br>                    except Exception as e:<br>                        i += 1<br>                        break<br>                    i += 1<br>                else:<br>                    break<br>        else:<br>            # å¯¹åº”ç¯çš„ç¬¬ä¸€ä¸ªä¸‹æ ‡ ring_f<br>            ring_f = ring_l<br>            ring_l = ring + ring_l<br>            ring_n += 1<br>            while i &lt; len(data_list):<br>                # ç¬¬ä¸‰ç¯-ç¬¬Nç¯<br>                if ring_f &lt;= i &lt; ring_l:<br>                    data_list[i][&quot;ring&quot;] = ring_n - 1<br>                    i += 1<br>                else:<br>                    break<br>    return data_list<br></code></pre></div></td></tr></table></figure></li></ul>]]></content>
    
    
    <categories>
      
      <category>Python</category>
      
      <category>django</category>
      
    </categories>
    
    
    <tags>
      
      <tag>çŸ©é˜µ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä¸€äº›æ²¡æ¥å¾—åŠç”¨çš„æƒ…å¤´</title>
    <link href="/2021/05/06/%E4%B8%80%E4%BA%9B%E6%B2%A1%E6%9D%A5%E5%BE%97%E5%8F%8A%E7%94%A8%E7%9A%84%E6%83%85%E5%A4%B4/"/>
    <url>/2021/05/06/%E4%B8%80%E4%BA%9B%E6%B2%A1%E6%9D%A5%E5%BE%97%E5%8F%8A%E7%94%A8%E7%9A%84%E6%83%85%E5%A4%B4/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p><img src="https://ae01.alicdn.com/kf/U9f091f9e89814e17aa8c762f6ff7e918I.jpg"></p><p><img src="https://ae01.alicdn.com/kf/U72936616b425494aa3987de0555e96c3Y.jpg"></p><p><img src="https://ae01.alicdn.com/kf/U48918f55e5354a8196973d8fe4715b66F.jpg"></p><p><img src="https://ae01.alicdn.com/kf/Udfb9fab9ed08401d9c1624bb43e95cfen.jpg"></p><p><img src="https://ae01.alicdn.com/kf/Uaa5e2ab59e594610b9c3a71573e28f14p.jpg"></p><p><img src="https://ae01.alicdn.com/kf/U2d48446a30304f8c92eb86238b27d1a8D.jpg"></p><p><img src="https://ae01.alicdn.com/kf/U7f2828030223447f831417bfff0ae453k.jpg"></p><p><img src="https://ae01.alicdn.com/kf/Uea69a4f71acf4940a1ac9090cbe7efb8y.jpg"></p><p><img src="https://ae01.alicdn.com/kf/U259fefdaffe3410592bc1f3d3acf6a57z.jpg"></p><p><img src="https://ae01.alicdn.com/kf/Uad8accff56b04ea18f49eb9c12aab391e.jpg"></p>]]></content>
    
    
    <categories>
      
      <category>life</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Love head</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>python venvåˆ›å»ºè™šæ‹Ÿç¯å¢ƒ</title>
    <link href="/2021/04/30/python%20venv%E5%88%9B%E5%BB%BA%E8%99%9A%E6%8B%9F%E7%8E%AF%E5%A2%83/"/>
    <url>/2021/04/30/python%20venv%E5%88%9B%E5%BB%BA%E8%99%9A%E6%8B%9F%E7%8E%AF%E5%A2%83/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p><code>ä¸å¡«è·¯å¾„é»˜è®¤ä¸ºå½“å‰è·¯å¾„</code></p><p><code>python -m venv æ–‡ä»¶è·¯å¾„</code></p><figure class="highlight cmake"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs cmake">pip <span class="hljs-keyword">install</span> -r requirements.txt<br></code></pre></div></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Python</category>
      
      <category>ç¬”è®°</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ç¬”è®°</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>mysqlè¯­å¥çš„ä¸€äº›é—®é¢˜è®°å½•</title>
    <link href="/2021/04/09/mysql%E4%B8%80%E4%BA%9B%E9%97%AE%E9%A2%98%E7%9A%84%E6%80%BB%E7%BB%93/"/>
    <url>/2021/04/09/mysql%E4%B8%80%E4%BA%9B%E9%97%AE%E9%A2%98%E7%9A%84%E6%80%BB%E7%BB%93/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h2 id="distinct"><a href="#distinct" class="headerlink" title="distinct"></a>distinct</h2><p>sqlæ•°æ®å»é‡</p><figure class="highlight n1ql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs n1ql"><span class="hljs-keyword">select</span> <span class="hljs-keyword">distinct</span> english <span class="hljs-keyword">from</span> students;<br></code></pre></div></td></tr></table></figure><p>å¤šä¸ªå­—æ®µï¼ˆå¤šä¸ªå­—æ®µå®Œå…¨ç›¸åŒæ‰ä¼šå»é‡ï¼‰</p><figure class="highlight pgsql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs pgsql"><span class="hljs-keyword">select</span> <span class="hljs-keyword">distinct</span> <span class="hljs-type">name</span>, english <span class="hljs-keyword">from</span> students;<br></code></pre></div></td></tr></table></figure><h2 id="group-by"><a href="#group-by" class="headerlink" title="group by"></a>group by</h2><p>group by å¦‚æœ è¿”å›çš„nameä¸­æœ‰ç›¸åŒçš„nameä¼šè‡ªåŠ¨å»é‡å–ç¬¬ä¸€ä¸ª</p><figure class="highlight pgsql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs pgsql"><span class="hljs-keyword">select</span> <span class="hljs-type">name</span>,sum(chinese+english+math) <span class="hljs-keyword">as</span> &quot;æ€»åˆ†&quot; <span class="hljs-keyword">from</span> students <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> <span class="hljs-type">name</span>;<br></code></pre></div></td></tr></table></figure><p>åŸè¡¨æ•°æ®ï¼š<img src="https://ae01.alicdn.com/kf/U827427c8057d475aadca6e88afe40af0j.jpg" alt="1617883619624">æŸ¥è¯¢ç»“æœï¼š<img src="https://ae01.alicdn.com/kf/Ufcf779f123654ead97a1c506ebe8623d8.jpg" alt="1617883550694"><br>è§£å†³ï¼š</p><figure class="highlight pgsql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs pgsql"><span class="hljs-keyword">select</span> <span class="hljs-type">name</span>,chinese+english+math <span class="hljs-keyword">as</span> &quot;æ€»åˆ†&quot; <span class="hljs-keyword">from</span> students;<br></code></pre></div></td></tr></table></figure><p>æŸ¥è¯¢ç»“æœï¼š<img src="https://ae01.alicdn.com/kf/Ua64f86f0ae824c13bf99f8a3c62315f8p.jpg" alt="1617883778292"></p>]]></content>
    
    
    <categories>
      
      <category>Python</category>
      
      <category>MySQL</category>
      
    </categories>
    
    
    <tags>
      
      <tag>MySQL</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Python Pandasæ“ä½œExcel</title>
    <link href="/2021/04/09/Excel/"/>
    <url>/2021/04/09/Excel/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h2 id="Python-Pandasæ“ä½œExcel"><a href="#Python-Pandasæ“ä½œExcel" class="headerlink" title="Python Pandasæ“ä½œExcel"></a><font color="#008080">Python Pandasæ“ä½œExcel</font></h2><p><code>å‰æƒ…æè¦</code></p><figure class="highlight"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs nginx">æœ¬ç« ä½¿ç”¨çš„ Python3.6 Pandas==0.25.3<br>é¡¹ç›®ä¸­éœ€è¦ç”¨åˆ°excelçš„æ–‡ä»¶å­—æ®µå¤ªå¤š è€ƒè™‘åˆ°åç»­å­—æ®µå‘½åçš„å˜åŠ¨ä»¥åŠä¸­æ–‡/è‹±æ–‡/æ—¥æ–‡...ç­‰å¤šå›½è¯­è¨€çš„æ ¡éªŒ<br>æ“ä½œéº»çƒ¦ åæ”¹è¿›çš„æ“ä½œæ–¹å¼<br></code></pre></div></td></tr></table></figure><h3 id="æµ‹è¯•æ–‡ä»¶ç‚¹å‡»ä¸‹è½½"><a href="#æµ‹è¯•æ–‡ä»¶ç‚¹å‡»ä¸‹è½½" class="headerlink" title="æµ‹è¯•æ–‡ä»¶ç‚¹å‡»ä¸‹è½½"></a><a href="https://qizai.bree.vip/static/ceshi.xlsx">æµ‹è¯•æ–‡ä»¶ç‚¹å‡»ä¸‹è½½</a></h3><h2 id="Pandasä¸­æ–‡æ–‡æ¡£"><a href="#Pandasä¸­æ–‡æ–‡æ¡£" class="headerlink" title="Pandasä¸­æ–‡æ–‡æ¡£"></a><font color="#008080">Pandasä¸­æ–‡æ–‡æ¡£</font></h2><h3 id="Pandasä¸­æ–‡æ–‡æ¡£-1"><a href="#Pandasä¸­æ–‡æ–‡æ¡£-1" class="headerlink" title="Pandasä¸­æ–‡æ–‡æ¡£"></a><a href="https://www.pypandas.cn/">Pandasä¸­æ–‡æ–‡æ¡£</a></h3><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment"># å®‰è£…pandas</span><br><span class="hljs-comment"># -i https://pypi.douban.com/simple/ å›½å†…é•œåƒåŠ é€Ÿ</span><br>pip insatll pandas==<span class="hljs-number">0.25</span><span class="hljs-number">.3</span> -i https://pypi.douban.com/simple/<br><br></code></pre></div></td></tr></table></figure><h2 id="æ“ä½œExcelæ–‡ä»¶-è·å–åˆ—æ•°æ®"><a href="#æ“ä½œExcelæ–‡ä»¶-è·å–åˆ—æ•°æ®" class="headerlink" title="æ“ä½œExcelæ–‡ä»¶/è·å–åˆ—æ•°æ®"></a><font color="#008080">æ“ä½œExcelæ–‡ä»¶/è·å–åˆ—æ•°æ®</font></h2><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">################ Rudy ################</span><br><span class="hljs-string">############# 2021-01-22 #############</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br><br><br><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_excel</span>(<span class="hljs-params">path_load</span>):</span><br>    df1 = pd.read_excel(path_load) <span class="hljs-comment"># è¯»å–excel</span><br>    df2 = df1.dropna(how=<span class="hljs-string">&#x27;all&#x27;</span>)  <span class="hljs-comment"># æ•°æ®æ¸…æ´—ï¼Œä¸ºå®Œæˆéœ€æ±‚åˆ å»ä¸å¿…è¦çš„è¡Œ</span><br>    df2 = df2.replace(<span class="hljs-string">&#x27;-&#x27;</span>, <span class="hljs-number">0</span>)  <span class="hljs-comment"># æŠŠâ€˜-â€™çš„æ›¿æ¢æˆ0ä¾¿äºåé¢è®¡ç®—</span><br>    df2 = df2.fillna(<span class="hljs-number">0</span>)  <span class="hljs-comment"># æ•°æ®æ¸…æ´—ï¼Œç¼ºå¤±å€¼ç”¨0è¡¥è¶³</span><br>    df2 = df2.reset_index(drop=<span class="hljs-literal">True</span>)  <span class="hljs-comment"># é‡è®¾è¡Œç´¢å¼•</span><br>    column_name = [i <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> df1]  <span class="hljs-comment"># è·å–æ‰€æœ‰çš„åˆ—å</span><br>    <span class="hljs-keyword">if</span> df2.empty:  <span class="hljs-comment"># æ ¡éªŒæ–‡ä»¶æ˜¯å¦ä¸ºç©º </span><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;æ–‡ä»¶å†…å®¹ä¸ºç©º,è¯·æ£€æŸ¥æ˜¯å¦æœ‰æ•°æ®&#x27;</span><br>    <span class="hljs-keyword">try</span>:<br>        start_date_time = df2[column_name[<span class="hljs-number">0</span>]].dt.strftime(<span class="hljs-string">&#x27;%Y-%m-%d&#x27;</span>)<br>        end_date_time = df2[column_name[<span class="hljs-number">1</span>]].dt.strftime(<span class="hljs-string">&#x27;%Y-%m-%d&#x27;</span>)<br>        advertising_mix_name = df2[column_name[<span class="hljs-number">2</span>]]<br>        currency = df2[column_name[<span class="hljs-number">3</span>]]<br>        name_of_advertising_campaign = df2[column_name[<span class="hljs-number">4</span>]]<br>        name_of_advertising_group = df2[column_name[<span class="hljs-number">5</span>]]<br>        launch = df2[column_name[<span class="hljs-number">6</span>]]<br>        matching_type = df2[column_name[<span class="hljs-number">7</span>]].replace(<span class="hljs-string">&#x27;-&#x27;</span>, <span class="hljs-string">&quot;Automatic&quot;</span>)<br>        customer_search_terms = df2[column_name[<span class="hljs-number">8</span>]]<br>        display_volume = df2[column_name[<span class="hljs-number">9</span>]]<br>        hits = df2[column_name[<span class="hljs-number">10</span>]]<br>        ctr = <span class="hljs-built_in">round</span>(df2[column_name[<span class="hljs-number">11</span>]] * <span class="hljs-number">100</span>, <span class="hljs-number">2</span>)<br>        cpc = <span class="hljs-built_in">round</span>(df2[column_name[<span class="hljs-number">12</span>]], <span class="hljs-number">2</span>)<br>        spend = df2[column_name[<span class="hljs-number">13</span>]]<br>        total_sales = df2[column_name[<span class="hljs-number">14</span>]]<br>        acos = <span class="hljs-built_in">round</span>(df2[column_name[<span class="hljs-number">15</span>]] * <span class="hljs-number">100</span>, <span class="hljs-number">2</span>)<br>        roas = <span class="hljs-built_in">round</span>(df2[column_name[<span class="hljs-number">16</span>]], <span class="hljs-number">2</span>)<br>        total_orders_in_seven_days = df2[column_name[<span class="hljs-number">17</span>]]<br>        total_sales2 = df2[column_name[<span class="hljs-number">18</span>]]<br>        seven_days_conversion_rate = <span class="hljs-built_in">round</span>(df2[column_name[<span class="hljs-number">19</span>]] * <span class="hljs-number">100</span>, <span class="hljs-number">2</span>)<br>        advertising_sku_sales = df2[column_name[<span class="hljs-number">20</span>]]<br>        other_sku_sales = df2[column_name[<span class="hljs-number">21</span>]]<br>        advertising_sku_sales2 = df2[column_name[<span class="hljs-number">22</span>]]<br>        other_sku_sales2 = df2[column_name[<span class="hljs-number">23</span>]]<br>    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>        print(e)<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;æ–‡ä»¶ä¸Šä¼ å¤±è´¥...è”ç³»å®¢æœè§£å†³&#x27;</span><br><br><br>file_path = <span class="hljs-string">&#x27;./ceshi.xlsx&#x27;</span><br>f = get_excel(file_path)<br>print(f)<br><br></code></pre></div></td></tr></table></figure><h2 id="å…¶ä»–æ“ä½œ-æŸè¡Œ-æŸåˆ—æ•°æ®"><a href="#å…¶ä»–æ“ä½œ-æŸè¡Œ-æŸåˆ—æ•°æ®" class="headerlink" title="å…¶ä»–æ“ä½œ/æŸè¡Œ/æŸåˆ—æ•°æ®"></a><font color="#008080">å…¶ä»–æ“ä½œ/æŸè¡Œ/æŸåˆ—æ•°æ®</font></h2><p><strong>è·å–æŸä¸€è¡Œæˆ–è€…æŸå‡ è¡Œçš„æ•°æ® æ•´è¡Œæ•°æ®</strong></p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment"># è·å–ä¸€è¡Œæ•°æ®</span><br>l1 = df2[<span class="hljs-number">0</span>:<span class="hljs-number">1</span>]<br><span class="hljs-comment"># è·å–å¤šè¡Œæ•°æ® ä¾‹å¦‚è·å–å…¨éƒ¨</span><br>l2 = df2[<span class="hljs-number">0</span>:<span class="hljs-built_in">len</span>(df2)]<br></code></pre></div></td></tr></table></figure><p><strong>æ“ä½œç¤ºä¾‹</strong></p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">################ Rudy ################</span><br><span class="hljs-string">############# 2021-01-22 #############</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br><br><br><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_excel</span>(<span class="hljs-params">path_load</span>):</span><br>    df1 = pd.read_excel(path_load)<br>    df2 = df1.dropna(how=<span class="hljs-string">&#x27;all&#x27;</span>)  <span class="hljs-comment"># æ•°æ®æ¸…æ´—ï¼Œä¸ºå®Œæˆéœ€æ±‚åˆ å»ä¸å¿…è¦çš„è¡Œ</span><br>    df2 = df2.replace(<span class="hljs-string">&#x27;-&#x27;</span>, <span class="hljs-number">0</span>)  <span class="hljs-comment"># æŠŠâ€˜-â€™çš„æ›¿æ¢æˆ0ä¾¿äºåé¢è®¡ç®—</span><br>    df2 = df2.fillna(<span class="hljs-number">0</span>)  <span class="hljs-comment"># æ•°æ®æ¸…æ´—ï¼Œç¼ºå¤±å€¼ç”¨0è¡¥è¶³</span><br>    df2 = df2.reset_index(drop=<span class="hljs-literal">True</span>)  <span class="hljs-comment"># é‡è®¾è¡Œç´¢å¼•</span><br>    column_name = [i <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> df1]  <span class="hljs-comment"># è·å–æ‰€æœ‰çš„åˆ—å</span><br>    <span class="hljs-keyword">if</span> df2.empty:  <span class="hljs-comment"># æ ¡éªŒæ–‡ä»¶æ˜¯å¦ä¸ºç©º </span><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;æ–‡ä»¶å†…å®¹ä¸ºç©º,è¯·æ£€æŸ¥æ˜¯å¦æœ‰æ•°æ®&#x27;</span><br>    <span class="hljs-comment"># è·å–ä¸€è¡Œæ•°æ®</span><br>    l1 = df2[<span class="hljs-number">0</span>:<span class="hljs-number">1</span>]<br>    <span class="hljs-comment"># è·å–å¤šè¡Œæ•°æ® ä¾‹å¦‚è·å–å…¨éƒ¨</span><br>    l2 = df2[<span class="hljs-number">0</span>:<span class="hljs-built_in">len</span>(df2)]<br><br><br>file_path = <span class="hljs-string">&#x27;./ceshi.xlsx&#x27;</span><br>f = get_excel(file_path)<br><br><span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">print(l1)</span><br><span class="hljs-string">  Start Date  ... 7 Day Other SKU Sales ($)</span><br><span class="hljs-string">0 2021-01-06  ...                         0</span><br><span class="hljs-string"></span><br><span class="hljs-string">[1 rows x 24 columns]</span><br><span class="hljs-string"></span><br><span class="hljs-string">print(l2)</span><br><span class="hljs-string">   Start Date  ... 7 Day Other SKU Sales ($)</span><br><span class="hljs-string">0  2021-01-06  ...                         0</span><br><span class="hljs-string">1  2021-01-06  ...                         0</span><br><span class="hljs-string">2  2021-01-05  ...                         0</span><br><span class="hljs-string">3  2021-01-05  ...                         0</span><br><span class="hljs-string">..................å‰©ä¸‹çš„å¿½ç•¥..................</span><br><span class="hljs-string"></span><br><span class="hljs-string">[31 rows x 24 columns]</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br><br></code></pre></div></td></tr></table></figure><p><strong>ä½¿ç”¨locè·å–æ•°æ®,locå¯æ¥å—ä¸¤ä¸ªå‚æ•°/ä¸€ä¸ªä¸ºè¡Œä¸‹æ ‡/ä¸€ä¸ªä¸ºåˆ—ä¸‹æ ‡</strong></p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment"># è·å–æŸä¸€è¡Œæ•°æ® å¦‚æœå·²çŸ¥è¡Œ å¯ä»¥é€‰æ‹©è¿™ç§æ–¹å¼</span><br>l1 = df2.loc[<span class="hljs-number">0</span>]<br><span class="hljs-comment"># è·å–ç¬¬å‡ è¡Œ ä¸ ç¬¬å‡ è¡Œçš„æ•°æ® æ³¨æ„æ˜¯ ä¸ ä»£è¡¨è·å–çš„ç¬¬5ä¸ç¬¬10è¡Œæ•°æ®</span><br>l2 = df2.loc[[<span class="hljs-number">5</span>, <span class="hljs-number">10</span>]]<br><span class="hljs-comment"># é€šè¿‡åˆ‡ç‰‡æ–¹å¼è·å–å¤šè¡Œæ•°æ®</span><br>l3 = df2.loc[<span class="hljs-number">0</span>:<span class="hljs-number">10</span>]<br></code></pre></div></td></tr></table></figure><p><strong>æ“ä½œç¤ºä¾‹:</strong></p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">################ Rudy ################</span><br><span class="hljs-string">############# 2021-01-22 #############</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br><br><br><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_excel</span>(<span class="hljs-params">path_load</span>):</span><br>    df1 = pd.read_excel(path_load)<br>    df2 = df1.dropna(how=<span class="hljs-string">&#x27;all&#x27;</span>)  <span class="hljs-comment"># æ•°æ®æ¸…æ´—ï¼Œä¸ºå®Œæˆéœ€æ±‚åˆ å»ä¸å¿…è¦çš„è¡Œ</span><br>    df2 = df2.replace(<span class="hljs-string">&#x27;-&#x27;</span>, <span class="hljs-number">0</span>)  <span class="hljs-comment"># æŠŠâ€˜-â€™çš„æ›¿æ¢æˆ0ä¾¿äºåé¢è®¡ç®—</span><br>    df2 = df2.fillna(<span class="hljs-number">0</span>)  <span class="hljs-comment"># æ•°æ®æ¸…æ´—ï¼Œç¼ºå¤±å€¼ç”¨0è¡¥è¶³</span><br>    df2 = df2.reset_index(drop=<span class="hljs-literal">True</span>)  <span class="hljs-comment"># é‡è®¾è¡Œç´¢å¼•</span><br>    column_name = [i <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> df1]  <span class="hljs-comment"># è·å–æ‰€æœ‰çš„åˆ—å</span><br>    <span class="hljs-keyword">if</span> df2.empty:  <span class="hljs-comment"># æ ¡éªŒæ–‡ä»¶æ˜¯å¦ä¸ºç©º </span><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;æ–‡ä»¶å†…å®¹ä¸ºç©º,è¯·æ£€æŸ¥æ˜¯å¦æœ‰æ•°æ®&#x27;</span><br>    <span class="hljs-comment"># è·å–æŸä¸€è¡Œæ•°æ® å¦‚æœå·²çŸ¥è¡Œ å¯ä»¥é€‰æ‹©è¿™ç§æ–¹å¼</span><br>    l1 = df2.loc[<span class="hljs-number">0</span>]<br>    <span class="hljs-comment"># è·å–ç¬¬å‡ è¡Œ ä¸ ç¬¬å‡ è¡Œçš„æ•°æ® æ³¨æ„æ˜¯ ä¸ ä»£è¡¨è·å–çš„ç¬¬5ä¸ç¬¬10è¡Œæ•°æ®</span><br>    l2 = df2.loc[[<span class="hljs-number">5</span>, <span class="hljs-number">10</span>]]<br>    <span class="hljs-comment"># é€šè¿‡åˆ‡ç‰‡æ–¹å¼è·å–å¤šè¡Œæ•°æ®</span><br>    l3 = df2.loc[<span class="hljs-number">0</span>:<span class="hljs-number">10</span>]<br><br><br>file_path = <span class="hljs-string">&#x27;./ceshi.xlsx&#x27;</span><br>f = get_excel(file_path)<br><br><span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">print(l1)</span><br><span class="hljs-string">Start Date                            2021-01-06 00:00:00</span><br><span class="hljs-string">End Date                              2021-01-06 00:00:00</span><br><span class="hljs-string">Portfolio name                                Not grouped</span><br><span class="hljs-string">....å¿½ç•¥ä¸­é—´éƒ¨åˆ†....</span><br><span class="hljs-string">7 Day Advertised SKU Units (#)                          0</span><br><span class="hljs-string">7 Day Other SKU Units (#)                               0</span><br><span class="hljs-string">7 Day Advertised SKU Sales ($)                          0</span><br><span class="hljs-string">7 Day Other SKU Sales ($)                               0</span><br><span class="hljs-string">Name: 0, dtype: object</span><br><span class="hljs-string"></span><br><span class="hljs-string">print(l2)</span><br><span class="hljs-string">   Start Date  ... 7 Day Other SKU Sales ($)</span><br><span class="hljs-string">5  2021-01-06  ...                         0</span><br><span class="hljs-string">10 2021-01-09  ...                         0</span><br><span class="hljs-string"></span><br><span class="hljs-string">[2 rows x 24 columns]</span><br><span class="hljs-string"></span><br><span class="hljs-string">print(l3)</span><br><span class="hljs-string">...</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br><br></code></pre></div></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Python</category>
      
      <category>æŠ€æœ¯æ‚è°ˆ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Python AWS æ”¶å½•ä¸æ’å</title>
    <link href="/2021/04/07/%E6%94%B6%E5%BD%95%E4%B8%8E%E6%8E%92%E5%90%8D/"/>
    <url>/2021/04/07/%E6%94%B6%E5%BD%95%E4%B8%8E%E6%8E%92%E5%90%8D/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h2 id="Python-requests-æŠ“å–AWSæ”¶å½•æ’å"><a href="#Python-requests-æŠ“å–AWSæ”¶å½•æ’å" class="headerlink" title="Python requests æŠ“å–AWSæ”¶å½•æ’å"></a><font color="#5e45a5">Python requests æŠ“å–AWSæ”¶å½•æ’å</font></h2><p><font color="gree">å‰æ–‡æè¦</font></p><figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">æ ¹æ®python requests ä»¥åŠ xpathè¯­æ³• æ­£åˆ™åŒ¹é…è¯­æ³•<br>è·å–é¡µé¢è·¯ç”± è§£æé¡µé¢ä¸­çš„ASIN ä»¥åŠ ç¬¬å‡ é¡µçš„æ’åæƒ…å†µ<br></code></pre></div></td></tr></table></figure><p><font color="gree">æµ‹è¯•ç”¨ è·¯ç”±é“¾æ¥</font></p><ul><li><p><a href="https://www.amazon.com/s?k=iphone&ref=nb_sb_noss">ç¾å›½ç«™ æœç´¢è¯ä¸º iphone</a></p></li><li><p><a href="https://www.amazon.cn/s?k=iphone&ref=nb_sb_noss">ä¸­å›½ç«™ æœç´¢è¯ä¸º iphone</a></p></li></ul><h2 id="æŸ¥çœ‹-è·å–ä¿¡æ¯"><a href="#æŸ¥çœ‹-è·å–ä¿¡æ¯" class="headerlink" title="æŸ¥çœ‹(è·å–ä¿¡æ¯)"></a><font color="#5e45a5">æŸ¥çœ‹(è·å–ä¿¡æ¯)</font></h2><p><font color="gree">ä»¥ç¾å›½ç«™ æœç´¢ iphoneæ¥æŸ¥çœ‹</font></p><p><a href="https://www.amazon.com/s?k=iphone&amp;ref=nb_sb_noss">https://www.amazon.com/s?k=iphone&amp;ref=nb_sb_noss</a></p><p><font color="gree">å¸¦Sponsoredçš„å¹¿å‘Šæ’å</font></p><p><img src="https://ae01.alicdn.com/kf/U8efc8490c5e64e21a390f77a73db45a9q.jpg" alt="å¹¿å‘Šæ’å"></p><p><a href="https://www.amazon.com/Mkeke-iPhone-Pro-Screen-Protector/dp/B08CTYNSX7/ref=sr_1_1_sspa?dchild=1&keywords=iphone&qid=1617787283&sr=8-1-spons&psc=1&smid=A3U8Y53UO7C38F&spLa=ZW5jcnlwdGVkUXVhbGlmaWVyPUEyQVgyWEYxNjMwTTE3JmVuY3J5cHRlZElkPUEwNjAwNTk4MzhWN0dERVlYM1MzNiZlbmNyeXB0ZWRBZElkPUEwODgwMTMwMjhDMkFWNDZZRUVWRCZ3aWRnZXROYW1lPXNwX2F0ZiZhY3Rpb249Y2xpY2tSZWRpcmVjdCZkb05vdExvZ0NsaWNrPXRydWU=">ç‚¹å‡»è·³è½¬ æŸ¥çœ‹è·¯ç”±ä¿¡æ¯</a></p><figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html">https://www.amazon.com/<br>Mkeke-iPhone-Pro-Screen-Protector/<br>dp/B08CTYNSX7/ref=sr_1_1_sspa?<br>dchild=1&amp;keywords=iphone&amp;<br>qid=1617787283&amp;sr=8-1-spons&amp;<br>psc=1&amp;<br>smid=A3U8Y53UO7C38F&amp;<br>spLa=ZW5jcnlwdGVkUXVhbGlmaWVyPUEyQVgyWEYxNjMwTTE3JmVuY3J5cHRlZElkPUEwNjAwNTk4MzhWN0dERVlYM1MzNiZlbmNyeXB0ZWRBZElkPUEwODgwMTMwMjhDMkFWNDZZRUVWRCZ3aWRnZXROYW1lPXNwX2F0ZiZhY3Rpb249Y2xpY2tSZWRpcmVjdCZkb05vdExvZ0NsaWNrPXRydWU=<br></code></pre></div></td></tr></table></figure><blockquote><p><font color="red">* dp/B08CTYNSX7/ref=sr_1_1_sspa?</font></p></blockquote><p><font color="gree">è‡ªç„¶æ’å</font></p><p><img src="https://ae01.alicdn.com/kf/U0993d39e5cf64c57963425073e78472aO.jpg" alt="è‡ªç„¶æ’å"></p><p><font color="gree">è·¯ç”±è§£æ</font></p><figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html">https://www.amazon.com/Tracfone-Apple-iPhone-Prepaid-Smartphone/dp/B08CL4CCG2/ref=sr_1_3?dchild=1&amp;keywords=iphone&amp;qid=1617787283&amp;sr=8-3<br></code></pre></div></td></tr></table></figure><blockquote><p><font color="red">* /dp/B08CL4CCG2/ref=sr_1_3?</font></p></blockquote><h2 id="ä½¿ç”¨ä»£ç è·å–æ’å"><a href="#ä½¿ç”¨ä»£ç è·å–æ’å" class="headerlink" title="ä½¿ç”¨ä»£ç è·å–æ’å"></a><font color="#5e45a5">ä½¿ç”¨ä»£ç è·å–æ’å</font></h2><p><font color="gree">æ„é€ headers è¯·æ±‚url</font></p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_url</span>(<span class="hljs-params">keyword</span>):</span><br>    headers = &#123;<br>        <span class="hljs-string">&quot;user-agent&quot;</span>: <span class="hljs-string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/88.0.4324.190 Safari/537.36&quot;</span>,<br>        <span class="hljs-string">&quot;authority&quot;</span>: <span class="hljs-string">&quot;www.amazon.com&quot;</span>,<br>        <span class="hljs-string">&quot;accept&quot;</span>: <span class="hljs-string">&quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9&quot;</span>,<br>        <span class="hljs-string">&quot;cookie&quot;</span>: <span class="hljs-string">&quot;session-id=131-1747394-2478939; i18n-prefs=USD; lc-main=en_US; ubid-main=135-8365978-8962108; session-token=xvpETHDUTSSp5nAFXoTx/d40nc8Vgp5Ge4deof1O1ki4bb6KWs+6KD9mPeHQWtJoRrVW9gCzZ3w+iY8HbjdFbcGxkqR1gTeTE7macaab72sZZwxZM/7BDpeqvJj2PFkt5x6j/cbbw6qKIXN0bkzLk+GvTh1JfF/uTids1d48X/Wzmo44DmPdBex1oG0/UfGxU99fv3xwHCG3Tg+WBrHwFPAydLqSykeCjh+DaT4VDGXzzTCpEYNGnqzTPXy6c+Ri; session-id-time=2082787201l; skin=noskin; csm-hit=tb:SZ3FQ85SSJ24FJ8NH5TX+s-JYM350PT95NF3YRKMX7F|1615275047338&amp;t:1615275047338&amp;adb:adblk_yes&quot;</span>,<br>        <span class="hljs-string">&quot;Referer&quot;</span>: <span class="hljs-string">&#x27;www.google.com&#x27;</span><br>    &#125;<br>    url = <span class="hljs-string">&#x27;https://www.amazon.com/s?k=&#123;&#125;&amp;ref=nb_sb_noss&#x27;</span>.<span class="hljs-built_in">format</span>(keyword)  <span class="hljs-comment"># è·å–å…³é”®è¯ æœç´¢é¡µé¢ .com .cn</span><br>    resp = requests.get(url=url, headers=headers)  <span class="hljs-comment"># æ·»åŠ headers å¦åˆ™ä¼šå‡ºç°503</span><br>    <span class="hljs-keyword">return</span> resp.content.decode(<span class="hljs-string">&#x27;utf8&#x27;</span>)  <span class="hljs-comment"># è¿”å›é¡µé¢ è§£ç å</span><br></code></pre></div></td></tr></table></figure><p><font color="gree">æ„é€ xpath è·å–é“¾æ¥å€¼</font></p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    keyword = <span class="hljs-string">&quot;iphone&quot;</span>  <span class="hljs-comment"># å…³é”®è¯</span><br>    page = get_url(keyword)  <span class="hljs-comment"># è°ƒç”¨è§£æurlçš„å‡½æ•°</span><br><br>    xpath_grammar = [<span class="hljs-string">&#x27;//h2/a/@href&#x27;</span>, <span class="hljs-string">&#x27;//h2/a/span/text()&#x27;</span>]  <span class="hljs-comment"># xpath_è¯­æ³•</span><br>    get_info(page, xpath_grammar)  <span class="hljs-comment"># è°ƒç”¨è·å–æ•°æ®çš„å‡½æ•°</span><br></code></pre></div></td></tr></table></figure><p><font color="gree">æ„é€ reè·å–asin ä¸ æ’å</font></p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_info</span>(<span class="hljs-params">page, country_mapper</span>):</span><br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    page : ç›®çš„è§£æhtmlé¡µé¢ç»“æ„</span><br><span class="hljs-string">    country_mapper : xpath_è¯­æ³•</span><br><span class="hljs-string">    :return:</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    html = etree.HTML(page)<br>    url_list = html.xpath(country_mapper[<span class="hljs-number">0</span>])  <span class="hljs-comment"># aæ ‡ç­¾çš„hrefå€¼</span><br>    span_list = html.xpath(country_mapper[<span class="hljs-number">1</span>])  <span class="hljs-comment"># spanæ ‡ç­¾çš„å€¼ æš‚æ— ç”¨åˆ°</span><br>    <span class="hljs-comment"># æ­£åˆ™è¯­æ³• 1. åŒ¹é…ref   2. åŒ¹é… %2F...</span><br>    re_grammar = [<span class="hljs-string">r&#x27;[\w]&#123;10&#125;/ref=\w+&#x27;</span>, <span class="hljs-string">r&#x27;[\w]&#123;10&#125;%2Fref%3D\w+&#x27;</span>]<br>    get_data(url_list, re_grammar)<br></code></pre></div></td></tr></table></figure><p><font color="gree">è·å–å¹¿å‘Šæ’å/è·å–è‡ªç„¶æ’å</font></p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_data</span>(<span class="hljs-params">url_list, re_grammar</span>):</span><br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    :param url_list: æ•°æ®åˆ—è¡¨</span><br><span class="hljs-string">    :param re_grammar: æ­£åˆ™è¡¨è¾¾å¼</span><br><span class="hljs-string">    :return:</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-comment"># print(url_list)</span><br>    pattern = re.<span class="hljs-built_in">compile</span>(re_grammar[<span class="hljs-number">0</span>])<br>    <span class="hljs-keyword">for</span> text <span class="hljs-keyword">in</span> url_list:  <span class="hljs-comment"># è·å–ç¬¬ä¸€ç§æ–¹å¼</span><br>        get_format_info(pattern, text, <span class="hljs-number">1</span>)<br><br>    pattern2 = re.<span class="hljs-built_in">compile</span>(re_grammar[<span class="hljs-number">1</span>])<br>    <span class="hljs-keyword">for</span> text2 <span class="hljs-keyword">in</span> url_list:  <span class="hljs-comment"># è·å–ç¬¬äºŒç§æ–¹å¼</span><br>        get_format_info(pattern2, text2, <span class="hljs-number">2</span>)<br></code></pre></div></td></tr></table></figure><p><font color="gree">æœ€ç»ˆçš„æ ¼å¼</font></p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_format_info</span>(<span class="hljs-params">pattern, text, to_num</span>):</span><br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    è·å–æœ€ç»ˆæ•°æ® æ ¼å¼çš„æ‰“å°</span><br><span class="hljs-string">    :param pattern: æ­£åˆ™è¯­æ³• 1 r&#x27;[\w]&#123;10&#125;/ref=\w+&#x27;</span><br><span class="hljs-string">    :param pattern: æ­£åˆ™è¯­æ³• 2 r&#x27;[\w]&#123;10&#125;%2Fref%3D\w+&#x27;</span><br><span class="hljs-string">    :param text: å­—ç¬¦ä¸² è¯­å¥</span><br><span class="hljs-string">    :param to_num: ç¡®è®¤è·å–çš„æ˜¯å“ªä¸ª</span><br><span class="hljs-string">    :return:</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    info = pattern.search(text)<br>    <span class="hljs-keyword">if</span> info <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<br>        <span class="hljs-keyword">if</span> to_num == <span class="hljs-number">1</span>:<br>            split_info = <span class="hljs-built_in">str</span>(info.group(<span class="hljs-number">0</span>)).split(<span class="hljs-string">&#x27;/&#x27;</span>)  <span class="hljs-comment"># ä»¥ / åˆ‡å‰²</span><br>        <span class="hljs-keyword">else</span>:<br>            split_info = <span class="hljs-built_in">str</span>(info.group(<span class="hljs-number">0</span>)).split(<span class="hljs-string">&#x27;%2Fref%3D&#x27;</span>)  <span class="hljs-comment"># ä»¥ %2Fref%3D åˆ‡å‰²</span><br>        asin_ranking_dict = &#123;split_info[<span class="hljs-number">0</span>]: split_info[<span class="hljs-number">1</span>]&#125;  <span class="hljs-comment"># æ ¼å¼ &#123;&quot;B085BGNQXR&quot;:&quot;ref=sr_1_18&quot;&#125;</span><br>        asin = get_asin()  <span class="hljs-comment"># è°ƒç”¨ è·å–asinå‡½æ•°</span><br>        <span class="hljs-keyword">for</span> a <span class="hljs-keyword">in</span> asin:<br>            <span class="hljs-keyword">for</span> k, v <span class="hljs-keyword">in</span> asin_ranking_dict.items():<br>                <span class="hljs-keyword">if</span> a == k:<br>                    print(k + <span class="hljs-string">&quot; - &quot;</span> + v)  <span class="hljs-comment"># ç»“æœè¾“å‡º</span><br></code></pre></div></td></tr></table></figure><p><font color="gree">asinçš„å¯¹æ¯”æ’å</font></p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_asin</span>():</span><br>    asin = [<br>        <span class="hljs-string">&#x27;B08CTYNSX7&#x27;</span>, <span class="hljs-string">&#x27;B08D3VH7G8&#x27;</span>, <span class="hljs-string">&#x27;B084GS5W9T&#x27;</span>, <span class="hljs-string">&#x27;B08CL4CCG2&#x27;</span>, <span class="hljs-string">&#x27;B07VSWLY55&#x27;</span>,<br>        <span class="hljs-string">&#x27;B07VSSS3ZN&#x27;</span>, <span class="hljs-string">&#x27;B08L5NDJ8H&#x27;</span>, <span class="hljs-string">&#x27;B08L5MJTCP&#x27;</span>, <span class="hljs-string">&#x27;B084GS884N&#x27;</span>, <span class="hljs-string">&#x27;B0875YBSLD&#x27;</span><br>    ]<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    # æ‰“å°ç»“æœ</span><br><span class="hljs-string">    B084GS5W9T - ref=sr_1_3</span><br><span class="hljs-string">    B08CL4CCG2 - ref=sr_1_4</span><br><span class="hljs-string">    B07VSWLY55 - ref=sr_1_5</span><br><span class="hljs-string">    B07VSSS3ZN - ref=sr_1_6</span><br><span class="hljs-string">    B08L5NDJ8H - ref=sr_1_7</span><br><span class="hljs-string">    B08L5MJTCP - ref=sr_1_8</span><br><span class="hljs-string">    B084GS884N - ref=sr_1_9</span><br><span class="hljs-string">    B0875YBSLD - ref=sr_1_10</span><br><span class="hljs-string">    B08CTYNSX7 - sr_1_1_sspa</span><br><span class="hljs-string">    B08D3VH7G8 - sr_1_2_sspa</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-keyword">return</span> asin<br></code></pre></div></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Python</category>
      
      <category>æŠ€æœ¯æ‚è°ˆ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>æŠ€æœ¯æ‚è°ˆ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Django Orm å¯¼å‡ºMySQLæ•°æ®åº“æ•°æ®åˆ°Excel</title>
    <link href="/2021/04/03/django%E5%AF%BC%E5%87%BAexcel/"/>
    <url>/2021/04/03/django%E5%AF%BC%E5%87%BAexcel/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h2 id="Django-MySQLæ•°æ®å¯¼å‡ºexcel"><a href="#Django-MySQLæ•°æ®å¯¼å‡ºexcel" class="headerlink" title="Django MySQLæ•°æ®å¯¼å‡ºexcel"></a><font color=" DeepSkyBlue ">Django MySQLæ•°æ®å¯¼å‡ºexcel</font></h2><p><code>å‰æƒ…æè¦</code></p><figure class="highlight powershell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs powershell">* æœ¬ç« å°†ä½¿ç”¨ <br>django <span class="hljs-number">1.11</span>.<span class="hljs-number">11</span> ç‰ˆæœ¬<br>MySQL  <span class="hljs-number">5.7</span> ç‰ˆæœ¬<br>xlrd   <span class="hljs-number">1.2</span>.<span class="hljs-number">0</span> ç‰ˆæœ¬<br>xlwt   <span class="hljs-number">1.3</span>.<span class="hljs-number">0</span> ç‰ˆæœ¬<br></code></pre></div></td></tr></table></figure><p><font color="gree">å®‰è£…ä¸Šè¿°ä¾èµ–</font></p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">* å®‰è£…æ–¹å¼ <br>* pip é•œåƒæº https://pypi.douban.com/simple/<br>pip install django==1.11.11 -i https://pypi.douban.com/simple/<br>pip install pymysql -i https://pypi.douban.com/simple/<br>pip install xlrd -i https://pypi.douban.com/simple/<br>pip install xlwt -i https://pypi.douban.com/simple/<br></code></pre></div></td></tr></table></figure><h2 id="å‰ç«¯js-html"><a href="#å‰ç«¯js-html" class="headerlink" title="å‰ç«¯js + html"></a><font color=" DeepSkyBlue ">å‰ç«¯js + html</font></h2><ol><li>å¼•å…¥jsæ–‡ä»¶ jqæ–‡ä»¶</li></ol><figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-comment">&lt;!-- å¼•å…¥å¤–éƒ¨ ç½‘ç»œä¸Šçš„js --&gt;</span><br>&lt;script<br>    src=&quot;https://code.jquery.com/jquery-3.3.1.min.js&quot;<br>    integrity=&quot;sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=&quot;<br>    crossorigin=&quot;anonymous&quot;&gt;<br><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></div></td></tr></table></figure><ol start="2"><li>jså‡½æ•°</li></ol><figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js">$(<span class="hljs-string">&quot;#export_excel&quot;</span>).click(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-keyword">var</span> csrf = $(<span class="hljs-string">&#x27;input[name=&quot;csrfmiddlewaretoken&quot;]&#x27;</span>).val();<br>        <span class="hljs-keyword">const</span> req = <span class="hljs-keyword">new</span> XMLHttpRequest();<br>        req.open(<span class="hljs-string">&#x27;POST&#x27;</span>, <span class="hljs-string">&#x27;/url/your url/&#x27;</span>, <span class="hljs-literal">true</span>);<br>        req.responseType = <span class="hljs-string">&#x27;blob&#x27;</span>;<br>        req.setRequestHeader(<span class="hljs-string">&#x27;Content-Type&#x27;</span>, <span class="hljs-string">&#x27;application/x-www-form-urlencoded&#x27;</span>); <span class="hljs-comment">//è®¾ç½®è¯·æ±‚å¤´</span><br>        req.send(<span class="hljs-string">&#x27;f_name=&#x27;</span> + $(<span class="hljs-string">&#x27;#f_name&#x27;</span>).val() + <span class="hljs-string">&quot;&amp;&amp;csrfmiddlewaretoken=&quot;</span> + csrf); <span class="hljs-comment">//ä¿å­˜çš„æ–‡ä»¶åç§°</span><br>        req.onload = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;<br>            <span class="hljs-keyword">const</span> data = req.response;<br>            <span class="hljs-keyword">const</span> a = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">&#x27;a&#x27;</span>);<br>            <span class="hljs-keyword">const</span> blob = <span class="hljs-keyword">new</span> Blob([data]);<br>            <span class="hljs-keyword">const</span> blobUrl = <span class="hljs-built_in">window</span>.URL.createObjectURL(blob);<br>            download(blobUrl);<br>        &#125;;<br><br>    &#125;);<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">download</span>(<span class="hljs-params">blobUrl</span>) </span>&#123;<br>        <span class="hljs-keyword">var</span> f_name = $(<span class="hljs-string">&quot;input[name=&#x27;f_name&#x27;]&quot;</span>).val();<br>        <span class="hljs-keyword">const</span> a = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">&#x27;a&#x27;</span>);<br>        a.style.display = <span class="hljs-string">&#x27;none&#x27;</span>;<br>        a.download = f_name + <span class="hljs-string">&quot;.xls&quot;</span>;<br>        a.href = blobUrl;<br>        a.click();<br>        <span class="hljs-built_in">document</span>.body.removeChild(a);<br>    &#125;<br></code></pre></div></td></tr></table></figure><ol start="3"><li>html  å¯¼å‡ºæŒ‰é’®</li></ol><figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;export_excel&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;button&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;layui-btn&quot;</span>&gt;</span>å¯¼å‡ºexcel<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br></code></pre></div></td></tr></table></figure><h2 id="åç«¯-Django-viewsè§†å›¾å‡½æ•°"><a href="#åç«¯-Django-viewsè§†å›¾å‡½æ•°" class="headerlink" title="åç«¯ Django viewsè§†å›¾å‡½æ•°"></a><font color=" DeepSkyBlue ">åç«¯ Django viewsè§†å›¾å‡½æ•°</font></h2><ol><li>urls.py æ–°å¢å¯¼å‡ºexcelçš„è·¯ç”±</li></ol><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">url(<span class="hljs-string">r&#x27;^url/your_url/$&#x27;</span>, export_excel, name=<span class="hljs-string">&#x27;export_excel&#x27;</span>),  <span class="hljs-comment"># å¯¼å‡ºexcel</span><br></code></pre></div></td></tr></table></figure><ol start="2"><li>views.py å¯¼å‡ºexcelçš„ä»£ç </li></ol><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">export_excel</span>(<span class="hljs-params">request</span>):</span><br>    f_name = request.POST.get(<span class="hljs-string">&#x27;f_name&#x27;</span>)<br>    response = HttpResponse(content_type=<span class="hljs-string">&#x27;application/vnd.ms-excel&#x27;</span>)<br>    response[<span class="hljs-string">&#x27;Content-Disposition&#x27;</span>] = <span class="hljs-string">&#x27;attachment;filename=&#x27;</span> + f_name + <span class="hljs-string">&#x27;.xls&#x27;</span><br>    <span class="hljs-string">&quot;&quot;&quot;å¯¼å‡ºexcelè¡¨&quot;&quot;&quot;</span><br>    wb = xlwt.Workbook(encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>)  <span class="hljs-comment"># Create job table</span><br>    ws = wb.add_sheet(<span class="hljs-string">&#x27;Menu&#x27;</span>, cell_overwrite_ok=<span class="hljs-literal">True</span>)  <span class="hljs-comment"># Create WorkSheet</span><br>    row_num = <span class="hljs-number">0</span><br>    font_style = xlwt.XFStyle()<br>    font_style.font.bold = <span class="hljs-literal">True</span>  <span class="hljs-comment"># Binary</span><br>    columns = [<span class="hljs-string">&#x27;å¾®ä¿¡åç§°&#x27;</span>, <span class="hljs-string">&#x27;å§“å&#x27;</span>]  <span class="hljs-comment"># Header if you add an expoeted columns</span><br>    <span class="hljs-keyword">for</span> col_num <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(columns)):  <span class="hljs-comment"># write Header content</span><br>        ws.write(row_num, col_num, columns[col_num], font_style)<br>    <span class="hljs-comment"># Sheet body, remaining rows</span><br>    font_style = xlwt.XFStyle()<br>    <span class="hljs-comment"># DB Data</span><br>    rows = User.objects.<span class="hljs-built_in">all</span>().values_list(<span class="hljs-string">&#x27;usernickname&#x27;</span>, <span class="hljs-string">&#x27;uu_name&#x27;</span>)<br>    <span class="hljs-keyword">for</span> row <span class="hljs-keyword">in</span> rows:<br>        row_num += <span class="hljs-number">1</span><br>        <span class="hljs-comment"># Write line by line in Excel</span><br>        <span class="hljs-keyword">for</span> col_num <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(row)):<br>            ws.write(row_num, col_num, row[col_num], font_style)<br>    wb.save(response)<br>    <span class="hljs-keyword">return</span> response<br></code></pre></div></td></tr></table></figure><blockquote><p><font color="red">response: å°±æ˜¯æ•°æ® è¿”å›åˆ°å‰ç«¯å å¯¼å‡ºåç¼€ä¸º .xls çš„æ–‡ä»¶</font></p></blockquote>]]></content>
    
    
    <categories>
      
      <category>Python</category>
      
      <category>Django</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Django</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Python åˆ—è¡¨å­—å…¸çš„æ’åºæ“ä½œ</title>
    <link href="/2021/04/01/Python%E5%88%97%E8%A1%A8%E5%AD%97%E5%85%B8%E6%93%8D%E4%BD%9C/"/>
    <url>/2021/04/01/Python%E5%88%97%E8%A1%A8%E5%AD%97%E5%85%B8%E6%93%8D%E4%BD%9C/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h2 id="Pythonå¿«é€ŸæŸ¥çœ‹åˆ—è¡¨å†…é‡å¤å…ƒç´ "><a href="#Pythonå¿«é€ŸæŸ¥çœ‹åˆ—è¡¨å†…é‡å¤å…ƒç´ " class="headerlink" title="Â Pythonå¿«é€ŸæŸ¥çœ‹åˆ—è¡¨å†…é‡å¤å…ƒç´ "></a><font color=" DeepSkyBlue ">Â Pythonå¿«é€ŸæŸ¥çœ‹åˆ—è¡¨å†…é‡å¤å…ƒç´ </font></h2><p><code>å‰æƒ…æè¦</code></p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">*åœ¨ä¸€ä¸ªé•¿åˆ—è¡¨å†… æ£€æŸ¥é‡å¤çš„å…ƒç´  å¹¶æ•´åˆæˆå­—å…¸æ ¼å¼<br>*åœ¨è¾“å‡ºçš„æ—¶å€™ ä¿æŒåˆ—è¡¨å†…å­—å…¸å…ƒç´ æ’åº<br>åˆ—è¡¨çš„æ’åº<br>å­—å…¸çš„æ’åº<br>åˆ—è¡¨å†…å­—å…¸çš„æ’åº<br></code></pre></div></td></tr></table></figure><h2 id="åˆ—è¡¨æ’åº-å‡åº-é™åº"><a href="#åˆ—è¡¨æ’åº-å‡åº-é™åº" class="headerlink" title="Â åˆ—è¡¨æ’åº(å‡åº-é™åº)"></a><font color=" DeepSkyBlue ">Â åˆ—è¡¨æ’åº(å‡åº-é™åº)</font></h2><p><font color="gree">æµ‹è¯•ç”¨ä¾‹ ä½¿ç”¨åˆ—è¡¨çš„sort</font></p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_sort</span>(<span class="hljs-params">k_list, screen</span>):</span><br>    <span class="hljs-keyword">if</span> screen == <span class="hljs-number">1</span>:<br>        k_list.sort()<br>        print(<span class="hljs-string">&quot;å‡åºä¹‹åæ•°æ®:&#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(k_list))<br>    <span class="hljs-keyword">elif</span> screen == <span class="hljs-number">2</span>:<br>        k_list.sort(reverse=<span class="hljs-literal">True</span>)<br>        print(<span class="hljs-string">&quot;é™åºä¹‹åæ•°æ®:&#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(k_list))<br>    <span class="hljs-keyword">else</span>:<br>        print(<span class="hljs-string">&#x27;å‚æ•°æœ‰è¯¯&#x27;</span>)<br><br><br>list1 = [<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">5</span>, <span class="hljs-number">7</span>, <span class="hljs-number">9</span>, <span class="hljs-number">8</span>, <span class="hljs-number">6</span>, <span class="hljs-number">4</span>, <span class="hljs-number">2</span>]<br>get_sort(list1, <span class="hljs-number">1</span>)<br><br></code></pre></div></td></tr></table></figure><p><font color="gree">æµ‹è¯•ç”¨ä¾‹ ä½¿ç”¨ sorted</font></p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_sort</span>(<span class="hljs-params">k_list, screen</span>):</span><br>    <span class="hljs-keyword">if</span> screen == <span class="hljs-number">1</span>:<br>        x = <span class="hljs-built_in">sorted</span>(k_list)<br>        print(<span class="hljs-string">&quot;å‡åºä¹‹åæ•°æ®:&#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(x))<br>    <span class="hljs-keyword">elif</span> screen == <span class="hljs-number">2</span>:<br>        x = <span class="hljs-built_in">sorted</span>(k_list, reverse=<span class="hljs-literal">True</span>)<br>        print(<span class="hljs-string">&quot;é™åºä¹‹åæ•°æ®:&#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(x))<br>    <span class="hljs-keyword">else</span>:<br>        print(<span class="hljs-string">&#x27;å‚æ•°æœ‰è¯¯&#x27;</span>)<br><br><br>list1 = [<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">5</span>, <span class="hljs-number">7</span>, <span class="hljs-number">9</span>, <span class="hljs-number">8</span>, <span class="hljs-number">6</span>, <span class="hljs-number">4</span>, <span class="hljs-number">2</span>]<br>get_sort(list1, <span class="hljs-number">2</span>)<br><br></code></pre></div></td></tr></table></figure><h2 id="å­—å…¸æ’åº-å‡åº-é™åº"><a href="#å­—å…¸æ’åº-å‡åº-é™åº" class="headerlink" title="Â å­—å…¸æ’åº(å‡åº-é™åº)"></a><font color=" DeepSkyBlue ">Â å­—å…¸æ’åº(å‡åº-é™åº)</font></h2><p><font color="gree">æµ‹è¯•ç”¨ä¾‹ å­—å…¸æ’åº æ ¹æ®key valueè¿›è¡Œæ’åº</font></p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_sort</span>(<span class="hljs-params">k_list, screen</span>):</span><br>    <span class="hljs-keyword">if</span> screen == <span class="hljs-number">1</span>:<br>        x = <span class="hljs-built_in">sorted</span>(k_list.items(), key=<span class="hljs-keyword">lambda</span> x: x[<span class="hljs-number">0</span>])<br>        print(<span class="hljs-string">&quot;[0]æ ¹æ® key å‡åºä¹‹åæ•°æ®:&#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(x))<br>    <span class="hljs-keyword">elif</span> screen == <span class="hljs-number">2</span>:<br>        x = <span class="hljs-built_in">sorted</span>(k_list.items(), key=<span class="hljs-keyword">lambda</span> x: x[<span class="hljs-number">1</span>], reverse=<span class="hljs-literal">True</span>)<br>        print(<span class="hljs-string">&quot;[1]æ ¹æ® value é™åºä¹‹åæ•°æ®:&#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(x))<br>    <span class="hljs-keyword">else</span>:<br>        print(<span class="hljs-string">&#x27;å‚æ•°æœ‰è¯¯&#x27;</span>)<br><br><br>k_dict = &#123;<span class="hljs-string">&#x27;chicken&#x27;</span>: <span class="hljs-number">3</span>, <span class="hljs-string">&#x27;coup&#x27;</span>: <span class="hljs-number">1</span>, <span class="hljs-string">&#x27;info&#x27;</span>: <span class="hljs-number">2</span>, <span class="hljs-string">&#x27;teok&#x27;</span>: <span class="hljs-number">2</span>, <span class="hljs-string">&#x27;for&#x27;</span>: <span class="hljs-number">1</span>, <span class="hljs-string">&#x27;out&#x27;</span>: <span class="hljs-number">1</span>&#125;<br>get_sort(k_dict, <span class="hljs-number">2</span>)<br><br></code></pre></div></td></tr></table></figure><h2 id="åˆ—è¡¨é‡Œé¢åŒ…å«å­—å…¸çš„-æ’åº-å‡åº-é™åº"><a href="#åˆ—è¡¨é‡Œé¢åŒ…å«å­—å…¸çš„-æ’åº-å‡åº-é™åº" class="headerlink" title="Â åˆ—è¡¨é‡Œé¢åŒ…å«å­—å…¸çš„ æ’åº(å‡åº-é™åº)"></a><font color=" DeepSkyBlue ">Â åˆ—è¡¨é‡Œé¢åŒ…å«å­—å…¸çš„ æ’åº(å‡åº-é™åº)</font></h2><p><font color="gree">æµ‹è¯•ç”¨ä¾‹ å­—å…¸æ’åº æ ¹æ®key valueè¿›è¡Œæ’åº</font></p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> re<br><span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> Counter<br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_preposition_isdigit</span>(<span class="hljs-params">k_dict</span>):</span><br>    preposition = [<span class="hljs-string">&quot;of&quot;</span>, <span class="hljs-string">&quot;with&quot;</span>, <span class="hljs-string">&quot;at&quot;</span>, <span class="hljs-string">&quot;from&quot;</span>, <span class="hljs-string">&quot;into&quot;</span>, <span class="hljs-string">&quot;during&quot;</span>, <span class="hljs-string">&quot;including&quot;</span>, <span class="hljs-string">&quot;until&quot;</span>, <span class="hljs-string">&quot;against&quot;</span>, <span class="hljs-string">&quot;among&quot;</span>,<br>                   <span class="hljs-string">&quot;throughout&quot;</span>, <span class="hljs-string">&quot;despite&quot;</span>, <span class="hljs-string">&quot;towards&quot;</span>, <span class="hljs-string">&quot;upon&quot;</span>, <span class="hljs-string">&quot;concerning&quot;</span>, <span class="hljs-string">&quot;to&quot;</span>, <span class="hljs-string">&quot;in&quot;</span>, <span class="hljs-string">&quot;for&quot;</span>, <span class="hljs-string">&quot;on&quot;</span>, <span class="hljs-string">&quot;by&quot;</span>,<br>                   <span class="hljs-string">&quot;about&quot;</span>, <span class="hljs-string">&quot;like&quot;</span>, <span class="hljs-string">&quot;through&quot;</span>, <span class="hljs-string">&quot;over&quot;</span>, <span class="hljs-string">&quot;before&quot;</span>, <span class="hljs-string">&quot;between&quot;</span>, <span class="hljs-string">&quot;after&quot;</span>, <span class="hljs-string">&quot;since&quot;</span>, <span class="hljs-string">&quot;without&quot;</span>,<br>                   <span class="hljs-string">&quot;under&quot;</span>, <span class="hljs-string">&quot;within&quot;</span>, <span class="hljs-string">&quot;along&quot;</span>, <span class="hljs-string">&quot;following&quot;</span>, <span class="hljs-string">&quot;across&quot;</span>, <span class="hljs-string">&quot;behind&quot;</span>, <span class="hljs-string">&quot;beyond&quot;</span>, <span class="hljs-string">&quot;except&quot;</span>, <span class="hljs-string">&quot;but&quot;</span>, <span class="hljs-string">&quot;is&quot;</span>,<br>                   <span class="hljs-string">&quot;up&quot;</span>, <span class="hljs-string">&quot;out&quot;</span>, <span class="hljs-string">&quot;around&quot;</span>, <span class="hljs-string">&quot;down&quot;</span>, <span class="hljs-string">&quot;off&quot;</span>, <span class="hljs-string">&quot;above&quot;</span>, <span class="hljs-string">&quot;near&quot;</span>, <span class="hljs-string">&quot;the&quot;</span>, <span class="hljs-string">&quot;and&quot;</span>, <span class="hljs-string">&quot;that&quot;</span>, <span class="hljs-string">&quot;this&quot;</span>, <span class="hljs-string">&quot;if&quot;</span>, <span class="hljs-string">&quot;in&quot;</span>,<br>                   <span class="hljs-string">&quot;those&quot;</span>, <span class="hljs-string">&quot;these&quot;</span>, <span class="hljs-string">&quot;all&quot;</span>, <span class="hljs-string">&quot;you&quot;</span>, <span class="hljs-string">&quot;me&quot;</span>, <span class="hljs-string">&quot;your&quot;</span>, <span class="hljs-string">&quot;my&quot;</span>, <span class="hljs-string">&quot;he&quot;</span>, <span class="hljs-string">&quot;his&quot;</span>, <span class="hljs-string">&quot;her&quot;</span>, <span class="hljs-string">&quot;she&quot;</span>, <span class="hljs-string">&quot;only&quot;</span>, <span class="hljs-string">&#x27;or&#x27;</span>, <span class="hljs-string">&#x27;it&#x27;</span>]<br>    l_list = []<br>    <span class="hljs-keyword">for</span> k, v <span class="hljs-keyword">in</span> <span class="hljs-built_in">list</span>(k_dict.items()):<br>        affirm_dict = &#123;&#125;<br>        <span class="hljs-keyword">if</span> k <span class="hljs-keyword">in</span> preposition <span class="hljs-keyword">or</span> k.isdigit() <span class="hljs-keyword">or</span> re.match(<span class="hljs-string">r&#x27;^[a-zA-Z]?$&#x27;</span>, k) <span class="hljs-keyword">or</span> <span class="hljs-keyword">not</span> k.isalpha():<br>            <span class="hljs-keyword">del</span> k_dict[k]<br>        <span class="hljs-keyword">else</span>:<br>            affirm_dict[<span class="hljs-string">&#x27;word&#x27;</span>] = k<br>            affirm_dict[<span class="hljs-string">&#x27;root&#x27;</span>] = v<br>            l_list.append(affirm_dict)<br>    <span class="hljs-keyword">return</span> l_list<br><br><br>k_list = [<span class="hljs-string">&#x27;chicken&#x27;</span>, <span class="hljs-string">&#x27;coup&#x27;</span>, <span class="hljs-string">&#x27;chicken&#x27;</span>, <span class="hljs-string">&#x27;info&#x27;</span>, <span class="hljs-string">&#x27;chicken&#x27;</span>, <span class="hljs-string">&#x27;teok&#x27;</span>, <span class="hljs-string">&#x27;info&#x27;</span>, <span class="hljs-string">&#x27;teok&#x27;</span>, <span class="hljs-string">&#x27;for&#x27;</span>, <span class="hljs-string">&#x27;out&#x27;</span>]<br><br>info = get_preposition_isdigit(<span class="hljs-built_in">dict</span>(Counter(k_list)))<br>data = <span class="hljs-built_in">sorted</span>(info, key=<span class="hljs-keyword">lambda</span> x: x[<span class="hljs-string">&#x27;root&#x27;</span>], reverse=<span class="hljs-literal">True</span>)<br>print(data)<br></code></pre></div></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Python</category>
      
      <category>æŠ€æœ¯æ‚è°ˆ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>æŠ€æœ¯æ‚è°ˆ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MySQL ä¿®æ”¹è¿æ¥æ•°å¤ªå¤§çš„æ—¶å€™</title>
    <link href="/2021/03/25/MySQL%E4%BF%AE%E6%94%B9%E8%BF%9E%E6%8E%A5%E6%95%B0/"/>
    <url>/2021/03/25/MySQL%E4%BF%AE%E6%94%B9%E8%BF%9E%E6%8E%A5%E6%95%B0/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h2 id="MySQLå‡ºç°è¿æ¥æ•°å¤ªå¤§æ—¶-ä¿®æ”¹é“¾æ¥æ•°"><a href="#MySQLå‡ºç°è¿æ¥æ•°å¤ªå¤§æ—¶-ä¿®æ”¹é“¾æ¥æ•°" class="headerlink" title="MySQLå‡ºç°è¿æ¥æ•°å¤ªå¤§æ—¶ ä¿®æ”¹é“¾æ¥æ•°"></a><font color="#00BBFF">MySQLå‡ºç°è¿æ¥æ•°å¤ªå¤§æ—¶ ä¿®æ”¹é“¾æ¥æ•°</font></h2><p><code>æŠ¥é”™æè¦</code></p><figure class="highlight nginx"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs nginx"><span class="hljs-attribute">ERROR</span> <span class="hljs-number">1040</span> (HY000): Too many connections<br>è¿æ¥æ•°å¤ªå¤§çš„æ—¶å€™ æ›´æ”¹ä¸€ä¸‹MySQL<br></code></pre></div></td></tr></table></figure><h2 id="åœ¨Linuxä¸‹å°è¯•è¿›å…¥MySQLæœåŠ¡"><a href="#åœ¨Linuxä¸‹å°è¯•è¿›å…¥MySQLæœåŠ¡" class="headerlink" title="åœ¨Linuxä¸‹å°è¯•è¿›å…¥MySQLæœåŠ¡"></a><font color="#00BBFF">åœ¨Linuxä¸‹å°è¯•è¿›å…¥MySQLæœåŠ¡</font></h2><figure class="highlight nginx"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs nginx"><span class="hljs-attribute">mysql</span> -uroot -p<br>Enter password: <br>ERROR <span class="hljs-number">1040</span> (HY000): Too many connections<br>å¦‚æœè¿˜æ˜¯å‡ºç°ä»¥ä¸Šé”™è¯¯ä¿¡æ¯<br></code></pre></div></td></tr></table></figure><ol><li>é‡å¯MySQLæœåŠ¡</li></ol><figure class="highlight"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs nginx">/etc/init.d/mysql restart<br></code></pre></div></td></tr></table></figure><ol start="2"><li>é‡æ–°ç™»å½•MySQLæœåŠ¡</li></ol><figure class="highlight nginx"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs nginx"><span class="hljs-attribute">mysql</span> -uroot -p<br>Enter password: <br>Welcome to the MySQL monitor.  Commands end with ; <span class="hljs-attribute">or</span> \g.<br>Your MySQL connection id is <span class="hljs-number">20</span><br>Server version: <span class="hljs-number">5</span>.<span class="hljs-number">7</span>.<span class="hljs-number">30</span>-0ubuntu0.<span class="hljs-number">16</span>.<span class="hljs-number">04</span>.<span class="hljs-number">1</span> (Ubuntu)<br><br>Copyright (c) <span class="hljs-number">2000</span>, <span class="hljs-number">2020</span>, Oracle and/or its affiliates. All rights reserved.<br><br>Oracle is a registered trademark of Oracle Corporation and/or its<br>affiliates. Other names may be trademarks of their respective<br>owners.<br><br>Type <span class="hljs-string">&#x27;help;&#x27;</span> or <span class="hljs-string">&#x27;\h&#x27;</span> for help. Type <span class="hljs-string">&#x27;\c&#x27;</span> to clear the current input statement.<br><br>mysql&gt; <br></code></pre></div></td></tr></table></figure><h2 id="ä½¿ç”¨å‘½ä»¤-å°†è¿æ¥æ•°æé«˜"><a href="#ä½¿ç”¨å‘½ä»¤-å°†è¿æ¥æ•°æé«˜" class="headerlink" title="ä½¿ç”¨å‘½ä»¤ å°†è¿æ¥æ•°æé«˜"></a><font color="#00BBFF">ä½¿ç”¨å‘½ä»¤ å°†è¿æ¥æ•°æé«˜</font></h2><ol><li>æŸ¥çœ‹è¿æ¥æ•°</li></ol><figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-operator">&gt;&gt;</span> <span class="hljs-keyword">show</span> variables <span class="hljs-keyword">like</span> &quot;max_connections&quot;;<br><span class="hljs-operator">+</span><span class="hljs-comment">-----------------+-------+</span><br><span class="hljs-operator">|</span> Variable_name   <span class="hljs-operator">|</span> <span class="hljs-keyword">Value</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-----------------+-------+</span><br><span class="hljs-operator">|</span> max_connections <span class="hljs-operator">|</span> <span class="hljs-number">151</span>   <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-----------------+-------+</span><br></code></pre></div></td></tr></table></figure><ol start="2"><li>ä¿®æ”¹è¿æ¥æ•°</li></ol><figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-operator">&gt;&gt;</span> <span class="hljs-keyword">set</span> <span class="hljs-keyword">GLOBAL</span> max_connections<span class="hljs-operator">=</span><span class="hljs-number">3600</span>;<br></code></pre></div></td></tr></table></figure><ol start="3"><li>æŸ¥çœ‹è¿æ¥æ•°æ˜¯å¦ä¿®æ”¹æˆåŠŸ</li></ol><figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-operator">&gt;&gt;</span> <span class="hljs-keyword">show</span> variables <span class="hljs-keyword">like</span> &quot;max_connections&quot;;<br><span class="hljs-operator">+</span><span class="hljs-comment">-----------------+-------+</span><br><span class="hljs-operator">|</span> Variable_name   <span class="hljs-operator">|</span> <span class="hljs-keyword">Value</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-----------------+-------+</span><br><span class="hljs-operator">|</span> max_connections <span class="hljs-operator">|</span> <span class="hljs-number">1000</span>  <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-----------------+-------+</span><br></code></pre></div></td></tr></table></figure><ol start="4"><li>é€€å‡º</li></ol><figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-operator">&gt;&gt;</span> exit<br></code></pre></div></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Python</category>
      
      <category>MySQL</category>
      
    </categories>
    
    
    <tags>
      
      <tag>MySQL</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MySQLæ•°æ®åº“ä¿å­˜emojiè¡¨æƒ…</title>
    <link href="/2021/03/25/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BF%9D%E5%AD%98emoji%E8%A1%A8%E6%83%85/"/>
    <url>/2021/03/25/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BF%9D%E5%AD%98emoji%E8%A1%A8%E6%83%85/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h2 id="MySQLæ•°æ®åº“ä¿å­˜emojiè¡¨æƒ…"><a href="#MySQLæ•°æ®åº“ä¿å­˜emojiè¡¨æƒ…" class="headerlink" title="MySQLæ•°æ®åº“ä¿å­˜emojiè¡¨æƒ…"></a><font color="#008080">MySQLæ•°æ®åº“ä¿å­˜emojiè¡¨æƒ…</font></h2><p><code>å‰æƒ…æè¦</code></p><figure class="highlight"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs nginx">å¾®ä¿¡ç™»å½•çš„ç”¨æˆ· è·å–ç”¨æˆ·å/æœ‰äº›ç”¨æˆ·çš„åç§°ä¼šå¸¦æœ‰emojiè¡¨æƒ…<br>æ­¤æ—¶MySQLæ•°æ®åº“å°±ä¼šæŠ¥é”™ æ‰€ä»¥éœ€è¦ä¿®æ”¹ è®©æ•°æ®åº“èƒ½å¤Ÿä¿å­˜emoji<br></code></pre></div></td></tr></table></figure><p><code>æŠ¥é”™ä¿¡æ¯:</code></p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">django.db.utils.OperationalError: (<span class="hljs-number">1366</span>, <span class="hljs-string">&quot;Incorrect string value: &#x27;\\xE5\\xA4\\xAB\\xE4\\xBA\\xBA&#x27; f</span><br></code></pre></div></td></tr></table></figure><h2 id="åœ¨djangoä¸­settings-pyæ·»åŠ è®¾ç½®"><a href="#åœ¨djangoä¸­settings-pyæ·»åŠ è®¾ç½®" class="headerlink" title="åœ¨djangoä¸­settings.pyæ·»åŠ è®¾ç½®"></a><font color="#008080">åœ¨djangoä¸­settings.pyæ·»åŠ è®¾ç½®</font></h2><p><code>æ·»åŠ :</code></p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-string">&#x27;charset&#x27;</span>: <span class="hljs-string">&#x27;utf8mb4&#x27;</span>,<br></code></pre></div></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">DATABASES = &#123;<br>    <span class="hljs-string">&#x27;default&#x27;</span>: &#123;<br>        <span class="hljs-string">&#x27;ENGINE&#x27;</span>: <span class="hljs-string">&#x27;django.db.backends.mysql&#x27;</span>,  <span class="hljs-comment"># æ•°æ®åº“å¼•æ“</span><br>        <span class="hljs-string">&#x27;HOST&#x27;</span>: <span class="hljs-string">&#x27;127.0.0.1&#x27;</span>,  <span class="hljs-comment"># æ•°æ®åº“ä¸»æœº</span><br>        <span class="hljs-string">&#x27;PORT&#x27;</span>: <span class="hljs-number">3365</span>,  <span class="hljs-comment"># æ•°æ®åº“ç«¯å£</span><br>        <span class="hljs-string">&#x27;USER&#x27;</span>: <span class="hljs-string">&#x27;edrfe&#x27;</span>,  <span class="hljs-comment"># æ•°æ®åº“ç”¨æˆ·å</span><br>        <span class="hljs-string">&#x27;PASSWORD&#x27;</span>: <span class="hljs-string">&#x27;rtyfghvbn&#x27;</span>,  <span class="hljs-comment"># æœåŠ¡å™¨æ•°æ®åº“ç”¨æˆ·å¯†ç </span><br>        <span class="hljs-string">&#x27;NAME&#x27;</span>: <span class="hljs-string">&#x27;qaw&#x27;</span>,  <span class="hljs-comment"># æ•°æ®åº“åå­—</span><br>        <span class="hljs-string">&#x27;OPTIONS&#x27;</span>: &#123;<br>            <span class="hljs-string">&quot;init_command&quot;</span>: <span class="hljs-string">&quot;SET foreign_key_checks = 0;&quot;</span>,<br>            <span class="hljs-string">&#x27;charset&#x27;</span>: <span class="hljs-string">&#x27;utf8mb4&#x27;</span>,<br>        &#125;<br>    &#125;,<br>&#125;<br></code></pre></div></td></tr></table></figure><h2 id="åœ¨MySQLä¸­ä¿®æ”¹æ•°æ®åº“çš„å­—ç¬¦é›†"><a href="#åœ¨MySQLä¸­ä¿®æ”¹æ•°æ®åº“çš„å­—ç¬¦é›†" class="headerlink" title="åœ¨MySQLä¸­ä¿®æ”¹æ•°æ®åº“çš„å­—ç¬¦é›†"></a><font color="#008080">åœ¨MySQLä¸­ä¿®æ”¹æ•°æ®åº“çš„å­—ç¬¦é›†</font></h2><p><code>1. è¿›å…¥MySQL:</code></p><figure class="highlight nginx"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs nginx">root@iZbp1faknmuby6hc0tazirZ:~/# mysql -uedrfe -p å¯†ç <br><br></code></pre></div></td></tr></table></figure><p><code>2. ä¿®æ”¹æŒ‡å®šçš„æ•°æ®åº“çš„å­—ç¬¦é›†</code></p><figure class="highlight nginx"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs nginx"><span class="hljs-attribute">ALTER</span> DATABASE æ•°æ®åº“å CHARACTER SET = utf8mb4 COLLATE = utf8mb4_unicode_ci;<br></code></pre></div></td></tr></table></figure><p><code>3. æŒ‡å®šæ•°æ®åº“ è¿›è¡Œä¿®æ”¹è¡¨çš„å­—ç¬¦é›†</code></p><figure class="highlight nginx"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs nginx"><span class="hljs-comment"># æŒ‡å®šæ•°æ®åº“</span><br><span class="hljs-attribute">use</span> æ•°æ®åº“å;<br><br><span class="hljs-comment"># ä¿®æ”¹å­—ç¬¦é›†</span><br><span class="hljs-attribute">ALTER</span> TABLE è¡¨å CONVERT TO CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;<br></code></pre></div></td></tr></table></figure><p><code>4. ä¿®æ”¹columnå­—ç¬¦é›†</code></p><figure class="highlight nginx"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs nginx"><span class="hljs-attribute">ALTER</span> TABLE è¡¨å CHANGE å­—æ®µå å­—æ®µå è¯¥å­—æ®µåŸæ¥çš„æ•°æ®ç±»å‹ CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;<br></code></pre></div></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Python</category>
      
      <category>MySQL</category>
      
    </categories>
    
    
    <tags>
      
      <tag>MySQL</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MySQL åˆ é™¤é‡å¤æ•°æ® å¤šæ¡ä»¶è¿‡æ»¤åˆ é™¤</title>
    <link href="/2021/03/25/MySQL%E5%88%A0%E9%99%A4%E9%87%8D%E5%A4%8D/"/>
    <url>/2021/03/25/MySQL%E5%88%A0%E9%99%A4%E9%87%8D%E5%A4%8D/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h2 id="MySQLæ•°æ®åº“ä¿å­˜é‡å¤å€¼-å»é™¤é‡å¤å€¼â­â­â­"><a href="#MySQLæ•°æ®åº“ä¿å­˜é‡å¤å€¼-å»é™¤é‡å¤å€¼â­â­â­" class="headerlink" title="MySQLæ•°æ®åº“ä¿å­˜é‡å¤å€¼ å»é™¤é‡å¤å€¼â­â­â­"></a><font color="#00AA00">MySQLæ•°æ®åº“ä¿å­˜é‡å¤å€¼ å»é™¤é‡å¤å€¼â­â­â­</font></h2><p><code>å¼€å‘æè¦</code></p><figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql">æ•°æ®å¯¼å…¥æ—¶é—´å¤ªæ…¢ é‡å¤è®¡ç®—æ•°æ®åº“æ˜¯å¦å­˜åœ¨é‡å¤æ•°æ®<br>å¦‚æœé‡å¤ åˆ™è·³è¿‡ å¦åˆ™å°±åˆ›å»º ä½†æ˜¯è¿™æ ·ä¼šå‡ºç°æ•°æ®é‡å¤§çš„æ—¶å€™ æ—¶é—´ç¼“æ…¢<br>åœ¨æ·»åŠ çš„æ—¶å€™ å¯ä»¥ä¸æ ¡éªŒ åœ¨åé¢å¼‚æ­¥æ“ä½œæ•°æ®åº“ è‡ªåŠ¨åˆ é™¤é‡å¤çš„æ•°æ®<br>å¹¶ä¿ç•™idå€¼æœ€å¤§<span class="hljs-operator">/</span>æœ€å°çš„æ•°æ®<br></code></pre></div></td></tr></table></figure><h2 id="å®æˆ˜æ¼”ç¤º-åˆ›å»ºæ•°æ®åº“åŠæ“ä½œâ­â­â­"><a href="#å®æˆ˜æ¼”ç¤º-åˆ›å»ºæ•°æ®åº“åŠæ“ä½œâ­â­â­" class="headerlink" title="å®æˆ˜æ¼”ç¤º åˆ›å»ºæ•°æ®åº“åŠæ“ä½œâ­â­â­"></a><font color="#00AA00">å®æˆ˜æ¼”ç¤º åˆ›å»ºæ•°æ®åº“åŠæ“ä½œâ­â­â­</font></h2><ol><li>åˆ›å»ºæ•°æ®åº“ å¹¶ use</li></ol><figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">create</span> database æ•°æ®åº“åç§°(sql_data);<br>Query OK, <span class="hljs-number">1</span> <span class="hljs-type">row</span> affected (<span class="hljs-number">0.00</span> sec)<br><br>use sql_data;<br></code></pre></div></td></tr></table></figure><ol start="2"><li>åˆ›å»ºæ•°æ®è¡¨</li></ol><figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `asin_keyword_info`  (<br>  `id` <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) UNSIGNED <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT,<br>  `keywordinfo_name` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-type">CHARACTER</span> <span class="hljs-keyword">SET</span> utf8 <span class="hljs-keyword">COLLATE</span> utf8_general_ci <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;å…³é”®è¯åå­—&#x27;</span>,<br>  `search_trend` longtext <span class="hljs-type">CHARACTER</span> <span class="hljs-keyword">SET</span> utf8 <span class="hljs-keyword">COLLATE</span> utf8_general_ci <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;æœˆè¶‹åŠ¿&#x27;</span>,<br>  `purchase` <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;æœˆè´­ä¹°é‡&#x27;</span>,<br>  `search_volume` <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;æœˆæœç´¢é‡&#x27;</span>,<br>  `search_hot` <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>  `results` <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;ç«å“æ•°é‡&#x27;</span>,<br>  `cvr` <span class="hljs-type">decimal</span>(<span class="hljs-number">10</span>, <span class="hljs-number">2</span>) <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;è´­ä¹°ç‡&#x27;</span>,<br>  `quality` <span class="hljs-type">decimal</span>(<span class="hljs-number">10</span>, <span class="hljs-number">2</span>) <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;è´¨é‡ç³»æ•°&#x27;</span>,<br>  `site_foreign` <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) UNSIGNED <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>  `user_foreign` <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>  `search_cate` <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) UNSIGNED <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;æ·»åŠ å“ªä¸ªåˆ†ç±»&#x27;</span>,<br>  `asin_foreign` <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) UNSIGNED <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>  `create_time` datetime(<span class="hljs-number">6</span>) <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">ON</span> UPDATE <span class="hljs-built_in">CURRENT_TIMESTAMP</span>(<span class="hljs-number">6</span>),<br>  `update_time` datetime(<span class="hljs-number">6</span>) <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">ON</span> UPDATE <span class="hljs-built_in">CURRENT_TIMESTAMP</span>(<span class="hljs-number">6</span>),<br>  `is_delete` tinyint(<span class="hljs-number">10</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span>,<br>  `is_sub` <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;å­åˆ†ç±»&#x27;</span>,<br>  <span class="hljs-keyword">PRIMARY</span> KEY (`id`) <span class="hljs-keyword">USING</span> BTREE,<br>  INDEX `foreign_asin`(`asin_foreign`) <span class="hljs-keyword">USING</span> BTREE,<br>  INDEX `search_cate_id`(`search_cate`) <span class="hljs-keyword">USING</span> BTREE,<br>  INDEX `user_id`(`user_foreign`) <span class="hljs-keyword">USING</span> BTREE,<br>  INDEX `site_id_fore`(`site_foreign`) <span class="hljs-keyword">USING</span> BTREE<br>) ENGINE <span class="hljs-operator">=</span> InnoDB AUTO_INCREMENT <span class="hljs-operator">=</span> <span class="hljs-number">7659761</span> <span class="hljs-type">CHARACTER</span> <span class="hljs-keyword">SET</span> <span class="hljs-operator">=</span> utf8 <span class="hljs-keyword">COLLATE</span> <span class="hljs-operator">=</span> utf8_general_ci ROW_FORMAT <span class="hljs-operator">=</span> <span class="hljs-keyword">Dynamic</span>;<br></code></pre></div></td></tr></table></figure><ol start="3"><li>æ·»åŠ æ•°æ® æ€»å…±5æ¡æ•°æ®</li></ol><figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> `asin_keyword_info` <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">1</span>, <span class="hljs-string">&#x27;solar pir led security light1&#x27;</span>, <span class="hljs-string">&#x27;[&#123;\&#x27;</span><span class="hljs-keyword">month</span>\<span class="hljs-string">&#x27;: \&#x27;</span><span class="hljs-number">202005</span>\<span class="hljs-string">&#x27;, \&#x27;</span>searches\<span class="hljs-string">&#x27;: 0&#125;, &#123;\&#x27;</span><span class="hljs-keyword">month</span>\<span class="hljs-string">&#x27;: \&#x27;</span><span class="hljs-number">202006</span>\<span class="hljs-string">&#x27;, \&#x27;</span>searches\<span class="hljs-string">&#x27;: 0&#125;, &#123;\&#x27;</span><span class="hljs-keyword">month</span>\<span class="hljs-string">&#x27;: \&#x27;</span><span class="hljs-number">202007</span>\<span class="hljs-string">&#x27;, \&#x27;</span>searches\<span class="hljs-string">&#x27;: 0&#125;, &#123;\&#x27;</span><span class="hljs-keyword">month</span>\<span class="hljs-string">&#x27;: \&#x27;</span><span class="hljs-number">202008</span>\<span class="hljs-string">&#x27;, \&#x27;</span>searches\<span class="hljs-string">&#x27;: 0&#125;, &#123;\&#x27;</span><span class="hljs-keyword">month</span>\<span class="hljs-string">&#x27;: \&#x27;</span><span class="hljs-number">202009</span>\<span class="hljs-string">&#x27;, \&#x27;</span>searches\<span class="hljs-string">&#x27;: 0&#125;, &#123;\&#x27;</span><span class="hljs-keyword">month</span>\<span class="hljs-string">&#x27;: \&#x27;</span><span class="hljs-number">202010</span>\<span class="hljs-string">&#x27;, \&#x27;</span>searches\<span class="hljs-string">&#x27;: 0&#125;, &#123;\&#x27;</span><span class="hljs-keyword">month</span>\<span class="hljs-string">&#x27;: \&#x27;</span><span class="hljs-number">202011</span>\<span class="hljs-string">&#x27;, \&#x27;</span>searches\<span class="hljs-string">&#x27;: 0&#125;, &#123;\&#x27;</span><span class="hljs-keyword">month</span>\<span class="hljs-string">&#x27;: \&#x27;</span><span class="hljs-number">202012</span>\<span class="hljs-string">&#x27;, \&#x27;</span>searches\<span class="hljs-string">&#x27;: 0&#125;, &#123;\&#x27;</span><span class="hljs-keyword">month</span>\<span class="hljs-string">&#x27;: \&#x27;</span><span class="hljs-number">202101</span>\<span class="hljs-string">&#x27;, \&#x27;</span>searches\<span class="hljs-string">&#x27;: 0&#125;]&#x27;</span>, <span class="hljs-number">172</span>, <span class="hljs-number">3815</span>, <span class="hljs-keyword">NULL</span>, <span class="hljs-number">10000</span>, <span class="hljs-number">0.05</span>, <span class="hljs-number">0.95</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-keyword">NULL</span>, <span class="hljs-string">&#x27;2021-03-18 14:07:33.199221&#x27;</span>, <span class="hljs-string">&#x27;2021-03-18 14:07:33.199221&#x27;</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>);<br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> `asin_keyword_info` <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">2</span>, <span class="hljs-string">&#x27;solar pir led security light1&#x27;</span>, <span class="hljs-string">&#x27;[&#123;\&#x27;</span><span class="hljs-keyword">month</span>\<span class="hljs-string">&#x27;: \&#x27;</span><span class="hljs-number">202005</span>\<span class="hljs-string">&#x27;, \&#x27;</span>searches\<span class="hljs-string">&#x27;: 0&#125;, &#123;\&#x27;</span><span class="hljs-keyword">month</span>\<span class="hljs-string">&#x27;: \&#x27;</span><span class="hljs-number">202006</span>\<span class="hljs-string">&#x27;, \&#x27;</span>searches\<span class="hljs-string">&#x27;: 0&#125;, &#123;\&#x27;</span><span class="hljs-keyword">month</span>\<span class="hljs-string">&#x27;: \&#x27;</span><span class="hljs-number">202007</span>\<span class="hljs-string">&#x27;, \&#x27;</span>searches\<span class="hljs-string">&#x27;: 0&#125;, &#123;\&#x27;</span><span class="hljs-keyword">month</span>\<span class="hljs-string">&#x27;: \&#x27;</span><span class="hljs-number">202008</span>\<span class="hljs-string">&#x27;, \&#x27;</span>searches\<span class="hljs-string">&#x27;: 0&#125;, &#123;\&#x27;</span><span class="hljs-keyword">month</span>\<span class="hljs-string">&#x27;: \&#x27;</span><span class="hljs-number">202009</span>\<span class="hljs-string">&#x27;, \&#x27;</span>searches\<span class="hljs-string">&#x27;: 0&#125;, &#123;\&#x27;</span><span class="hljs-keyword">month</span>\<span class="hljs-string">&#x27;: \&#x27;</span><span class="hljs-number">202010</span>\<span class="hljs-string">&#x27;, \&#x27;</span>searches\<span class="hljs-string">&#x27;: 0&#125;, &#123;\&#x27;</span><span class="hljs-keyword">month</span>\<span class="hljs-string">&#x27;: \&#x27;</span><span class="hljs-number">202011</span>\<span class="hljs-string">&#x27;, \&#x27;</span>searches\<span class="hljs-string">&#x27;: 0&#125;, &#123;\&#x27;</span><span class="hljs-keyword">month</span>\<span class="hljs-string">&#x27;: \&#x27;</span><span class="hljs-number">202012</span>\<span class="hljs-string">&#x27;, \&#x27;</span>searches\<span class="hljs-string">&#x27;: 0&#125;, &#123;\&#x27;</span><span class="hljs-keyword">month</span>\<span class="hljs-string">&#x27;: \&#x27;</span><span class="hljs-number">202101</span>\<span class="hljs-string">&#x27;, \&#x27;</span>searches\<span class="hljs-string">&#x27;: 0&#125;]&#x27;</span>, <span class="hljs-number">172</span>, <span class="hljs-number">3815</span>, <span class="hljs-keyword">NULL</span>, <span class="hljs-number">10000</span>, <span class="hljs-number">0.05</span>, <span class="hljs-number">0.95</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-keyword">NULL</span>, <span class="hljs-string">&#x27;2021-03-18 14:07:41.870335&#x27;</span>, <span class="hljs-string">&#x27;2021-03-18 14:07:41.870335&#x27;</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>);<br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> `asin_keyword_info` <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">3</span>, <span class="hljs-string">&#x27;solar pir led security light1&#x27;</span>, <span class="hljs-string">&#x27;[&#123;\&#x27;</span><span class="hljs-keyword">month</span>\<span class="hljs-string">&#x27;: \&#x27;</span><span class="hljs-number">202005</span>\<span class="hljs-string">&#x27;, \&#x27;</span>searches\<span class="hljs-string">&#x27;: 0&#125;, &#123;\&#x27;</span><span class="hljs-keyword">month</span>\<span class="hljs-string">&#x27;: \&#x27;</span><span class="hljs-number">202006</span>\<span class="hljs-string">&#x27;, \&#x27;</span>searches\<span class="hljs-string">&#x27;: 0&#125;, &#123;\&#x27;</span><span class="hljs-keyword">month</span>\<span class="hljs-string">&#x27;: \&#x27;</span><span class="hljs-number">202007</span>\<span class="hljs-string">&#x27;, \&#x27;</span>searches\<span class="hljs-string">&#x27;: 0&#125;, &#123;\&#x27;</span><span class="hljs-keyword">month</span>\<span class="hljs-string">&#x27;: \&#x27;</span><span class="hljs-number">202008</span>\<span class="hljs-string">&#x27;, \&#x27;</span>searches\<span class="hljs-string">&#x27;: 0&#125;, &#123;\&#x27;</span><span class="hljs-keyword">month</span>\<span class="hljs-string">&#x27;: \&#x27;</span><span class="hljs-number">202009</span>\<span class="hljs-string">&#x27;, \&#x27;</span>searches\<span class="hljs-string">&#x27;: 0&#125;, &#123;\&#x27;</span><span class="hljs-keyword">month</span>\<span class="hljs-string">&#x27;: \&#x27;</span><span class="hljs-number">202010</span>\<span class="hljs-string">&#x27;, \&#x27;</span>searches\<span class="hljs-string">&#x27;: 0&#125;, &#123;\&#x27;</span><span class="hljs-keyword">month</span>\<span class="hljs-string">&#x27;: \&#x27;</span><span class="hljs-number">202011</span>\<span class="hljs-string">&#x27;, \&#x27;</span>searches\<span class="hljs-string">&#x27;: 0&#125;, &#123;\&#x27;</span><span class="hljs-keyword">month</span>\<span class="hljs-string">&#x27;: \&#x27;</span><span class="hljs-number">202012</span>\<span class="hljs-string">&#x27;, \&#x27;</span>searches\<span class="hljs-string">&#x27;: 0&#125;, &#123;\&#x27;</span><span class="hljs-keyword">month</span>\<span class="hljs-string">&#x27;: \&#x27;</span><span class="hljs-number">202101</span>\<span class="hljs-string">&#x27;, \&#x27;</span>searches\<span class="hljs-string">&#x27;: 0&#125;]&#x27;</span>, <span class="hljs-number">172</span>, <span class="hljs-number">3815</span>, <span class="hljs-keyword">NULL</span>, <span class="hljs-number">10000</span>, <span class="hljs-number">0.05</span>, <span class="hljs-number">0.95</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-keyword">NULL</span>, <span class="hljs-string">&#x27;2021-03-18 13:28:09.365996&#x27;</span>, <span class="hljs-string">&#x27;2021-03-18 13:28:09.365996&#x27;</span>, <span class="hljs-number">0</span>, <span class="hljs-keyword">NULL</span>);<br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> `asin_keyword_info` <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">4</span>, <span class="hljs-string">&#x27;solar pir led security light1&#x27;</span>, <span class="hljs-string">&#x27;[&#123;\&#x27;</span><span class="hljs-keyword">month</span>\<span class="hljs-string">&#x27;: \&#x27;</span><span class="hljs-number">202005</span>\<span class="hljs-string">&#x27;, \&#x27;</span>searches\<span class="hljs-string">&#x27;: 0&#125;, &#123;\&#x27;</span><span class="hljs-keyword">month</span>\<span class="hljs-string">&#x27;: \&#x27;</span><span class="hljs-number">202006</span>\<span class="hljs-string">&#x27;, \&#x27;</span>searches\<span class="hljs-string">&#x27;: 0&#125;, &#123;\&#x27;</span><span class="hljs-keyword">month</span>\<span class="hljs-string">&#x27;: \&#x27;</span><span class="hljs-number">202007</span>\<span class="hljs-string">&#x27;, \&#x27;</span>searches\<span class="hljs-string">&#x27;: 0&#125;, &#123;\&#x27;</span><span class="hljs-keyword">month</span>\<span class="hljs-string">&#x27;: \&#x27;</span><span class="hljs-number">202008</span>\<span class="hljs-string">&#x27;, \&#x27;</span>searches\<span class="hljs-string">&#x27;: 0&#125;, &#123;\&#x27;</span><span class="hljs-keyword">month</span>\<span class="hljs-string">&#x27;: \&#x27;</span><span class="hljs-number">202009</span>\<span class="hljs-string">&#x27;, \&#x27;</span>searches\<span class="hljs-string">&#x27;: 0&#125;, &#123;\&#x27;</span><span class="hljs-keyword">month</span>\<span class="hljs-string">&#x27;: \&#x27;</span><span class="hljs-number">202010</span>\<span class="hljs-string">&#x27;, \&#x27;</span>searches\<span class="hljs-string">&#x27;: 0&#125;, &#123;\&#x27;</span><span class="hljs-keyword">month</span>\<span class="hljs-string">&#x27;: \&#x27;</span><span class="hljs-number">202011</span>\<span class="hljs-string">&#x27;, \&#x27;</span>searches\<span class="hljs-string">&#x27;: 0&#125;, &#123;\&#x27;</span><span class="hljs-keyword">month</span>\<span class="hljs-string">&#x27;: \&#x27;</span><span class="hljs-number">202012</span>\<span class="hljs-string">&#x27;, \&#x27;</span>searches\<span class="hljs-string">&#x27;: 0&#125;, &#123;\&#x27;</span><span class="hljs-keyword">month</span>\<span class="hljs-string">&#x27;: \&#x27;</span><span class="hljs-number">202101</span>\<span class="hljs-string">&#x27;, \&#x27;</span>searches\<span class="hljs-string">&#x27;: 0&#125;]&#x27;</span>, <span class="hljs-number">172</span>, <span class="hljs-number">3815</span>, <span class="hljs-keyword">NULL</span>, <span class="hljs-number">10000</span>, <span class="hljs-number">0.05</span>, <span class="hljs-number">0.95</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-keyword">NULL</span>, <span class="hljs-string">&#x27;2021-03-18 13:28:09.365996&#x27;</span>, <span class="hljs-string">&#x27;2021-03-18 13:28:09.365996&#x27;</span>, <span class="hljs-number">0</span>, <span class="hljs-keyword">NULL</span>);<br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> `asin_keyword_info` <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">5</span>, <span class="hljs-string">&#x27;solar pir led security light1&#x27;</span>, <span class="hljs-string">&#x27;[&#123;\&#x27;</span><span class="hljs-keyword">month</span>\<span class="hljs-string">&#x27;: \&#x27;</span><span class="hljs-number">202005</span>\<span class="hljs-string">&#x27;, \&#x27;</span>searches\<span class="hljs-string">&#x27;: 0&#125;, &#123;\&#x27;</span><span class="hljs-keyword">month</span>\<span class="hljs-string">&#x27;: \&#x27;</span><span class="hljs-number">202006</span>\<span class="hljs-string">&#x27;, \&#x27;</span>searches\<span class="hljs-string">&#x27;: 0&#125;, &#123;\&#x27;</span><span class="hljs-keyword">month</span>\<span class="hljs-string">&#x27;: \&#x27;</span><span class="hljs-number">202007</span>\<span class="hljs-string">&#x27;, \&#x27;</span>searches\<span class="hljs-string">&#x27;: 0&#125;, &#123;\&#x27;</span><span class="hljs-keyword">month</span>\<span class="hljs-string">&#x27;: \&#x27;</span><span class="hljs-number">202008</span>\<span class="hljs-string">&#x27;, \&#x27;</span>searches\<span class="hljs-string">&#x27;: 0&#125;, &#123;\&#x27;</span><span class="hljs-keyword">month</span>\<span class="hljs-string">&#x27;: \&#x27;</span><span class="hljs-number">202009</span>\<span class="hljs-string">&#x27;, \&#x27;</span>searches\<span class="hljs-string">&#x27;: 0&#125;, &#123;\&#x27;</span><span class="hljs-keyword">month</span>\<span class="hljs-string">&#x27;: \&#x27;</span><span class="hljs-number">202010</span>\<span class="hljs-string">&#x27;, \&#x27;</span>searches\<span class="hljs-string">&#x27;: 0&#125;, &#123;\&#x27;</span><span class="hljs-keyword">month</span>\<span class="hljs-string">&#x27;: \&#x27;</span><span class="hljs-number">202011</span>\<span class="hljs-string">&#x27;, \&#x27;</span>searches\<span class="hljs-string">&#x27;: 0&#125;, &#123;\&#x27;</span><span class="hljs-keyword">month</span>\<span class="hljs-string">&#x27;: \&#x27;</span><span class="hljs-number">202012</span>\<span class="hljs-string">&#x27;, \&#x27;</span>searches\<span class="hljs-string">&#x27;: 0&#125;, &#123;\&#x27;</span><span class="hljs-keyword">month</span>\<span class="hljs-string">&#x27;: \&#x27;</span><span class="hljs-number">202101</span>\<span class="hljs-string">&#x27;, \&#x27;</span>searches\<span class="hljs-string">&#x27;: 0&#125;]&#x27;</span>, <span class="hljs-number">172</span>, <span class="hljs-number">3815</span>, <span class="hljs-keyword">NULL</span>, <span class="hljs-number">10000</span>, <span class="hljs-number">0.05</span>, <span class="hljs-number">0.95</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-keyword">NULL</span>, <span class="hljs-string">&#x27;2021-03-18 13:28:09.365996&#x27;</span>, <span class="hljs-string">&#x27;2021-03-18 13:28:09.365996&#x27;</span>, <span class="hljs-number">0</span>, <span class="hljs-keyword">NULL</span>);<br></code></pre></div></td></tr></table></figure><h2 id="SQLçš„ç¼–å†™â­â­â­"><a href="#SQLçš„ç¼–å†™â­â­â­" class="headerlink" title="SQLçš„ç¼–å†™â­â­â­"></a><font color="#00AA00">SQLçš„ç¼–å†™â­â­â­</font></h2><blockquote><p>åœ¨ä¸ç¡®å®šSQLè¯­å¥å†™çš„å¯¹ä¸å¯¹çš„æƒ…å†µä¸‹ å»ºè®®å…ˆç”¨æŸ¥è¯¢è¯­å¥ æ‹ä¸€ä¸‹æ€è·¯</p></blockquote><table><thead><tr><th>å­—æ®µå</th><th>ä½œç”¨</th><th>æ˜¯å¦éœ€è¦Y/N</th></tr></thead><tbody><tr><td>keywordinfo_name</td><td>å…³é”®è¯åç§°/ä¼šå‡ºç°é‡å¤çš„</td><td>Y</td></tr><tr><td>site_foreign</td><td>ç«™ç‚¹å…³è”</td><td>Y</td></tr><tr><td>user_foreign</td><td>ç”¨æˆ·å…³è”</td><td>Y</td></tr><tr><td>search_cate</td><td>åˆ†ç±»å…³è”</td><td>Y</td></tr><tr><td>is_sub</td><td>äºŒçº§åˆ†ç±»å…³è”</td><td>Y</td></tr></tbody></table><ol><li>ä½¿ç”¨sqlè¯­å¥æŸ¥è¯¢é‡å¤çš„æ•°æ®</li></ol><p>â­ æ•°æ®æŸ¥è¯¢ä¸ºnullçš„æ—¶å€™ is NULL</p><figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> asin_keyword_info <span class="hljs-keyword">where</span> site_foreign<span class="hljs-operator">=</span><span class="hljs-number">2</span> <span class="hljs-keyword">and</span> user_foreign<span class="hljs-operator">=</span><span class="hljs-number">1</span> <span class="hljs-keyword">and</span> <br>search_cate<span class="hljs-operator">=</span><span class="hljs-number">2</span> <span class="hljs-keyword">and</span> is_sub <span class="hljs-keyword">is</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">and</span> keywordinfo_name <span class="hljs-keyword">in</span><br>(<span class="hljs-keyword">select</span> keywordinfo_name <span class="hljs-keyword">from</span> asin_keyword_info <span class="hljs-keyword">where</span> <span class="hljs-keyword">where</span> site_foreign<span class="hljs-operator">=</span><span class="hljs-number">2</span> <br><span class="hljs-keyword">and</span> user_foreign<span class="hljs-operator">=</span><span class="hljs-number">1</span> <span class="hljs-keyword">and</span> search_cate<span class="hljs-operator">=</span><span class="hljs-number">2</span> <span class="hljs-keyword">and</span> is_sub <span class="hljs-keyword">is</span> <span class="hljs-keyword">NULL</span><br><span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> keywordinfo_name <span class="hljs-keyword">HAVING</span> <span class="hljs-built_in">COUNT</span>(keywordinfo_name) <span class="hljs-operator">&gt;</span> <span class="hljs-number">1</span>)<br> <br><span class="hljs-comment">-- ä¸Šè¿°è¯­å¥ æŸ¥è¯¢å…³é”®è¯åç§° åœ¨è¡¨ä¸­å‡ºç°äº†å¤šå°‘ å¹¶ä¸” æ˜¯åœ¨å“ªä¸ªç«™ç‚¹ å“ªä¸ªç”¨æˆ· å“ªä¸ªåˆ†ç±» å­åˆ†ç±»ä¸ºnullçš„æ—¶å€™</span><br></code></pre></div></td></tr></table></figure><ol start="2"><li>æ ¹æ®ä¸Šè¿°æŸ¥è¯¢è¯­å¥ åå†™åˆ é™¤è¯­å¥</li></ol><p>â­ åˆ é™¤çš„æ—¶å€™ ä¸èƒ½å¯¹å½“å‰æ“ä½œçš„è¡¨è¿›è¡Œä¿®æ”¹ å¦åˆ™ä¼šæŠ¥é”™</p><figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-comment">-- é”™è¯¯è¯­æ³•</span><br><span class="hljs-keyword">delete</span> <span class="hljs-keyword">from</span> asin_keyword_info <span class="hljs-keyword">where</span> keywordinfo_name <span class="hljs-keyword">in</span> <br>(<span class="hljs-keyword">select</span> keywordinfo_name <span class="hljs-keyword">from</span> asin_keyword_info <br>     <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> keywordinfo_name <span class="hljs-keyword">HAVING</span> <span class="hljs-built_in">COUNT</span>(keywordinfo_name) <span class="hljs-operator">&gt;</span> <span class="hljs-number">1</span>)<br><br><span class="hljs-operator">&gt;</span> <span class="hljs-number">1093</span> <span class="hljs-operator">-</span> You can<span class="hljs-string">&#x27;t specify target table &#x27;</span>asin_keyword_info<span class="hljs-string">&#x27; for update in FROM clause</span><br><span class="hljs-string">&gt; æ—¶é—´: 0s</span><br></code></pre></div></td></tr></table></figure><p>â­â­ä¸èƒ½å°†ç›´æ¥æŸ¥å¤„æ¥çš„æ•°æ®å½“åšåˆ é™¤æ•°æ®çš„æ¡ä»¶ï¼Œæˆ‘ä»¬åº”è¯¥å…ˆæŠŠæŸ¥å‡ºæ¥çš„æ•°æ®å½“ä½œæ–°çš„ï¼Œç„¶åå†ä½œä¸ºæ¡ä»¶è¿›è¡Œåˆ é™¤åŠŸèƒ½</p><ol start="3"><li>å½“ä¸æƒ³ä¿å­˜é‡å¤çš„æ•°æ®çš„æ—¶å€™(ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ç»“æœ)</li></ol><figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">delete</span> <span class="hljs-keyword">from</span> asin_keyword_info <span class="hljs-keyword">where</span> keywordinfo_name <span class="hljs-keyword">in</span> <br>(<span class="hljs-keyword">select</span> k.keywordinfo_name <span class="hljs-keyword">from</span> <br>(<span class="hljs-keyword">SELECT</span> keywordinfo_name <span class="hljs-keyword">from</span> asin_keyword_info <span class="hljs-keyword">where</span> keywordinfo_name <span class="hljs-keyword">in</span> <br>(<span class="hljs-keyword">select</span> keywordinfo_name <span class="hljs-keyword">from</span> asin_keyword_info <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> keywordinfo_name <span class="hljs-keyword">HAVING</span> <span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>) <span class="hljs-operator">&gt;</span> <span class="hljs-number">1</span>)<br><span class="hljs-keyword">and</span> site_foreign<span class="hljs-operator">=</span><span class="hljs-number">2</span> <span class="hljs-keyword">and</span> user_foreign<span class="hljs-operator">=</span><span class="hljs-number">1</span> <span class="hljs-keyword">and</span> search_cate<span class="hljs-operator">=</span><span class="hljs-number">2</span> <span class="hljs-keyword">and</span> is_sub <span class="hljs-keyword">is</span> <span class="hljs-keyword">NULL</span><br>)<br>k)<br><br><span class="hljs-comment">-- ä¸Šè¿°è¯­å¥ åˆ é™¤é‡å¤çš„ ä¸ä¿ç•™æœ€å¤§id/æœ€å°id</span><br></code></pre></div></td></tr></table></figure><ol start="4"><li>æ¡ä»¶åªæ»¡è¶³max / min çš„æ—¶å€™ (ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ç»“æœ)</li></ol><p>â­â­å½“æ¡ä»¶åªæ»¡è¶³äº† max / minçš„æ—¶å€™ ä¼šå°†å…¶ä½™é‡å¤çš„åˆ é™¤ åªä¿ç•™æœ€å¤§/æœ€å°id</p><figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">delete</span> <span class="hljs-keyword">from</span> asin_keyword_info <span class="hljs-keyword">where</span> keywordinfo_name <span class="hljs-keyword">in</span><br>(<span class="hljs-keyword">select</span> keywordinfo_name <span class="hljs-keyword">from</span> (<span class="hljs-keyword">select</span> keywordinfo_name <span class="hljs-keyword">from</span> asin_keyword_info <br><span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> keywordinfo_name <span class="hljs-keyword">HAVING</span> <span class="hljs-built_in">COUNT</span>(keywordinfo_name) <span class="hljs-operator">&gt;</span> <span class="hljs-number">1</span>) e) <span class="hljs-keyword">AND</span> id <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> <br>(<span class="hljs-keyword">select</span> id <span class="hljs-keyword">from</span> (<span class="hljs-keyword">select</span> <span class="hljs-built_in">max</span>(id) <span class="hljs-keyword">as</span> id <span class="hljs-keyword">from</span> asin_keyword_info <br><span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> keywordinfo_name <span class="hljs-keyword">HAVING</span> <span class="hljs-built_in">COUNT</span>(keywordinfo_name) <span class="hljs-operator">&gt;</span> <span class="hljs-number">1</span>) t) <br><span class="hljs-keyword">and</span> site_foreign<span class="hljs-operator">=</span><span class="hljs-number">2</span> <span class="hljs-keyword">and</span> user_foreign<span class="hljs-operator">=</span><span class="hljs-number">1</span> <span class="hljs-keyword">and</span> search_cate<span class="hljs-operator">=</span><span class="hljs-number">2</span> <span class="hljs-keyword">and</span> is_sub<span class="hljs-operator">=</span><span class="hljs-number">1</span><br><br><span class="hljs-comment">-- ä¸Šè¿°è¯­å¥ æœ€åandæ¡ä»¶is_sub=1 æ²¡æœ‰è¢«æ‰§è¡Œ</span><br></code></pre></div></td></tr></table></figure><ol start="5"><li>åŒæ—¶æ»¡è¶³æ¡ä»¶çš„æ—¶å€™ æ‰§è¡Œåˆ é™¤(æˆ‘ä»¬æƒ³è¦çš„ç»“æœ)</li></ol><p>â­â­â­å½“æ¡ä»¶æ»¡è¶³ æ‰§è¡Œä¿ç•™æœ€å¤§idå€¼å¾—æ•°æ®</p><figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">delete</span> <span class="hljs-keyword">from</span> asin_keyword_info <span class="hljs-keyword">where</span> site_foreign<span class="hljs-operator">=</span><span class="hljs-number">2</span> <span class="hljs-keyword">and</span> user_foreign<span class="hljs-operator">=</span><span class="hljs-number">1</span> <span class="hljs-keyword">and</span> <br>search_cate<span class="hljs-operator">=</span><span class="hljs-number">2</span> <span class="hljs-keyword">and</span> is_sub <span class="hljs-keyword">is</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">and</span> keywordinfo_name <span class="hljs-keyword">in</span><br>(<span class="hljs-keyword">select</span> keywordinfo_name <span class="hljs-keyword">from</span> (<span class="hljs-keyword">select</span> keywordinfo_name <span class="hljs-keyword">from</span> asin_keyword_info <br><span class="hljs-keyword">where</span> site_foreign<span class="hljs-operator">=</span><span class="hljs-number">2</span> <span class="hljs-keyword">and</span> user_foreign<span class="hljs-operator">=</span><span class="hljs-number">1</span> <span class="hljs-keyword">and</span> search_cate<span class="hljs-operator">=</span><span class="hljs-number">2</span> <span class="hljs-keyword">and</span> is_sub <span class="hljs-keyword">is</span> <span class="hljs-keyword">NULL</span><br><span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> keywordinfo_name <span class="hljs-keyword">HAVING</span> <span class="hljs-built_in">COUNT</span>(keywordinfo_name) <span class="hljs-operator">&gt;</span> <span class="hljs-number">1</span>) e)<br><span class="hljs-keyword">AND</span> id <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> (<span class="hljs-keyword">select</span> id <span class="hljs-keyword">from</span> (<span class="hljs-keyword">select</span> <span class="hljs-built_in">max</span>(id) <span class="hljs-keyword">as</span> id <span class="hljs-keyword">from</span> asin_keyword_info <br><span class="hljs-keyword">where</span> site_foreign<span class="hljs-operator">=</span><span class="hljs-number">2</span> <span class="hljs-keyword">and</span> user_foreign<span class="hljs-operator">=</span><span class="hljs-number">1</span> <span class="hljs-keyword">and</span> search_cate<span class="hljs-operator">=</span><span class="hljs-number">2</span> <span class="hljs-keyword">and</span> is_sub <span class="hljs-keyword">is</span> <span class="hljs-keyword">NULL</span><br><span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> keywordinfo_name <span class="hljs-keyword">HAVING</span> <span class="hljs-built_in">COUNT</span>(keywordinfo_name) <span class="hljs-operator">&gt;</span> <span class="hljs-number">1</span>) t)<br></code></pre></div></td></tr></table></figure><h2 id="æ€»è§ˆsqlè¯­å¥â­â­â­â­â­"><a href="#æ€»è§ˆsqlè¯­å¥â­â­â­â­â­" class="headerlink" title="æ€»è§ˆsqlè¯­å¥â­â­â­â­â­"></a><font color="#00AA00">æ€»è§ˆsqlè¯­å¥â­â­â­â­â­</font></h2><figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-comment">-- æŠ¥é”™çš„è¯­æ³•</span><br><span class="hljs-keyword">delete</span> <span class="hljs-keyword">from</span> asin_keyword_info <span class="hljs-keyword">where</span> keywordinfo_name <span class="hljs-keyword">in</span> <br>(<span class="hljs-keyword">select</span> keywordinfo_name <span class="hljs-keyword">from</span> asin_keyword_info <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> keywordinfo_name <span class="hljs-keyword">HAVING</span> <span class="hljs-built_in">COUNT</span>(keywordinfo_name) <span class="hljs-operator">&gt;</span> <span class="hljs-number">1</span>)<br><br><span class="hljs-comment">-- æŸ¥è¯¢é‡å¤çš„æ•°æ®</span><br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> asin_keyword_info <span class="hljs-keyword">where</span> keywordinfo_name <span class="hljs-keyword">in</span><br>(<span class="hljs-keyword">select</span> keywordinfo_name <span class="hljs-keyword">from</span> asin_keyword_info <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> keywordinfo_name <span class="hljs-keyword">HAVING</span> <span class="hljs-built_in">COUNT</span>(keywordinfo_name) <span class="hljs-operator">&gt;</span> <span class="hljs-number">1</span>) <span class="hljs-keyword">and</span> <br>site_foreign<span class="hljs-operator">=</span><span class="hljs-number">2</span> <span class="hljs-keyword">and</span> user_foreign<span class="hljs-operator">=</span><span class="hljs-number">1</span> <span class="hljs-keyword">and</span> search_cate<span class="hljs-operator">=</span><span class="hljs-number">2</span> <span class="hljs-keyword">and</span> is_sub<span class="hljs-operator">=</span><span class="hljs-number">1</span><br><br><span class="hljs-comment">-- åˆ é™¤æ‰€æœ‰é‡å¤çš„ ä¸ä¿ç•™ æœ€å¤§/æœ€å°idå€¼</span><br><span class="hljs-keyword">delete</span> <span class="hljs-keyword">from</span> asin_keyword_info <span class="hljs-keyword">where</span> keywordinfo_name <span class="hljs-keyword">in</span> <br>(<span class="hljs-keyword">select</span> k.keywordinfo_name <span class="hljs-keyword">from</span> <br>(<span class="hljs-keyword">SELECT</span> keywordinfo_name <span class="hljs-keyword">from</span> asin_keyword_info <span class="hljs-keyword">where</span> keywordinfo_name <span class="hljs-keyword">in</span> <br>(<span class="hljs-keyword">select</span> keywordinfo_name <span class="hljs-keyword">from</span> asin_keyword_info <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> keywordinfo_name <span class="hljs-keyword">HAVING</span> <span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>) <span class="hljs-operator">&gt;</span> <span class="hljs-number">1</span>)<br><span class="hljs-keyword">and</span> site_foreign<span class="hljs-operator">=</span><span class="hljs-number">2</span> <span class="hljs-keyword">and</span> user_foreign<span class="hljs-operator">=</span><span class="hljs-number">1</span> <span class="hljs-keyword">and</span> search_cate<span class="hljs-operator">=</span><span class="hljs-number">2</span> <span class="hljs-keyword">and</span> is_sub <span class="hljs-keyword">is</span> <span class="hljs-keyword">NULL</span><br>)<br>k)<br><br><span class="hljs-comment">-- ä¸æ‰§è¡Œis_subçš„æ¡ä»¶è¯­ åªä¿ç•™äº†æœ€å¤§/æœ€å° å…¶ä½™æ¡ä»¶æœªæ‰§è¡Œ</span><br><span class="hljs-keyword">delete</span> <span class="hljs-keyword">from</span> asin_keyword_info <span class="hljs-keyword">where</span> keywordinfo_name <span class="hljs-keyword">in</span><br>(<span class="hljs-keyword">select</span> keywordinfo_name <span class="hljs-keyword">from</span> (<span class="hljs-keyword">select</span> keywordinfo_name <span class="hljs-keyword">from</span> asin_keyword_info <br><span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> keywordinfo_name <span class="hljs-keyword">HAVING</span> <span class="hljs-built_in">COUNT</span>(keywordinfo_name) <span class="hljs-operator">&gt;</span> <span class="hljs-number">1</span>) e) <span class="hljs-keyword">AND</span> id <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> <br>(<span class="hljs-keyword">select</span> id <span class="hljs-keyword">from</span> (<span class="hljs-keyword">select</span> <span class="hljs-built_in">max</span>(id) <span class="hljs-keyword">as</span> id <span class="hljs-keyword">from</span> asin_keyword_info <br><span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> keywordinfo_name <span class="hljs-keyword">HAVING</span> <span class="hljs-built_in">COUNT</span>(keywordinfo_name) <span class="hljs-operator">&gt;</span> <span class="hljs-number">1</span>) t) <br><span class="hljs-keyword">and</span> site_foreign<span class="hljs-operator">=</span><span class="hljs-number">2</span> <span class="hljs-keyword">and</span> user_foreign<span class="hljs-operator">=</span><span class="hljs-number">1</span> <span class="hljs-keyword">and</span> search_cate<span class="hljs-operator">=</span><span class="hljs-number">2</span> <span class="hljs-keyword">and</span> is_sub<span class="hljs-operator">=</span><span class="hljs-number">1</span><br><br><span class="hljs-comment">-- æ»¡è¶³æ‰€æœ‰æ¡ä»¶çš„åˆ é™¤è¯­å¥ ä¿ç•™æœ€å¤§/æœ€å°å€¼</span><br><span class="hljs-keyword">delete</span> <span class="hljs-keyword">from</span> asin_keyword_info <span class="hljs-keyword">where</span> site_foreign<span class="hljs-operator">=</span><span class="hljs-number">2</span> <span class="hljs-keyword">and</span> user_foreign<span class="hljs-operator">=</span><span class="hljs-number">1</span> <span class="hljs-keyword">and</span> <br>search_cate<span class="hljs-operator">=</span><span class="hljs-number">2</span> <span class="hljs-keyword">and</span> is_sub <span class="hljs-keyword">is</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">and</span> keywordinfo_name <span class="hljs-keyword">in</span><br>(<span class="hljs-keyword">select</span> keywordinfo_name <span class="hljs-keyword">from</span> (<span class="hljs-keyword">select</span> keywordinfo_name <span class="hljs-keyword">from</span> asin_keyword_info <br><span class="hljs-keyword">where</span> site_foreign<span class="hljs-operator">=</span><span class="hljs-number">2</span> <span class="hljs-keyword">and</span> user_foreign<span class="hljs-operator">=</span><span class="hljs-number">1</span> <span class="hljs-keyword">and</span> search_cate<span class="hljs-operator">=</span><span class="hljs-number">2</span> <span class="hljs-keyword">and</span> is_sub <span class="hljs-keyword">is</span> <span class="hljs-keyword">NULL</span><br><span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> keywordinfo_name <span class="hljs-keyword">HAVING</span> <span class="hljs-built_in">COUNT</span>(keywordinfo_name) <span class="hljs-operator">&gt;</span> <span class="hljs-number">1</span>) e)<br><span class="hljs-keyword">AND</span> id <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> (<span class="hljs-keyword">select</span> id <span class="hljs-keyword">from</span> (<span class="hljs-keyword">select</span> <span class="hljs-built_in">max</span>(id) <span class="hljs-keyword">as</span> id <span class="hljs-keyword">from</span> asin_keyword_info <br><span class="hljs-keyword">where</span> site_foreign<span class="hljs-operator">=</span><span class="hljs-number">2</span> <span class="hljs-keyword">and</span> user_foreign<span class="hljs-operator">=</span><span class="hljs-number">1</span> <span class="hljs-keyword">and</span> search_cate<span class="hljs-operator">=</span><span class="hljs-number">2</span> <span class="hljs-keyword">and</span> is_sub <span class="hljs-keyword">is</span> <span class="hljs-keyword">NULL</span><br><span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> keywordinfo_name <span class="hljs-keyword">HAVING</span> <span class="hljs-built_in">COUNT</span>(keywordinfo_name) <span class="hljs-operator">&gt;</span> <span class="hljs-number">1</span>) t)<br><br><br></code></pre></div></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Python</category>
      
      <category>MySQL</category>
      
    </categories>
    
    
    <tags>
      
      <tag>MySQL</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Ubuntu16.04 ä¸‹ MySQL5.7å¯†ç ä¿®æ”¹</title>
    <link href="/2021/03/25/MySQL%E5%AF%86%E7%A0%81%E4%BF%AE%E6%94%B9/"/>
    <url>/2021/03/25/MySQL%E5%AF%86%E7%A0%81%E4%BF%AE%E6%94%B9/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h2 id="Ubuntu16-04ä¸‹-MySQLå¯†ç å¿˜è®°æ“ä½œ"><a href="#Ubuntu16-04ä¸‹-MySQLå¯†ç å¿˜è®°æ“ä½œ" class="headerlink" title="Ubuntu16.04ä¸‹ MySQLå¯†ç å¿˜è®°æ“ä½œ"></a><font color="#00BBFF">Ubuntu16.04ä¸‹ MySQLå¯†ç å¿˜è®°æ“ä½œ</font></h2><p><code>æŠ¥é”™æè¦</code></p><figure class="highlight powershell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs powershell">root@xswdsa:~<span class="hljs-comment"># mysql -uroot -p xxxxxxxxxxx</span><br>mysql: [<span class="hljs-type">Warning</span>] <span class="hljs-keyword">Using</span> a password on the <span class="hljs-keyword">command</span> line interface can be insecure.<br>ERROR <span class="hljs-number">1045</span> (<span class="hljs-number">28000</span>): Access denied <span class="hljs-keyword">for</span> user <span class="hljs-string">&#x27;root&#x27;</span><span class="hljs-string">@&#x27;localhost&#x27; (using password: YES)</span><br><span class="hljs-string"></span><br><span class="hljs-string">åœ¨æ›´æ–°å¯†ç å è¿˜ä¼šå‡ºç°ä¸Šè¿°é—®é¢˜...</span><br></code></pre></div></td></tr></table></figure><h2 id="ä¿®æ”¹mysql-cnfæ–‡ä»¶"><a href="#ä¿®æ”¹mysql-cnfæ–‡ä»¶" class="headerlink" title="ä¿®æ”¹mysql.cnfæ–‡ä»¶"></a><font color="#00BBFF">ä¿®æ”¹mysql.cnfæ–‡ä»¶</font></h2><ol><li>æ–‡ä»¶è·¯å¾„(Ubuntu16.04): /etc/mysql/mysql.conf.d/</li></ol><figure class="highlight powershell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs powershell">root@xswdsa:~<span class="hljs-comment"># cd /etc/mysql/mysql.conf.d/</span><br><br>root@xswdsa:~<span class="hljs-comment"># ls</span><br>mysqld.cnf<br></code></pre></div></td></tr></table></figure><ol start="2"><li>æ›´æ”¹MySQL.cnfæ–‡ä»¶ åœ¨æ–‡ä»¶æœ€åé¢ æ·»åŠ è·³è¿‡éªŒè¯çš„ä»£ç </li></ol><figure class="highlight powershell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs powershell">root@xswdsa:~<span class="hljs-comment"># vim mysqld.cnf</span><br></code></pre></div></td></tr></table></figure><ol start="3"><li>æ·»åŠ è¯­å¥ ä¿å­˜ é€€å‡º</li></ol><figure class="highlight powershell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs powershell"><span class="hljs-built_in">skip-grant</span><span class="hljs-literal">-tables</span><br></code></pre></div></td></tr></table></figure><ol start="4"><li>é‡å¯MySQLæœåŠ¡</li></ol><figure class="highlight powershell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs powershell">root@xswdsa:~<span class="hljs-comment"># sudo systemctl restart mysql.service</span><br></code></pre></div></td></tr></table></figure><h2 id="é‡æ–°è®¾ç½®å¯†ç éªŒè¯"><a href="#é‡æ–°è®¾ç½®å¯†ç éªŒè¯" class="headerlink" title="é‡æ–°è®¾ç½®å¯†ç éªŒè¯"></a><font color="#00BBFF">é‡æ–°è®¾ç½®å¯†ç éªŒè¯</font></h2><ol><li>é‡æ–°ç™»å½•MySQLæœåŠ¡</li></ol><figure class="highlight nginx"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs nginx"><span class="hljs-attribute">mysql</span> -uroot -p<br>Enter password:<br>Welcome to the MySQL monitor.  Commands end with ; <span class="hljs-attribute">or</span> \g.<br>Your MySQL connection id is <span class="hljs-number">20</span><br>Server version: <span class="hljs-number">5</span>.<span class="hljs-number">7</span>.<span class="hljs-number">30</span>-0ubuntu0.<span class="hljs-number">16</span>.<span class="hljs-number">04</span>.<span class="hljs-number">1</span> (Ubuntu)<br><br>Copyright (c) <span class="hljs-number">2000</span>, <span class="hljs-number">2020</span>, Oracle and/or its affiliates. All rights reserved.<br><br>Oracle is a registered trademark of Oracle Corporation and/or its<br>affiliates. Other names may be trademarks of their respective<br>owners.<br><br>Type <span class="hljs-string">&#x27;help;&#x27;</span> or <span class="hljs-string">&#x27;\h&#x27;</span> for help. Type <span class="hljs-string">&#x27;\c&#x27;</span> to clear the current input statement.<br><br>mysql&gt; use mysql; <span class="hljs-comment"># ä½¿ç”¨mysqlåº“</span><br></code></pre></div></td></tr></table></figure><ol start="2"><li>æŸ¥çœ‹æ˜¯å¦å­˜åœ¨passwordå­—æ®µ ç°åœ¨æ˜¯è¿™ä¸ª(authentication_string)</li></ol><blockquote><p><font color="#FF0000">æ³¨æ„MySQLçš„ç‰ˆæœ¬ä¸ä¸€æ · å¯†ç å­—æ®µå°±ä¸ä¸€æ ·</font></p></blockquote><figure class="highlight powershell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs powershell">mysql&gt; desc user;<br>+------------------------+-----------------------------------+------+-----+-----------------------+-------+<br>| Field                  | <span class="hljs-built_in">Type</span>                              | Null | Key | Default               | Extra |<br>+------------------------+-----------------------------------+------+-----+-----------------------+-------+<br>| Host                   | char(<span class="hljs-number">60</span>)                          | NO   | PRI |                       |       |<br>| User                   | char(<span class="hljs-number">32</span>)                          | NO   | PRI |                       |       |<br>| authentication_string  | text                              | YES  |     | NULL                  |       |<br>.............................<br></code></pre></div></td></tr></table></figure><ol start="3"><li>ä¿®æ”¹rootå¯†ç  å…¶ä»–ç”¨æˆ·ä¹Ÿä¸€æ · </li></ol><figure class="highlight powershell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs powershell">mysql&gt; update user <span class="hljs-built_in">set</span> authentication_string=password(<span class="hljs-string">&quot;newpassword&quot;</span>) <span class="hljs-built_in">where</span> user=<span class="hljs-string">&quot;root&quot;</span> and Host=<span class="hljs-string">&quot;localhost&quot;</span>;<br></code></pre></div></td></tr></table></figure><ol start="4"><li>æ›´æ–°æƒé™</li></ol><figure class="highlight powershell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs powershell">mysql&gt; flush privileges;   <span class="hljs-comment"># åˆ·æ–°æƒé™</span><br>mysql&gt; quit;               <span class="hljs-comment"># é€€å‡º</span><br></code></pre></div></td></tr></table></figure><ol start="5"><li>å°†æ–‡ä»¶<strong>mysqld.cnf</strong> å†…çš„ <strong>skip-grant-tables</strong> åˆ é™¤ é‡å¯</li></ol><figure class="highlight powershell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs powershell">root@xswdsa:~<span class="hljs-comment"># sudo systemctl restart mysql.service</span><br></code></pre></div></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Python</category>
      
      <category>MySQL</category>
      
    </categories>
    
    
    <tags>
      
      <tag>MySQL</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MySQLè¿æ¥æŠ¥é”™ 1130é—®é¢˜</title>
    <link href="/2021/03/25/mysql1130/"/>
    <url>/2021/03/25/mysql1130/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h2 id="MySQLè¿æ¥æŠ¥é”™1130â­â­"><a href="#MySQLè¿æ¥æŠ¥é”™1130â­â­" class="headerlink" title="MySQLè¿æ¥æŠ¥é”™1130â­â­"></a><font color="#00AA00">MySQLè¿æ¥æŠ¥é”™1130â­â­</font></h2><p><code>é—®é¢˜æè¿°</code></p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">é€šè¿‡Navicat for MySQLè¿œç¨‹è¿æ¥çš„æ—¶å€™æŠ¥é”™mysql 1130çš„è§£å†³æ–¹æ³•<br>é”™è¯¯ä»£ç æ˜¯1130ï¼ŒERROR 1130: Host 1.2.7.0 is not allowed to connect to this MySQL server<br>çŒœæƒ³æ˜¯æ— æ³•ç»™è¿œç¨‹è¿æ¥çš„ç”¨æˆ·æƒé™é—®é¢˜ã€‚<br></code></pre></div></td></tr></table></figure><p><code>é—®é¢˜è§£å†³æè¿°</code></p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">åœ¨æœåŠ¡å™¨ç™»å…¥mysqlåï¼Œæ›´æ”¹ â€œmysqlâ€ æ•°æ®åº“é‡Œçš„ â€œuserâ€ è¡¨é‡Œçš„ â€œhostâ€ é¡¹ï¼Œä»â€localhostâ€æ”¹ç§°&#x27;%&#x27;ã€‚<br>ä¸‹é¢æ˜¯ç”¨SQLè¯­å¥è§£å†³é—®é¢˜ï¼š<br></code></pre></div></td></tr></table></figure><h2 id="SQLè¯­å¥è§£å†³é—®é¢˜â­â­"><a href="#SQLè¯­å¥è§£å†³é—®é¢˜â­â­" class="headerlink" title="SQLè¯­å¥è§£å†³é—®é¢˜â­â­"></a><font color="#00AA00">SQLè¯­å¥è§£å†³é—®é¢˜â­â­</font></h2><figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql">mysql <span class="hljs-operator">-</span>uroot <span class="hljs-operator">-</span>p<br><br>use mysql;<br><br><span class="hljs-keyword">select</span> <span class="hljs-string">&#x27;host&#x27;</span> <span class="hljs-keyword">from</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">where</span> <span class="hljs-keyword">user</span><span class="hljs-operator">=</span><span class="hljs-string">&#x27;root&#x27;</span>;<br><br>update <span class="hljs-keyword">user</span> <span class="hljs-keyword">set</span> host <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;%&#x27;</span> <span class="hljs-keyword">where</span> <span class="hljs-keyword">user</span><span class="hljs-operator">=</span><span class="hljs-string">&#x27;root&#x27;</span>;<br><br>flush privileges<br><br><span class="hljs-keyword">select</span> <span class="hljs-string">&#x27;host&#x27;</span> <span class="hljs-keyword">from</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">where</span> <span class="hljs-keyword">user</span><span class="hljs-operator">=</span><span class="hljs-string">&#x27;root&#x27;</span>;<br></code></pre></div></td></tr></table></figure><p><code>è§£æSQLè¯­å¥</code></p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">ç¬¬ä¸€å¥æ˜¯ä»¥æƒé™ç”¨æˆ·rootç™»å½•<br>ç¬¬äºŒå¥ï¼šé€‰æ‹©mysqlåº“<br>ç¬¬ä¸‰å¥ï¼šæŸ¥çœ‹mysqlåº“ä¸­çš„userè¡¨çš„hostå€¼ï¼ˆå³å¯è¿›è¡Œè¿æ¥è®¿é—®çš„ä¸»æœº/IPåç§°ï¼‰<br>ç¬¬å››å¥ï¼šä¿®æ”¹hostå€¼ï¼ˆä»¥é€šé…ç¬¦%çš„å†…å®¹å¢åŠ ä¸»æœº/IPåœ°å€ï¼‰ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ç›´æ¥å¢åŠ IPåœ°å€<br>ç¬¬äº”å¥ï¼šåˆ·æ–°MySQLçš„ç³»ç»Ÿæƒé™ç›¸å…³è¡¨<br>ç¬¬å…­å¥ï¼šå†é‡æ–°æŸ¥çœ‹userè¡¨æ—¶ï¼Œæœ‰ä¿®æ”¹ã€‚ã€‚<br>é‡èµ·mysqlæœåŠ¡å³å¯å®Œæˆã€‚<br></code></pre></div></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Python</category>
      
      <category>MySQL</category>
      
    </categories>
    
    
    <tags>
      
      <tag>MySQL</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç™»å½•é™åˆ¶IP</title>
    <link href="/2021/03/25/login-IP/"/>
    <url>/2021/03/25/login-IP/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h2 id="ç™»å½•-é™åˆ¶ipâ˜Ÿ"><a href="#ç™»å½•-é™åˆ¶ipâ˜Ÿ" class="headerlink" title="ç™»å½•-é™åˆ¶ipâ˜Ÿ"></a><font color="#008080">ç™»å½•-é™åˆ¶ipâ˜Ÿ</font></h2><p><strong><code>å‰æƒ…æè¦</code> <a href="#">â˜Ÿ</a></strong></p><figure class="highlight"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs nginx">ç”¨æˆ·ä½¿ç”¨æ‰‹æœºå·ç ç™»å½• æ ¡éªŒå¯†ç è¾“å…¥é”™è¯¯çš„æ¬¡æ•°<br>ä½¿ç”¨MySQLè®°å½•å¯†ç è¾“å…¥æ¬¡æ•° å½“è¾“å…¥æ¬¡æ•°è¾¾åˆ°10æ¬¡<br>ä½¿ç”¨redisè®°å½•ipåœ°å€ å°†é™åˆ¶è¯¥ipç¦æ­¢è®¿é—®é¡µé¢ 30min<br>æœ¬ç« ä½¿ç”¨: python3.6 django MySQL Redis<br></code></pre></div></td></tr></table></figure><p><img src="https://p.pstatp.com/origin/1376e0001f46d7a8f33f4" alt="æµç¨‹å›¾"></p><h2 id="ç™»å½•æ¥å£â€“-gt-GETè¯·æ±‚â˜Ÿ"><a href="#ç™»å½•æ¥å£â€“-gt-GETè¯·æ±‚â˜Ÿ" class="headerlink" title="ç™»å½•æ¥å£â€“&gt;GETè¯·æ±‚â˜Ÿ"></a><font color="#008080">ç™»å½•æ¥å£â€“&gt;GETè¯·æ±‚â˜Ÿ</font></h2><table><thead><tr><th>å‚æ•°</th><th>å€¼</th><th>å¤‡æ³¨</th><th>è¯·æ±‚æ–¹å¼</th></tr></thead><tbody><tr><td>å‚è€ƒè·¯ç”±</td><td><a href="http://127.0.0.1:8000/login/">http://127.0.0.1:8000/login/</a></td><td>ç”¨æˆ·ç™»å½•æ¥å£</td><td>GET</td></tr><tr><td>GETè¯·æ±‚</td><td>login.html</td><td>è¿”å›ç™»å½•é¡µé¢</td><td></td></tr></tbody></table><h2 id="åç«¯ä»£ç â€“-gt-django-urls"><a href="#åç«¯ä»£ç â€“-gt-django-urls" class="headerlink" title="åç«¯ä»£ç â€“&gt;django/urls"></a>åç«¯ä»£ç â€“&gt;django/urls</h2><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">from</span> django.urls <span class="hljs-keyword">import</span> re_path<br><br><span class="hljs-comment"># æ–°å¢ä¸€ä¸ªè·¯ç”±</span><br>re_path(<span class="hljs-string">r&#x27;login/$&#x27;</span>, LoginView.as_view(), name=<span class="hljs-string">&quot;login&quot;</span>),  <span class="hljs-comment"># ç™»å½•æ¥å£</span><br></code></pre></div></td></tr></table></figure><h2 id="åç«¯ä»£ç â€“-gt-django-views"><a href="#åç«¯ä»£ç â€“-gt-django-views" class="headerlink" title="åç«¯ä»£ç â€“&gt;django/views"></a>åç«¯ä»£ç â€“&gt;django/views</h2><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LoginView</span>(<span class="hljs-params">View</span>):</span><br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get</span>(<span class="hljs-params">self, request</span>):</span><br>        <span class="hljs-string">&quot;&quot;&quot;è¿”å›ç™»å½•é¡µé¢&quot;&quot;&quot;</span><br>        ip_lock = get_ip_lock(request)  <span class="hljs-comment"># get_ip_lock()è‡ªå®šä¹‰å‡½æ•° ç”¨äºè·å–ipæ˜¯å¦è¢«é”å®šé™åˆ¶</span><br>        <span class="hljs-keyword">if</span> ip_lock:<br>            response = render(request, <span class="hljs-string">&#x27;404.html&#x27;</span>, ip_lock)<br>            <span class="hljs-keyword">return</span> response<br>        <span class="hljs-keyword">return</span> render(request, <span class="hljs-string">&#x27;login.html&#x27;</span>)<br></code></pre></div></td></tr></table></figure><h2 id="åç«¯ä»£ç â€“-gt-django-utils"><a href="#åç«¯ä»£ç â€“-gt-django-utils" class="headerlink" title="åç«¯ä»£ç â€“&gt;django/utils"></a>åç«¯ä»£ç â€“&gt;django/utils</h2><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment"># è‡ªå®šä¹‰å·¥å…·åŒ… ç”¨äºè·å–ip</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_ip_lock</span>(<span class="hljs-params">request</span>):</span><br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    get lock ip</span><br><span class="hljs-string">    :param request:</span><br><span class="hljs-string">    :return:</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    x_forwarded_for = request.META.get(<span class="hljs-string">&#x27;HTTP_X_FORWARDED_FOR&#x27;</span>)<br>    <span class="hljs-keyword">if</span> x_forwarded_for:<br>        ip = x_forwarded_for.split(<span class="hljs-string">&#x27;,&#x27;</span>)[<span class="hljs-number">0</span>]<br>    <span class="hljs-keyword">else</span>:<br>        ip = request.META.get(<span class="hljs-string">&#x27;REMOTE_ADDR&#x27;</span>)<br>    <span class="hljs-keyword">try</span>:<br>        ip_lock_time = <span class="hljs-built_in">eval</span>(redis_conn.get(<span class="hljs-string">&#x27;ip_%s&#x27;</span> % ip).decode())<br>        <span class="hljs-keyword">if</span> ip_lock_time <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<br>            <span class="hljs-keyword">if</span> (datetime.datetime.now() - ip_lock_time.get(<span class="hljs-string">&#x27;time&#x27;</span>)).total_seconds() &lt; <span class="hljs-number">1800</span>:<br>                s = <span class="hljs-built_in">int</span>(<span class="hljs-number">1800</span> - (datetime.datetime.now() - ip_lock_time.get(<span class="hljs-string">&#x27;time&#x27;</span>)).total_seconds())<br>                content = &#123;<span class="hljs-string">&#x27;s_time&#x27;</span>: s&#125;<br>                <span class="hljs-keyword">return</span> content<br>    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-keyword">pass</span><br></code></pre></div></td></tr></table></figure><h2 id="ç™»å½•æ¥å£â€“-gt-POSTè¯·æ±‚â˜Ÿ"><a href="#ç™»å½•æ¥å£â€“-gt-POSTè¯·æ±‚â˜Ÿ" class="headerlink" title="ç™»å½•æ¥å£â€“&gt;POSTè¯·æ±‚â˜Ÿ"></a><font color="#008080">ç™»å½•æ¥å£â€“&gt;POSTè¯·æ±‚â˜Ÿ</font></h2><table><thead><tr><th>å‚æ•°</th><th>å€¼</th><th>å¤‡æ³¨</th><th>è¯·æ±‚æ–¹å¼</th></tr></thead><tbody><tr><td>username/mobile</td><td>kiki/13412345678</td><td>ç”¨æˆ·å/æ‰‹æœºå·</td><td>POST</td></tr><tr><td>password</td><td>kiokiokiokio</td><td>å¯†ç </td><td></td></tr></tbody></table><h2 id="åç«¯ä»£ç â€“-gt-django-views-1"><a href="#åç«¯ä»£ç â€“-gt-django-views-1" class="headerlink" title="åç«¯ä»£ç â€“&gt;django/views"></a>åç«¯ä»£ç â€“&gt;django/views</h2><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">post</span>(<span class="hljs-params">self, request</span>):</span><br>    username = <span class="hljs-built_in">str</span>(request.POST.get(<span class="hljs-string">&#x27;username&#x27;</span>)).strip()<br>    password = <span class="hljs-built_in">str</span>(request.POST.get(<span class="hljs-string">&#x27;password&#x27;</span>)).strip()<br>    remembered = request.POST.get(<span class="hljs-string">&#x27;remembered&#x27;</span>)<br>    x_forwarded_for = request.META.get(<span class="hljs-string">&#x27;HTTP_X_FORWARDED_FOR&#x27;</span>)<br>    <span class="hljs-keyword">if</span> x_forwarded_for:<br>        ip = x_forwarded_for.split(<span class="hljs-string">&#x27;,&#x27;</span>)[<span class="hljs-number">0</span>]<br>    <span class="hljs-keyword">else</span>:<br>        ip = request.META.get(<span class="hljs-string">&#x27;REMOTE_ADDR&#x27;</span>)<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-built_in">all</span>([username, password]):<br>       <span class="hljs-keyword">return</span> render(request, <span class="hljs-string">&#x27;login.html&#x27;</span>, &#123;<span class="hljs-string">&#x27;account_errmsg&#x27;</span>: <span class="hljs-string">&#x27;ç¼ºå°‘å‚æ•°,è¯·æ£€æŸ¥&#x27;</span>&#125;)<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> re.match(<span class="hljs-string">r&#x27;^[0-9a-zA-Z]&#123;8,20&#125;$&#x27;</span>, password):<br>       <span class="hljs-keyword">return</span> render(request, <span class="hljs-string">&#x27;login.html&#x27;</span>, &#123;<span class="hljs-string">&#x27;account_errmsg&#x27;</span>: <span class="hljs-string">&#x27;å¯†ç é•¿åº¦8-20ä¹‹é—´çš„è‹±æ–‡ä¸æ•°å­—&#x27;</span>&#125;)<br>    user = auth.authenticate(username=username, password=password)<br>    <span class="hljs-keyword">if</span> user <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:<br>        <span class="hljs-keyword">try</span>:<br>            user = User.objects.get(Q(username=username) | Q(email=username) | Q(mobile=username))<br>            get_lock_user(user, ip)  <span class="hljs-comment"># è·å–è´¦å·è¾“å…¥çš„å¯†ç é”™è¯¯æ¬¡æ•°è®°å½•ä¸ipè®°å½•</span><br>            <span class="hljs-keyword">if</span> user.pass_error &gt;= <span class="hljs-number">10</span>:<br>                <span class="hljs-keyword">return</span> render(request, <span class="hljs-string">&#x27;login.html&#x27;</span>, &#123;<span class="hljs-string">&#x27;account_errmsg&#x27;</span>: <span class="hljs-string">&#x27;å¯†ç é”™è¯¯è¶…è¿‡10æ¬¡ï¼Œç”¨æˆ·é”å®šåŠå°æ—¶&#x27;</span>&#125;)<br>            <span class="hljs-keyword">elif</span> <span class="hljs-number">5</span> &lt;= user.pass_error &lt;= <span class="hljs-number">9</span>:<br>                <span class="hljs-keyword">return</span> render(request, <span class="hljs-string">&#x27;login.html&#x27;</span>, &#123;<span class="hljs-string">&#x27;account_errmsg&#x27;</span>: <span class="hljs-string">&#x27;å¯†ç é”™è¯¯è¶…è¿‡5æ¬¡ï¼Œç”¨æˆ·é”å®šååˆ†é’Ÿ&#x27;</span>&#125;)<br>        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>            <span class="hljs-keyword">return</span> render(request, <span class="hljs-string">&#x27;login.html&#x27;</span>, &#123;<span class="hljs-string">&#x27;account_errmsg&#x27;</span>: <span class="hljs-string">&#x27;æš‚æ— è¯¥è´¦æˆ·,è¯·å…ˆæ³¨å†Œ&#x27;</span>&#125;)<br>        <span class="hljs-keyword">return</span> render(request, <span class="hljs-string">&#x27;login.html&#x27;</span>, &#123;<span class="hljs-string">&#x27;account_errmsg&#x27;</span>: <span class="hljs-string">&#x27;è´¦å·æˆ–å¯†ç è¾“å…¥æœ‰è¯¯,è¯·æ£€æŸ¥&#x27;</span>&#125;)<br>    <span class="hljs-keyword">if</span> user.is_login:<br>        <span class="hljs-keyword">return</span> render(request, <span class="hljs-string">&#x27;login.html&#x27;</span>, &#123;<span class="hljs-string">&#x27;account_errmsg&#x27;</span>: <span class="hljs-string">&#x27;è¯¥è´¦å·å·²ç™»å½•&#x27;</span>&#125;)<br>    <span class="hljs-keyword">if</span> <span class="hljs-number">5</span> &lt;= user.pass_error &lt; <span class="hljs-number">10</span>:<br>        <span class="hljs-keyword">if</span> (datetime.datetime.now() - user.login_lock).total_seconds() &lt; <span class="hljs-number">600</span>:<br>            <span class="hljs-keyword">return</span> render(request, <span class="hljs-string">&#x27;login.html&#x27;</span>, &#123;<span class="hljs-string">&#x27;account_errmsg&#x27;</span>: <span class="hljs-string">&#x27;è´¦å·é”å®šååˆ†é’Ÿå†…ä¸èƒ½ç™»é™†æˆåŠŸ!&#x27;</span>&#125;)<br>    login(request, user)<br>    <span class="hljs-keyword">if</span> remembered != <span class="hljs-string">&#x27;on&#x27;</span>:<br>        request.session.set_expiry(<span class="hljs-number">7</span> * <span class="hljs-number">24</span> * <span class="hljs-number">3600</span>)<br>    <span class="hljs-keyword">else</span>:<br>        request.session.set_expiry(<span class="hljs-number">7</span> * <span class="hljs-number">24</span> * <span class="hljs-number">3600</span>)<br>    <span class="hljs-built_in">next</span> = request.GET.get(<span class="hljs-string">&#x27;next&#x27;</span>)<br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">next</span>:<br>        response = redirect(<span class="hljs-built_in">next</span>)<br>    <span class="hljs-keyword">else</span>:<br>        response = redirect(reverse(<span class="hljs-string">&#x27;alex_index:index&#x27;</span>))<br>    get_login_user(user)  <span class="hljs-comment"># ç”¨æˆ·ç™»å½•æˆåŠŸ åˆ™å°†è®°å½•æ¸…é™¤ä¸º0</span><br>    response.set_cookie(<span class="hljs-string">&#x27;username&#x27;</span>, user.username, max_age=<span class="hljs-number">7</span> * <span class="hljs-number">24</span> * <span class="hljs-number">3600</span>)<br>    <span class="hljs-keyword">return</span> response<br></code></pre></div></td></tr></table></figure><h2 id="åç«¯ä»£ç â€“-gt-django-utils-1"><a href="#åç«¯ä»£ç â€“-gt-django-utils-1" class="headerlink" title="åç«¯ä»£ç â€“&gt;django/utils"></a>åç«¯ä»£ç â€“&gt;django/utils</h2><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_lock_user</span>(<span class="hljs-params">user, ip</span>):</span><br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    get lock user</span><br><span class="hljs-string">    :param user:</span><br><span class="hljs-string">    :param ip:</span><br><span class="hljs-string">    :return:</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-keyword">if</span> user.ip <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span> <span class="hljs-keyword">or</span> user.ip != ip:<br>        user.ip = ip<br>    user.login_lock = datetime.datetime.now()<br>    user.pass_error += <span class="hljs-number">1</span><br>    <span class="hljs-keyword">if</span> user.pass_error &gt;= <span class="hljs-number">10</span>:  <span class="hljs-comment"># if pass_error &gt; 10 lockIP å½“å¯†ç é”™è¯¯è®°å½•åˆ°10</span><br>        lock_ip_time = &#123;<span class="hljs-string">&quot;time&quot;</span>: datetime.datetime.now(), <span class="hljs-string">&#x27;ip&#x27;</span>: ip&#125;  <span class="hljs-comment"># è®°å½•å½“å‰æ—¶é—´ä¸ip</span><br>        redis_conn.setex(<span class="hljs-string">&#x27;ip_%s&#x27;</span> % ip, constants.IP_LOCK_TIME, <span class="hljs-built_in">str</span>(lock_ip_time))  <span class="hljs-comment"># redisè®°å½•ip</span><br>    user.save()<br></code></pre></div></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Python</category>
      
      <category>æŠ€æœ¯æ‚è°ˆ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Jwt_tokençš„è®¤è¯ä¸ç”Ÿæˆ</title>
    <link href="/2021/03/25/Jwt_token/"/>
    <url>/2021/03/25/Jwt_token/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h2 id="JWTçš„ç®€å•ä½¿ç”¨"><a href="#JWTçš„ç®€å•ä½¿ç”¨" class="headerlink" title="JWTçš„ç®€å•ä½¿ç”¨"></a><font color="#00ffff">JWTçš„ç®€å•ä½¿ç”¨</font></h2><h2 id="TIP-å®‰è£…æ¨¡å—-jwtæ˜¯ä¸€ä¸ªç¬¬ä¸‰æ–¹æ¨¡å—"><a href="#TIP-å®‰è£…æ¨¡å—-jwtæ˜¯ä¸€ä¸ªç¬¬ä¸‰æ–¹æ¨¡å—" class="headerlink" title="TIP:å®‰è£…æ¨¡å— jwtæ˜¯ä¸€ä¸ªç¬¬ä¸‰æ–¹æ¨¡å—"></a><font color=" LimeGreen ">TIP:å®‰è£…æ¨¡å— jwtæ˜¯ä¸€ä¸ªç¬¬ä¸‰æ–¹æ¨¡å—</font></h2><figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">pip install djangorestframework-jwt -i https://pypi.douban.com/simple/<br></code></pre></div></td></tr></table></figure><h2 id="TIP-JWTçš„ä½¿ç”¨-ä¸€-è‡ªå®šä¹‰è¿”å›çš„"><a href="#TIP-JWTçš„ä½¿ç”¨-ä¸€-è‡ªå®šä¹‰è¿”å›çš„" class="headerlink" title="TIP:JWTçš„ä½¿ç”¨ (ä¸€) è‡ªå®šä¹‰è¿”å›çš„"></a><font color=" LimeGreen ">TIP:JWTçš„ä½¿ç”¨ (ä¸€) è‡ªå®šä¹‰è¿”å›çš„</font></h2><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment"># settings.py é‡Œé¢é…ç½®ä¸€ä¸‹</span><br><br>REST_FRAMEWORK = &#123;<br>    <span class="hljs-comment"># å¼•å…¥JWTè®¤è¯æœºåˆ¶ï¼Œå½“å®¢æˆ·ç«¯å°†jwt tokenä¼ é€’ç»™æœåŠ¡å™¨ä¹‹å</span><br>    <span class="hljs-comment"># æ­¤è®¤è¯æœºåˆ¶ä¼šè‡ªåŠ¨æ ¡éªŒjwt tokençš„æœ‰æ•ˆæ€§ï¼Œæ— æ•ˆä¼šç›´æ¥è¿”å›401(æœªè®¤è¯é”™è¯¯)</span><br>    <span class="hljs-string">&#x27;DEFAULT_AUTHENTICATION_CLASSES&#x27;</span>: (<br>        <span class="hljs-string">&#x27;rest_framework_jwt.authentication.JSONWebTokenAuthentication&#x27;</span>,<br>        <span class="hljs-string">&#x27;rest_framework.authentication.SessionAuthentication&#x27;</span>,<br>        <span class="hljs-string">&#x27;rest_framework.authentication.BasicAuthentication&#x27;</span>,<br>    ),<br>    <span class="hljs-string">&#x27;PAGE_SIZE&#x27;</span>: <span class="hljs-number">100</span>,  <span class="hljs-comment"># æ˜¾ç¤ºå¤šå°‘æ•°æ®</span><br>    <span class="hljs-string">&#x27;DEFAULT_PAGINATION_CLASS&#x27;</span>: <span class="hljs-string">&#x27;rest_framework.pagination.PageNumberPagination&#x27;</span>,  <span class="hljs-comment"># é˜²æ­¢è·³å‡º è­¦å‘Š</span><br>&#125;<br><br><span class="hljs-comment"># JWTæ‰©å±•é…ç½®</span><br>JWT_AUTH = &#123;<br>    <span class="hljs-comment"># é‡æ–°å®šä¹‰jwtè®¤è¯æˆåŠŸåè¿”å›çš„æ•°æ® days(å¤©) hours(æ—¶) minutes(åˆ†)</span><br>    <span class="hljs-string">&#x27;JWT_EXPIRATION_DELTA&#x27;</span>: datetime.timedelta(days=<span class="hljs-number">1</span>),  <span class="hljs-comment"># å®šä¹‰tokenè¿‡æœŸæ—¶é—´1å¤©</span><br>&#125;<br></code></pre></div></td></tr></table></figure><h2 id="TIP-æ‰‹åŠ¨ç”Ÿæˆ-JWT-token"><a href="#TIP-æ‰‹åŠ¨ç”Ÿæˆ-JWT-token" class="headerlink" title="TIP: æ‰‹åŠ¨ç”Ÿæˆ JWT token"></a><font color=" LimeGreen ">TIP: æ‰‹åŠ¨ç”Ÿæˆ JWT token</font></h2><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment"># è¯¥æ–¹æ³• åœ¨åé¢ä¼šç”¨!!!</span><br><br><span class="hljs-keyword">from</span> rest_framework_jwt.settings <span class="hljs-keyword">import</span> api_settings<br><br>jwt_payload_handler = api_settings.JWT_PAYLOAD_HANDLER<br>jwt_encode_handler = api_settings.JWT_ENCODE_HANDLER<br><br>payload = jwt_payload_handler(user)<br>token = jwt_encode_handler(payload)<br></code></pre></div></td></tr></table></figure><h2 id="TIP-å­åº”ç”¨â€”æ¨¡å‹ç±»â€”views-py"><a href="#TIP-å­åº”ç”¨â€”æ¨¡å‹ç±»â€”views-py" class="headerlink" title="TIP: å­åº”ç”¨â€”æ¨¡å‹ç±»â€”views.py"></a><font color=" LimeGreen ">TIP: å­åº”ç”¨â€”æ¨¡å‹ç±»â€”views.py</font></h2><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment"># models.py</span><br><br><span class="hljs-keyword">from</span> django.contrib.auth.models <span class="hljs-keyword">import</span> AbstractUser<br><span class="hljs-keyword">from</span> django.db <span class="hljs-keyword">import</span> models<br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span>(<span class="hljs-params">AbstractUser</span>):</span><br>    <span class="hljs-string">&quot;&quot;&quot;è‡ªå®šä¹‰ç”¨æˆ·æ¨¡å‹ç±»&quot;&quot;&quot;</span><br>    mobile = models.CharField(max_length=<span class="hljs-number">11</span>, unique=<span class="hljs-literal">True</span>, verbose_name=<span class="hljs-string">&#x27;Mobile&#x27;</span>)<br><br>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Meta</span>:</span><br>        db_table = <span class="hljs-string">&#x27;tb_users&#x27;</span><br>        verbose_name = <span class="hljs-string">&#x27;ç”¨æˆ·&#x27;</span><br>        verbose_name_plural = verbose_name<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__str__</span>(<span class="hljs-params">self</span>):</span><br>        <span class="hljs-keyword">return</span> self.username<br><br></code></pre></div></td></tr></table></figure><h2 id="TIP-å­åº”ç”¨é‡Œçš„-urls-py"><a href="#TIP-å­åº”ç”¨é‡Œçš„-urls-py" class="headerlink" title="TIP: å­åº”ç”¨é‡Œçš„ urls.py"></a><font color=" LimeGreen ">TIP: å­åº”ç”¨é‡Œçš„ urls.py</font></h2><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment"># urls.py</span><br><br><span class="hljs-comment"># coding:utf-8</span><br><span class="hljs-keyword">from</span> django.conf.urls <span class="hljs-keyword">import</span> url<br><br><span class="hljs-keyword">from</span> apps.user.views <span class="hljs-keyword">import</span> *<br><br>app_name = <span class="hljs-string">&#x27;user&#x27;</span><br>urlpatterns = [<br>    url(<span class="hljs-string">r&#x27;^register/$&#x27;</span>, RegisterView.as_view()),  <span class="hljs-comment"># ç”¨æˆ·æ³¨å†Œæ¥å£</span><br>    url(<span class="hljs-string">r&#x27;^mobiles/$&#x27;</span>, MobileCountView.as_view()),  <span class="hljs-comment"># æ ¡éªŒæ‰‹æœºå·ç æ˜¯å¦æ³¨å†Œè¿‡</span><br>    url(<span class="hljs-string">r&#x27;^login/$&#x27;</span>, AdminAuthorizeView.as_view()),  <span class="hljs-comment"># ç”¨æˆ·jwtè®¤è¯æ¥å£</span><br>]<br></code></pre></div></td></tr></table></figure><h2 id="TIP-views-py"><a href="#TIP-views-py" class="headerlink" title="TIP: views.py "></a><font color=" LimeGreen ">TIP: views.py </font></h2><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment"># coding:utf-8</span><br><span class="hljs-keyword">import</span> re<br><br><span class="hljs-keyword">from</span> django <span class="hljs-keyword">import</span> http<br><span class="hljs-keyword">from</span> django.contrib.auth <span class="hljs-keyword">import</span> authenticate, login<br><span class="hljs-keyword">from</span> django.views <span class="hljs-keyword">import</span> View<br><span class="hljs-keyword">from</span> django_redis <span class="hljs-keyword">import</span> get_redis_connection<br><span class="hljs-keyword">from</span> pymysql <span class="hljs-keyword">import</span> DatabaseError<br><span class="hljs-keyword">from</span> rest_framework.response <span class="hljs-keyword">import</span> Response<br><span class="hljs-keyword">from</span> rest_framework.views <span class="hljs-keyword">import</span> APIView<br><span class="hljs-keyword">from</span> rest_framework_jwt.settings <span class="hljs-keyword">import</span> api_settings<br><br><span class="hljs-keyword">from</span> apps.user.models <span class="hljs-keyword">import</span> User<br><span class="hljs-keyword">from</span> utils.response_code <span class="hljs-keyword">import</span> RET<br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AdminAuthorizeView</span>(<span class="hljs-params">APIView</span>):</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">post</span>(<span class="hljs-params">self, request</span>):</span><br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        ç™»å½•</span><br><span class="hljs-string">        :param request:</span><br><span class="hljs-string">        :return:</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        username = request.POST.get(<span class="hljs-string">&#x27;username&#x27;</span>)<br>        password = request.POST.get(<span class="hljs-string">&#x27;password&#x27;</span>)<br><br>        <span class="hljs-keyword">if</span> username <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span> <span class="hljs-keyword">or</span> password <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:<br>            <span class="hljs-keyword">return</span> Response(&#123;<span class="hljs-string">&#x27;code&#x27;</span>: <span class="hljs-number">500</span>, <span class="hljs-string">&#x27;message&#x27;</span>: <span class="hljs-string">&#x27;è¯·æ±‚å‚æ•°é”™è¯¯&#x27;</span>&#125;)<br><br>        is_login = authenticate(request, username=username, password=password)<br>        <span class="hljs-keyword">if</span> is_login <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:<br>            <span class="hljs-keyword">return</span> Response(&#123;<span class="hljs-string">&#x27;code&#x27;</span>: <span class="hljs-number">500</span>, <span class="hljs-string">&#x27;message&#x27;</span>: <span class="hljs-string">&#x27;è´¦å·æˆ–å¯†ç é”™è¯¯&#x27;</span>&#125;)<br><br>        login(request, is_login) <span class="hljs-comment"># ä¿å­˜ç™»å½•çŠ¶æ€ ä½†æ²¡å¿…è¦ å› ä¸ºå·²ç»æ˜¯ jwtè®¤è¯äº†</span><br><span class="hljs-comment">### æ­¤å¤„ä¸ºç”Ÿæˆ token çš„åœ°æ–¹ ###</span><br>        jwt_payload_handler = api_settings.JWT_PAYLOAD_HANDLER<br>        jwt_encode_handler = api_settings.JWT_ENCODE_HANDLER<br>        payload = jwt_payload_handler(is_login)<br>        token = jwt_encode_handler(payload)<br>        <span class="hljs-keyword">return</span> Response(&#123;<span class="hljs-string">&#x27;code&#x27;</span>: RET.OK, <span class="hljs-string">&#x27;message&#x27;</span>: <span class="hljs-string">&quot;ç™»å½•æˆåŠŸ&quot;</span>, <span class="hljs-string">&quot;token&quot;</span>: token&#125;)<br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RegisterView</span>(<span class="hljs-params">APIView</span>):</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">post</span>(<span class="hljs-params">self, request</span>):</span><br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        æ³¨å†Œ</span><br><span class="hljs-string">        :param request:</span><br><span class="hljs-string">        :return:</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        password = request.POST.get(<span class="hljs-string">&#x27;password&#x27;</span>)<br>        mobile = request.POST.get(<span class="hljs-string">&#x27;mobile&#x27;</span>)<br>        <span class="hljs-comment"># çŸ­ä¿¡éªŒè¯ç </span><br>        <span class="hljs-comment"># sms_code = request.POST.get(&#x27;sms_code&#x27;)</span><br><br>        <span class="hljs-comment"># åˆ¤æ–­å‚æ•°æ˜¯å¦é½å…¨</span><br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-built_in">all</span>([password, mobile]):<br>            <span class="hljs-keyword">return</span> http.HttpResponseBadRequest(<span class="hljs-string">&#x27;ç¼ºå°‘å¿…ä¼ å‚æ•°&#x27;</span>)<br>        <span class="hljs-comment"># åˆ¤æ–­å¯†ç æ˜¯å¦æ˜¯8-20ä¸ªæ•°å­—</span><br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> re.match(<span class="hljs-string">r&#x27;^[0-9A-Za-z]&#123;8,20&#125;$&#x27;</span>, password):<br>            <span class="hljs-keyword">return</span> http.HttpResponseBadRequest(<span class="hljs-string">&#x27;è¯·è¾“å…¥8-20ä½çš„å¯†ç &#x27;</span>)<br>        <span class="hljs-comment"># åˆ¤æ–­æ‰‹æœºå·æ˜¯å¦åˆæ³•</span><br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> re.match(<span class="hljs-string">r&#x27;^1[3-9]\d&#123;9&#125;$&#x27;</span>, mobile):<br>            <span class="hljs-keyword">return</span> http.HttpResponseBadRequest(<span class="hljs-string">&#x27;è¯·è¾“å…¥æ­£ç¡®çš„æ‰‹æœºå·ç &#x27;</span>)<br><br>        <span class="hljs-comment"># redis_conn = get_redis_connection(&#x27;code&#x27;)</span><br>        <span class="hljs-comment"># sms_code_saved = redis_conn.get(&#x27;sms_%s&#x27; % mobile)</span><br>        <span class="hljs-comment"># if sms_code_saved is None:</span><br>        <span class="hljs-comment">#    return Response(&#123;&#x27;code&#x27;: RET.NODATA, &#x27;errmsg&#x27;: &#x27;æ— æ•ˆçš„éªŒè¯ç &#x27;&#125;)</span><br>        <span class="hljs-comment"># if sms_code != sms_code_saved.decode():</span><br>        <span class="hljs-comment">#    return Response(&#123;&#x27;code&#x27;: RET.DATAERR, &#x27;errmsg&#x27;: &#x27;éªŒè¯ç è¾“å…¥é”™è¯¯&#x27;&#125;)</span><br><br>        <span class="hljs-keyword">try</span>:<br>            User.objects.create_user(username=mobile, password=password, mobile=mobile)<br>        <span class="hljs-keyword">except</span> DatabaseError:<br>            <span class="hljs-keyword">return</span> Response(&#123;<span class="hljs-string">&#x27;code&#x27;</span>: RET.DBERR, <span class="hljs-string">&#x27;message&#x27;</span>: <span class="hljs-string">&#x27;æ³¨å†Œå¤±è´¥&#x27;</span>&#125;)<br><br>        <span class="hljs-keyword">return</span> Response(&#123;<span class="hljs-string">&#x27;code&#x27;</span>: RET.OK, <span class="hljs-string">&#x27;message&#x27;</span>: <span class="hljs-string">&quot;å®Œæˆæ³¨å†Œ&quot;</span>&#125;)<br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MobileCountView</span>(<span class="hljs-params">View</span>):</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get</span>(<span class="hljs-params">self, request</span>):</span><br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        æ ¡éªŒæ‰‹æœºå·ç æ˜¯å¦é‡å¤æ³¨å†Œ</span><br><span class="hljs-string">        :param request:</span><br><span class="hljs-string">        :return:</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        mobile = request.GET.get(<span class="hljs-string">&#x27;mobile&#x27;</span>)<br>        count = User.objects.<span class="hljs-built_in">filter</span>(mobile=mobile).count()<br>        <span class="hljs-keyword">return</span> http.JsonResponse(&#123;<span class="hljs-string">&#x27;code&#x27;</span>: RET.OK, <span class="hljs-string">&#x27;count&#x27;</span>: count&#125;)<br><br></code></pre></div></td></tr></table></figure><h2 id="å‰ç«¯è¿”å›tokenå-åç«¯æ ¡éªŒtoken"><a href="#å‰ç«¯è¿”å›tokenå-åç«¯æ ¡éªŒtoken" class="headerlink" title="å‰ç«¯è¿”å›tokenå,åç«¯æ ¡éªŒtoken"></a><font color="#00ffff">å‰ç«¯è¿”å›tokenå,åç«¯æ ¡éªŒtoken</font></h2><h2 id="TIP-å®‰è£…cors"><a href="#TIP-å®‰è£…cors" class="headerlink" title="TIP:å®‰è£…cors"></a><font color=" LimeGreen ">TIP:å®‰è£…cors</font></h2><figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">pip install django-cors-headers<br></code></pre></div></td></tr></table></figure><h2 id="TIP-å‰åç«¯åˆ†ç¦»-ä¼šæœ‰è·¨åŸŸçš„é—®é¢˜-å¹¶ä¸”-æ²¡æœ‰ä½¿ç”¨åˆ°-COOKIES-SESSIONS"><a href="#TIP-å‰åç«¯åˆ†ç¦»-ä¼šæœ‰è·¨åŸŸçš„é—®é¢˜-å¹¶ä¸”-æ²¡æœ‰ä½¿ç”¨åˆ°-COOKIES-SESSIONS" class="headerlink" title="TIP: å‰åç«¯åˆ†ç¦» ä¼šæœ‰è·¨åŸŸçš„é—®é¢˜ å¹¶ä¸” æ²¡æœ‰ä½¿ç”¨åˆ° COOKIES SESSIONS"></a><font color=" LimeGreen ">TIP: å‰åç«¯åˆ†ç¦» ä¼šæœ‰è·¨åŸŸçš„é—®é¢˜ å¹¶ä¸” æ²¡æœ‰ä½¿ç”¨åˆ° COOKIES SESSIONS</font></h2><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment"># settings.py</span><br>INSTALLED_APPS = [<br>    <span class="hljs-string">&#x27;django.contrib.admin&#x27;</span>,<br>    <span class="hljs-string">&#x27;django.contrib.auth&#x27;</span>,<br>    <span class="hljs-string">&#x27;django.contrib.contenttypes&#x27;</span>,<br>    <span class="hljs-string">&#x27;django.contrib.sessions&#x27;</span>,<br>    <span class="hljs-string">&#x27;django.contrib.messages&#x27;</span>,<br>    <span class="hljs-string">&#x27;django.contrib.staticfiles&#x27;</span>,<br>    <span class="hljs-string">&#x27;rest_framework&#x27;</span>,<br>    <span class="hljs-string">&#x27;apps.user&#x27;</span>,  <span class="hljs-comment"># user</span><br>    <span class="hljs-string">&#x27;corsheaders&#x27;</span>,  <span class="hljs-comment"># è·¨åŸŸ</span><br>]<br><br>MIDDLEWARE = [<br>    <span class="hljs-string">&#x27;corsheaders.middleware.CorsMiddleware&#x27;</span>,  <span class="hljs-comment"># è·¨åŸŸ</span><br>    <span class="hljs-string">&#x27;django.middleware.security.SecurityMiddleware&#x27;</span>,<br>    <span class="hljs-string">&#x27;django.contrib.sessions.middleware.SessionMiddleware&#x27;</span>,<br>    <span class="hljs-string">&#x27;django.middleware.common.CommonMiddleware&#x27;</span>,<br>    <span class="hljs-string">&#x27;django.middleware.csrf.CsrfViewMiddleware&#x27;</span>,<br>    <span class="hljs-string">&#x27;django.contrib.auth.middleware.AuthenticationMiddleware&#x27;</span>,<br>    <span class="hljs-string">&#x27;django.contrib.messages.middleware.MessageMiddleware&#x27;</span>,<br>    <span class="hljs-string">&#x27;django.middleware.clickjacking.XFrameOptionsMiddleware&#x27;</span>,<br>]<br><br><span class="hljs-comment"># è·¨åŸŸå¢åŠ å¿½ç•¥</span><br>CORS_ALLOW_CREDENTIALS = <span class="hljs-literal">True</span>  <span class="hljs-comment"># å…è®¸æºå¸¦cookie</span><br>CORS_ORIGIN_ALLOW_ALL = <span class="hljs-literal">True</span><br><span class="hljs-comment"># è®¾ç½®å…è®¸çš„è¯·æ±‚</span><br>CORS_ALLOW_METHODS = (<br>    <span class="hljs-string">&#x27;DELETE&#x27;</span>,<br>    <span class="hljs-string">&#x27;GET&#x27;</span>,<br>    <span class="hljs-string">&#x27;OPTIONS&#x27;</span>,<br>    <span class="hljs-string">&#x27;PATCH&#x27;</span>,<br>    <span class="hljs-string">&#x27;POST&#x27;</span>,<br>    <span class="hljs-string">&#x27;PUT&#x27;</span>,<br>    <span class="hljs-string">&#x27;VIEW&#x27;</span>,<br>)<br><span class="hljs-comment"># è®¾ç½®å…è®¸çš„header</span><br>CORS_ALLOW_HEADERS = (<br>    <span class="hljs-string">&#x27;XMLHttpRequest&#x27;</span>,<br>    <span class="hljs-string">&#x27;X_FILENAME&#x27;</span>,<br>    <span class="hljs-string">&#x27;accept-encoding&#x27;</span>,<br>    <span class="hljs-string">&#x27;authorization&#x27;</span>,<br>    <span class="hljs-string">&#x27;content-type&#x27;</span>,<br>    <span class="hljs-string">&#x27;dnt&#x27;</span>,<br>    <span class="hljs-string">&#x27;origin&#x27;</span>,<br>    <span class="hljs-string">&#x27;user-agent&#x27;</span>,<br>    <span class="hljs-string">&#x27;x-csrftoken&#x27;</span>,<br>    <span class="hljs-string">&#x27;x-requested-with&#x27;</span>,<br>    <span class="hljs-string">&#x27;Pragma&#x27;</span>,<br>)<br><br></code></pre></div></td></tr></table></figure><h2 id="TIP-è‡ªå®šä¹‰åŸºäºjwtçš„æƒé™ç±»-ç¬¬ä¸€ç§æ–¹æ³•"><a href="#TIP-è‡ªå®šä¹‰åŸºäºjwtçš„æƒé™ç±»-ç¬¬ä¸€ç§æ–¹æ³•" class="headerlink" title=" TIP: è‡ªå®šä¹‰åŸºäºjwtçš„æƒé™ç±» (ç¬¬ä¸€ç§æ–¹æ³•)"></a><font color=" LimeGreen "> TIP: è‡ªå®šä¹‰åŸºäºjwtçš„æƒé™ç±» (ç¬¬ä¸€ç§æ–¹æ³•)</font></h2><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment"># æ–°å»ºä¸€ä¸ªauth.py ç”¨äºè®¤è¯ç”¨æˆ·æ˜¯å¦ç™»å½• åœ¨ä¸€äº›éœ€è¦ç™»å½•åæ‰èƒ½è®¿é—®çš„è§†å›¾åšæ ¡éªŒ</span><br><br><span class="hljs-keyword">from</span> rest_framework.authentication <span class="hljs-keyword">import</span> BaseAuthentication<br><span class="hljs-keyword">from</span> rest_framework_jwt.authentication <span class="hljs-keyword">import</span> jwt_decode_handler<br><span class="hljs-keyword">from</span> rest_framework.exceptions <span class="hljs-keyword">import</span> AuthenticationFailed<br><span class="hljs-keyword">import</span> jwt<br><span class="hljs-keyword">from</span> apps.user.models <span class="hljs-keyword">import</span> User<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyBaseAuthentication</span>(<span class="hljs-params">BaseAuthentication</span>):</span><br>    <span class="hljs-comment"># é‡å†™authenticate</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">authenticate</span>(<span class="hljs-params">self, request</span>):</span><br>        <span class="hljs-comment"># è·å–tokençš„ç¬¬äºŒéƒ¨åˆ†</span><br>        jwt_value = request.META.get(<span class="hljs-string">&#x27;HTTP_AUTHORIZATION&#x27;</span>)<br>        <span class="hljs-comment"># æ³¨æ„æ­¤å¤„ä¸º postman çš„æ—¶å€™è¯·æ±‚ ä¼šå¸¦æœ‰ Bearer æ‰€ä»¥ä½¿ç”¨äº†åˆ‡å‰²å­—ç¬¦ä¸²</span><br>        jwt_value = jwt_value.split()[<span class="hljs-number">1</span>]  <span class="hljs-comment"># æµè§ˆå™¨è¯·æ±‚å¤´ä¸Šä¼ çš„æ—¶å€™ å¯ä»¥å°†æ­¤å¥æ³¨é‡Šæ‰</span><br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> jwt_value:<br>            <span class="hljs-comment"># å¦‚æœæ²¡æœ‰å°±æŠ›å¼‚å¸¸</span><br>            <span class="hljs-keyword">raise</span> AuthenticationFailed(<span class="hljs-string">&#x27;æ‚¨æ²¡æœ‰æºå¸¦è®¤è¯ä¿¡æ¯&#x27;</span>)<br>        <span class="hljs-keyword">try</span>:<br>            <span class="hljs-comment"># å°†tokenåè§£æˆç”¨æˆ·ä¿¡æ¯å­—å…¸</span><br>            payload = jwt_decode_handler(jwt_value)<br>        <span class="hljs-keyword">except</span> jwt.ExpiredSignature:<br>            <span class="hljs-keyword">raise</span> AuthenticationFailed(<span class="hljs-string">&#x27;è®¤è¯è¶…æ—¶&#x27;</span>)<br>        <span class="hljs-keyword">except</span> jwt.InvalidTokenError:<br>            <span class="hljs-keyword">raise</span> AuthenticationFailed(<span class="hljs-string">&#x27;éæ³•ç”¨æˆ·&#x27;</span>)<br>        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>            <span class="hljs-keyword">raise</span> AuthenticationFailed(<span class="hljs-built_in">str</span>(e))<br>        <span class="hljs-comment"># ç›´æ¥è¿”å›å¯¹è±¡ ä¸æŸ¥åº“ï¼Œé€Ÿåº¦å¿«äº›ï¼ˆåªèƒ½è·å–ä¼ å…¥çš„å‚æ•°çš„å€¼ï¼‰</span><br>        <span class="hljs-comment"># user = User(id=payload.get(&#x27;user_id&#x27;), username=payload.get(&#x27;username&#x27;))</span><br>        <span class="hljs-comment"># å»æ•°æ®åº“ä¸­æŸ¥æ‰¾è·å–userå¯¹è±¡ï¼ˆèƒ½è·å–çš„å­—æ®µæ›´å¤šï¼‰</span><br>        user = User.objects.<span class="hljs-built_in">filter</span>(pk=payload.get(<span class="hljs-string">&#x27;user_id&#x27;</span>)).first()<br>        <span class="hljs-keyword">return</span> user, jwt_value<br></code></pre></div></td></tr></table></figure><h2 id="TIP-è‡ªå®šä¹‰åŸºäºjwtçš„æƒé™ç±»-ç¬¬äºŒç§æ–¹æ³•"><a href="#TIP-è‡ªå®šä¹‰åŸºäºjwtçš„æƒé™ç±»-ç¬¬äºŒç§æ–¹æ³•" class="headerlink" title="TIP: è‡ªå®šä¹‰åŸºäºjwtçš„æƒé™ç±» (ç¬¬äºŒç§æ–¹æ³•) "></a><font color=" LimeGreen ">TIP: è‡ªå®šä¹‰åŸºäºjwtçš„æƒé™ç±» (ç¬¬äºŒç§æ–¹æ³•) </font></h2><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">from</span> rest_framework.authentication <span class="hljs-keyword">import</span> BaseAuthentication<br><span class="hljs-keyword">from</span> rest_framework_jwt.authentication <span class="hljs-keyword">import</span> BaseJSONWebTokenAuthentication<br><span class="hljs-keyword">from</span> rest_framework_jwt.authentication <span class="hljs-keyword">import</span> jwt_decode_handler<br><span class="hljs-keyword">from</span> rest_framework.exceptions <span class="hljs-keyword">import</span> AuthenticationFailed<br><span class="hljs-keyword">import</span> jwt<br><br><span class="hljs-comment"># ç»§æ‰¿BaseJSONWebTokenAuthenticationï¼Œé‡å†™çˆ¶ç±»çš„authenticateæ–¹æ³•</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyToken</span>(<span class="hljs-params">BaseJSONWebTokenAuthentication</span>):</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">authenticate</span>(<span class="hljs-params">self, request</span>):</span><br>        <span class="hljs-comment"># è·å–tokençš„ç¬¬äºŒéƒ¨åˆ†</span><br>        jwt_value = request.META.get(<span class="hljs-string">&#x27;HTTP_AUTHORIZATION&#x27;</span>)<br>        print(jwt_value)<br>        <span class="hljs-comment"># åˆ¤æ–­getè¯·æ±‚å¤´ä¸­æ˜¯å¦æºå¸¦tokenï¼Œå¦‚æœæ²¡æœ‰å°±æ˜¯æ¸¸å®¢æ¨¡å¼ï¼Œç›´æ¥è¿”å›None</span><br><br>        <span class="hljs-keyword">if</span> jwt_value <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span><br>        <span class="hljs-keyword">try</span>:<br>            <span class="hljs-comment"># å°†tokenæ•°æ®è¿›è¡Œdecodeè§£ç åå¾—åˆ°payloadï¼ˆç”¨æˆ·ä¿¡æ¯å­—å…¸ï¼‰ï¼Œå¦‚æœtokenè¶…æ—¶æˆ–è€…é”™è¯¯ï¼Œå°±ä¼šæŠ›å‡ºå¼‚å¸¸</span><br>            payload = jwt_decode_handler(jwt_value)<br>            <span class="hljs-comment"># token = jwt_encode_handler(payload) è·å–token</span><br>        <span class="hljs-keyword">except</span> jwt.ExpiredSignature:<br>            <span class="hljs-keyword">raise</span> AuthenticationFailed(<span class="hljs-string">&#x27;è®¤è¯è¶…æ—¶&#x27;</span>)<br>        <span class="hljs-keyword">except</span> jwt.InvalidTokenError:<br>            <span class="hljs-keyword">raise</span> AuthenticationFailed(<span class="hljs-string">&#x27;éæ³•ç”¨æˆ·&#x27;</span>)<br>        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>            <span class="hljs-keyword">raise</span> AuthenticationFailed(<span class="hljs-built_in">str</span>(e))<br>        <span class="hljs-comment"># å°†ç”¨æˆ·ä¿¡æ¯å­—å…¸ä¼ å…¥ï¼Œå†…éƒ¨ä¼šæŸ¥è¯¢æ•°æ®åº“è¿”å›userå¯¹è±¡</span><br>        user = self.authenticate_credentials(payload)<br>        <span class="hljs-comment"># æœ€åè¿”å›ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯userå¯¹è±¡ï¼Œå¦ä¸€ä¸ªæ˜¯tokenï¼ˆä¹Ÿå¯ä»¥æ˜¯å…¶ä»–æ•°æ®çœ‹ä½ è‡ªå·±è¦è¿”å›å•¥ï¼‰</span><br>        <span class="hljs-keyword">return</span> user, jwt_value<br></code></pre></div></td></tr></table></figure><h2 id="TIP-ä½¿ç”¨POSTman-æµ‹è¯•"><a href="#TIP-ä½¿ç”¨POSTman-æµ‹è¯•" class="headerlink" title="TIP: ä½¿ç”¨POSTman æµ‹è¯•"></a><font color=" LimeGreen ">TIP: ä½¿ç”¨POSTman æµ‹è¯•</font></h2><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SearchCateGoryView</span>(<span class="hljs-params">APIView</span>):</span><br>    <span class="hljs-comment"># authentication_classes = [MyToken, ]</span><br>    <span class="hljs-comment">### è‡ªå®šä¹‰è®¤è¯ JWT æ–¹æ³•</span><br>    authentication_classes = [MyBaseAuthentication, ]<br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get</span>(<span class="hljs-params">self,request</span>):</span><br>        data = <span class="hljs-string">&#x27;getæ–¹æ³•&#x27;</span><br>        <span class="hljs-keyword">return</span> Response(&#123;<span class="hljs-string">&quot;code&quot;</span>:<span class="hljs-string">&quot;OK&quot;</span>,<span class="hljs-string">&#x27;message&#x27;</span>:data&#125;)<br></code></pre></div></td></tr></table></figure><p><font color=" LimeGreen ">TIP: å½“ç„¶ è¿˜æœ‰åºåˆ—åŒ–å™¨å®ç°çš„</font></p>]]></content>
    
    
    <categories>
      
      <category>Python</category>
      
      <category>æŠ€æœ¯æ‚è°ˆ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>hexo fluidç¾åŒ–é¡µé¢æ•ˆæœ</title>
    <link href="/2021/03/25/hexo%E7%BE%8E%E5%8C%96%E9%A1%B5%E9%9D%A2/"/>
    <url>/2021/03/25/hexo%E7%BE%8E%E5%8C%96%E9%A1%B5%E9%9D%A2/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h2 id="Hexo-Fluidç¾åŒ–é¡µé¢"><a href="#Hexo-Fluidç¾åŒ–é¡µé¢" class="headerlink" title="Hexo Fluidç¾åŒ–é¡µé¢"></a><font color="#027cd8">Hexo Fluidç¾åŒ–é¡µé¢</font></h2><p><code>å‰æƒ…æè¦</code></p><figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash"><span class="hljs-comment"># é¡µé¢æ·»åŠ ç«™ç‚¹è¿è¡Œæ—¶é—´</span><br><span class="hljs-comment"># ç¾åŒ–é¼ æ ‡</span><br><span class="hljs-comment"># åŠ¨æ€çº¿æ¡</span><br></code></pre></div></td></tr></table></figure><h2 id="1-ä¸»é¢˜-config-ymlæ–‡ä»¶ä¸­ä¿®æ”¹custom-jsä¸custom-css"><a href="#1-ä¸»é¢˜-config-ymlæ–‡ä»¶ä¸­ä¿®æ”¹custom-jsä¸custom-css" class="headerlink" title="1. ä¸»é¢˜_config.ymlæ–‡ä»¶ä¸­ä¿®æ”¹custom_jsä¸custom_css"></a><font color="#027cd8">1. ä¸»é¢˜_config.ymlæ–‡ä»¶ä¸­ä¿®æ”¹custom_jsä¸custom_css</font></h2><h4 id="custom-js-ä¿®æ”¹å‰-ä¿®æ”¹å"><a href="#custom-js-ä¿®æ”¹å‰-ä¿®æ”¹å" class="headerlink" title="custom_js ä¿®æ”¹å‰ / ä¿®æ”¹å"></a><font color="#4fb8fe">custom_js ä¿®æ”¹å‰ / ä¿®æ”¹å</font></h4><figure class="highlight yml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs yml"><span class="hljs-comment"># ä¿®æ”¹å‰</span><br><span class="hljs-attr">custom_js:</span><br><span class="hljs-comment"># æŒ‡å®šè‡ªå®šä¹‰ .css æ–‡ä»¶è·¯å¾„ï¼Œç”¨æ³•å’Œ custom_js ç›¸åŒ</span><br><span class="hljs-comment"># The usage is the same as custom_js</span><br><br><span class="hljs-comment"># ä¿®æ”¹å</span><br><span class="hljs-attr">custom_js:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">//cdn.jsdelivr.net/gh/bynotes/texiao/source/js/caidai.js</span> <span class="hljs-comment"># åŠ¨æ€å½©å¸¦</span><br>  <span class="hljs-comment"># - //cdn.jsdelivr.net/gh/bynotes/texiao/source/js/jingtaisidai.js # é™æ€å½©å¸¦</span><br>  <span class="hljs-comment"># - //cdn.jsdelivr.net/gh/bynotes/texiao/source/js/xiantiao.js # åŠ¨æ€é»‘è‰²çº¿æ¡</span><br>  <span class="hljs-comment"># - //cdn.jsdelivr.net/gh/bynotes/texiao/source/js/daxuehua.js # å¤§é›ªèŠ±é£˜è½</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">//cdn.jsdelivr.net/gh/bynotes/texiao/source/js/xiaoxingxing.js</span> <span class="hljs-comment"># é¼ æ ‡è·Ÿéšå°æ˜Ÿæ˜Ÿ</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">//cdn.jsdelivr.net/gh/bynotes/texiao/source/js/timeDate.js</span> <span class="hljs-comment"># è¿è¡Œæ—¶é—´</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">//cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js</span>  <span class="hljs-comment">#/APlayer#/APlayerä¾èµ–</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">//cdn.jsdelivr.net/gh/metowolf/Metingjs@1.2/dist/Meting.min.js</span>  <span class="hljs-comment">#/APlayerä¾èµ–</span><br><br><span class="hljs-comment"># æŒ‡å®šè‡ªå®šä¹‰ .css æ–‡ä»¶è·¯å¾„ï¼Œç”¨æ³•å’Œ custom_js ç›¸åŒ</span><br><span class="hljs-comment"># The usage is the same as custom_js</span><br></code></pre></div></td></tr></table></figure><h4 id="custom-css-ä¿®æ”¹å‰-ä¿®æ”¹å"><a href="#custom-css-ä¿®æ”¹å‰-ä¿®æ”¹å" class="headerlink" title="custom_css ä¿®æ”¹å‰ / ä¿®æ”¹å"></a><font color="#4fb8fe">custom_css ä¿®æ”¹å‰ / ä¿®æ”¹å</font></h4><figure class="highlight yml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs yml"><span class="hljs-comment"># ä¿®æ”¹å‰</span><br><span class="hljs-attr">custom_css:</span><br><br><span class="hljs-comment"># ä¿®æ”¹å</span><br><span class="hljs-attr">custom_css:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">//cdn.jsdelivr.net/gh/bynotes/texiao/source/css/shubiao.css</span> <span class="hljs-comment">#é¼ æ ‡æŒ‡é’ˆ</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">//cdn.jsdelivr.net/gh/bynotes/texiao/source/css/gundongtiao.css</span> <span class="hljs-comment"># æ»šåŠ¨æ¡é¢œè‰²</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">//cdn.jsdelivr.net/gh/bynotes/texiao/source/css/toubudaziji.css</span> <span class="hljs-comment"># å¤´éƒ¨æ‰“å­—æœºé¢œè‰²æ•ˆæœæ¸å˜</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">//cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css</span>   <span class="hljs-comment">#/APlayerä¾èµ–</span><br></code></pre></div></td></tr></table></figure><h2 id="2-åœ¨ç½‘ç«™é¡µè„šå¤„-æ’å…¥è¿è¡Œæ—¶é—´-æ‰¾åˆ°footer-ejs"><a href="#2-åœ¨ç½‘ç«™é¡µè„šå¤„-æ’å…¥è¿è¡Œæ—¶é—´-æ‰¾åˆ°footer-ejs" class="headerlink" title="2. åœ¨ç½‘ç«™é¡µè„šå¤„ æ’å…¥è¿è¡Œæ—¶é—´ æ‰¾åˆ°footer.ejs"></a><font color="#027cd8">2. åœ¨ç½‘ç«™é¡µè„šå¤„ æ’å…¥è¿è¡Œæ—¶é—´ æ‰¾åˆ°footer.ejs</font></h2><h4 id="è·¯å¾„-ä¸»é¢˜æ–‡ä»¶ä¸‹-layout-partial-footer-ejs"><a href="#è·¯å¾„-ä¸»é¢˜æ–‡ä»¶ä¸‹-layout-partial-footer-ejs" class="headerlink" title="è·¯å¾„ ä¸»é¢˜æ–‡ä»¶ä¸‹/layout/_partial/footer.ejs"></a><font color="#4fb8fe">è·¯å¾„ ä¸»é¢˜æ–‡ä»¶ä¸‹/layout/_partial/footer.ejs</font></h4><figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js">&lt;footer <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;text-center mt-5 py-3&quot;</span>&gt;<br>  &lt;div <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;footer-content&quot;</span>&gt;<br>    &lt;%- theme.footer.content %&gt;<br>  &lt;/div&gt;<br>  &lt;%- partial(<span class="hljs-string">&#x27;_partial/statistics.ejs&#x27;</span>) %&gt;<br>    &lt;%- partial(<span class="hljs-string">&#x27;_partial/beian.ejs&#x27;</span>) %&gt;<br>      &lt;% <span class="hljs-keyword">if</span>(theme.web_analytics.cnzz) &#123; %&gt;<br>        &lt;!-- cnzz Analytics Icon --&gt;<br>        &lt;span id=<span class="hljs-string">&quot;cnzz_stat_icon_&lt;%- theme.web_analytics.cnzz %&gt;&quot;</span> style=<span class="hljs-string">&quot;display: none&quot;</span>&gt;&lt;/span&gt;<br>        &lt;% &#125; %&gt;<br>&lt;/footer&gt;<br><br>&lt;!-- SCRIPTS --&gt;<br>&lt;%- partial(<span class="hljs-string">&#x27;_partial/scripts.ejs&#x27;</span>) %&gt;<br>  &lt;center&gt;<br>    &lt;span id=<span class="hljs-string">&quot;timeDate&quot;</span>&gt;è½½å…¥å¤©æ•°...&lt;<span class="hljs-regexp">/span&gt;&lt;span id=&quot;times&quot;&gt;è½½å…¥æ—¶åˆ†ç§’...&lt;/</span>span&gt;<br>    &lt;script&gt;<br>      <span class="hljs-comment">//è¿è¡Œæ—¶é—´bynote.cn</span><br>      <span class="hljs-keyword">var</span> now = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>();<br>      <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">createtime</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-keyword">var</span> grt = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(<span class="hljs-string">&quot;8/15/2020 17:38:00&quot;</span>);<span class="hljs-comment">//åœ¨æ­¤å¤„ä¿®æ”¹ä½ çš„å»ºç«™æ—¶é—´ï¼Œæ ¼å¼ï¼šæœˆ/æ—¥/å¹´ æ—¶:åˆ†:ç§’</span><br>        now.setTime(now.getTime() + <span class="hljs-number">250</span>);<br>        days = (now - grt) / <span class="hljs-number">1000</span> / <span class="hljs-number">60</span> / <span class="hljs-number">60</span> / <span class="hljs-number">24</span>; dnum = <span class="hljs-built_in">Math</span>.floor(days);<br>        hours = (now - grt) / <span class="hljs-number">1000</span> / <span class="hljs-number">60</span> / <span class="hljs-number">60</span> - (<span class="hljs-number">24</span> * dnum); hnum = <span class="hljs-built_in">Math</span>.floor(hours);<br>        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">String</span>(hnum).length == <span class="hljs-number">1</span>) &#123; hnum = <span class="hljs-string">&quot;0&quot;</span> + hnum; &#125; minutes = (now - grt) / <span class="hljs-number">1000</span> / <span class="hljs-number">60</span> - (<span class="hljs-number">24</span> * <span class="hljs-number">60</span> * dnum) - (<span class="hljs-number">60</span> * hnum);<br>        mnum = <span class="hljs-built_in">Math</span>.floor(minutes); <span class="hljs-keyword">if</span> (<span class="hljs-built_in">String</span>(mnum).length == <span class="hljs-number">1</span>) &#123; mnum = <span class="hljs-string">&quot;0&quot;</span> + mnum; &#125;<br>        seconds = (now - grt) / <span class="hljs-number">1000</span> - (<span class="hljs-number">24</span> * <span class="hljs-number">60</span> * <span class="hljs-number">60</span> * dnum) - (<span class="hljs-number">60</span> * <span class="hljs-number">60</span> * hnum) - (<span class="hljs-number">60</span> * mnum);<br>        snum = <span class="hljs-built_in">Math</span>.round(seconds); <span class="hljs-keyword">if</span> (<span class="hljs-built_in">String</span>(snum).length == <span class="hljs-number">1</span>) &#123; snum = <span class="hljs-string">&quot;0&quot;</span> + snum; &#125;<br>        <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">&quot;timeDate&quot;</span>).innerHTML = <span class="hljs-string">&quot;æœ¬ç«™å·²è¿è¡Œ &quot;</span> + dnum + <span class="hljs-string">&quot; å¤© &quot;</span>;<br>        <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">&quot;times&quot;</span>).innerHTML = hnum + <span class="hljs-string">&quot; å°æ—¶ &quot;</span> + mnum + <span class="hljs-string">&quot; åˆ† &quot;</span> + snum + <span class="hljs-string">&quot; ç§’&quot;</span>;<br>      &#125;<br>      <span class="hljs-built_in">setInterval</span>(<span class="hljs-string">&quot;createtime()&quot;</span>, <span class="hljs-number">250</span>);<br>    &lt;/script&gt;<br>  &lt;/center&gt;<br><br></code></pre></div></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Hexo</category>
      
      <category>Themes</category>
      
    </categories>
    
    
    <tags>
      
      <tag>hexo</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>GitHubæˆæƒç™»å½•è·å–IDå¯†é’¥</title>
    <link href="/2021/03/25/github%E7%99%BB%E5%BD%95/"/>
    <url>/2021/03/25/github%E7%99%BB%E5%BD%95/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h2 id="Githubçš„æˆæƒå¯†é’¥çš„è·å–"><a href="#Githubçš„æˆæƒå¯†é’¥çš„è·å–" class="headerlink" title="Githubçš„æˆæƒå¯†é’¥çš„è·å–"></a><font color="Cyan">Githubçš„æˆæƒå¯†é’¥çš„è·å–</font></h2><p><strong><font color="#4682B4">è¿›å…¥githubï¼Œé€‰æ‹©settings=&gt;Developer-settingsï¼Œç„¶åé€‰æ‹©OAuth Apps=&gt;New OAuth Appã€‚æœ€ç»ˆå¦‚ä¸‹å›¾</font></strong></p><p><img src="https://p.pstatp.com/origin/138f500001508602aa3f6" alt="åˆ›å»ºåº”ç”¨"></p><p><strong><font color="#4682B4">ç‚¹å‡»Register applicationå<a href="#">Â¶</a></font></strong></p><p><img src="https://p.pstatp.com/origin/1386800012122fa097f44" alt="æŸ¥çœ‹IDå¯†é’¥"></p><p><strong><font color="#4682B4">æ³¨æ„:å¯†é’¥åªèƒ½æŸ¥çœ‹ä¸€æ¬¡ å¦åˆ™éœ€è¦é‡æ–°ç”Ÿæˆ/åˆ é™¤</font></strong></p><p><strong><font color="#4682B4">ç‚¹å‡»è·³è½¬Â <a href="https://bree.vip/article/d_social/">djangoä½¿ç”¨socialå®ç°ç¬¬ä¸‰æ–¹ç™»å½•</a></font></strong></p>]]></content>
    
    
    <categories>
      
      <category>Python</category>
      
      <category>æŠ€æœ¯æ‚è°ˆ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>æŠ€æœ¯æ‚è°ˆ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Django-socialå®ç°ç¬¬ä¸‰æ–¹ç™»å½•</title>
    <link href="/2021/03/25/django-social%E7%AC%AC%E4%B8%89%E6%96%B9%E7%99%BB%E5%BD%95/"/>
    <url>/2021/03/25/django-social%E7%AC%AC%E4%B8%89%E6%96%B9%E7%99%BB%E5%BD%95/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h2 id="ä½¿ç”¨-django-social-å®ç°ç¬¬ä¸‰æ–¹ç™»å½•"><a href="#ä½¿ç”¨-django-social-å®ç°ç¬¬ä¸‰æ–¹ç™»å½•" class="headerlink" title=" ä½¿ç”¨ django-social å®ç°ç¬¬ä¸‰æ–¹ç™»å½• "></a><font color="#008080"> ä½¿ç”¨ django-social å®ç°ç¬¬ä¸‰æ–¹ç™»å½• </font></h2><p><code>å‰æƒ…æ‘˜è¦</code></p><figure class="highlight"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs nginx">ä½¿ç”¨ GitHubç™»å½• -- å› ä¸ºGitHubè®¤è¯ç›¸å¯¹æ¥è¯´ æ˜¯æœ€ç®€å•çš„...<br>ä½¿ç”¨ weiboç™»å½• -- éœ€è¦è®¤è¯(å..)<br>OAuthï¼ˆå¼€æ”¾æˆæƒ Open Authorizationï¼‰æ˜¯ä¸€ä¸ªå¼€æ”¾æ ‡å‡†ï¼Œ<br>å…è®¸ç”¨æˆ·æˆæƒç¬¬ä¸‰æ–¹ç½‘ç«™è®¿é—®ä»–ä»¬å­˜å‚¨åœ¨å¦å¤–çš„æœåŠ¡æä¾›è€…ä¸Šçš„ä¿¡æ¯ï¼Œ<br>è€Œä¸éœ€è¦å°†ç”¨æˆ·åå’Œå¯†ç æä¾›ç»™ç¬¬ä¸‰æ–¹ç½‘ç«™æˆ–åˆ†äº«ä»–ä»¬æ•°æ®çš„æ‰€æœ‰å†…å®¹ã€‚<br>OAuth1.0ç‰ˆæœ¬å› ä¸ºå­˜åœ¨æ•°æ®ä¸å®‰å…¨çš„æƒ…å†µ å·²ç»å…¨é¢ä½¿ç”¨OAuth2.0ç‰ˆæœ¬ <br>æ¥ä¸‹æ¥çš„ä½¿ç”¨ ä¹Ÿæ˜¯æ ¹æ®OAuth2.0åè®®è¿›è¡Œçš„<br></code></pre></div></td></tr></table></figure><h3 id="ç‚¹å‡»è·³è½¬-å®˜æ–¹æ–‡æ¡£"><a href="#ç‚¹å‡»è·³è½¬-å®˜æ–¹æ–‡æ¡£" class="headerlink" title="ç‚¹å‡»è·³è½¬Â å®˜æ–¹æ–‡æ¡£"></a><font color="#008080">ç‚¹å‡»è·³è½¬Â <a href="https://python-social-auth.readthedocs.io/en/latest/configuration/django.html">å®˜æ–¹æ–‡æ¡£</a></font></h3><h2 id="å®‰è£…æ¨¡å—åŒ…"><a href="#å®‰è£…æ¨¡å—åŒ…" class="headerlink" title="å®‰è£…æ¨¡å—åŒ…"></a><font color="#008080">å®‰è£…æ¨¡å—åŒ…</font></h2><p><font color="#4682B4">From <a href="http://pypi.python.org/pypi/social-auth-app-django/">pypi</a> </font></p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">pip install social-auth-app-django<br></code></pre></div></td></tr></table></figure><h2 id="å®‰è£…å¥½ä¹‹å-åœ¨settingsé‡Œé¢é…ç½®"><a href="#å®‰è£…å¥½ä¹‹å-åœ¨settingsé‡Œé¢é…ç½®" class="headerlink" title="å®‰è£…å¥½ä¹‹å åœ¨settingsé‡Œé¢é…ç½®"></a><font color="#008080">å®‰è£…å¥½ä¹‹å åœ¨settingsé‡Œé¢é…ç½®</font></h2><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">INSTALLED_APPS = (<br>    ...<br>    <span class="hljs-string">&#x27;social_django&#x27;</span>,<br>    ...<br>)<br></code></pre></div></td></tr></table></figure><h2 id="é…ç½®ä¸€äº›ç¬¬ä¸‰æ–¹ç™»å½•æˆæƒ"><a href="#é…ç½®ä¸€äº›ç¬¬ä¸‰æ–¹ç™»å½•æˆæƒ" class="headerlink" title="é…ç½®ä¸€äº›ç¬¬ä¸‰æ–¹ç™»å½•æˆæƒ"></a><font color="#008080">é…ç½®ä¸€äº›ç¬¬ä¸‰æ–¹ç™»å½•æˆæƒ</font></h2><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">AUTHENTICATION_BACKENDS = (<br>    <span class="hljs-string">&#x27;allauth.account.auth_backends.AuthenticationBackend&#x27;</span>,  <span class="hljs-comment"># allauth emailç™»å½•è®¤è¯</span><br>    <span class="hljs-string">&#x27;social_core.backends.github.GithubOAuth2&#x27;</span>,  <span class="hljs-comment"># github</span><br>    <span class="hljs-string">&#x27;social_core.backends.weibo.WeiboOAuth2&#x27;</span>,  <span class="hljs-comment"># å¾®åš</span><br>    <span class="hljs-string">&#x27;django.contrib.auth.backends.ModelBackend&#x27;</span>,  <span class="hljs-comment"># æŒ‡å®šä½¿ç”¨djangoçš„modelç±»</span><br>)<br></code></pre></div></td></tr></table></figure><h2 id="é¡¹ç›®settingæ·»åŠ "><a href="#é¡¹ç›®settingæ·»åŠ " class="headerlink" title="é¡¹ç›®settingæ·»åŠ "></a><font color="#008080">é¡¹ç›®settingæ·»åŠ </font></h2><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment"># ä½†æ˜¯æºç é‡Œé¢å¥½åƒå·²ç»æœ‰åˆ¤æ–­æ˜¯å¦ä¼ å…¥socialäº†...</span><br><span class="hljs-comment"># æºç : NAMESPACE = getattr(settings, setting_name(&#x27;URL_NAMESPACE&#x27;), None) or &#x27;social&#x27;</span><br>SOCIAL_AUTH_URL_NAMESPACE = <span class="hljs-string">&#x27;social&#x27;</span><br></code></pre></div></td></tr></table></figure><h2 id="æ·»åŠ github-å¾®åšçš„key-amp-secret"><a href="#æ·»åŠ github-å¾®åšçš„key-amp-secret" class="headerlink" title="æ·»åŠ github å¾®åšçš„key &amp; secret"></a><font color="#008080">æ·»åŠ github å¾®åšçš„key &amp; secret</font></h2><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">SOCIAL_AUTH_GITHUB_KEY = <span class="hljs-string">&#x27;fa***************&#x27;</span><br>SOCIAL_AUTH_GITHUB_SECRET = <span class="hljs-string">&#x27;71**********************************&#x27;</span><br>SOCIAL_AUTH_GITHUB_USE_OPENID_AS_USERNAME = <span class="hljs-literal">True</span><br><br>SOCIAL_AUTH_WEIBO_KEY = <span class="hljs-string">&#x27;8*******&#x27;</span><br>SOCIAL_AUTH_WEIBO_SECRET = <span class="hljs-string">&#x27;9a****************************&#x27;</span><br>SOCIAL_AUTH_WEIBO_USE_OPENID_AS_USERNAME = <span class="hljs-literal">True</span><br></code></pre></div></td></tr></table></figure><h2 id="ç™»å½•æˆåŠŸå-è·³è½¬çš„è·¯ç”±"><a href="#ç™»å½•æˆåŠŸå-è·³è½¬çš„è·¯ç”±" class="headerlink" title="ç™»å½•æˆåŠŸå è·³è½¬çš„è·¯ç”±"></a><font color="#008080">ç™»å½•æˆåŠŸå è·³è½¬çš„è·¯ç”±</font></h2><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">SOCIAL_AUTH_LOGIN_REDIRECT_URL = <span class="hljs-string">&#x27;/&#x27;</span><br></code></pre></div></td></tr></table></figure><h2 id="åœ¨TEMPLATEä¸‹æ–°å¢ä¸¤ä¸ªé…ç½®"><a href="#åœ¨TEMPLATEä¸‹æ–°å¢ä¸¤ä¸ªé…ç½®" class="headerlink" title="åœ¨TEMPLATEä¸‹æ–°å¢ä¸¤ä¸ªé…ç½®"></a><font color="#008080">åœ¨TEMPLATEä¸‹æ–°å¢ä¸¤ä¸ªé…ç½®</font></h2><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">TEMPLATES = [<br>    &#123;<br>        <span class="hljs-string">&#x27;BACKEND&#x27;</span>: <span class="hljs-string">&#x27;django.template.backends.django.DjangoTemplates&#x27;</span>,<br>        <span class="hljs-string">&#x27;DIRS&#x27;</span>: [os.path.join(BASE_DIR, <span class="hljs-string">&#x27;templates&#x27;</span>)],<br>        <span class="hljs-string">&#x27;APP_DIRS&#x27;</span>: <span class="hljs-literal">True</span>,<br>        <span class="hljs-string">&#x27;OPTIONS&#x27;</span>: &#123;<br>            <span class="hljs-string">&#x27;context_processors&#x27;</span>: [<br>                <span class="hljs-string">&#x27;django.template.context_processors.debug&#x27;</span>,<br>                <span class="hljs-string">&#x27;django.template.context_processors.request&#x27;</span>,<br>                <span class="hljs-string">&#x27;django.contrib.auth.context_processors.auth&#x27;</span>,<br>                <span class="hljs-string">&#x27;django.contrib.messages.context_processors.messages&#x27;</span>,<br>                <span class="hljs-comment"># æ¨¡æ¿ä¸Šä¸‹æ–‡å¤„ç†å™¨Â¶</span><br>                <span class="hljs-string">&#x27;social_django.context_processors.backends&#x27;</span>,<br>                <span class="hljs-string">&#x27;social_django.context_processors.login_redirect&#x27;</span>, <br>            ],<br>        &#125;,<br>    &#125;,<br>]<br></code></pre></div></td></tr></table></figure><h2 id="åœ¨è·ŸsettingåŒçº§ç›®å½•ä¸‹-çš„urls-pyæ–‡ä»¶é‡Œé¢-æ·»åŠ ä¸€æ¡URL"><a href="#åœ¨è·ŸsettingåŒçº§ç›®å½•ä¸‹-çš„urls-pyæ–‡ä»¶é‡Œé¢-æ·»åŠ ä¸€æ¡URL" class="headerlink" title="åœ¨è·ŸsettingåŒçº§ç›®å½•ä¸‹ çš„urls.pyæ–‡ä»¶é‡Œé¢ æ·»åŠ ä¸€æ¡URL"></a><font color="#008080">åœ¨è·ŸsettingåŒçº§ç›®å½•ä¸‹ çš„urls.pyæ–‡ä»¶é‡Œé¢ æ·»åŠ ä¸€æ¡URL</font></h2><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">path(<span class="hljs-string">&#x27;&#x27;</span>, include(<span class="hljs-string">&#x27;social_django.urls&#x27;</span>, namespace=<span class="hljs-string">&#x27;social&#x27;</span>)),<br></code></pre></div></td></tr></table></figure><h2 id="åœ¨æ¨¡æ¿æ–‡ä»¶é‡Œé¢-æ·»åŠ "><a href="#åœ¨æ¨¡æ¿æ–‡ä»¶é‡Œé¢-æ·»åŠ " class="headerlink" title="åœ¨æ¨¡æ¿æ–‡ä»¶é‡Œé¢ æ·»åŠ "></a><font color="#008080">åœ¨æ¨¡æ¿æ–‡ä»¶é‡Œé¢ æ·»åŠ </font></h2><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">&lt;a class=&quot;mx-4&quot; href=&quot;&#123;% url &#x27;social:begin&#x27; &#x27;github&#x27; %&#125;&quot; title=&quot;githubè´¦å·ç™»å½•&quot;&gt;<br>    &lt;i class=&quot;fa fa-github fa-2x&quot;&gt;&lt;/i&gt;<br>&lt;/a&gt;<br>&lt;a class=&quot;mx-4&quot; href=&quot;&#123;% url &#x27;social:begin&#x27; &#x27;weibo&#x27; %&#125;&quot; title=&quot;å¾®åšè´¦å·ç™»å½•&quot;&gt;<br>     &lt;i class=&quot;fa fa-weibo fa-2x&quot;&gt;&lt;/i&gt;<br>&lt;/a&gt;<br><span class="hljs-comment"># ä¸Šè¿°å°±æ˜¯æ ¹æ®ä½ çš„å‘½åç©ºé—´å®šä¹‰ æŸ¥è¯¢çš„URLåœ°å€</span><br></code></pre></div></td></tr></table></figure><h2 id="æœ€å-ä¹Ÿæ˜¯æœ€é‡è¦çš„ä¸€æ­¥-åŒæ­¥æ•°æ®åº“"><a href="#æœ€å-ä¹Ÿæ˜¯æœ€é‡è¦çš„ä¸€æ­¥-åŒæ­¥æ•°æ®åº“" class="headerlink" title="æœ€å ä¹Ÿæ˜¯æœ€é‡è¦çš„ä¸€æ­¥ åŒæ­¥æ•°æ®åº“"></a><font color="#008080">æœ€å ä¹Ÿæ˜¯æœ€é‡è¦çš„ä¸€æ­¥ åŒæ­¥æ•°æ®åº“</font></h2><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">python manage.py migrate<br></code></pre></div></td></tr></table></figure><blockquote><p>ä¼šæœ‰ä¸€äº› socialå¯¹åº”çš„æ•°æ®è¡¨åˆ›å»º ä¾‹å¦‚ social_auth_usersocialauth è¯¥è¡¨å‚¨å­˜çš„å°±æ˜¯ä½ æˆæƒçš„è®¤è¯è¡¨</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>Python</category>
      
      <category>Django</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Django</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Django Celeryçš„ä½¿ç”¨</title>
    <link href="/2021/03/25/django-celery/"/>
    <url>/2021/03/25/django-celery/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h2 id="celeryçš„ç®€ä»‹"><a href="#celeryçš„ç®€ä»‹" class="headerlink" title="celeryçš„ç®€ä»‹"></a><font color="#00AA00">celeryçš„ç®€ä»‹</font></h2><p><code>celeryç®€ä»‹</code></p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment"># ä»»åŠ¡è°ƒåº¦å™¨ Celery</span><br>celeryæ˜¯Pythonå¼€å‘çš„ä¸€ä¸ªåˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦æ¨¡å—<br>Celeryæ˜¯ä¸€ä¸ªç®€å•ï¼Œçµæ´»ï¼Œå¯é çš„åˆ†å¸ƒå¼ç³»ç»Ÿï¼Œç”¨äºå¤„ç†å¤§é‡æ¶ˆæ¯ï¼ŒåŒæ—¶ä¸ºæ“ä½œæä¾›ç»´æŠ¤æ­¤ç±»ç³»ç»Ÿæ‰€éœ€çš„å·¥å…·ã€‚<br>å®ƒæ˜¯ä¸€ä¸ªä»»åŠ¡é˜Ÿåˆ—ï¼Œä¸“æ³¨äºå®æ—¶å¤„ç†ï¼ŒåŒæ—¶è¿˜æ”¯æŒä»»åŠ¡è°ƒåº¦ã€‚<br></code></pre></div></td></tr></table></figure><p><code>celeryçš„ä¼˜ç‚¹</code></p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-number">1.</span> ç®€å•: celeryçš„ä½¿ç”¨ç›¸å¯¹ç®€å• å¹¶ä¸”åœ¨åæœŸç»´æŠ¤ç­‰æ“ä½œéƒ½æ˜¯æ¯”è¾ƒæ–¹ä¾¿çš„<br><span class="hljs-number">2.</span> å¿«é€Ÿ: ä¸€ä¸ªå•è¿›ç¨‹çš„celery æ¯åˆ†é’Ÿå¯å¤„ç†ä¸Šç™¾ä¸‡ä¸ªä»»åŠ¡ åœ¨ä¸€äº›å¸¸ç”¨ä¸”ç­‰å¾…æ—¶é•¿æ¯”è¾ƒå¤§çš„æ—¶å€™ å°†ä¼šæ˜¯æœ€å¥½çš„é€‰æ‹©<br><span class="hljs-number">3.</span> çµæ´»: celeryçš„ç»„ä»¶ å‡ ä¹éƒ½æ˜¯å¯ä»¥è¢«è‡ªå®šä¹‰ä»¥åŠæ‰©å±•ä½¿ç”¨çš„<br><span class="hljs-number">4.</span> é«˜å¯ç”¨: å½“ä»»åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­é“¾æ¥ä¸­æ–­ é‚£ä¹ˆceleryä¼šè‡ªåŠ¨å°è¯•é‡æ–°æ‰§è¡Œä»»åŠ¡ <br></code></pre></div></td></tr></table></figure><p><code>celeryçš„Broker</code></p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">å½“ä½¿ç”¨æ•°æ®æŒä¹…åŒ–çš„æ—¶å€™ é€‰æ‹©RabbitMQ<br>abbitmqæä¾›çš„é˜Ÿåˆ—å’Œæ¶ˆæ¯æŒä¹…åŒ–æœºåˆ¶æ›´åŠ ç¨³å®š<br>å½“ä¸åœ¨ä¹ä»»åŠ¡æ˜¯å¦ä¸¢å¤±çš„æƒ…å†µä¸‹ ä½¿ç”¨Redis<br>redisåœ¨æœåŠ¡å´©æºƒçš„æ—¶å€™ å¯èƒ½å¯¼è‡´æ•°æ®ä¸¢å¤±çš„æƒ…å†µ<br></code></pre></div></td></tr></table></figure><h2 id="é¡¹ç›®ä½¿ç”¨celeryçš„æ“ä½œè®°å½•ç‰ˆæœ¬"><a href="#é¡¹ç›®ä½¿ç”¨celeryçš„æ“ä½œè®°å½•ç‰ˆæœ¬" class="headerlink" title="é¡¹ç›®ä½¿ç”¨celeryçš„æ“ä½œè®°å½•ç‰ˆæœ¬"></a><font color="#00AA00">é¡¹ç›®ä½¿ç”¨celeryçš„æ“ä½œè®°å½•ç‰ˆæœ¬</font></h2><table><thead><tr><th>è¯­è¨€/æ¨¡å—</th><th>ç‰ˆæœ¬</th><th>å®‰è£…æ–¹å¼</th></tr></thead><tbody><tr><td>Python</td><td>3.6</td><td><a href="https://www.python.org/">DownloadPython</a></td></tr><tr><td>celery</td><td>3.1.22</td><td>pip install celery==3.1.22 -i <a href="https://pypi.douban.com/simple/">https://pypi.douban.com/simple/</a></td></tr><tr><td>django</td><td>1.11.11</td><td>pip install django==1.11.11 -i <a href="https://pypi.douban.com/simple/">https://pypi.douban.com/simple/</a></td></tr><tr><td>django-celery</td><td>3.1.17</td><td></td></tr><tr><td>redis</td><td>2.10.6</td><td>pip install redis==2.10.6 -i <a href="https://pypi.douban.com/simple/">https://pypi.douban.com/simple/</a></td></tr><tr><td>pymongo</td><td>3.11.0</td><td>pip install mongo -i <a href="https://pypi.douban.com/simple/">https://pypi.douban.com/simple/</a></td></tr></tbody></table><h2 id="celeryé‡Œé¢-ç»“åˆmongodb-redis"><a href="#celeryé‡Œé¢-ç»“åˆmongodb-redis" class="headerlink" title="celeryé‡Œé¢ ç»“åˆmongodb redis"></a><font color="#00AA00">celeryé‡Œé¢ ç»“åˆmongodb redis</font></h2><ol><li>æ–°å»ºcelery ä»»åŠ¡æ–‡ä»¶</li></ol><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> datetime<br><span class="hljs-keyword">import</span> pymongo<br><span class="hljs-keyword">from</span> celery <span class="hljs-keyword">import</span> Celery, platforms<br><span class="hljs-keyword">import</span> redis<br><br><span class="hljs-comment"># å®šä¹‰å½“å‰æ¨¡å—çš„åç§° ä»¥åŠæ¶ˆæ¯é˜Ÿåˆ—çš„å­˜å‚¨è·¯å¾„</span><br>redistrend = Celery(<br>    <span class="hljs-string">&#x27;redistrend&#x27;</span>,  <span class="hljs-comment"># å½“å‰æ¨¡å—çš„åå­—</span><br>    broker=<span class="hljs-string">&#x27;redis://:å¯†ç @localhost:6379/12&#x27;</span>,  <span class="hljs-comment"># æ¶ˆæ¯é˜Ÿåˆ—çš„url</span><br>)<br><br><span class="hljs-comment"># ä»»åŠ¡è¿‡æœŸæ—¶é—´</span><br>redistrend.conf.update(<br>    result_expires=<span class="hljs-number">3600</span>,<br>)<br><br><span class="hljs-comment"># celeryä¸èƒ½ä½¿ç”¨æœ€é«˜æƒé™ç”¨æˆ·å¯åŠ¨çš„æ—¶å€™ é…ç½®ä¸€ä¸‹ C_FORCE_ROOT</span><br>platforms.C_FORCE_ROOT = <span class="hljs-literal">True</span><br><br></code></pre></div></td></tr></table></figure><ol start="2"><li>åŒæ–‡ä»¶ä¸‹ é…ç½®mongodb æœåŠ¡å™¨é…ç½®</li></ol><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment"># mongodbæœåŠ¡å™¨çš„é…ç½®</span><br>CONN_ADDR1 = <span class="hljs-string">&#x27;d.com:9876&#x27;</span>  <span class="hljs-comment"># å…¬ç½‘</span><br>CONN_ADDR2 = <span class="hljs-string">&#x27;d.com:9876&#x27;</span>  <span class="hljs-comment"># å†…ç½‘</span><br>REPLICAT_SET = <span class="hljs-string">&#x27;what</span><br><span class="hljs-string">username = &#x27;</span>ikwlamks<span class="hljs-string">&#x27;</span><br><span class="hljs-string">password = &#x27;</span>wajloselkzpp2la0<span class="hljs-string">&#x27;</span><br><span class="hljs-string">#  #è·å–mongoclient</span><br><span class="hljs-string">myclient = pymongo.MongoClient([CONN_ADDR2, CONN_ADDR1], replicaSet=REPLICAT_SET)</span><br><span class="hljs-string">#  #æˆæƒã€‚ è¿™é‡Œçš„useråŸºäºadminæ•°æ®åº“æˆæƒã€‚</span><br><span class="hljs-string">myclient.admin.authenticate(username, password)</span><br><span class="hljs-string">mydb = myclient[&quot;joiki&quot;] # è·å–è¿æ¥çš„é›†åˆåç§°</span><br></code></pre></div></td></tr></table></figure><ol start="3"><li>åŒæ–‡ä»¶ä¸‹ åˆ›å»ºä»»åŠ¡å‡½æ•°</li></ol><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-meta">@redistrend.task</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">redis_trend</span>(<span class="hljs-params">key, date_list, uid</span>):</span><br>    first_date, last_date = date_list<br>    first_date = datetime.datetime.strptime(first_date, <span class="hljs-string">&quot;%Y-%m-%d&quot;</span>)  <span class="hljs-comment"># ç¬¬ä¸€å¤©</span><br>    last_date = datetime.datetime.strptime(last_date, <span class="hljs-string">&quot;%Y-%m-%d&quot;</span>)  <span class="hljs-comment"># æœ€åä¸€å¤©</span><br>    day_num = (last_date - first_date).days  <span class="hljs-comment"># ç›¸éš”å‡ å¤©</span><br>    rank_list = &#123;&#125;<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(day_num + <span class="hljs-number">1</span>):<br>        <span class="hljs-comment"># TODO æ­¤å¤„æ—¶é—´éœ€è¦ä¿®æ”¹ æœ¬åœ°æµ‹è¯•windows--&gt; %Y-%#m-%#d è¿œç¨‹Linux--? %Y-%-m-%-d</span><br>        new_date = (first_date + datetime.timedelta(days=i)).strftime(<span class="hljs-string">&quot;%Y-%-m-%-d&quot;</span>)<br>        new_mycol = mydb[new_date]<br>        new_data = new_mycol.find(&#123;<span class="hljs-string">&#x27;search_key&#x27;</span>: &#123;<span class="hljs-string">&#x27;$regex&#x27;</span>: key&#125;&#125;).sort(<span class="hljs-string">&#x27;search_frequency&#x27;</span>)<br>        <span class="hljs-keyword">for</span> data <span class="hljs-keyword">in</span> new_data:<br>            <span class="hljs-keyword">if</span> data[<span class="hljs-string">&#x27;search_key&#x27;</span>] <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> rank_list:<br>                rank_list[data[<span class="hljs-string">&#x27;search_key&#x27;</span>]] = [&#123;<span class="hljs-string">&#x27;date&#x27;</span>: data[<span class="hljs-string">&#x27;dated&#x27;</span>], <span class="hljs-string">&#x27;rank&#x27;</span>: data[<span class="hljs-string">&#x27;search_frequency&#x27;</span>]&#125;]<br>            <span class="hljs-keyword">else</span>:<br>                rank_list[data[<span class="hljs-string">&#x27;search_key&#x27;</span>]].append(&#123;<span class="hljs-string">&#x27;date&#x27;</span>: data[<span class="hljs-string">&#x27;dated&#x27;</span>], <br>                                                      <span class="hljs-string">&#x27;rank&#x27;</span>:data[<span class="hljs-string">&#x27;search_frequency&#x27;</span>]&#125;)<br>    <span class="hljs-comment"># æ•°æ®å†™å…¥redis</span><br>    r = redis.Redis(connection_pool=pool)<br>    pipe = r.pipeline()  <span class="hljs-comment"># é»˜è®¤äº‹åŠ¡å¼€å¯ï¼Œå…·å¤‡åŸå­æ€§</span><br>    pipe.<span class="hljs-built_in">set</span>(<span class="hljs-string">&#x27;%s_%s_%s_%s&#x27;</span> % (key, date_list[<span class="hljs-number">0</span>], date_list[<span class="hljs-number">1</span>], uid), <span class="hljs-built_in">str</span>(rank_list), <span class="hljs-number">3</span> * <span class="hljs-number">24</span> * <span class="hljs-number">3600</span>)<br>    pipe.execute()<br>    <span class="hljs-keyword">return</span> rank_list<br></code></pre></div></td></tr></table></figure><ol start="4"><li>åœ¨éœ€è¦ä½¿ç”¨åˆ°çš„åœ°æ–¹ è°ƒç”¨å¼‚æ­¥è°ƒåº¦å™¨å°±å¯ä»¥äº†</li></ol><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment"># æ³¨æ„ä¼ é€’å‚æ•°çš„æ—¶å€™çš„æ ¼å¼ args=[xxx,]</span><br>redistrend.send_task(<span class="hljs-string">&quot;redistrend.redis_trend&quot;</span>, args=[key, date_list, user.<span class="hljs-built_in">id</span>])<br></code></pre></div></td></tr></table></figure><h2 id="åœ¨taskæ–‡ä»¶è·¯å¾„å¼€å¯celery"><a href="#åœ¨taskæ–‡ä»¶è·¯å¾„å¼€å¯celery" class="headerlink" title="åœ¨taskæ–‡ä»¶è·¯å¾„å¼€å¯celery"></a><font color="#00AA00">åœ¨taskæ–‡ä»¶è·¯å¾„å¼€å¯celery</font></h2><ol><li>Windowsä¸‹é¢çš„å¼€å¯</li></ol><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">celery -A redistrend worker --loglevel=info<br></code></pre></div></td></tr></table></figure><ol start="2"><li>Linuxä¸‹ åå°å¯åŠ¨</li></ol><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">celery multi start a1 -A redistrend -l info   â­ä¸å»ºè®®<br><br><span class="hljs-meta">#</span><span class="bash"> æŒ‡å®š<span class="hljs-built_in">log</span>æ–‡ä»¶ä»¥åŠpidæ–‡ä»¶çš„å‚¨å­˜ä½ç½® â­â­â­â­â­</span><br>celery multi start a1 -A redistrend -l info --logfile=./log/1_post.log --pidfile=./log/1_post.pid<br></code></pre></div></td></tr></table></figure><h2 id="åœ¨taskæ–‡ä»¶è·¯å¾„åœæ­¢celery"><a href="#åœ¨taskæ–‡ä»¶è·¯å¾„åœæ­¢celery" class="headerlink" title="åœ¨taskæ–‡ä»¶è·¯å¾„åœæ­¢celery"></a><font color="#00AA00">åœ¨taskæ–‡ä»¶è·¯å¾„åœæ­¢celery</font></h2><ol><li>Windowsä¸‹é¢ ç›´æ¥ctrl + c å°±å¯ä»¥åœæ­¢äº† / æ¸…æ‰redis</li></ol><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> ä¸å†™ç‚¹ä»€ä¹ˆæ€ä¹ˆè§‰æ€ªæ€ªçš„</span><br></code></pre></div></td></tr></table></figure><ol start="2"><li>æ¸…é™¤celeryçš„è¿›ç¨‹</li></ol><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">ps auxww|grep &quot;celery worker&quot;|grep -v grep|awk &#x27;&#123;print $2&#125;&#x27;|xargs kill -9<br></code></pre></div></td></tr></table></figure><ol start="3"><li>åœæ­¢celery  stop</li></ol><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">celery multi stop a1 -A redistrend -l info<br></code></pre></div></td></tr></table></figure><ol start="4"><li>é‡å¯ restart</li></ol><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">celery multi restart a1 -A newtestfile -l info --pidfile=./log/1_post.pid<br></code></pre></div></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Python</category>
      
      <category>Django</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Django</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Django Uwsgi Nginx éƒ¨ç½²é¡¹ç›®</title>
    <link href="/2021/03/25/django+uwsgi+nginx%E9%83%A8%E7%BD%B2%E9%A1%B9%E7%9B%AE/"/>
    <url>/2021/03/25/django+uwsgi+nginx%E9%83%A8%E7%BD%B2%E9%A1%B9%E7%9B%AE/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h2 id="Django-Nginx-Uwsgiéƒ¨ç½²é¡¹ç›®"><a href="#Django-Nginx-Uwsgiéƒ¨ç½²é¡¹ç›®" class="headerlink" title="Django + Nginx + Uwsgiéƒ¨ç½²é¡¹ç›®"></a><font color="#008080">Django + Nginx + Uwsgiéƒ¨ç½²é¡¹ç›®</font></h2><h5 id="å‰æƒ…æè¦â˜Ÿ"><a href="#å‰æƒ…æè¦â˜Ÿ" class="headerlink" title="å‰æƒ…æè¦â˜Ÿ"></a><strong><code>å‰æƒ…æè¦</code><a href="#">â˜Ÿ</a></strong></h5><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">é¡¹ç›®ä½¿ç”¨Ubuntu 18.04.1 LTSï¼Œdjango2.0ï¼ŒPython3.6.8ã€nginxã€uWSGIï¼ŒUbuntu éƒ¨ç½²<br></code></pre></div></td></tr></table></figure><h2 id="å®‰è£…uwsgi"><a href="#å®‰è£…uwsgi" class="headerlink" title="å®‰è£…uwsgi"></a><font color=" #00DD00">å®‰è£…uwsgi</font></h2><h5 id="æ³¨æ„æƒé™é—®é¢˜"><a href="#æ³¨æ„æƒé™é—®é¢˜" class="headerlink" title="æ³¨æ„æƒé™é—®é¢˜"></a><strong><code>æ³¨æ„æƒé™é—®é¢˜</code></strong></h5><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">sudo pip3 install uwsgi<br>å…³äºpipé•œåƒåŠ é€Ÿæº å¯ä»¥ä½¿ç”¨å›½å†…çš„<br>sudo pip3 install uwsgi -i https://pypi.douban.com/simple/<br></code></pre></div></td></tr></table></figure><h5 id="æ ¹æ®å®˜æ–¹æ–‡æ¡£è¯´æ˜-uWSGIæ”¯æŒé€šè¿‡ç®€å•ç£ç›˜æ–‡ä»¶ä»¥å¤–çš„å‡ ç§æ–¹æ³•æ¥åŠ è½½é…ç½®æ–‡ä»¶ï¼š"><a href="#æ ¹æ®å®˜æ–¹æ–‡æ¡£è¯´æ˜-uWSGIæ”¯æŒé€šè¿‡ç®€å•ç£ç›˜æ–‡ä»¶ä»¥å¤–çš„å‡ ç§æ–¹æ³•æ¥åŠ è½½é…ç½®æ–‡ä»¶ï¼š" class="headerlink" title="æ ¹æ®å®˜æ–¹æ–‡æ¡£è¯´æ˜ uWSGIæ”¯æŒé€šè¿‡ç®€å•ç£ç›˜æ–‡ä»¶ä»¥å¤–çš„å‡ ç§æ–¹æ³•æ¥åŠ è½½é…ç½®æ–‡ä»¶ï¼š"></a><strong><code>æ ¹æ®å®˜æ–¹æ–‡æ¡£è¯´æ˜ uWSGIæ”¯æŒé€šè¿‡ç®€å•ç£ç›˜æ–‡ä»¶ä»¥å¤–çš„å‡ ç§æ–¹æ³•æ¥åŠ è½½é…ç½®æ–‡ä»¶ï¼š</code></strong></h5><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">uwsgi --ini http://uwsgi.it/configs/myapp.ini # HTTP<br>uwsgi --xml - # standard input<br>uwsgi --yaml fd://0 # file descriptor<br>uwsgi --json &#x27;exec://nc 192.168.11.2:33000&#x27; # arbitrary executable<br></code></pre></div></td></tr></table></figure><h5 id="å®‰è£…å-è¿›å…¥é¡¹ç›®ç›®å½•-æ–°å»ºxxx-xmlæ–‡ä»¶-å¹¶è¾“å…¥ä»¥ä¸‹ä»£ç "><a href="#å®‰è£…å-è¿›å…¥é¡¹ç›®ç›®å½•-æ–°å»ºxxx-xmlæ–‡ä»¶-å¹¶è¾“å…¥ä»¥ä¸‹ä»£ç " class="headerlink" title="å®‰è£…å,è¿›å…¥é¡¹ç›®ç›®å½• æ–°å»ºxxx.xmlæ–‡ä»¶ å¹¶è¾“å…¥ä»¥ä¸‹ä»£ç :"></a><strong><code>å®‰è£…å,è¿›å…¥é¡¹ç›®ç›®å½• æ–°å»ºxxx.xmlæ–‡ä»¶ å¹¶è¾“å…¥ä»¥ä¸‹ä»£ç :</code></strong></h5><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">&lt;uwsgi&gt;    <br>   &lt;socket&gt;127.0.0.1:8000&lt;/socket&gt;&lt;!-- å†…éƒ¨ç«¯å£ï¼Œè‡ªå®šä¹‰ --&gt; <br>   &lt;chdir&gt;/home/ubuntu/project/xxx/&lt;/chdir&gt;&lt;!-- é¡¹ç›®è·¯å¾„ --&gt;            <br>   &lt;module&gt;xxx.wsgi&lt;/module&gt; <br>   &lt;processes&gt;4&lt;/processes&gt; &lt;!-- è¿›ç¨‹æ•° --&gt;     <br>   &lt;daemonize&gt;uwsgi.log&lt;/daemonize&gt;&lt;!-- æ—¥å¿—æ–‡ä»¶ --&gt;<br>&lt;/uwsgi&gt;<br></code></pre></div></td></tr></table></figure><h5 id="å¼€å¯å‘½ä»¤"><a href="#å¼€å¯å‘½ä»¤" class="headerlink" title="å¼€å¯å‘½ä»¤"></a><strong><code>å¼€å¯å‘½ä»¤</code></strong></h5><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> å¯åŠ¨uwsgl</span><br>uwsgi -x mysite.xml<br><br><span class="hljs-meta">#</span><span class="bash"> æŸ¥çœ‹uwsgiæ˜¯å¦å¼€å¯æˆåŠŸ</span><br>ps -ef|grep uwsgi<br><span class="hljs-meta">#</span><span class="bash"> åˆ é™¤è¿›ç¨‹ å¦‚æœæƒ³é‡å¯uwsgi, å…ˆåˆ é™¤è¿›ç¨‹ åé‡å¯uwsgi</span><br>killall -9 uwsgi<br></code></pre></div></td></tr></table></figure><h5 id="ä¸Šè¿°æ˜¯ç¬¬ä¸€ç§æ–¹å¼-è¿˜å¯ä»¥ä½¿ç”¨-iniæ–‡ä»¶æ–¹å¼-è®¾ç½®uwsgiå±æ€§"><a href="#ä¸Šè¿°æ˜¯ç¬¬ä¸€ç§æ–¹å¼-è¿˜å¯ä»¥ä½¿ç”¨-iniæ–‡ä»¶æ–¹å¼-è®¾ç½®uwsgiå±æ€§" class="headerlink" title="ä¸Šè¿°æ˜¯ç¬¬ä¸€ç§æ–¹å¼ è¿˜å¯ä»¥ä½¿ç”¨ .iniæ–‡ä»¶æ–¹å¼ è®¾ç½®uwsgiå±æ€§"></a><strong><code>ä¸Šè¿°æ˜¯ç¬¬ä¸€ç§æ–¹å¼ è¿˜å¯ä»¥ä½¿ç”¨ .iniæ–‡ä»¶æ–¹å¼ è®¾ç½®uwsgiå±æ€§</code></strong></h5><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">[uwsgi]<br><span class="hljs-meta">#</span><span class="bash">é…ç½®å’Œnginxè¿æ¥çš„socketè¿æ¥</span><br>socket=127.0.0.1:8000<br><span class="hljs-meta">#</span><span class="bash">é…ç½®é¡¹ç›®è·¯å¾„ï¼Œé¡¹ç›®çš„æ‰€åœ¨ç›®å½•</span><br>chdir=/home/ubuntu/project/xxx/<br><span class="hljs-meta">#</span><span class="bash">é…ç½®wsgiæ¥å£æ¨¡å—æ–‡ä»¶è·¯å¾„,ä¹Ÿå°±æ˜¯wsgi.pyè¿™ä¸ªæ–‡ä»¶æ‰€åœ¨çš„ç›®å½•å</span><br>wsgi-file=xxx/wsgi.py<br><span class="hljs-meta">#</span><span class="bash">é…ç½®å¯åŠ¨çš„è¿›ç¨‹æ•°</span><br>processes=4<br><span class="hljs-meta">#</span><span class="bash">é…ç½®æ¯ä¸ªè¿›ç¨‹çš„çº¿ç¨‹æ•°</span><br>threads=2<br><span class="hljs-meta">#</span><span class="bash">é…ç½®å¯åŠ¨ç®¡ç†ä¸»è¿›ç¨‹</span><br>master=True<br><span class="hljs-meta">#</span><span class="bash">é…ç½®å­˜æ”¾ä¸»è¿›ç¨‹çš„è¿›ç¨‹å·æ–‡ä»¶</span><br>pidfile=uwsgi.pid<br><span class="hljs-meta">#</span><span class="bash">é…ç½®dumpæ—¥å¿—è®°å½•</span><br>daemonize=uwsgi.log<br><span class="hljs-meta">#</span><span class="bash">æ›´æ–°ä»£ç åè‡ªåŠ¨é‡å¯</span><br>py-autoreload=1<br><span class="hljs-meta">#</span><span class="bash">å¼€å¯å†…å­˜ä½¿ç”¨æƒ…å†µæŠ¥å‘Š</span><br>memory-report=true<br><span class="hljs-meta">#</span><span class="bash">ä¸è®°å½•requestæ—¥å¿—ï¼Œåªè®°å½•é”™è¯¯æ—¥å¿—</span><br>disable-logging=true<br><span class="hljs-meta">#</span><span class="bash">ä¼˜é›…é‡å¯</span><br>lazy-apps=true<br><span class="hljs-meta">#</span><span class="bash"><span class="hljs-built_in">log</span>æ—¥å¿—</span><br>log-maxsize = 50000000<br></code></pre></div></td></tr></table></figure><h5 id="uwsgiå¼€å¯Â·é‡å¯Â·åœæ­¢å‘½ä»¤"><a href="#uwsgiå¼€å¯Â·é‡å¯Â·åœæ­¢å‘½ä»¤" class="headerlink" title="uwsgiå¼€å¯Â·é‡å¯Â·åœæ­¢å‘½ä»¤"></a><strong><code>uwsgiå¼€å¯Â·é‡å¯Â·åœæ­¢å‘½ä»¤</code></strong></h5><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> å¼€å¯</span><br>uwsgi --ini uwsgi.ini<br>æ•ˆæœ:<br>[uWSGI] getting INI configuration from uwsgi.ini<br><br><span class="hljs-meta">#</span><span class="bash"> åœæ­¢è¿è¡Œuwsgiï¼Œé€šè¿‡åŒ…å«ä¸»è¿›ç¨‹ç¼–å·çš„æ–‡ä»¶è®¾ç½®åœæ­¢é¡¹ç›®</span><br>uwsgi --stop uwsgi.pid<br><br><span class="hljs-meta">#</span><span class="bash"> é‡å¯uwsgi</span><br>uwsgi --reload uwsgi.pid<br></code></pre></div></td></tr></table></figure><h4 id="Uwsgiå®˜æ–¹æ–‡æ¡£"><a href="#Uwsgiå®˜æ–¹æ–‡æ¡£" class="headerlink" title="Uwsgiå®˜æ–¹æ–‡æ¡£"></a><strong><a href="https://uwsgi-docs.readthedocs.io/en/latest/Configuration.html">Uwsgiå®˜æ–¹æ–‡æ¡£</a></strong></h4><h2 id="å®‰è£…nginx"><a href="#å®‰è£…nginx" class="headerlink" title="å®‰è£…nginx"></a><font color="#00DD00">å®‰è£…nginx</font></h2><h5 id="å®‰è£…nginx-æœ‰å¾ˆå¤šæ–¹å¼-ç½‘ä¸Šä¹Ÿå¯ä»¥æ‰¾åˆ°n-1ç§æ–¹å¼-åœ¨è¿™é‡Œé€‰ç”¨åœ¨çº¿å®‰è£…"><a href="#å®‰è£…nginx-æœ‰å¾ˆå¤šæ–¹å¼-ç½‘ä¸Šä¹Ÿå¯ä»¥æ‰¾åˆ°n-1ç§æ–¹å¼-åœ¨è¿™é‡Œé€‰ç”¨åœ¨çº¿å®‰è£…" class="headerlink" title="å®‰è£…nginx æœ‰å¾ˆå¤šæ–¹å¼ ç½‘ä¸Šä¹Ÿå¯ä»¥æ‰¾åˆ°n+1ç§æ–¹å¼ åœ¨è¿™é‡Œé€‰ç”¨åœ¨çº¿å®‰è£…"></a><strong><code>å®‰è£…nginx æœ‰å¾ˆå¤šæ–¹å¼ ç½‘ä¸Šä¹Ÿå¯ä»¥æ‰¾åˆ°n+1ç§æ–¹å¼ åœ¨è¿™é‡Œé€‰ç”¨åœ¨çº¿å®‰è£…</code></strong></h5><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">apt-get install nginx<br></code></pre></div></td></tr></table></figure><h5 id="åœ¨çº¿å®‰è£…è¯´æ˜"><a href="#åœ¨çº¿å®‰è£…è¯´æ˜" class="headerlink" title="åœ¨çº¿å®‰è£…è¯´æ˜:"></a><strong><code>åœ¨çº¿å®‰è£…è¯´æ˜:</code></strong></h5><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">å¯åŠ¨nginxçš„ç¨‹åºæ–‡ä»¶ /usr/sbin/nginx<br>æ—¥å¿—æ”¾åœ¨äº†/var/log/nginxä¸­ï¼Œåˆ†åˆ«æ˜¯access.logå’Œerror.log<br>å¹¶å·²ç»åœ¨/etc/init.d/ä¸‹åˆ›å»ºäº†å¯åŠ¨è„šæœ¬nginx<br></code></pre></div></td></tr></table></figure><h5 id="åœ¨çº¿å¯åŠ¨-é‡å¯"><a href="#åœ¨çº¿å¯åŠ¨-é‡å¯" class="headerlink" title="åœ¨çº¿å¯åŠ¨-é‡å¯"></a><strong><code>åœ¨çº¿å¯åŠ¨-é‡å¯</code></strong></h5><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> start</span><br>/etc/init.d/nginx start<br><br><span class="hljs-meta">#</span><span class="bash"> restart</span><br>/etc/init.d/nginx restart<br></code></pre></div></td></tr></table></figure><h5 id="Nginxå®˜æ–¹ä¸­æ–‡æ‰‹å†Œ"><a href="#Nginxå®˜æ–¹ä¸­æ–‡æ‰‹å†Œ" class="headerlink" title="Nginxå®˜æ–¹ä¸­æ–‡æ‰‹å†Œ"></a><strong><a href="https://www.nginx.cn/nginx-how-to">Nginxå®˜æ–¹ä¸­æ–‡æ‰‹å†Œ</a></strong></h5><h5 id="æ¥ä¸‹æ¥-é…ç½®nginx-é¦–å…ˆå¤‡ä»½ä¸€ä¸‹nginx-confæ–‡ä»¶-ä»¥é˜²å‡ºç°é—®é¢˜"><a href="#æ¥ä¸‹æ¥-é…ç½®nginx-é¦–å…ˆå¤‡ä»½ä¸€ä¸‹nginx-confæ–‡ä»¶-ä»¥é˜²å‡ºç°é—®é¢˜" class="headerlink" title="æ¥ä¸‹æ¥ é…ç½®nginx é¦–å…ˆå¤‡ä»½ä¸€ä¸‹nginx.confæ–‡ä»¶ ä»¥é˜²å‡ºç°é—®é¢˜"></a><strong><code>æ¥ä¸‹æ¥ é…ç½®nginx é¦–å…ˆå¤‡ä»½ä¸€ä¸‹nginx.confæ–‡ä»¶ ä»¥é˜²å‡ºç°é—®é¢˜</code></strong></h5><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">sudo cp /etc/nginx/nginx.conf /etc/nginx/nginx.conf.bak<br></code></pre></div></td></tr></table></figure><h5 id="ç„¶åé‡æ–°å°†nginx-confæ–‡ä»¶å†…å®¹åˆ é™¤-é‡æ–°æ­é…ä¸€ä»½"><a href="#ç„¶åé‡æ–°å°†nginx-confæ–‡ä»¶å†…å®¹åˆ é™¤-é‡æ–°æ­é…ä¸€ä»½" class="headerlink" title="ç„¶åé‡æ–°å°†nginx.confæ–‡ä»¶å†…å®¹åˆ é™¤ é‡æ–°æ­é…ä¸€ä»½"></a><strong><code>ç„¶åé‡æ–°å°†nginx.confæ–‡ä»¶å†…å®¹åˆ é™¤ é‡æ–°æ­é…ä¸€ä»½</code></strong></h5><figure class="highlight nginx"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs nginx"><span class="hljs-section">events</span> &#123;<br><span class="hljs-attribute">worker_connections</span>  <span class="hljs-number">1024</span>;<br>&#125;<br><span class="hljs-section">http</span> &#123;<br>    <span class="hljs-attribute">include</span>       mime.types;<br>    <span class="hljs-attribute">default_type</span>  application/octet-stream;<br>    <span class="hljs-attribute">sendfile</span>        <span class="hljs-literal">on</span>;<br>    <span class="hljs-section">server</span> &#123;<br>        <span class="hljs-attribute">listen</span>       <span class="hljs-number">80</span>;<br>        <span class="hljs-attribute">server_name</span>  åŸŸå/å…¬ç½‘ip;<br>        <span class="hljs-attribute">charset</span> utf-<span class="hljs-number">8</span>;<br>        <span class="hljs-attribute">location</span> / &#123;<br>           <span class="hljs-attribute">include</span> uwsgi_params;<br>           <span class="hljs-attribute">uwsgi_pass</span> <span class="hljs-number">127.0.0.1:8000</span>; <span class="hljs-comment"># ç«¯å£éœ€è¦è·Ÿuwsgi.ini/uwsgi.xmlæ–‡ä»¶é‡Œé¢çš„é…ç½®ä¸€æ ·</span><br>           <span class="hljs-attribute">uwsgi_param</span> UWSGI_SCRIPT xxx.wsgi;<br>           <span class="hljs-attribute">uwsgi_param</span> UWSGI_CHDIR /home/ubuntu/project/xxx/; <span class="hljs-comment"># é¡¹ç›®è·¯å¾„</span><br><br>       <span class="hljs-attribute">location</span> /static/ &#123;<br>        <span class="hljs-attribute">alias</span> /home/ubuntu/project/xxx/static/; <span class="hljs-comment"># é™æ€èµ„æº</span><br>       &#125;<br>        &#125;<br>&#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><h5 id="è¾“å…¥å‘½ä»¤-æŸ¥çœ‹å½“å‰é…ç½®æ˜¯å¦æœ‰é—®é¢˜"><a href="#è¾“å…¥å‘½ä»¤-æŸ¥çœ‹å½“å‰é…ç½®æ˜¯å¦æœ‰é—®é¢˜" class="headerlink" title="è¾“å…¥å‘½ä»¤ æŸ¥çœ‹å½“å‰é…ç½®æ˜¯å¦æœ‰é—®é¢˜"></a><strong><code>è¾“å…¥å‘½ä»¤ æŸ¥çœ‹å½“å‰é…ç½®æ˜¯å¦æœ‰é—®é¢˜</code></strong></h5><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">uuu@VM-8-16-ubuntu:/etc/nginx$ sudo nginx -t<br><span class="hljs-meta">#</span><span class="bash"> æ•ˆæœå¦‚ä¸‹:</span><br>nginx: the configuration file /etc/nginx/nginx.conf syntax is ok<br>nginx: configuration file /etc/nginx/nginx.conf test is successful<br><br></code></pre></div></td></tr></table></figure><h5 id="é‡å¯Nginx"><a href="#é‡å¯Nginx" class="headerlink" title="é‡å¯Nginx"></a><strong><code>é‡å¯Nginx</code></strong></h5><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">uuu@VM-8-16-ubuntu:~$ sudo /etc/init.d/nginx restart<br><span class="hljs-meta">#</span><span class="bash"> æ•ˆæœå¦‚ä¸‹:</span><br>[ ok ] Restarting nginx (via systemctl): nginx.service.<br></code></pre></div></td></tr></table></figure><h5 id="è¿›å…¥é¡¹ç›®-è·Ÿuwsgi-ini-uwsgi-xmlæ–‡ä»¶åŒçº§ä¸‹-å¯åŠ¨uwsgi-å¦‚æœä¹‹å‰å¯åŠ¨äº†-å¯ä»¥é‡å¯"><a href="#è¿›å…¥é¡¹ç›®-è·Ÿuwsgi-ini-uwsgi-xmlæ–‡ä»¶åŒçº§ä¸‹-å¯åŠ¨uwsgi-å¦‚æœä¹‹å‰å¯åŠ¨äº†-å¯ä»¥é‡å¯" class="headerlink" title="è¿›å…¥é¡¹ç›® è·Ÿuwsgi.ini/uwsgi.xmlæ–‡ä»¶åŒçº§ä¸‹ å¯åŠ¨uwsgi(å¦‚æœä¹‹å‰å¯åŠ¨äº† å¯ä»¥é‡å¯)"></a><strong><code>è¿›å…¥é¡¹ç›® è·Ÿuwsgi.ini/uwsgi.xmlæ–‡ä»¶åŒçº§ä¸‹ å¯åŠ¨uwsgi(å¦‚æœä¹‹å‰å¯åŠ¨äº† å¯ä»¥é‡å¯)</code></strong></h5><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> xmlå¯åŠ¨æ–¹å¼</span><br>uwsgi -x xxx.xml<br><span class="hljs-meta">#</span><span class="bash"> iniå¯åŠ¨æ–¹å¼</span><br>uwsgi --ini uwsgi.ini<br><br><span class="hljs-meta">#</span><span class="bash"> ä¸Šè¿°å·²ç»æœ‰å¯åŠ¨æ–¹å¼</span><br></code></pre></div></td></tr></table></figure><h5 id="ä¸Šè¿°é…ç½®å®Œæˆå-æ‰“å¼€æµè§ˆå™¨-å‘ç°é¡¹ç›®é™æ€æ–‡ä»¶è®¿é—®ä¸åˆ°-403-æˆ–è€…æ²¡æœ‰è·å–åˆ°é™æ€èµ„æºæ ·å¼"><a href="#ä¸Šè¿°é…ç½®å®Œæˆå-æ‰“å¼€æµè§ˆå™¨-å‘ç°é¡¹ç›®é™æ€æ–‡ä»¶è®¿é—®ä¸åˆ°-403-æˆ–è€…æ²¡æœ‰è·å–åˆ°é™æ€èµ„æºæ ·å¼" class="headerlink" title="ä¸Šè¿°é…ç½®å®Œæˆå æ‰“å¼€æµè§ˆå™¨ å‘ç°é¡¹ç›®é™æ€æ–‡ä»¶è®¿é—®ä¸åˆ° 403 æˆ–è€…æ²¡æœ‰è·å–åˆ°é™æ€èµ„æºæ ·å¼"></a><strong><code>ä¸Šè¿°é…ç½®å®Œæˆå æ‰“å¼€æµè§ˆå™¨ å‘ç°é¡¹ç›®é™æ€æ–‡ä»¶è®¿é—®ä¸åˆ° 403 æˆ–è€…æ²¡æœ‰è·å–åˆ°é™æ€èµ„æºæ ·å¼</code></strong></h5><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> 1. ä¿®æ”¹nginxçš„é…ç½®æ–‡ä»¶ åœ¨æœ€ä¸Šé¢ åŠ ä¸Š user root;</span><br>sudo vim /etc/nginx/nginx.conf<br>user root;<br>events &#123;<br>worker_connections  1024;<br>&#125;<br>...<br><br><span class="hljs-meta">#</span><span class="bash"> æ”¶é›†CSSæ ·å¼ï¼Œåœ¨ç»ˆç«¯è¾“å…¥ï¼š</span><br>python manage.py collectstatic<br><br><span class="hljs-meta">#</span><span class="bash"> è¿è¡Œè¿™ä¸ªå‘½ä»¤ä¹‹åï¼Œå°±ä¼šè‡ªåŠ¨æŠŠåå°CSSæ ·å¼æ”¶é›†åˆ°/static/ç›®å½•ä¸‹ã€‚åˆ·æ–°é¡µé¢å°±èƒ½æ¢å¤æ ·å¼ï¼</span><br></code></pre></div></td></tr></table></figure><h5 id="ok-éƒ¨ç½²å®Œæˆ-åæœŸä¼šå¸¦ä¸Š-https-å¤šç«™ç‚¹éƒ¨ç½²"><a href="#ok-éƒ¨ç½²å®Œæˆ-åæœŸä¼šå¸¦ä¸Š-https-å¤šç«™ç‚¹éƒ¨ç½²" class="headerlink" title="ok éƒ¨ç½²å®Œæˆ åæœŸä¼šå¸¦ä¸Š https/å¤šç«™ç‚¹éƒ¨ç½²"></a><strong><code>ok éƒ¨ç½²å®Œæˆ åæœŸä¼šå¸¦ä¸Š https/å¤šç«™ç‚¹éƒ¨ç½²</code></strong></h5>]]></content>
    
    
    <categories>
      
      <category>Python</category>
      
      <category>Django</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Django</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å¾®ä¿¡æ”¯ä»˜-ä¼šå‘˜å‡çº§</title>
    <link href="/2021/03/25/%E5%BE%AE%E4%BF%A1%E6%94%AF%E4%BB%98-4/"/>
    <url>/2021/03/25/%E5%BE%AE%E4%BF%A1%E6%94%AF%E4%BB%98-4/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h2 id="ä¼šå‘˜å‡çº§â€“è¡¥å·®ä»·"><a href="#ä¼šå‘˜å‡çº§â€“è¡¥å·®ä»·" class="headerlink" title="ä¼šå‘˜å‡çº§â€“è¡¥å·®ä»·"></a><font color="#008080">ä¼šå‘˜å‡çº§â€“è¡¥å·®ä»·</font></h2><p><code>å‰æƒ…æè¦</code></p><figure class="highlight"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs nginx">æ ¹æ®å¾®ä¿¡æ”¯ä»˜æ¥å®ç°çš„ä¼šå‘˜å‡çº§ (ä½é…ç‰ˆ)<br>ç”¨æˆ·è´­ä¹°å¹´ä¼šå‘˜/ä¸å¤Ÿç”¨ ä½†æ˜¯ä½¿ç”¨çš„æ—¶é—´æ‰ä¸‰ä¸ªæœˆ<br>å¯æ˜¯é‡æ–°è´­ä¹°ä¸€ä¸ªçš„è¯ å°±æµªè´¹äº† æ‰€ä»¥éœ€è¦å‡çº§ä¼šå‘˜<br>æœ¬ç« ä½¿ç”¨: Python3.6 django MySQL<br></code></pre></div></td></tr></table></figure><p><code>æµç¨‹å›¾&lt;--&gt;é€»è¾‘</code></p><p><img src="https://p.pstatp.com/origin/137790001afcaaf439a79" alt="æµç¨‹"></p><h2 id="å‡çº§ä»£ç -è·å–ç”¨æˆ·çš„ç­‰çº§ä¸ä»·æ ¼"><a href="#å‡çº§ä»£ç -è·å–ç”¨æˆ·çš„ç­‰çº§ä¸ä»·æ ¼" class="headerlink" title="å‡çº§ä»£ç /è·å–ç”¨æˆ·çš„ç­‰çº§ä¸ä»·æ ¼"></a><font color="#008080">å‡çº§ä»£ç /è·å–ç”¨æˆ·çš„ç­‰çº§ä¸ä»·æ ¼</font></h2><table><thead><tr><th>å‚æ•°</th><th>å€¼</th><th>å¤‡æ³¨</th><th>è¯·æ±‚æ–¹å¼</th></tr></thead><tbody><tr><td>å‚è€ƒè·¯ç”±</td><td><a href="http://127.0.0.1:8000/memberupgrade/">http://127.0.0.1:8000/memberupgrade/</a></td><td>ä¼šå‘˜å‡çº§/éœ€è·å–å½“å‰ç”¨æˆ·çš„çº§åˆ«</td><td>POST</td></tr><tr><td>body</td><td>xxxå¾®ä¿¡æ”¯ä»˜</td><td>å•†å“æè¿°</td><td></td></tr><tr><td>total_fee</td><td>2980</td><td>ç°ä»·æ ¼</td><td></td></tr></tbody></table><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment"># è®¤è¯ç”¨æˆ·çš„jwt_token</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MemberUpgradeView</span>(<span class="hljs-params">APIView</span>):</span><br>    <span class="hljs-string">&quot;&quot;&quot;MemberUpgradeView è¯¥ç±»--&gt;ä¼šå‘˜å‡çº§&quot;&quot;&quot;</span><br>    authentication_classes = [MyBaseAuthentication, ]  <span class="hljs-comment"># è®¤è¯ç”¨æˆ·/ç™»å½•/è¿‡æœŸ/å•ç‚¹ç™»å½•</span><br>    <br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">post</span>(<span class="hljs-params">self, request</span>):</span><br>        body = request.POST.get(<span class="hljs-string">&#x27;body&#x27;</span>).encode(<span class="hljs-string">&#x27;utf-8&#x27;</span>)  <span class="hljs-comment"># å•†å“æè¿°</span><br>        total_fee = <span class="hljs-built_in">int</span>(request.POST.get(<span class="hljs-string">&#x27;total_fee&#x27;</span>))  <span class="hljs-comment"># ç°ä»·æ ¼</span><br>        user = request.user  <span class="hljs-comment"># è·å–ç™»å½•çš„ç”¨æˆ·/ä¼šå‘˜</span><br>        create_vip_time = user.create_vip_time  <span class="hljs-comment"># åˆ›å»ºä¼šå‘˜çš„æ—¥æœŸ</span><br>        nowdays = datetime.datetime.now()  <span class="hljs-comment"># ä»Šå¤©çš„æ—¥æœŸ</span><br>        days = (nowdays - create_vip_time).days  <span class="hljs-comment"># ç”¨æ‰çš„å¤©æ•°</span><br>        <span class="hljs-keyword">if</span> days &lt;= <span class="hljs-number">0</span>:<br>            <span class="hljs-keyword">return</span> Response(&#123;<span class="hljs-string">&#x27;code&#x27;</span>: RET.DBERR, <span class="hljs-string">&#x27;message&#x27;</span>: <span class="hljs-string">&#x27;ä¼šå‘˜ä½¿ç”¨ä¸è¶³7å¤©&#x27;</span>&#125;)<br>        <span class="hljs-string">&quot;&quot;&quot;è¿™ä¸€å—çš„æ ¡éªŒ è‡ªå·±æ·»åŠ &quot;&quot;&quot;</span><br>        <span class="hljs-keyword">if</span> user.user_type == <span class="hljs-number">1</span>:  <span class="hljs-comment"># æ ¹æ®ç”¨æˆ·çš„ç­‰çº§ ç¡®è®¤å‡çº§çš„ä¼šå‘˜</span><br>            <span class="hljs-keyword">return</span> Response(&#123;<span class="hljs-string">&#x27;code&#x27;</span>: RET.DBERR, <span class="hljs-string">&#x27;message&#x27;</span>: <span class="hljs-string">&#x27;æ‚¨ä¸æ˜¯ä¼šå‘˜,å¯å…ˆè´­ä¹°åå‡çº§ä¼šå‘˜&#x27;</span>&#125;)<br>        <span class="hljs-keyword">elif</span> user.user_type == <span class="hljs-number">2</span>:<br>            day_price = <span class="hljs-number">1980</span> / <span class="hljs-number">12</span> / <span class="hljs-number">30</span>  <span class="hljs-comment"># æ—¥ä»·æ ¼</span><br>            price_difference = total_fee - (<span class="hljs-number">1980</span> - day_price * days)  <span class="hljs-comment"># å·®ä»·è®¡ç®—</span><br>        out_trade_no = create_orderId(<span class="hljs-number">5</span>)<br>        body = body.decode()<br>        price_difference = price_difference * <span class="hljs-number">100</span><br>        data_dict = wxpay(body, <span class="hljs-built_in">int</span>(price_difference), out_trade_no)  <span class="hljs-comment"># å¾—åˆ°å­—å…¸æ•°æ®</span><br>        user = request.user<br>        <span class="hljs-keyword">if</span> data_dict.get(<span class="hljs-string">&#x27;return_code&#x27;</span>) == <span class="hljs-string">&#x27;SUCCESS&#x27;</span>:<br>            code_url = get_code_url(data_dict)  <span class="hljs-comment"># è·å–äºŒç»´ç å­—ç¬¦ä¸²</span><br>            img = create_image(code_url)  <span class="hljs-comment"># åˆ›å»ºæ”¯ä»˜ äºŒç»´ç </span><br>            qrcode_name = out_trade_no + <span class="hljs-string">&#x27;.png&#x27;</span><br>            img.save(<span class="hljs-string">r&#x27;static&#x27;</span> + <span class="hljs-string">&#x27;/&#x27;</span> + qrcode_name)<br>            img_url = <span class="hljs-string">&#x27;/static/&#x27;</span> + qrcode_name<br>            <span class="hljs-comment"># è®¢å•å†™å…¥ å…³è”ä¸ªäºº</span><br>            OrderInfo.objects.create(order_id=out_trade_no, user=user, total_amout=total_fee, status=<span class="hljs-string">&#x27;&#x27;</span>)<br>            <span class="hljs-keyword">return</span> Response(<br>                &#123;<span class="hljs-string">&#x27;code&#x27;</span>: RET.OK, <span class="hljs-string">&#x27;img_url&#x27;</span>: img_url, <span class="hljs-string">&#x27;order_id&#x27;</span>: out_trade_no, <span class="hljs-string">&#x27;total_fee&#x27;</span>: price_difference&#125;)<br>        <span class="hljs-keyword">return</span> Response(&#123;<span class="hljs-string">&#x27;code&#x27;</span>: RET.DBERR, <span class="hljs-string">&#x27;message&#x27;</span>: <span class="hljs-string">&#x27;è·å–å¾®ä¿¡code_urlå¤±è´¥&#x27;</span>&#125;)<br></code></pre></div></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>WeChat</category>
      
    </categories>
    
    
    <tags>
      
      <tag>WeChat Pay</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å¾®ä¿¡æ”¯ä»˜-åç«¯VIEW</title>
    <link href="/2021/03/25/%E5%BE%AE%E4%BF%A1%E6%94%AF%E4%BB%98-3/"/>
    <url>/2021/03/25/%E5%BE%AE%E4%BF%A1%E6%94%AF%E4%BB%98-3/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h2 id="WeChat-Pay"><a href="#WeChat-Pay" class="headerlink" title="WeChat Pay"></a><font color=" DeepSkyBlue ">WeChat Pay</font></h2><p><font color="  LimeGreen "><a href="https://pay.weixin.qq.com/wiki/doc/api/index.html">å¾®ä¿¡å¼€å‘æ–‡æ¡£</a></font></p><h2 id="é…ç½®è·¯ç”±ä¸æ–‡ä»¶è·¯å¾„"><a href="#é…ç½®è·¯ç”±ä¸æ–‡ä»¶è·¯å¾„" class="headerlink" title="é…ç½®è·¯ç”±ä¸æ–‡ä»¶è·¯å¾„"></a><font color=" DeepSkyBlue ">é…ç½®è·¯ç”±ä¸æ–‡ä»¶è·¯å¾„</font></h2><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-string">&quot;&quot;&quot;wechatPay URL Configuration</span><br><span class="hljs-string"></span><br><span class="hljs-string">The `urlpatterns` list routes URLs to views. For more information please see:</span><br><span class="hljs-string">    https://docs.djangoproject.com/en/1.11/topics/http/urls/</span><br><span class="hljs-string">Examples:</span><br><span class="hljs-string">Function views</span><br><span class="hljs-string">    1. Add an import:  from my_app import views</span><br><span class="hljs-string">    2. Add a URL to urlpatterns:  url(r&#x27;^$&#x27;, views.home, name=&#x27;home&#x27;)</span><br><span class="hljs-string">Class-based views</span><br><span class="hljs-string">    1. Add an import:  from other_app.views import Home</span><br><span class="hljs-string">    2. Add a URL to urlpatterns:  url(r&#x27;^$&#x27;, Home.as_view(), name=&#x27;home&#x27;)</span><br><span class="hljs-string">Including another URLconf</span><br><span class="hljs-string">    1. Import the include() function: from django.conf.urls import url, include</span><br><span class="hljs-string">    2. Add a URL to urlpatterns:  url(r&#x27;^blog/&#x27;, include(&#x27;blog.urls&#x27;))</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br><br><span class="hljs-keyword">from</span> django.conf.urls <span class="hljs-keyword">import</span> url, include<br><span class="hljs-keyword">from</span> django.contrib <span class="hljs-keyword">import</span> admin<br><br>urlpatterns = [<br>    url(<span class="hljs-string">r&#x27;^admin/&#x27;</span>, admin.site.urls),<br>    url(<span class="hljs-string">r&#x27;^&#x27;</span>, include(<span class="hljs-string">&#x27;pay.urls&#x27;</span>))<br>]<br><br></code></pre></div></td></tr></table></figure><p><font color="  LimeGreen ">åœ¨å­åº”ç”¨å½“ä¸­ æ–°å»ºurls.py</font></p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">from</span> django.conf.urls <span class="hljs-keyword">import</span> url<br><span class="hljs-keyword">from</span> . <span class="hljs-keyword">import</span> views<br><br>urlpatterns = [<br>    url(<span class="hljs-string">r&#x27;^$&#x27;</span>, views.index), <span class="hljs-comment"># ä¸»é¡µé¢</span><br>    url(<span class="hljs-string">r&#x27;^pay&#x27;</span>, views.pay), <span class="hljs-comment"># å¾®ä¿¡æ”¯ä»˜çš„æ¥å£</span><br>    url(<span class="hljs-string">r&#x27;^result&#x27;</span>, views.result), <span class="hljs-comment"># å¾®ä¿¡æ”¯ä»˜æˆåŠŸä¹‹å å›è°ƒå‡½æ•°</span><br>    url(<span class="hljs-string">r&#x27;websocketLink/(?P&lt;out_trade_no&gt;\w+)&#x27;</span>, views.websocketLink)  <span class="hljs-comment"># webSocket é“¾æ¥</span><br>]<br><br></code></pre></div></td></tr></table></figure><p><font color="  LimeGreen ">é…ç½®ä¸€ä¸‹æ¨¡æ¿æ–‡ä»¶çš„è®¿é—®</font></p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">TEMPLATES = [<br>    &#123;<br>        <span class="hljs-string">&#x27;BACKEND&#x27;</span>: <span class="hljs-string">&#x27;django.template.backends.django.DjangoTemplates&#x27;</span>,<br>        <span class="hljs-string">&#x27;DIRS&#x27;</span>: [os.path.join(BASE_DIR, <span class="hljs-string">&#x27;templates&#x27;</span>)],<br>        <span class="hljs-string">&#x27;APP_DIRS&#x27;</span>: <span class="hljs-literal">True</span>,<br>        <span class="hljs-string">&#x27;OPTIONS&#x27;</span>: &#123;<br>            <span class="hljs-string">&#x27;context_processors&#x27;</span>: [<br>                <span class="hljs-string">&#x27;django.template.context_processors.debug&#x27;</span>,<br>                <span class="hljs-string">&#x27;django.template.context_processors.request&#x27;</span>,<br>                <span class="hljs-string">&#x27;django.contrib.auth.context_processors.auth&#x27;</span>,<br>                <span class="hljs-string">&#x27;django.contrib.messages.context_processors.messages&#x27;</span>,<br>            ],<br>        &#125;,<br>    &#125;,<br>]<br></code></pre></div></td></tr></table></figure><h2 id="è¿”å›ä¸»é¡µé¢åŠsettingsé…ç½®"><a href="#è¿”å›ä¸»é¡µé¢åŠsettingsé…ç½®" class="headerlink" title="è¿”å›ä¸»é¡µé¢åŠsettingsé…ç½®"></a><font color=" DeepSkyBlue ">è¿”å›ä¸»é¡µé¢åŠsettingsé…ç½®</font></h2><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">from</span> django.shortcuts <span class="hljs-keyword">import</span> render<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">index</span>(<span class="hljs-params">request</span>):</span><br>    <span class="hljs-keyword">return</span> render(request, <span class="hljs-string">&#x27;index.html&#x27;</span>)<br></code></pre></div></td></tr></table></figure><p><font color="  LimeGreen ">åœ¨å­åº”ç”¨å½“ä¸­æ–°å»ºpay_setting.py é…ç½®ä¸€ä¸‹å¾®ä¿¡æ”¯ä»˜éœ€è¦çš„æ•°æ®</font></p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">APP_ID = <span class="hljs-string">&quot;wx**********&quot;</span>  <span class="hljs-comment"># å¾®ä¿¡å…¬ä¼—å·ID</span><br>MCH_ID = <span class="hljs-string">&quot;1*********&quot;</span>  <span class="hljs-comment"># å•†æˆ·å·ID</span><br>API_KEY = <span class="hljs-string">&quot;8**************************c&quot;</span>  <span class="hljs-comment"># APKå¯†é’¥(åœ¨å•†æˆ·å¹³å°é‡Œ--&gt;&gt;APIå¯†é’¥é‡Œé¢è®¾ç½®)(å»ºè®® å…³äºå¯†é’¥éƒ½è®¾ç½®æˆç»Ÿä¸€çš„ å¥½è®°)</span><br>UFDOOER_URL = <span class="hljs-string">&quot;https://api.mch.weixin.qq.com/pay/unifiedorder&quot;</span>  <span class="hljs-comment"># å¾®ä¿¡ç»Ÿä¸€ä¸‹å•åœ°å€ é»˜è®¤çš„</span><br><span class="hljs-comment"># æ³¨æ„ å†…ç½‘ç©¿é€çš„åœ°å€æ˜¯åªèƒ½ç»´æŒå‡ ä¸ªå°æ—¶çš„ å¦‚æœæ—¶é—´åˆ°äº† è¯·è‡ªè¡Œé‡å¯</span><br>NOTIFY_URL = <span class="hljs-string">&quot;http://t4knvu.natappfree.cc/result&quot;</span>  <span class="hljs-comment"># å›è°ƒï¼Œå¯ä½¿ç”¨å†…ç½‘ç©¿é€å·¥å…·è¿›è¡Œæµ‹è¯•</span><br>CREATE_IP = <span class="hljs-string">&quot;127.0.0.1&quot;</span>  <span class="hljs-comment"># æœåŠ¡å™¨çš„å…¬ç½‘IP æµ‹è¯•ä½¿ç”¨æœ¬åœ°</span><br><br></code></pre></div></td></tr></table></figure><h2 id="å¾®ä¿¡æ”¯ä»˜-æ‰«ç æ¥å£ä¸å›è°ƒå‡½æ•°"><a href="#å¾®ä¿¡æ”¯ä»˜-æ‰«ç æ¥å£ä¸å›è°ƒå‡½æ•°" class="headerlink" title="å¾®ä¿¡æ”¯ä»˜ æ‰«ç æ¥å£ä¸å›è°ƒå‡½æ•°"></a><font color=" DeepSkyBlue ">å¾®ä¿¡æ”¯ä»˜ æ‰«ç æ¥å£ä¸å›è°ƒå‡½æ•°</font></h2><table><thead><tr><th>å‚æ•°</th><th>å€¼</th><th>å¤‡æ³¨</th><th>è¯·æ±‚æ–¹å¼</th></tr></thead><tbody><tr><td>å‚è€ƒè·¯ç”±</td><td><a href="http://127.0.0.1:8000/pay/">http://127.0.0.1:8000/pay/</a></td><td>å¾®ä¿¡æ‰«ç æ”¯ä»˜çš„ç¬¬ä¸€æ­¥ æ‰«ç </td><td>GET</td></tr><tr><td>body</td><td>xxxå¾®ä¿¡æ”¯ä»˜</td><td>å•†å“æè¿°</td><td></td></tr><tr><td>total_fee</td><td>Aswce67249198721</td><td>è®¢å•å·</td><td></td></tr></tbody></table><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">pay</span>(<span class="hljs-params">request</span>):</span><br>    body = <span class="hljs-string">&#x27;payTest&#x27;</span>  <span class="hljs-comment"># å•†å“æè¿°</span><br>    total_fee = <span class="hljs-number">1</span>  <span class="hljs-comment"># ä»˜æ¬¾é‡‘é¢ï¼Œå•ä½æ˜¯åˆ†ï¼Œå¿…é¡»æ˜¯æ•´æ•°</span><br>    out_trade_no = create_orderId(<span class="hljs-number">5</span>) <span class="hljs-comment"># è¿™æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰çš„å‡½æ•° ç›®çš„æ˜¯ç”Ÿæˆè®¢å•å·</span><br>    data_dict = wxpay(body, total_fee, out_trade_no)  <span class="hljs-comment"># è¿™æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰çš„å‡½æ•°</span><br>    <span class="hljs-keyword">if</span> data_dict.get(<span class="hljs-string">&#x27;return_code&#x27;</span>) == <span class="hljs-string">&#x27;SUCCESS&#x27;</span>:<br>        code_url = get_code_url(data_dict) <span class="hljs-comment"># è¿™æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰å‡½æ•°,ç›®çš„æ˜¯è·å–æ”¯ä»˜äºŒç»´ç çš„åœ°å€</span><br>        img = create_image(code_url) <span class="hljs-comment"># åˆ›å»ºæ”¯ä»˜äºŒç»´ç çš„å›¾ç‰‡</span><br>        qrcode_name = out_trade_no + <span class="hljs-string">&#x27;wxpay.png&#x27;</span> <span class="hljs-comment"># è®¢å•å·åŠ åç¼€ ä½œä¸ºå›¾ç‰‡</span><br>        img.save(<span class="hljs-string">r&#x27;static&#x27;</span> + <span class="hljs-string">&#x27;/&#x27;</span> + qrcode_name) <span class="hljs-comment"># ä¿å­˜å›¾ç‰‡</span><br>        <span class="hljs-keyword">return</span> render(request, <span class="hljs-string">&#x27;qrcode.html&#x27;</span>, &#123;<span class="hljs-string">&#x27;qrcode_name&#x27;</span>: qrcode_name, <span class="hljs-string">&#x27;out_trade_no&#x27;</span>: out_trade_no&#125;) <span class="hljs-comment"># å‰ç«¯è·å–è¿”å›çš„è®¢å•å· è½®è¯¢è®¢å•æ˜¯å¦æ”¯ä»˜å®Œæˆ</span><br>    <span class="hljs-keyword">return</span> render(request, <span class="hljs-string">&#x27;index.html&#x27;</span>, &#123;<span class="hljs-string">&#x27;err_msg&#x27;</span>: <span class="hljs-string">&#x27;è·å–å¾®ä¿¡çš„code_urlå¤±è´¥&#x27;</span>&#125;)<br></code></pre></div></td></tr></table></figure><p><font color="  LimeGreen ">ä¸Šè¿°çš„è§†å›¾,å¦‚æœæ”¯ä»˜æˆåŠŸ å°±èµ°æ”¯ä»˜æˆåŠŸçš„å›è°ƒå‡½æ•°</font></p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">result</span>(<span class="hljs-params">request</span>):</span><br>    data_dict = trans_xml_to_dict(request.body)  <span class="hljs-comment"># å›è°ƒæ•°æ®è½¬å­—å…¸</span><br>    <span class="hljs-comment"># print(&#x27;æ”¯ä»˜å›è°ƒç»“æœ&#x27;, data_dict)</span><br>    sign = data_dict.pop(<span class="hljs-string">&#x27;sign&#x27;</span>)  <span class="hljs-comment"># å–å‡ºç­¾å</span><br>    back_sign = get_sign(data_dict, API_KEY)  <span class="hljs-comment"># è®¡ç®—ç­¾å</span><br>    <span class="hljs-comment"># éªŒè¯ç­¾åæ˜¯å¦ä¸å›è°ƒç­¾åç›¸åŒ</span><br>    <span class="hljs-keyword">if</span> sign == back_sign <span class="hljs-keyword">and</span> data_dict[<span class="hljs-string">&#x27;return_code&#x27;</span>] == <span class="hljs-string">&#x27;SUCCESS&#x27;</span>:<br>        <span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">        æ£€æŸ¥å¯¹åº”ä¸šåŠ¡æ•°æ®çš„çŠ¶æ€ï¼Œåˆ¤æ–­è¯¥é€šçŸ¥æ˜¯å¦å·²ç»å¤„ç†è¿‡ï¼Œå¦‚æœæ²¡æœ‰å¤„ç†è¿‡å†è¿›è¡Œå¤„ç†ï¼Œå¦‚æœå¤„ç†è¿‡ç›´æ¥è¿”å›ç»“æœæˆåŠŸã€‚</span><br><span class="hljs-string">        &#x27;&#x27;&#x27;</span><br>        print(<span class="hljs-string">&#x27;å¾®ä¿¡æ”¯ä»˜æˆåŠŸä¼šå›è°ƒï¼&#x27;</span>)<br>        <span class="hljs-comment"># å¤„ç†æ”¯ä»˜æˆåŠŸé€»è¾‘ï¼Œå‘å‰ç«¯é¡µé¢å‘é€å®æ—¶æ¶ˆæ¯</span><br>        out_trade_no = data_dict[<span class="hljs-string">&#x27;out_trade_no&#x27;</span>]<br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        æ­¤å¤„å¯åšæ”¯ä»˜æˆåŠŸåçš„ä¸šåŠ¡é€»è¾‘</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        send(out_trade_no, <span class="hljs-string">&#x27;æ”¯ä»˜æˆåŠŸ&#x27;</span>) <span class="hljs-comment"># è¿”å›å‰ç«¯çš„æ¶ˆæ¯</span><br>        <span class="hljs-comment"># è¿”å›æ¥æ”¶ç»“æœç»™å¾®ä¿¡ï¼Œå¦åˆ™å¾®ä¿¡ä¼šæ¯éš”8åˆ†é’Ÿå‘é€postè¯·æ±‚</span><br>        <span class="hljs-keyword">return</span> HttpResponse(trans_dict_to_xml(&#123;<span class="hljs-string">&#x27;return_code&#x27;</span>: <span class="hljs-string">&#x27;SUCCESS&#x27;</span>, <span class="hljs-string">&#x27;return_msg&#x27;</span>: <span class="hljs-string">&#x27;OK&#x27;</span>&#125;))<br>    <span class="hljs-keyword">return</span> HttpResponse(trans_dict_to_xml(&#123;<span class="hljs-string">&#x27;return_code&#x27;</span>: <span class="hljs-string">&#x27;FAIL&#x27;</span>, <span class="hljs-string">&#x27;return_msg&#x27;</span>: <span class="hljs-string">&#x27;SIGNERROR&#x27;</span>&#125;))<br></code></pre></div></td></tr></table></figure><h2 id="å‰ç«¯è½®è¯¢æ”¯ä»˜çŠ¶æ€"><a href="#å‰ç«¯è½®è¯¢æ”¯ä»˜çŠ¶æ€" class="headerlink" title="å‰ç«¯è½®è¯¢æ”¯ä»˜çŠ¶æ€"></a><font color=" DeepSkyBlue ">å‰ç«¯è½®è¯¢æ”¯ä»˜çŠ¶æ€</font></h2><p><font color="  LimeGreen ">è¿”å›å‰ç«¯çš„æ¶ˆæ¯</font></p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">clients = &#123;&#125;  <span class="hljs-comment"># åˆ›å»ºä¸€ä¸ªç©ºå­—å…¸ï¼Œç”¨äºä¿å­˜æ‰€æœ‰æ¥å…¥çš„ç”¨æˆ·åœ°å€</span><br><br><br><span class="hljs-meta">@accept_websocket</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">websocketLink</span>(<span class="hljs-params">request, out_trade_no</span>):</span><br>    <span class="hljs-string">&quot;&quot;&quot;è¿æ¥websocket&quot;&quot;&quot;</span><br>    <span class="hljs-keyword">if</span> request.is_websocket:<br>        lock = threading.RLock()  <span class="hljs-comment"># rlockçº¿ç¨‹é”</span><br>        <span class="hljs-keyword">try</span>:<br>            lock.acquire()  <span class="hljs-comment"># æŠ¢å èµ„æº</span><br>            clients[out_trade_no] = request.websocket<br>            <span class="hljs-comment"># ç›‘å¬æ¥æ”¶å®¢æˆ·ç«¯å‘é€çš„æ¶ˆæ¯ æˆ–è€… å®¢æˆ·ç«¯æ–­å¼€è¿æ¥</span><br>            <span class="hljs-keyword">for</span> message <span class="hljs-keyword">in</span> request.websocket:<br>                <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> message:<br>                    <span class="hljs-keyword">break</span><br>                <span class="hljs-keyword">else</span>:<br>                    request.websocket.send(message)<br>        <span class="hljs-keyword">finally</span>:<br>            <span class="hljs-comment"># é‡Šæ”¾é”</span><br>            lock.release()<br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">send</span>(<span class="hljs-params">out_trade_no, msg</span>):</span><br>    <span class="hljs-string">&quot;&quot;&quot;æœåŠ¡ç«¯å‘é€æ¶ˆæ¯&quot;&quot;&quot;</span><br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-keyword">if</span> clients[out_trade_no]:<br>            clients[out_trade_no].send(msg.encode(<span class="hljs-string">&#x27;utf-8&#x27;</span>))<br>            <span class="hljs-comment"># æ”¯ä»˜ç»“æœå‘é€ç»™å‰ç«¯é¡µé¢åï¼Œè¯¥è¿æ¥ä½¿å‘½å°±å®Œæˆäº†ï¼Œå‰ç«¯é¡µé¢ä¼šå…³é—­è¯¥é“¾æ¥ï¼Œè¿™é‡Œéœ€è¦å½“å‰è¿æ¥çš„è®°å½•</span><br>            <span class="hljs-keyword">del</span> clients[out_trade_no]<br>    <span class="hljs-keyword">except</span> BaseException:<br>        print(<span class="hljs-string">&#x27;å‘é€æ¶ˆæ¯å‡ºé”™äº†...&#x27;</span>)<br></code></pre></div></td></tr></table></figure><h2 id="Utils-å·¥å…·åŒ…"><a href="#Utils-å·¥å…·åŒ…" class="headerlink" title="Utils å·¥å…·åŒ…"></a><font color=" DeepSkyBlue ">Utils å·¥å…·åŒ…</font></h2><p><font color="  LimeGreen ">ä¸Šè¿°çš„è§†å›¾,å†…éƒ¨æ‰€éœ€çš„å‡½æ•° è‡ªå®šä¹‰å·¥å…·åŒ…</font></p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">from</span> random <span class="hljs-keyword">import</span> Random<br><span class="hljs-keyword">import</span> time<br><span class="hljs-keyword">import</span> hashlib<br><span class="hljs-keyword">from</span> bs4 <span class="hljs-keyword">import</span> BeautifulSoup<br><span class="hljs-keyword">from</span> pay.pay_setting <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> qrcode<br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">random_str</span>(<span class="hljs-params">randomlength=<span class="hljs-number">8</span></span>):</span><br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    ç”Ÿæˆéšæœºå­—ç¬¦ä¸²</span><br><span class="hljs-string">    :param randomlength: å­—ç¬¦ä¸²é•¿åº¦</span><br><span class="hljs-string">    :return:</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-built_in">str</span> = <span class="hljs-string">&#x27;&#x27;</span><br>    chars = <span class="hljs-string">&#x27;AaBbCcDdEeFfGgHhIiJjKkLlMmNnOoPpQqRrSsTtUuVvWwXxYyZz0123456789&#x27;</span><br>    length = <span class="hljs-built_in">len</span>(chars) - <span class="hljs-number">1</span><br>    random = Random()<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(randomlength):<br>        <span class="hljs-built_in">str</span> += chars[random.randint(<span class="hljs-number">0</span>, length)]<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">str</span><br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">create_orderId</span>(<span class="hljs-params">length</span>):</span><br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    ç”Ÿæˆæ‰«ç è®¢å•å·</span><br><span class="hljs-string">    :param length: è‡ªå®šä¹‰é•¿åº¦</span><br><span class="hljs-string">    :return:</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    local_time = time.strftime(<span class="hljs-string">&#x27;%Y%m%d%H%M%S&#x27;</span>, time.localtime(time.time()))<br>    out_trade_no = random_str(length) + local_time<br>    <span class="hljs-keyword">return</span> out_trade_no<br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_sign</span>(<span class="hljs-params">data_dict, key</span>):</span><br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    ç­¾åå‡½æ•°</span><br><span class="hljs-string">    :param data_dict: éœ€è¦ç­¾åçš„å‚æ•°ï¼Œæ ¼å¼ä¸ºå­—å…¸</span><br><span class="hljs-string">    :param key: å¯†é’¥ ï¼Œå³ä¸Šé¢çš„API_KEY</span><br><span class="hljs-string">    :return: å­—ç¬¦ä¸²</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    params_list = <span class="hljs-built_in">sorted</span>(data_dict.items(), key=<span class="hljs-keyword">lambda</span> e: e[<span class="hljs-number">0</span>], reverse=<span class="hljs-literal">False</span>)  <span class="hljs-comment"># å‚æ•°å­—å…¸å€’æ’åºä¸ºåˆ—è¡¨</span><br>    params_str = <span class="hljs-string">&quot;&amp;&quot;</span>.join(<span class="hljs-string">u&quot;&#123;&#125;=&#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(k, v) <span class="hljs-keyword">for</span> k, v <span class="hljs-keyword">in</span> params_list) + <span class="hljs-string">&#x27;&amp;key=&#x27;</span> + key<br>    <span class="hljs-comment"># ç»„ç»‡å‚æ•°å­—ç¬¦ä¸²å¹¶åœ¨æœ«å°¾æ·»åŠ å•†æˆ·äº¤æ˜“å¯†é’¥</span><br>    md5 = hashlib.md5()  <span class="hljs-comment"># ä½¿ç”¨MD5åŠ å¯†æ¨¡å¼</span><br>    md5.update(params_str.encode(<span class="hljs-string">&#x27;utf-8&#x27;</span>))  <span class="hljs-comment"># å°†å‚æ•°å­—ç¬¦ä¸²ä¼ å…¥</span><br>    sign = md5.hexdigest().upper()  <span class="hljs-comment"># å®ŒæˆåŠ å¯†å¹¶è½¬ä¸ºå¤§å†™</span><br>    <span class="hljs-keyword">return</span> sign<br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">trans_dict_to_xml</span>(<span class="hljs-params">data_dict</span>):</span><br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    å®šä¹‰å­—å…¸è½¬XMLçš„å‡½æ•°</span><br><span class="hljs-string">    :param data_dict:</span><br><span class="hljs-string">    :return:</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    data_xml = []<br>    <span class="hljs-keyword">for</span> k <span class="hljs-keyword">in</span> <span class="hljs-built_in">sorted</span>(data_dict.keys()):  <span class="hljs-comment"># éå†å­—å…¸æ’åºåçš„key</span><br>        v = data_dict.get(k)  <span class="hljs-comment"># å–å‡ºå­—å…¸ä¸­keyå¯¹åº”çš„value</span><br>        <span class="hljs-keyword">if</span> k == <span class="hljs-string">&#x27;detail&#x27;</span> <span class="hljs-keyword">and</span> <span class="hljs-keyword">not</span> v.startswith(<span class="hljs-string">&#x27;&lt;![CDATA[&#x27;</span>):  <span class="hljs-comment"># æ·»åŠ XMLæ ‡è®°</span><br>            v = <span class="hljs-string">&#x27;&lt;![CDATA[&#123;&#125;]]&gt;&#x27;</span>.<span class="hljs-built_in">format</span>(v)<br>        data_xml.append(<span class="hljs-string">&#x27;&lt;&#123;key&#125;&gt;&#123;value&#125;&lt;/&#123;key&#125;&gt;&#x27;</span>.<span class="hljs-built_in">format</span>(key=k, value=v))<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&lt;xml&gt;&#123;&#125;&lt;/xml&gt;&#x27;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-string">&#x27;&#x27;</span>.join(data_xml))  <span class="hljs-comment"># è¿”å›XML</span><br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">trans_xml_to_dict</span>(<span class="hljs-params">data_xml</span>):</span><br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    å®šä¹‰XMLè½¬å­—å…¸çš„å‡½æ•°</span><br><span class="hljs-string">    :param data_xml:</span><br><span class="hljs-string">    :return:</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    soup = BeautifulSoup(data_xml, features=<span class="hljs-string">&#x27;xml&#x27;</span>)<br>    xml = soup.find(<span class="hljs-string">&#x27;xml&#x27;</span>)  <span class="hljs-comment"># è§£æXML</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> xml:<br>        <span class="hljs-keyword">return</span> &#123;&#125;<br>    data_dict = <span class="hljs-built_in">dict</span>([(item.name, item.text) <span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> xml.find_all()])<br>    <span class="hljs-keyword">return</span> data_dict<br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">wxpay</span>(<span class="hljs-params">body, total_fee, out_trade_no</span>):</span><br>    <span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">    å‘å¾®ä¿¡å‘å‡ºè¯·æ±‚ï¼Œå¹¶è·å–è¿”å›çš„xmlï¼Œå°†è¯¥xmlè½¬ä¸ºå­—å…¸</span><br><span class="hljs-string">    :return:</span><br><span class="hljs-string">    &#x27;&#x27;&#x27;</span><br>    <span class="hljs-comment"># random_strè‡ªå®šä¹‰çš„å‡½æ•°</span><br>    nonce_str = random_str(<span class="hljs-number">20</span>)  <span class="hljs-comment"># æ‹¼æ¥å‡ºéšæœºçš„å­—ç¬¦ä¸²å³å¯ï¼Œæˆ‘è¿™é‡Œæ˜¯ç”¨  æ—¶é—´+éšæœºæ•°å­—+5ä¸ªéšæœºå­—æ¯</span><br>    params = &#123;<br>        <span class="hljs-string">&#x27;appid&#x27;</span>: APP_ID,  <span class="hljs-comment"># APPID</span><br>        <span class="hljs-string">&#x27;mch_id&#x27;</span>: MCH_ID,  <span class="hljs-comment"># å•†æˆ·å·</span><br>        <span class="hljs-string">&#x27;nonce_str&#x27;</span>: nonce_str,  <span class="hljs-comment"># éšæœºå­—ç¬¦ä¸²</span><br>        <span class="hljs-string">&#x27;out_trade_no&#x27;</span>: out_trade_no,  <span class="hljs-comment"># è®¢å•ç¼–å·ï¼Œå¯è‡ªå®šä¹‰</span><br>        <span class="hljs-string">&#x27;total_fee&#x27;</span>: total_fee,  <span class="hljs-comment"># è®¢å•æ€»é‡‘é¢</span><br>        <span class="hljs-string">&#x27;spbill_create_ip&#x27;</span>: CREATE_IP,  <span class="hljs-comment"># è‡ªå·±æœåŠ¡å™¨çš„IPåœ°å€</span><br>        <span class="hljs-string">&#x27;notify_url&#x27;</span>: NOTIFY_URL,  <span class="hljs-comment"># å›è°ƒåœ°å€ï¼Œå¾®ä¿¡æ”¯ä»˜æˆåŠŸåä¼šå›è°ƒè¿™ä¸ªurlï¼Œå‘ŠçŸ¥å•†æˆ·æ”¯ä»˜ç»“æœ</span><br>        <span class="hljs-string">&#x27;body&#x27;</span>: body,  <span class="hljs-comment"># å•†å“æè¿°</span><br>        <span class="hljs-string">&#x27;trade_type&#x27;</span>: <span class="hljs-string">&#x27;NATIVE&#x27;</span>,  <span class="hljs-comment"># æ‰«ç æ”¯ä»˜ç±»å‹</span><br>    &#125;<br>    sign = get_sign(params, API_KEY)  <span class="hljs-comment"># è·å–ç­¾å</span><br>    params[<span class="hljs-string">&#x27;sign&#x27;</span>] = sign  <span class="hljs-comment"># æ·»åŠ ç­¾ååˆ°å‚æ•°å­—å…¸</span><br>    xml = trans_dict_to_xml(params)  <span class="hljs-comment"># è½¬æ¢å­—å…¸ä¸ºXML</span><br>    <span class="hljs-comment"># ä»¥POSTæ–¹å¼å‘å¾®ä¿¡å…¬ä¼—å¹³å°æœåŠ¡å™¨å‘èµ·è¯·æ±‚</span><br>    response = requests.request(<span class="hljs-string">&#x27;post&#x27;</span>, <span class="hljs-string">&#x27;https://api.mch.weixin.qq.com/pay/unifiedorder&#x27;</span>, data=xml)<br>    data_dict = trans_xml_to_dict(response.content)  <span class="hljs-comment"># å°†è¯·æ±‚è¿”å›çš„æ•°æ®è½¬ä¸ºå­—å…¸</span><br>    <span class="hljs-keyword">return</span> data_dict<br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_code_url</span>(<span class="hljs-params">data_dict</span>):</span><br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    ä»å¾®ä¿¡è¿”å›çš„æ•°æ®ä¸­æå–å‡ºäºŒç»´ç å­—ç¬¦ä¸²</span><br><span class="hljs-string">    :param data_dict: å­—å…¸æ•°æ®</span><br><span class="hljs-string">    :return: äºŒç»´ç é“¾æ¥</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    code_url = data_dict.get(<span class="hljs-string">&#x27;code_url&#x27;</span>)<br>    <span class="hljs-keyword">return</span> code_url<br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">create_image</span>(<span class="hljs-params">code_url</span>):</span><br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    å°†ä¼ è¿›æ¥çš„äºŒç»´ç é“¾æ¥è½¬æ¢ä¸ºäºŒç»´ç å›¾ç‰‡</span><br><span class="hljs-string">    :param code_url: äºŒç»´ç é“¾æ¥</span><br><span class="hljs-string">    :return: äºŒç»´ç å›¾ç‰‡</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    img = qrcode.make(code_url)<br>    <span class="hljs-keyword">return</span> img<br><br></code></pre></div></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>WeChat</category>
      
    </categories>
    
    
    <tags>
      
      <tag>WeChat Pay</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å¾®ä¿¡æ”¯ä»˜-å‰ç«¯HTML</title>
    <link href="/2021/03/25/%E5%BE%AE%E4%BF%A1%E6%94%AF%E4%BB%98-2/"/>
    <url>/2021/03/25/%E5%BE%AE%E4%BF%A1%E6%94%AF%E4%BB%98-2/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h2 id="WeChatPayâ˜Ÿ"><a href="#WeChatPayâ˜Ÿ" class="headerlink" title=" WeChatPayâ˜Ÿ"></a><font color=" DeepSkyBlue "> WeChatPayâ˜Ÿ</font></h2><p><strong><code>å‰æƒ…æè¦</code> <a href="#">â˜Ÿ</a></strong></p><figure class="highlight"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs nginx">æœ¬ç« ä½¿ç”¨: Python3.6 django MySQL<br>é¡¹ç›®ä½¿ç”¨å¾®ä¿¡æ”¯ä»˜ è´­ä¹°ä¼šå‘˜ django+pcç«¯<br></code></pre></div></td></tr></table></figure><h2 id="ä½¿ç”¨djangoåˆ›å»ºé¡¹ç›®"><a href="#ä½¿ç”¨djangoåˆ›å»ºé¡¹ç›®" class="headerlink" title="ä½¿ç”¨djangoåˆ›å»ºé¡¹ç›®"></a><font color=" DeepSkyBlue ">ä½¿ç”¨djangoåˆ›å»ºé¡¹ç›®</font></h2><p><strong>Django å®‰è£…</strong></p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">pip install django==<span class="hljs-number">1.11</span><span class="hljs-number">.11</span><br></code></pre></div></td></tr></table></figure><p><strong>Django åˆ›å»ºé¡¹ç›®</strong></p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">django-admin startproject WeChatPay<br></code></pre></div></td></tr></table></figure><p><strong>Django åˆ›å»ºå¥½é¡¹ç›®å æ–°å»ºä¸€ä¸ªå­åº”ç”¨</strong></p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">python manage.py startapp pay<br></code></pre></div></td></tr></table></figure><p><strong>é¡¹ç›®ç›®å½•ç»“æ„</strong></p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">â”œâ”€â”€ WeChatPay<br>â”‚â”œâ”€â”€ pay        <span class="hljs-comment"># å­åº”ç”¨(åŒ…)</span><br>â”‚â”‚â”œâ”€â”€ __init__.py<br>â”‚â”‚â”œâ”€â”€ models.py  <span class="hljs-comment"># æ¨¡å‹ç±»</span><br>â”‚â”‚â”œâ”€â”€ test.py<br>â”‚â”‚â”œâ”€â”€ views.py <span class="hljs-comment"># è§†å›¾å‡½æ•°</span><br>â”‚â”œâ”€â”€ templates  <span class="hljs-comment"># æ¨¡æ¿æ–‡ä»¶çš„æ–‡ä»¶å¤¹ html</span><br>â”‚â”œâ”€â”€ static     <span class="hljs-comment"># é™æ€èµ„æºæ–‡ä»¶å¤¹ ä¾‹å¦‚js cssç­‰</span><br>â”‚â”œâ”€â”€ WeChatPay  <span class="hljs-comment"># è·Ÿé¡¹ç›®åŒåçš„æ–‡ä»¶å¤¹</span><br>â”‚â”‚   â”œâ”€â”€ __init__.py<br>â”‚â”‚   â”œâ”€â”€ settings <span class="hljs-comment"># é…ç½®æ–‡ä»¶çš„ä½ç½®</span><br>â”‚â”‚   â”œâ”€â”€ urls.py  <span class="hljs-comment"># å…¨å±€è·¯ç”±</span><br>â”‚â”‚   â””â”€â”€ wsgi.py<br>â”‚â”œâ”€â”€ manage.py<br></code></pre></div></td></tr></table></figure><p><strong>åœ¨è·Ÿé¡¹ç›®åŒåä¸‹çš„ settings.pyæ–‡ä»¶é‡Œé¢ é…ç½®å­åº”ç”¨</strong></p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">INSTALLED_APPS = [<br>    <span class="hljs-string">&#x27;...&#x27;</span>,<br>    <span class="hljs-string">&#x27;pay&#x27;</span>,  <span class="hljs-comment"># å¾®ä¿¡æ”¯ä»˜</span><br>    <span class="hljs-string">&#x27;...&#x27;</span><br>]<br><br>MIDDLEWARE = [<br>    <span class="hljs-string">&#x27;django.middleware.security.SecurityMiddleware&#x27;</span>,<br>    <span class="hljs-string">&#x27;django.contrib.sessions.middleware.SessionMiddleware&#x27;</span>,<br>    <span class="hljs-string">&#x27;django.middleware.common.CommonMiddleware&#x27;</span>,<br>    <span class="hljs-comment">#&#x27;django.middleware.csrf.CsrfViewMiddleware&#x27;,</span><br>    <span class="hljs-string">&#x27;django.contrib.auth.middleware.AuthenticationMiddleware&#x27;</span>,<br>    <span class="hljs-string">&#x27;django.contrib.messages.middleware.MessageMiddleware&#x27;</span>,<br>    <span class="hljs-string">&#x27;django.middleware.clickjacking.XFrameOptionsMiddleware&#x27;</span>,<br>]<br><br><span class="hljs-comment"># é…ç½®é™æ€èµ„æºçš„è¯·æ±‚</span><br>STATIC_URL = <span class="hljs-string">&#x27;/static/&#x27;</span><br>STATICFILES_DIRS = (<br>    os.path.join(os.path.join(BASE_DIR, <span class="hljs-string">&#x27;static&#x27;</span>)),<br>)<br></code></pre></div></td></tr></table></figure><h2 id="é…ç½®å‰ç«¯æ–‡ä»¶"><a href="#é…ç½®å‰ç«¯æ–‡ä»¶" class="headerlink" title="é…ç½®å‰ç«¯æ–‡ä»¶"></a><font color=" DeepSkyBlue ">é…ç½®å‰ç«¯æ–‡ä»¶</font></h2><p><strong>åœ¨templatesé‡Œé¢æ–°å»ºindex.html</strong></p><figure class="highlight"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">&lt;!DOCTYPE html&gt;<br>&lt;html&gt;<br>&lt;head&gt;<br>    &lt;meta charset=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;<br>    &lt;title&gt;å¾®ä¿¡æ”¯ä»˜&lt;/title&gt;<br>    &lt;style&gt;<br><br>        .main_div&#123;<br>            width: 320px;<br>            height: 150px;<br>            text-align: center;<br>            margin:<span class="hljs-number">0</span> auto;<br>            margin-top: 100px;<br>            border: aquamarine 2px solid;<br>            border-radius: 5px;<br>        &#125;<br>    &lt;/style&gt;<br>&lt;/head&gt;<br>&lt;body&gt;<br><br>    &lt;div class=&quot;main_div&quot;&gt;<br>        &lt;br&gt;<br>        &lt;h1&gt;è¿›è¡Œå¾®ä¿¡æ”¯ä»˜æµ‹è¯•ï¼Ÿ&lt;/h1&gt;<br>        &lt;a href=&quot;pay&quot;&gt;ç¡®å®š&lt;/a&gt;<br>    &lt;/div&gt;<br><br>&lt;/body&gt;<br>&lt;/html&gt;<br></code></pre></div></td></tr></table></figure><p><strong>åœ¨templatesé‡Œé¢æ–°å»ºqrcode.html</strong></p><figure class="highlight"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">&lt;!DOCTYPE html&gt;<br>&lt;html lang=<span class="hljs-string">&quot;zh-CN&quot;</span>&gt;<br><br>&lt;head&gt;<br>    &lt;meta charset=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;<br>    &lt;title&gt;æ‰«ç æ”¯ä»˜&lt;/title&gt;<br>&lt;/head&gt;<br>&lt;style&gt;<br>    .box &#123;<br>        position: absolute;<br>        left: <span class="hljs-number">50</span>%;<br>        top: <span class="hljs-number">10</span>%;<br>        transform: translate(-<span class="hljs-number">50</span>%);<br>        text-align: center;<br>    &#125;<br>    .conten &#123;<br>        width: <span class="hljs-number">100</span>%;<br>    &#125;<br>    body &#123;<br>        background: <span class="hljs-comment">#ccc;</span><br>    &#125;<br>&lt;/style&gt;<br>&lt;body&gt;<br>    &#123;% load staticfiles %&#125;<br>    &lt;div class=&quot;box&quot;&gt;<br>        &lt;h2 class=&quot;content&quot;&gt;&lt;span&gt;æ‰«ç æ”¯ä»˜&lt;/span&gt;&lt;/h2&gt;<br>        &lt;h5&gt;è®¢å•å·ï¼š&lt;span id=&quot;out_trade_no&quot;&gt;&#123;&#123; out_trade_no &#125;&#125;&lt;/span&gt;&lt;/h5&gt;<br>        &lt;!--&lt;h2&gt;æ‰«ç æ”¯ä»˜&lt;/h2&gt;--&gt;<br>        &lt;img src=&quot;&#123;% static qrcode_name %&#125;&quot;/&gt;&lt;!--æ˜¾ç¤ºæ”¯ä»˜äºŒç»´ç --&gt;<br>        &lt;br&gt;<br>        &lt;span id=&quot;message&quot;&gt;&lt;/span&gt;<br>    &lt;/div&gt;<br><br>&lt;/body&gt;<br><br>&lt;script <span class="hljs-built_in">type</span>=<span class="hljs-string">&quot;text/javascript&quot;</span>&gt;<br>var websocket = null;//websocket çš„å˜é‡<br>function load() &#123;//åˆå§‹åŒ– websocket<br>//è·å–è®¢å•å·<br>var out_trade_no = <span class="hljs-string">&quot;&#123;&#123; out_trade_no &#125;&#125;&quot;</span>;<br>//å»ºç«‹è¿æ¥<br><span class="hljs-keyword">if</span> (<span class="hljs-string">&#x27;WebSocket&#x27;</span> <span class="hljs-keyword">in</span> window) &#123;//æ”¯æŒ websocket<br>            // æ­¤å¤„ä¸ºè·å–æ”¯ä»˜æ˜¯å¦æˆåŠŸ<br>websocket = new WebSocket(<span class="hljs-string">&quot;ws://localhost:80/websocketLink/&quot;</span> + out_trade_no);<br>websocket.onopen = function() &#123;<br>fillData(<span class="hljs-string">&quot;è¯·åœ¨ä¸¤å°æ—¶å†…å®Œæˆæ”¯ä»˜&quot;</span>)<br>&#125;<br>websocket.onclose = function() &#123;<br>fillData(<span class="hljs-string">&quot;è¿æ¥å…³é—­äº†&quot;</span>)<br>&#125;<br>websocket.onerror = function() &#123;<br>fillData(<span class="hljs-string">&quot;å‡ºç°é”™è¯¯äº†&quot;</span>)<br>&#125;<br>websocket.onmessage = function(event) &#123;<br>fillData(event.data);<br>alert(<span class="hljs-string">&quot;æ”¯ä»˜æˆåŠŸï¼ï¼ï¼&quot;</span>);<br><span class="hljs-keyword">if</span> (window.s) &#123;<br>                    window.s.close();//å…³é—­websocket<br>                    console.log(<span class="hljs-string">&#x27;websocketå·²å…³é—­&#x27;</span>);<br>                &#125;<br>&#125;<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>alert(<span class="hljs-string">&quot;æµè§ˆå™¨ä¸æ”¯æŒ websocket&quot;</span>)<br>&#125;<br>//è®¾ç½®ç›‘å¬,å½“æœ‰æ¶ˆæ¯æ¥çš„æ—¶å€™çš„ç›‘å¬<br>&#125;<br>function fillData(data) &#123;<br>document.getElementById(<span class="hljs-string">&quot;message&quot;</span>).innerHTML = data;<br>&#125;<br>window.onload=load();//é¡µé¢åŠ è½½å®Œæˆåæ‰§è¡Œ load æ–¹æ³•<br>&lt;/script&gt;<br>&lt;/html&gt;<br></code></pre></div></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>WeChat</category>
      
    </categories>
    
    
    <tags>
      
      <tag>WeChat Pay</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å¾®ä¿¡æ”¯ä»˜è·å–å¼€å‘è€…id å¯†é’¥</title>
    <link href="/2021/03/25/%E5%BE%AE%E4%BF%A1%E6%94%AF%E4%BB%98-1/"/>
    <url>/2021/03/25/%E5%BE%AE%E4%BF%A1%E6%94%AF%E4%BB%98-1/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h2 id="WeChatPay"><a href="#WeChatPay" class="headerlink" title=" WeChatPay"></a><font color=" DeepSkyBlue "> WeChatPay</font></h2><p><font color="  LimeGreen ">TIP: å¾®ä¿¡æ”¯ä»˜æ‰€éœ€ æ¥å£</font></p><h2 id="å¾®ä¿¡å…¬ä¼—å·å¹³å°"><a href="#å¾®ä¿¡å…¬ä¼—å·å¹³å°" class="headerlink" title="å¾®ä¿¡å…¬ä¼—å·å¹³å°"></a><font color=" DeepSkyBlue ">å¾®ä¿¡å…¬ä¼—å·å¹³å°</font></h2><p><font color="  LimeGreen "><a href="https://mp.weixin.qq.com/cgi-bin/loginpage">ç‚¹å‡»è·³è½¬</a></font></p><p><img src="https://external-30160.picsz.qpic.cn/bd4cb6e93c877366ff14e87d6054c18d" alt="å¾®ä¿¡å…¬ä¼—å·é“¾æ¥"></p><p>é¦–å…ˆåœ¨å³ä¸Šè§’é‚£é‡Œ äº¤300è®¤è¯ä¸€ä¸‹â€“&gt;è®¤è¯å®Œæˆåâ€“&gt;åœ¨å·¦è¾¹åŸºæœ¬é…ç½®é‚£é‡Œ</p><figure class="highlight"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs json">å…¬ä¼—å·å¼€å‘ä¿¡æ¯<br>å¼€å‘è€…ID(AppID) wxxxxxxx58<br><br>å¼€å‘è€…IDæ˜¯å…¬ä¼—å·å¼€å‘è¯†åˆ«ç ï¼Œé…åˆå¼€å‘è€…å¯†ç å¯è°ƒç”¨å…¬ä¼—å·çš„æ¥å£èƒ½åŠ›ã€‚<br><br>å¼€å‘è€…å¯†ç (AppSecret)é‡ç½® <br>å¼€å‘è€…å¯†ç æ˜¯æ ¡éªŒå…¬ä¼—å·å¼€å‘è€…èº«ä»½çš„å¯†ç ï¼Œå…·æœ‰æé«˜çš„å®‰å…¨æ€§ã€‚åˆ‡è®°å‹¿æŠŠå¯†ç ç›´æ¥äº¤ç»™ç¬¬ä¸‰æ–¹å¼€å‘è€…æˆ–ç›´æ¥å­˜å‚¨åœ¨ä»£ç ä¸­ã€‚å¦‚éœ€ç¬¬ä¸‰æ–¹ä»£å¼€å‘å…¬ä¼—å·ï¼Œè¯·ä½¿ç”¨æˆæƒæ–¹å¼æ¥å…¥ã€‚<br><br>IPç™½åå•æŸ¥çœ‹<br>é€šè¿‡å¼€å‘è€…IDåŠå¯†ç è°ƒç”¨è·å–access_tokenæ¥å£æ—¶ï¼Œéœ€è¦è®¾ç½®è®¿é—®æ¥æºIPä¸ºç™½åå•ã€‚äº†è§£æ›´å¤šã€‚<br></code></pre></div></td></tr></table></figure><p><font color="  LimeGreen ">TIP: è·å–å¼€å‘è€…ID(AppID)</font></p><p><font color="  LimeGreen ">TIP: è·å–å¼€å‘è€…å¯†ç (AppSecret)</font></p><p><font color="  LimeGreen ">TIP: è®¾ç½®IPç™½åå• æ³¨æ„æˆ‘ä»¬æ˜¯éœ€è¦access_tokençš„ å¤šçœ‹çœ‹ä»‹ç»</font></p><h2 id="å¾®ä¿¡å•†æˆ·å¹³å°"><a href="#å¾®ä¿¡å•†æˆ·å¹³å°" class="headerlink" title="å¾®ä¿¡å•†æˆ·å¹³å°"></a><font color=" DeepSkyBlue ">å¾®ä¿¡å•†æˆ·å¹³å°</font></h2><p><font color="  LimeGreen "><a href="https://pay.weixin.qq.com/index.php/core/home/login?return_url=/">ç‚¹å‡»è·³è½¬</a></font></p><p><img src="https://external-30160.picsz.qpic.cn/a8db422486a3587709896a5b9a52c7d4" alt="å¾®ä¿¡æ”¯ä»˜å¹³å°"></p><p>å•†æˆ·å·: 16xxxxxx</p><figure class="highlight"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs json">ä¸ªäººä¿¡æ¯<br>è´¦å·ä¿¡æ¯<br>ç™»å½•è´¦å·:    æ³¨æ„è¿™å°±æ˜¯ä½ çš„å•†æˆ·å·<br><br>è´¦å·è§’è‰²:    è¶…çº§ç®¡ç†å‘˜<br>åˆ›å»ºæ—¶é—´:    2020å¹´8æœˆ5æ—¥ 17:23:43<br>ç»‘å®šå¾®ä¿¡å·:  f**********25æ›´æ¢ç»‘å®š<br>åŸºæœ¬ä¿¡æ¯ä¿®æ”¹<br>å§“      å:  xxx<br>è”ç³»æ‰‹æœº:     188**********<br>è”ç³»é‚®ç®±:     19*******@qq.com<br><br>å®‰å…¨ä¿¡æ¯<br>æ“ä½œå¯†ç :     ä¿®æ”¹<br>é¢„ç•™ä¿¡æ¯:     æœªè®¾ç½®ä¿®æ”¹<br>é¢„ç•™ä¿¡æ¯æ˜¯ç”±ä½ è‡ªå·±è®¾ç½®çš„ä¸€æ®µæ–‡å­—ï¼Œç”¨æ¥é‰´å®šç½‘ç«™èº«ä»½ï¼Œé˜²æ­¢å‡å†’ç½‘ç«™é€ æˆæŸå¤±ã€‚<br><br>é…ç½®åå°†åœ¨é¦–é¡µåŠå……å€¼é¡µé¢æ˜¾ç¤ºã€‚è‹¥æœªçœ‹åˆ°é¢„ç•™ä¿¡æ¯ï¼Œè¡¨æ˜å½“å‰è®¿é—®çš„ç½‘ç«™å­˜åœ¨é£é™©ï¼Œè¯·ç»ˆæ­¢æ“ä½œï¼Œå¹¶ä¿®æ”¹å¯†ç ã€‚<br><br>æœªå®‰è£…æ“ä½œè¯ä¹¦æ—¶é¢„ç•™ä¿¡æ¯å°†è¢«éƒ¨åˆ†æ©ç ã€‚<br></code></pre></div></td></tr></table></figure><p><font color="  LimeGreen ">åŸºæœ¬éƒ½æ˜¯ä¸€äº›é…ç½® ä¾‹å¦‚:åœ¨APIå®‰å…¨é‡Œé¢é…ç½®å¯†é’¥é‚£äº›</font></p><p><img src="https://external-30160.picsz.qpic.cn/6dc041cfda52a130cf4708ec6874fc74" alt="APIå®‰å…¨é…ç½®å¯†é’¥"></p><p><font color="  LimeGreen ">ç„¶ååœ¨äº§å“ä¸­å¿ƒ è·å–ä½ æ‰€éœ€è¦çš„äº§å“</font></p><p><img src="https://external-30160.picsz.qpic.cn/837b4a928d0af1243603eb249342a58c"></p><p><font color="  LimeGreen ">ä¸Šè¿°çº¢æ¡† éƒ½æ˜¯ä¸€äº›å¾®ä¿¡æ”¯ä»˜çš„æ¥å£ ä»”ç»†çœ‹ä¸€ä¸‹å†…éƒ¨çš„æ–‡æ¡£</font></p><p><font color="  LimeGreen ">æœ€åå°±æ˜¯ å¦‚æœè‡ªå·±å°±æ˜¯è¶…çº§ç®¡ç†å‘˜(ç”³è¯·è´¦å·çš„äººçš„å¾®ä¿¡ æ‰«ç ç™»å½•)</font></p><p><img src="https://external-30160.picsz.qpic.cn/e75176c01f2c104dc41a185be966a28f"></p><p><font color="  LimeGreen ">ä¸Šè¿°å°±æ˜¯ é…ç½®æ”¯ä»˜çš„å…³è” å¾®ä¿¡çš„æŒ‡å¼•å·²ç»å†™çš„å¾ˆæ˜ç™½äº†</font></p>]]></content>
    
    
    <categories>
      
      <category>WeChat</category>
      
    </categories>
    
    
    <tags>
      
      <tag>WeChat Pay</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å¾®ä¿¡ç™»å½•-æ‰«ç ç»‘å®šç”¨æˆ· äºŒ)</title>
    <link href="/2021/03/25/%E5%BE%AE%E4%BF%A1%E7%99%BB%E5%BD%95-3/"/>
    <url>/2021/03/25/%E5%BE%AE%E4%BF%A1%E7%99%BB%E5%BD%95-3/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h2 id="åœ¨å¾®ä¿¡æ‰«ç ç™»å½•çš„æ—¶å€™-é™å®šç»‘å®šæ‰‹æœºå·â˜Ÿ"><a href="#åœ¨å¾®ä¿¡æ‰«ç ç™»å½•çš„æ—¶å€™-é™å®šç»‘å®šæ‰‹æœºå·â˜Ÿ" class="headerlink" title="åœ¨å¾®ä¿¡æ‰«ç ç™»å½•çš„æ—¶å€™ é™å®šç»‘å®šæ‰‹æœºå·â˜Ÿ"></a><font color="#008080">åœ¨å¾®ä¿¡æ‰«ç ç™»å½•çš„æ—¶å€™ é™å®šç»‘å®šæ‰‹æœºå·â˜Ÿ</font></h2><p><strong><code>å‰æƒ…æè¦</code> <a href="#">â˜Ÿ</a></strong></p><figure class="highlight"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs json">ç”¨æˆ·ä½¿ç”¨æ‰‹æœºå·ç ç™»å½•å æ ¡éªŒæ˜¯å¦å·²ç»ç»‘å®šå¾®ä¿¡å·<br>å¾®ä¿¡æ‰«ç ç™»å½•çš„ç”¨æˆ· æ ¡éªŒæ˜¯å¦å·²ç»ç»‘å®šæ‰‹æœºå·ç <br>æœ¬ç« ä½¿ç”¨: python3.6 django MySQL<br>åœ¨å¾®ä¿¡æ‰«ç çš„ç™»é™†çš„æ—¶å€™ æ ¡éªŒæ²¡æœ‰ç»‘å®šæ‰‹æœºå·çš„è¯ å°±è·³è½¬ç»‘å®šæ‰‹æœºå·<br></code></pre></div></td></tr></table></figure><p><img src="https://p.pstatp.com/origin/138390002aa0dc5ee88b7" alt="æµç¨‹å›¾"></p><h2 id="æ ¡éªŒç¬¬ä¸€æ¬¡å¾®ä¿¡æ‰«ç â˜Ÿ"><a href="#æ ¡éªŒç¬¬ä¸€æ¬¡å¾®ä¿¡æ‰«ç â˜Ÿ" class="headerlink" title="æ ¡éªŒç¬¬ä¸€æ¬¡å¾®ä¿¡æ‰«ç â˜Ÿ"></a><font color="#008080">æ ¡éªŒç¬¬ä¸€æ¬¡å¾®ä¿¡æ‰«ç â˜Ÿ</font></h2><table><thead><tr><th>å‚æ•°</th><th>å€¼</th><th>å¤‡æ³¨</th><th>è¯·æ±‚æ–¹å¼</th></tr></thead><tbody><tr><td>å‚è€ƒè·¯ç”±</td><td><a href="http://127.0.0.1:8000/Wxbinduser/">http://127.0.0.1:8000/Wxbinduser/</a></td><td>æ ¡éªŒç¬¬ä¸€æ¬¡æ‰«ç å¾®ä¿¡</td><td>GET</td></tr><tr><td>code</td><td>071xnUkl2wUPo64to1ol2MhKFY1xnUkZ</td><td>ç”¨æˆ·æ‰«ç åçš„codeå€¼</td><td></td></tr><tr><td>state</td><td>STATE</td><td>é»˜è®¤å€¼</td><td></td></tr></tbody></table><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WeXinLogin</span>(<span class="hljs-params">APIView</span>):</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get</span>(<span class="hljs-params">self, request</span>):</span><br>        code = request.GET.get(<span class="hljs-string">&#x27;code&#x27;</span>)<br>        state = request.GET.get(<span class="hljs-string">&quot;state&quot;</span>)<br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-built_in">all</span>([code, state]):<br>            <span class="hljs-keyword">return</span> Response(&#123;<span class="hljs-string">&#x27;code&#x27;</span>: RET.DBERR, <span class="hljs-string">&#x27;message&#x27;</span>: <span class="hljs-string">&#x27;ç¼ºå°‘codeæ•°æ®&#x27;</span>&#125;)<br>        useropenid, usernickname, userheadimgurl, userunionid = get_wechat_user(code)<br>        <span class="hljs-keyword">try</span>:<br>            user = User.objects.get(useropenid=useropenid)<br>        <span class="hljs-keyword">except</span>:<br>            <span class="hljs-keyword">return</span> Response(&#123;<span class="hljs-string">&#x27;code&#x27;</span>: RET.USERERR, <span class="hljs-string">&#x27;message&#x27;</span>: <span class="hljs-string">&#x27;è¯·å…ˆæ³¨å†Œä¸€ä¸ªæ‰‹æœºå·&#x27;</span>&#125;)<br>        <span class="hljs-keyword">return</span> Response(&#123;<span class="hljs-string">&#x27;code&#x27;</span>: RET.OK, <span class="hljs-string">&#x27;token&#x27;</span>: user.jwt_token, <span class="hljs-string">&#x27;mobile&#x27;</span>: user.mobile&#125;)<br></code></pre></div></td></tr></table></figure><h2 id="æ ¡éªŒæ˜¯å¦å·²ç»ç»‘å®šè¿‡å¾®ä¿¡â˜Ÿ"><a href="#æ ¡éªŒæ˜¯å¦å·²ç»ç»‘å®šè¿‡å¾®ä¿¡â˜Ÿ" class="headerlink" title="æ ¡éªŒæ˜¯å¦å·²ç»ç»‘å®šè¿‡å¾®ä¿¡â˜Ÿ"></a><font color="#008080">æ ¡éªŒæ˜¯å¦å·²ç»ç»‘å®šè¿‡å¾®ä¿¡â˜Ÿ</font></h2><table><thead><tr><th>å‚æ•°</th><th>å€¼</th><th>å¤‡æ³¨</th><th>è¯·æ±‚æ–¹å¼</th></tr></thead><tbody><tr><td>å‚è€ƒè·¯ç”±</td><td><a href="http://127.0.0.1:8000/checkWx/">http://127.0.0.1:8000/checkWx/</a></td><td>æ ¡éªŒè¯¥æ‰‹æœºç”¨æˆ·æ˜¯å¦ç»‘å®šäº†å¾®ä¿¡</td><td>GET</td></tr></tbody></table><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WeXinBindView</span>(<span class="hljs-params">APIView</span>):</span><br>    <span class="hljs-string">&quot;&quot;&quot;æ ¡éªŒæ˜¯å¦å·²ç»ç»‘å®šè¿‡å¾®ä¿¡&quot;&quot;&quot;</span><br>    authentication_classes = [MyBaseAuthentication, ]<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get</span>(<span class="hljs-params">self, request</span>):</span><br>        user = is_master(request.user)<br>        <span class="hljs-keyword">if</span> user.useropenid <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:<br>            <span class="hljs-keyword">return</span> Response(&#123;<span class="hljs-string">&#x27;code&#x27;</span>: RET.DBERR, <span class="hljs-string">&#x27;message&#x27;</span>: <span class="hljs-string">&#x27;æ‚¨çš„è´¦å·å°šæœªç»‘å®šå¾®ä¿¡,è¯·å…ˆç»‘å®šå¾®ä¿¡&#x27;</span>&#125;)<br>        <span class="hljs-keyword">return</span> Response(&#123;<span class="hljs-string">&#x27;code&#x27;</span>: RET.OK&#125;)<br></code></pre></div></td></tr></table></figure><h2 id="æ ¡éªŒç¬¬äºŒæ¬¡å¾®ä¿¡æ‰«ç â˜Ÿ"><a href="#æ ¡éªŒç¬¬äºŒæ¬¡å¾®ä¿¡æ‰«ç â˜Ÿ" class="headerlink" title="æ ¡éªŒç¬¬äºŒæ¬¡å¾®ä¿¡æ‰«ç â˜Ÿ"></a><font color="#008080">æ ¡éªŒç¬¬äºŒæ¬¡å¾®ä¿¡æ‰«ç â˜Ÿ</font></h2><table><thead><tr><th>å‚æ•°</th><th>å€¼</th><th>å¤‡æ³¨</th><th>è¯·æ±‚æ–¹å¼</th></tr></thead><tbody><tr><td>å‚è€ƒè·¯ç”±</td><td><a href="http://127.0.0.1:8000/UW/">http://127.0.0.1:8000/UW/</a></td><td>ç”¨æˆ·ç™»å½•æˆåŠŸ/ç¬¬äºŒæ¬¡æ‰«ç -ç»‘å®šå¾®ä¿¡</td><td>GET</td></tr><tr><td>code</td><td>071xnUkl2wUPo64to1ol2MhKFY1xnUkZ</td><td>codeå€¼</td><td></td></tr><tr><td>state</td><td>STATE</td><td>é»˜è®¤å€¼</td><td></td></tr></tbody></table><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MobileBindWeChatView</span>(<span class="hljs-params">APIView</span>):</span><br>    <span class="hljs-string">&quot;&quot;&quot;æ‰‹æœºå·ç ç™»å½•æˆåŠŸ--ç»‘å®šå¾®ä¿¡å·&quot;&quot;&quot;</span><br>    authentication_classes = [MyBaseAuthentication, ]<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get</span>(<span class="hljs-params">self, request</span>):</span><br>        code = request.GET.get(<span class="hljs-string">&#x27;code&#x27;</span>)<br>        state = request.GET.get(<span class="hljs-string">&quot;state&quot;</span>)<br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-built_in">all</span>([code, state]):<br>            <span class="hljs-keyword">return</span> Response(&#123;<span class="hljs-string">&#x27;code&#x27;</span>: RET.DBERR, <span class="hljs-string">&#x27;message&#x27;</span>: <span class="hljs-string">&#x27;ç¼ºå°‘codeæ•°æ®&#x27;</span>&#125;)<br>        user = is_master(request.user)<br>        useropenid, usernickname, userheadimgurl, userunionid = get_wechat_user(code)<br>        user.useropenid = useropenid<br>        user.usernickname = usernickname<br>        user.userheadimgurl = userheadimgurl<br>        user.userunionid = userunionid<br>        user.state = state<br>        user.save()<br>        <span class="hljs-keyword">return</span> Response(&#123;<span class="hljs-string">&#x27;code&#x27;</span>: RET.OK, <span class="hljs-string">&#x27;token&#x27;</span>: user.jwt_token, <span class="hljs-string">&#x27;mobile&#x27;</span>: user.mobile&#125;)<br></code></pre></div></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>WeChat</category>
      
    </categories>
    
    
    <tags>
      
      <tag>WeChat Login</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å¾®ä¿¡ç™»å½•-æ‰«ç ç»‘å®šç”¨æˆ· ä¸€)</title>
    <link href="/2021/03/25/%E5%BE%AE%E4%BF%A1%E7%99%BB%E5%BD%95-2/"/>
    <url>/2021/03/25/%E5%BE%AE%E4%BF%A1%E7%99%BB%E5%BD%95-2/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h2 id="å¾®ä¿¡ç™»å½•ä¸ç»‘å®šç”¨æˆ·â˜Ÿ"><a href="#å¾®ä¿¡ç™»å½•ä¸ç»‘å®šç”¨æˆ·â˜Ÿ" class="headerlink" title="å¾®ä¿¡ç™»å½•ä¸ç»‘å®šç”¨æˆ·â˜Ÿ"></a><font color="#008080">å¾®ä¿¡ç™»å½•ä¸ç»‘å®šç”¨æˆ·â˜Ÿ</font></h2><p><strong><code>å‰æƒ…æè¦</code> <a href="#">â˜Ÿ</a></strong></p><figure class="highlight"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs json">ç”¨æˆ·ä½¿ç”¨æ‰‹æœºå·ç ç™»å½•å æ ¡éªŒæ˜¯å¦å·²ç»ç»‘å®šå¾®ä¿¡å·<br>å¾®ä¿¡æ‰«ç ç™»å½•çš„ç”¨æˆ· æ ¡éªŒæ˜¯å¦å·²ç»ç»‘å®šæ‰‹æœºå·ç <br>æœ¬ç« ä½¿ç”¨: python3.6 django MySQL<br>å¾®ä¿¡æ‰«ç ç™»é™† æ ¡éªŒæ˜¯å¦å·²ç»ç»‘å®šå¾®ä¿¡/æ‰‹æœºå·ç <br></code></pre></div></td></tr></table></figure><p><img src="https://p.pstatp.com/origin/137340002b9a1dcb33085" alt="æµç¨‹å›¾"></p><h2 id="æ ¡éªŒæ˜¯å¦å·²ç»ç»‘å®šè¿‡æ‰‹æœºå·ç -å¾®ä¿¡â˜Ÿ"><a href="#æ ¡éªŒæ˜¯å¦å·²ç»ç»‘å®šè¿‡æ‰‹æœºå·ç -å¾®ä¿¡â˜Ÿ" class="headerlink" title="æ ¡éªŒæ˜¯å¦å·²ç»ç»‘å®šè¿‡æ‰‹æœºå·ç /å¾®ä¿¡â˜Ÿ"></a><font color="#008080">æ ¡éªŒæ˜¯å¦å·²ç»ç»‘å®šè¿‡æ‰‹æœºå·ç /å¾®ä¿¡â˜Ÿ</font></h2><table><thead><tr><th>å‚æ•°</th><th>å€¼</th><th>å¤‡æ³¨</th><th>è¯·æ±‚æ–¹å¼</th></tr></thead><tbody><tr><td>å‚è€ƒè·¯ç”±</td><td><a href="http://127.0.0.1:8000/WxOrUser/">http://127.0.0.1:8000/WxOrUser/</a></td><td>æ ¡éªŒæ˜¯å¦å·²ç»ç»‘å®šè¿‡æ‰‹æœºå·ç æˆ–å¾®ä¿¡</td><td>GET</td></tr></tbody></table><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WeXinBindView</span>(<span class="hljs-params">APIView</span>):</span><br>    <span class="hljs-string">&quot;&quot;&quot;æ ¡éªŒæ˜¯å¦å·²ç»ç»‘å®šè¿‡å¾®ä¿¡--æ‰‹æœºå·&quot;&quot;&quot;</span><br>    authentication_classes = [MyBaseAuthentication, ]  <span class="hljs-comment"># jwt_tokenè®¤è¯ç”¨æˆ·</span><br>    <br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get</span>(<span class="hljs-params">self, request</span>):</span><br>        user = is_master(request.user)<br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> re.match(<span class="hljs-string">r&#x27;^1[3-9]\d&#123;9&#125;$&#x27;</span>, user.mobile):<br>            <span class="hljs-keyword">return</span> Response(&#123;<span class="hljs-string">&#x27;code&#x27;</span>: RET.DBERR, <span class="hljs-string">&#x27;message&#x27;</span>: <span class="hljs-string">&#x27;æ‚¨çš„è´¦å·å°šæœªç»‘å®šæ‰‹æœºå·,è¯·å…ˆç»‘å®šæ‰‹æœºå·&#x27;</span>&#125;)<br>        <span class="hljs-keyword">elif</span> user.useropenid <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:<br>            <span class="hljs-keyword">return</span> Response(&#123;<span class="hljs-string">&#x27;code&#x27;</span>: RET.DBERR, <span class="hljs-string">&#x27;message&#x27;</span>: <span class="hljs-string">&#x27;æ‚¨çš„è´¦å·å°šæœªç»‘å®šå¾®ä¿¡,è¯·å…ˆç»‘å®šå¾®ä¿¡&#x27;</span>&#125;)<br>        <span class="hljs-keyword">return</span> Response(&#123;<span class="hljs-string">&#x27;code&#x27;</span>: RET.OK&#125;)<br></code></pre></div></td></tr></table></figure><h2 id="å¾®ä¿¡ç™»å½•æˆåŠŸâ€“ç»‘å®šæ‰‹æœºå·ç â˜Ÿ"><a href="#å¾®ä¿¡ç™»å½•æˆåŠŸâ€“ç»‘å®šæ‰‹æœºå·ç â˜Ÿ" class="headerlink" title="å¾®ä¿¡ç™»å½•æˆåŠŸâ€“ç»‘å®šæ‰‹æœºå·ç â˜Ÿ"></a><font color="#008080">å¾®ä¿¡ç™»å½•æˆåŠŸâ€“ç»‘å®šæ‰‹æœºå·ç â˜Ÿ</font></h2><table><thead><tr><th>å‚æ•°</th><th>å€¼</th><th>å¤‡æ³¨</th><th>è¯·æ±‚æ–¹å¼</th></tr></thead><tbody><tr><td>å‚è€ƒè·¯ç”±</td><td><a href="http://127.0.0.1:8000/wx_mobile/">http://127.0.0.1:8000/wx_mobile/</a></td><td>å¾®ä¿¡ç™»å½•çš„ç”¨æˆ·-ç»‘å®šæ‰‹æœºå·ç </td><td>POST</td></tr><tr><td>mobile</td><td>13456789011</td><td>æ‰‹æœºå·ç </td><td></td></tr></tbody></table><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WeChatBindMobileView</span>(<span class="hljs-params">APIView</span>):</span><br>    <span class="hljs-string">&quot;&quot;&quot;å¾®ä¿¡ç™»å½•æˆåŠŸ--ç»‘å®šæ‰‹æœºå·ç &quot;&quot;&quot;</span><br>    authentication_classes = [MyBaseAuthentication, ]  <span class="hljs-comment"># jwt_tokenè®¤è¯ç”¨æˆ·</span><br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">post</span>(<span class="hljs-params">self, request</span>):</span><br>        user = is_master(request.user)<br>        mobile = request.POST.get(<span class="hljs-string">&#x27;mobile&#x27;</span>)<br>        password = request.POST.get(<span class="hljs-string">&#x27;password&#x27;</span>)  <span class="hljs-comment"># æ”¹å¯†ç å°†åœ¨ç”¨æˆ·æ‰‹æœºå·ç™»å½•çš„æ—¶å€™ä½¿ç”¨</span><br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-built_in">all</span>([mobile, password]):<br>            <span class="hljs-keyword">return</span> Response(&#123;<span class="hljs-string">&#x27;code&#x27;</span>: RET.PARAMERR, <span class="hljs-string">&#x27;message&#x27;</span>: <span class="hljs-string">&#x27;ç¼ºå°‘æ‰‹æœºå·æˆ–å¯†ç &#x27;</span>&#125;)<br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> re.match(<span class="hljs-string">r&#x27;^1[3-9]\d&#123;9&#125;$&#x27;</span>, mobile):<br>            <span class="hljs-keyword">return</span> Response(&#123;<span class="hljs-string">&#x27;code&#x27;</span>: RET.USERERR, <span class="hljs-string">&#x27;message&#x27;</span>: <span class="hljs-string">&#x27;è¯·è¾“å…¥æ­£ç¡®çš„æ‰‹æœºå·ç &#x27;</span>&#125;)<br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> re.match(<span class="hljs-string">r&#x27;^[0-9a-zA-Z]&#123;8,20&#125;$&#x27;</span>, password):<br>            <span class="hljs-keyword">return</span> Response(&#123;<span class="hljs-string">&#x27;code&#x27;</span>: RET.PWDERR, <span class="hljs-string">&#x27;message&#x27;</span>: <span class="hljs-string">&#x27;è¯·è¾“å…¥8-20ä½çš„æ•°å­—å­—æ¯å¯†ç &#x27;</span>&#125;)<br>        user.mobile = mobile<br>        user.password = make_password(password, <span class="hljs-string">&#x27;pbkdf2_sha256&#x27;</span>)<br>        user.save()<br>        <span class="hljs-keyword">return</span> Response(&#123;<span class="hljs-string">&#x27;code&#x27;</span>: RET.OK, <span class="hljs-string">&#x27;token&#x27;</span>: user.jwt_token, <span class="hljs-string">&#x27;mobile&#x27;</span>: mobile&#125;)<br></code></pre></div></td></tr></table></figure><h2 id="æ‰‹æœºå·ç™»å½•æˆåŠŸâ€“ç»‘å®šå¾®ä¿¡å·â˜Ÿ"><a href="#æ‰‹æœºå·ç™»å½•æˆåŠŸâ€“ç»‘å®šå¾®ä¿¡å·â˜Ÿ" class="headerlink" title="æ‰‹æœºå·ç™»å½•æˆåŠŸâ€“ç»‘å®šå¾®ä¿¡å·â˜Ÿ"></a><font color="#008080">æ‰‹æœºå·ç™»å½•æˆåŠŸâ€“ç»‘å®šå¾®ä¿¡å·â˜Ÿ</font></h2><table><thead><tr><th>å‚æ•°</th><th>å€¼</th><th>å¤‡æ³¨</th><th>è¯·æ±‚æ–¹å¼</th></tr></thead><tbody><tr><td>å‚è€ƒè·¯ç”±</td><td><a href="http://127.0.0.1:8000/mobile_wx/">http://127.0.0.1:8000/mobile_wx/</a></td><td>æ‰‹æœºå·ç™»å½•çš„ç”¨æˆ·â€“ç»‘å®šå¾®ä¿¡å·</td><td>GET</td></tr><tr><td>code</td><td>071xnUkl2wUPo64to1ol2MhKFY1xnUkZ</td><td>ç”¨æˆ·æ‰«ç åçš„codeå€¼</td><td></td></tr><tr><td>state</td><td>STATE</td><td>é»˜è®¤STATE</td><td></td></tr></tbody></table><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MobileBindWeChatView</span>(<span class="hljs-params">APIView</span>):</span><br>    authentication_classes = [MyBaseAuthentication, ]  <span class="hljs-comment"># jwt_tokenè®¤è¯ç”¨æˆ·</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get</span>(<span class="hljs-params">self, request</span>):</span><br>        code = request.GET.get(<span class="hljs-string">&#x27;code&#x27;</span>)  <span class="hljs-comment"># è·å–codeå€¼</span><br>        state = request.GET.get(<span class="hljs-string">&quot;state&quot;</span>)<br>        user = is_master(request.user)<br><br>        myurl = <span class="hljs-string">&quot;https://api.weixin.qq.com/sns/oauth2/access_token?appid=&quot;</span> \<br>        + AppID + <span class="hljs-string">&quot;&amp;secret=&quot;</span> + AppSecret + <span class="hljs-string">&quot;&amp;code=&quot;</span> + code + <span class="hljs-string">&quot;&amp;grant_type=authorization_code&quot;</span><br><br>        request = Request(myurl)<br>        html = urlopen(request)<br>        <span class="hljs-comment"># è·å–æ•°æ®</span><br>        data = html.read()<br>        strs = json.loads(data.decode())<br>        mytoken = strs[<span class="hljs-string">&quot;access_token&quot;</span>]<br>        myrhtoken = strs[<span class="hljs-string">&quot;refresh_token&quot;</span>]<br>        myopenid = strs[<span class="hljs-string">&quot;openid&quot;</span>]<br>        myunionid = strs[<span class="hljs-string">&quot;unionid&quot;</span>]<br>        <span class="hljs-comment"># è·å–ç”¨æˆ·ä¿¡æ¯çš„apiæ¥å£</span><br>        mytwourl = <span class="hljs-string">&quot;https://api.weixin.qq.com/sns/userinfo?access_token=&quot;</span> + mytoken + <span class="hljs-string">&quot;&amp;openid=&quot;</span> + myopenid + <span class="hljs-string">&quot;&amp;lang=zh_CN&quot;</span><br>        request2 = Request(mytwourl)<br>        html2 = urlopen(request2)<br>        data2 = html2.read()<br>        strs2 = json.loads(data2.decode())<br>        <span class="hljs-comment"># ä¸‹é¢æ˜¯è·å–æ‰«ç è€…å¾®ä¿¡å¸å·å®Œæ•´ä¿¡æ¯</span><br>        useropenid = strs2[<span class="hljs-string">&quot;openid&quot;</span>]<br>        usernickname = strs2[<span class="hljs-string">&quot;nickname&quot;</span>]<br>        userheadimgurl = strs2[<span class="hljs-string">&quot;headimgurl&quot;</span>]<br>        userunionid = strs2[<span class="hljs-string">&quot;unionid&quot;</span>]<br>        user.useropenid = useropenid<br>        user.usernickname = usernickname<br>        user.userheadimgurl = userheadimgurl<br>        user.userunionid = userunionid<br>        user.state = state<br>        user.save()<br><br>        <span class="hljs-keyword">return</span> Response(&#123;<span class="hljs-string">&#x27;code&#x27;</span>: RET.OK, <span class="hljs-string">&#x27;token&#x27;</span>: user.jwt_token, <span class="hljs-string">&#x27;mobile&#x27;</span>: user.mobile&#125;)<br></code></pre></div></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>WeChat</category>
      
    </categories>
    
    
    <tags>
      
      <tag>WeChat Login</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å¾®ä¿¡ç™»å½•-æ‰«ç ç™»å½•</title>
    <link href="/2021/03/25/%E5%BE%AE%E4%BF%A1%E7%99%BB%E5%BD%95-1/"/>
    <url>/2021/03/25/%E5%BE%AE%E4%BF%A1%E7%99%BB%E5%BD%95-1/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h2 id="å¾®ä¿¡ç™»å½•ä¸ç»‘å®šç”¨æˆ·â˜Ÿ"><a href="#å¾®ä¿¡ç™»å½•ä¸ç»‘å®šç”¨æˆ·â˜Ÿ" class="headerlink" title="å¾®ä¿¡ç™»å½•ä¸ç»‘å®šç”¨æˆ·â˜Ÿ"></a><font color="#008080">å¾®ä¿¡ç™»å½•ä¸ç»‘å®šç”¨æˆ·â˜Ÿ</font></h2><p><strong><code>å‰æƒ…æè¦</code> <a href="#">â˜Ÿ</a></strong></p><figure class="highlight"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs json">ç”¨æˆ·ä½¿ç”¨æ‰‹æœºå·ç ç™»å½•å æ ¡éªŒæ˜¯å¦å·²ç»ç»‘å®šå¾®ä¿¡å·<br>å¾®ä¿¡æ‰«ç ç™»å½•çš„ç”¨æˆ· æ ¡éªŒæ˜¯å¦å·²ç»ç»‘å®šæ‰‹æœºå·ç <br>æœ¬ç« ä½¿ç”¨: python3.6 django MySQL<br>å¾®ä¿¡æ‰«ç ç™»é™†æµç¨‹ä¸åç«¯ä»£ç <br></code></pre></div></td></tr></table></figure><h2 id="å¾®ä¿¡æ‰«ç ç™»å½•æµç¨‹â˜Ÿ"><a href="#å¾®ä¿¡æ‰«ç ç™»å½•æµç¨‹â˜Ÿ" class="headerlink" title="å¾®ä¿¡æ‰«ç ç™»å½•æµç¨‹â˜Ÿ"></a><font color="#008080">å¾®ä¿¡æ‰«ç ç™»å½•æµç¨‹â˜Ÿ</font></h2><h3 id="â˜-å¾®ä¿¡å¼€æ”¾å¹³å°"><a href="#â˜-å¾®ä¿¡å¼€æ”¾å¹³å°" class="headerlink" title="â˜ å¾®ä¿¡å¼€æ”¾å¹³å°"></a><a href="https://open.weixin.qq.com/cgi-bin/applist?t=manage/list&page=0&num=20&openapptype=1&lang=zh_CN&token=a40f5be463a14389f1c21ba201b68972d5b44dc6">â˜ å¾®ä¿¡å¼€æ”¾å¹³å°</a></h3><h2 id="åˆ›å»ºç½‘ç«™åº”ç”¨"><a href="#åˆ›å»ºç½‘ç«™åº”ç”¨" class="headerlink" title="åˆ›å»ºç½‘ç«™åº”ç”¨"></a><font color=" #66DD00">åˆ›å»ºç½‘ç«™åº”ç”¨</font></h2><p><img src="https://p.pstatp.com/origin/ff6b000286106846991d" alt="åˆ›å»ºç½‘ç«™åº”ç”¨"></p><h2 id="å¡«å†™ç½‘ç«™åº”ç”¨ä¿¡æ¯"><a href="#å¡«å†™ç½‘ç«™åº”ç”¨ä¿¡æ¯" class="headerlink" title="å¡«å†™ç½‘ç«™åº”ç”¨ä¿¡æ¯"></a><font color=" #66DD00">å¡«å†™ç½‘ç«™åº”ç”¨ä¿¡æ¯</font></h2><p><img src="https://p.pstatp.com/origin/13783000248ddf4318435" alt="å¡«å†™ç½‘ç«™åº”ç”¨ä¿¡æ¯"></p><h2 id="æŸ¥çœ‹idä¸å¯†é’¥"><a href="#æŸ¥çœ‹idä¸å¯†é’¥" class="headerlink" title="æŸ¥çœ‹idä¸å¯†é’¥"></a><font color=" #66DD00">æŸ¥çœ‹idä¸å¯†é’¥</font></h2><p><img src="https://p.pstatp.com/origin/1386c00040776e81450dd" alt="æŸ¥çœ‹idä¸å¯†é’¥"></p><h2 id="è®¾ç½®å›è°ƒåŸŸ"><a href="#è®¾ç½®å›è°ƒåŸŸ" class="headerlink" title="è®¾ç½®å›è°ƒåŸŸ"></a><font color=" #66DD00">è®¾ç½®å›è°ƒåŸŸ</font></h2><p><img src="https://p.pstatp.com/origin/1387c0000f4bfa737d7ff" alt="è®¾ç½®å›è°ƒåŸŸ"></p><h2 id="å¾®ä¿¡æ‰«ç ç™»å½•-è·å–codeå€¼â˜Ÿ"><a href="#å¾®ä¿¡æ‰«ç ç™»å½•-è·å–codeå€¼â˜Ÿ" class="headerlink" title="å¾®ä¿¡æ‰«ç ç™»å½•-è·å–codeå€¼â˜Ÿ"></a><font color="#008080">å¾®ä¿¡æ‰«ç ç™»å½•-è·å–codeå€¼â˜Ÿ</font></h2><table><thead><tr><th align="center">è·¯ç”±</th></tr></thead><tbody><tr><td align="center"><a href="https://open.weixin.qq.com/connect/qrconnect?appid=APPID&amp;redirect_uri=%E4%BD%A0%E8%87%AA%E5%B7%B1%E7%9A%84%E5%9F%9F%E5%90%8D&amp;response_type=code&amp;scope=snsapi_login&amp;state=STATE">https://open.weixin.qq.com/connect/qrconnect?appid=APPID&amp;redirect_uri=ä½ è‡ªå·±çš„åŸŸå&amp;response_type=code&amp;scope=snsapi_login&amp;state=STATE</a></td></tr></tbody></table><table><thead><tr><th align="center">ä¸Šè¿°è·¯ç”±å‚æ•°</th><th align="center">å€¼</th><th align="center">å¤‡æ³¨</th></tr></thead><tbody><tr><td align="center">APPID</td><td align="center">åˆšåˆšè·å–åˆ°çš„appid</td><td align="center">appid</td></tr><tr><td align="center">redirect_uri</td><td align="center">http:// https://æ ¹æ®ä½ çš„åŸŸå</td><td align="center">ä¾‹å¦‚æœ¬åœ°: <a href="http://127.0.0.1:8000/">http://127.0.0.1:8000</a></td></tr><tr><td align="center">response_type</td><td align="center">code</td><td align="center">é»˜è®¤å€¼</td></tr><tr><td align="center">scope</td><td align="center">snsapi_login</td><td align="center">é»˜è®¤å€¼</td></tr><tr><td align="center">state</td><td align="center">STATE</td><td align="center">é»˜è®¤å€¼</td></tr></tbody></table><h2 id="å¾®ä¿¡æ‰«ç ç™»å½•-è·å–access-tokenå€¼â˜Ÿ"><a href="#å¾®ä¿¡æ‰«ç ç™»å½•-è·å–access-tokenå€¼â˜Ÿ" class="headerlink" title="å¾®ä¿¡æ‰«ç ç™»å½•-è·å–access_tokenå€¼â˜Ÿ"></a><font color="#008080">å¾®ä¿¡æ‰«ç ç™»å½•-è·å–access_tokenå€¼â˜Ÿ</font></h2><table><thead><tr><th align="center">è·¯ç”±</th></tr></thead><tbody><tr><td align="center"><a href="https://api.weixin.qq.com/sns/oauth2/access_token?appid=APPID&amp;secret=SECRET&amp;code=CODE&amp;grant_type=authorization_code">https://api.weixin.qq.com/sns/oauth2/access_token?appid=APPID&amp;secret=SECRET&amp;code=CODE&amp;grant_type=authorization_code</a></td></tr></tbody></table><table><thead><tr><th align="center">ä¸Šè¿°è·¯ç”±å‚æ•°</th><th align="center">å€¼</th><th align="center">å¤‡æ³¨</th></tr></thead><tbody><tr><td align="center">APPID</td><td align="center">appid</td><td align="center">appid</td></tr><tr><td align="center">SECRET</td><td align="center">å¯†é’¥ ç½‘ç«™åº”ç”¨çš„å¯†é’¥</td><td align="center">å¯†é’¥ ç½‘ç«™åº”ç”¨çš„å¯†é’¥</td></tr><tr><td align="center">CODE</td><td align="center">è¿”å›çš„codeå€¼</td><td align="center">å¾®ä¿¡æ‰«ç ç™»å½•è¿”å›çš„codeå€¼</td></tr><tr><td align="center">grant_type</td><td align="center">authorization_code</td><td align="center">é»˜è®¤å€¼</td></tr></tbody></table><p><strong><font color=" #66DD00">è¿”å›å€¼:</font></strong></p><figure class="highlight"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs json">&#123;<br>  <span class="hljs-attr">&quot;access_token&quot;</span>: <span class="hljs-string">&quot;36_tzQMLluQGxWLvty7ivsqs7xpE3GvUzbgIrYyvldhAB_WDg3c-wB4-N6OP8uc-y************************************&quot;</span>,<br>  <span class="hljs-attr">&quot;expires_in&quot;</span>: <span class="hljs-number">7200</span>,<br>  <span class="hljs-attr">&quot;refresh_token&quot;</span>: <span class="hljs-string">&quot;36_S2uCpIM4dU9Z65uvn__PcD5UYp8_uPii97R04NSMItZs2keyuMp7zTkXzehYQ_tHNIPaE4Bh-oIp6cl********************&quot;</span>,<br>  <span class="hljs-attr">&quot;openid&quot;</span>: <span class="hljs-string">&quot;ä½ çš„openid&quot;</span>,<br>  <span class="hljs-attr">&quot;scope&quot;</span>: <span class="hljs-string">&quot;snsapi_login&quot;</span>,<br>  <span class="hljs-attr">&quot;unionid&quot;</span>: <span class="hljs-string">&quot;ä½ çš„unionid&quot;</span><br>&#125;<br><br># ä¸Šè¿°è¿”å›å€¼è§£æ<br>access_token åŒ…å«æ‰«ç ç”¨æˆ·çš„ä¿¡æ¯<br>expires_in è¶…æ—¶æ—¶é—´(è¿‡æœŸæ—¶é—´)<br>openid å°±æ˜¯ç¡®è®¤æ˜¯ä½ æ‰«ç çš„<br></code></pre></div></td></tr></table></figure><h2 id="å¾®ä¿¡æ‰«ç ç™»å½•-è·å–æ‰«ç ç”¨æˆ·çš„ä¿¡æ¯â˜Ÿ"><a href="#å¾®ä¿¡æ‰«ç ç™»å½•-è·å–æ‰«ç ç”¨æˆ·çš„ä¿¡æ¯â˜Ÿ" class="headerlink" title="å¾®ä¿¡æ‰«ç ç™»å½•-è·å–æ‰«ç ç”¨æˆ·çš„ä¿¡æ¯â˜Ÿ"></a><font color="#008080">å¾®ä¿¡æ‰«ç ç™»å½•-è·å–æ‰«ç ç”¨æˆ·çš„ä¿¡æ¯â˜Ÿ</font></h2><table><thead><tr><th align="center">è·¯ç”±</th></tr></thead><tbody><tr><td align="center"><a href="https://api.weixin.qq.com/sns/userinfo?access_token=ACCESS_TOKEN&amp;openid=OPENID&amp;lang=zh_CN">https://api.weixin.qq.com/sns/userinfo?access_token=ACCESS_TOKEN&amp;openid=OPENID&amp;lang=zh_CN</a></td></tr></tbody></table><table><thead><tr><th align="center">ä¸Šè¿°è·¯ç”±å‚æ•°</th><th align="center">å€¼</th><th align="center">å¤‡æ³¨</th></tr></thead><tbody><tr><td align="center">access_token</td><td align="center">36_tzQMXXXXXXX</td><td align="center">å‰é¢è·å–çš„access_token</td></tr><tr><td align="center">openid</td><td align="center">openid</td><td align="center">å‰é¢è·å–çš„openid</td></tr></tbody></table><p><strong><font color=" #66DD00">è¿”å›å€¼:</font></strong></p><figure class="highlight"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs json">&#123;<br>  <span class="hljs-attr">&quot;openid&quot;</span>: <span class="hljs-string">&quot;ä½ çš„openid&quot;</span>,<br>  <span class="hljs-attr">&quot;nickname&quot;</span>: <span class="hljs-string">&quot;å¾®ä¿¡åå­—&quot;</span>,<br>  &quot;sex&quot;: 1, # ç”·å¥³çš„æ„æ€<br>  &quot;language&quot;: &quot;zh_CN&quot;, # ä¸­æ–‡<br>  &quot;city&quot;: &quot;Abiko-shi&quot;, # åŸå¸‚<br>  &quot;province&quot;: &quot;Chiba-ken&quot;, # ä¹¡é•‡ <br>  &quot;country&quot;: &quot;JP&quot;, # æ—¥æœ¬<br>  &quot;headimgurl&quot;:&quot;http://thirdwx.qlogo.cn/mmopen/vi_32/dpF4rnCxdZ3VFjdnEEZ7J2e3hDJORNGibADyWavEeykwWnRnsGuP7dxkAPG70d8BFiagArJ69xy1wkxTG36m18bw/132&quot;, # ä½ çš„å¤´åƒ<br>  &quot;privilege&quot;: [<br><br>  ],<br>  &quot;unionid&quot;: &quot;ä½ çš„unionid&quot;<br>&#125;<br></code></pre></div></td></tr></table></figure><h2 id="å¾®ä¿¡æ‰«ç ç™»å½•-åç«¯ä»£ç â˜Ÿ"><a href="#å¾®ä¿¡æ‰«ç ç™»å½•-åç«¯ä»£ç â˜Ÿ" class="headerlink" title="å¾®ä¿¡æ‰«ç ç™»å½•-åç«¯ä»£ç â˜Ÿ"></a><font color="#008080">å¾®ä¿¡æ‰«ç ç™»å½•-åç«¯ä»£ç â˜Ÿ</font></h2><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment"># è·¯ç”±</span><br>url(<span class="hljs-string">r&#x27;^wx_login/$&#x27;</span>, WeXinLogin.as_view()),  <span class="hljs-comment"># è·å–å¾®ä¿¡ç™»å½• codeå€¼</span><br><br><span class="hljs-comment"># å¯¹åº”çš„è§†å›¾å‡½æ•°</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WeXinLogin</span>(<span class="hljs-params">APIView</span>):</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get</span>(<span class="hljs-params">self, request</span>):</span><br>        code = request.GET.get(<span class="hljs-string">&#x27;code&#x27;</span>)  <span class="hljs-comment"># è·å–codeå€¼</span><br>        state = request.GET.get(<span class="hljs-string">&quot;state&quot;</span>)<br><br>        myurl = <span class="hljs-string">&quot;https://api.weixin.qq.com/sns/oauth2/access_token?appid=&quot;</span> + AppID + <span class="hljs-string">&quot;&amp;secret=&quot;</span> + AppSecret + <span class="hljs-string">&quot;&amp;code=&quot;</span> + code + <span class="hljs-string">&quot;&amp;grant_type=authorization_code&quot;</span><br><br>        request = Request(myurl)<br>        html = urlopen(request)<br>        <span class="hljs-comment"># è·å–æ•°æ®</span><br>        data = html.read()<br>        strs = json.loads(data.decode())<br>        mytoken = strs[<span class="hljs-string">&quot;access_token&quot;</span>]<br>        myrhtoken = strs[<span class="hljs-string">&quot;refresh_token&quot;</span>]<br>        myopenid = strs[<span class="hljs-string">&quot;openid&quot;</span>]<br>        myunionid = strs[<span class="hljs-string">&quot;unionid&quot;</span>]<br>        <span class="hljs-comment"># è·å–ç”¨æˆ·ä¿¡æ¯çš„apiæ¥å£</span><br>        mytwourl = <span class="hljs-string">&quot;https://api.weixin.qq.com/sns/userinfo?access_token=&quot;</span> + mytoken + <span class="hljs-string">&quot;&amp;openid=&quot;</span> + myopenid + <span class="hljs-string">&quot;&amp;lang=zh_CN&quot;</span><br>        request2 = Request(mytwourl)<br>        html2 = urlopen(request2)<br>        data2 = html2.read()<br>        strs2 = json.loads(data2.decode())<br>        <span class="hljs-comment"># ä¸‹é¢æ˜¯è·å–æ‰«ç è€…å¾®ä¿¡å¸å·å®Œæ•´ä¿¡æ¯</span><br>        useropenid = strs2[<span class="hljs-string">&quot;openid&quot;</span>]<br>        usernickname = strs2[<span class="hljs-string">&quot;nickname&quot;</span>]<br>        userheadimgurl = strs2[<span class="hljs-string">&quot;headimgurl&quot;</span>]<br>        userunionid = strs2[<span class="hljs-string">&quot;unionid&quot;</span>]<br><br>        user = User.objects.<span class="hljs-built_in">filter</span>(useropenid=useropenid)<br>        <span class="hljs-keyword">if</span> user.count() &lt;= <span class="hljs-number">0</span>:<br>            is_login = User.objects.create_user(useropenid=useropenid,<br>                                                usernickname=usernickname,<br>                                                userheadimgurl=userheadimgurl,<br>                                                userunionid=userunionid,<br>                                                username=usernickname,<br>                                                password=userunionid,<br>                                                mobile=usernickname,<br>                                                mystate=state)<br>            jwt_payload_handler = api_settings.JWT_PAYLOAD_HANDLER<br>            jwt_encode_handler = api_settings.JWT_ENCODE_HANDLER<br>            payload = jwt_payload_handler(is_login)<br>            token = jwt_encode_handler(payload)<br>            User.objects.<span class="hljs-built_in">filter</span>(username=is_login).update(jwt_token=token)<br>            <span class="hljs-keyword">return</span> Response(&#123;<span class="hljs-string">&#x27;code&#x27;</span>: RET.OK, <span class="hljs-string">&#x27;mobile&#x27;</span>: usernickname, <span class="hljs-string">&#x27;token&#x27;</span>: token&#125;)<br>        is_login = User.objects.get(useropenid=useropenid)<br>        jwt_payload_handler = api_settings.JWT_PAYLOAD_HANDLER<br>        jwt_encode_handler = api_settings.JWT_ENCODE_HANDLER<br>        payload = jwt_payload_handler(is_login)<br>        token = jwt_encode_handler(payload)<br>        User.objects.<span class="hljs-built_in">filter</span>(useropenid=useropenid).update(jwt_token=token)<br>        <span class="hljs-keyword">return</span> Response(&#123;<span class="hljs-string">&#x27;code&#x27;</span>: RET.OK, <span class="hljs-string">&quot;token&quot;</span>: token, <span class="hljs-string">&#x27;mobile&#x27;</span>: is_login.username&#125;)<br></code></pre></div></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>WeChat</category>
      
    </categories>
    
    
    <tags>
      
      <tag>WeChat Login</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å¾®åšæˆæƒç™»å½•è·å–IDå¯†é’¥</title>
    <link href="/2021/03/25/%E5%BE%AE%E5%8D%9A%E7%99%BB%E5%BD%95/"/>
    <url>/2021/03/25/%E5%BE%AE%E5%8D%9A%E7%99%BB%E5%BD%95/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h2 id="é¢˜è®°"><a href="#é¢˜è®°" class="headerlink" title="é¢˜è®°"></a>é¢˜è®°</h2><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">social-auth-app-djangoæ¨¡å—æ˜¯ä¸“é—¨ç”¨äºDjangoçš„ç¬¬ä¸‰æ–¹ç™»å½•OAuth2åè®®æ¨¡å—<br>ç›®å‰æµè¡Œçš„ç¬¬ä¸‰æ–¹ç™»å½•éƒ½é‡‡ç”¨äº†OAuth2åè®®<br></code></pre></div></td></tr></table></figure><p><a href="https://open.weibo.com/wiki/%E5%BE%AE%E5%8D%9AAPI#OAuth2">å¾®åšAPI</a></p><h2 id="ä½¿ç”¨å¾®åšçš„ç™»å½•-éœ€è¦è·å–å¼€å‘è€…æƒé™"><a href="#ä½¿ç”¨å¾®åšçš„ç™»å½•-éœ€è¦è·å–å¼€å‘è€…æƒé™" class="headerlink" title="ä½¿ç”¨å¾®åšçš„ç™»å½• éœ€è¦è·å–å¼€å‘è€…æƒé™"></a>ä½¿ç”¨å¾®åšçš„ç™»å½• éœ€è¦è·å–å¼€å‘è€…æƒé™</h2><p>1.ç™»å½•å¾®åšå¼€æ”¾å¹³å°ï¼Œå¦‚æœæ˜¯æ–°ç”¨æˆ·ä¼šå®¡æ ¸ä¸€äº›ä¸œè¥¿ï¼Œå¯ä»¥ç•¥è¿‡é‚£äº›ï¼Œé€‰æ‹©æ€§å¡«å†™ã€‚</p><p><a href="https://open.weibo.com/developers/level">ç‚¹å‡»è·³è½¬å¾®åšå¼€æ”¾å¹³å°</a></p><p>2.ç™»å½•å¾®åš<a href="#">Â¶</a></p><p><img src="https://s3.ax1x.com/2020/12/04/DbplJH.jpg" alt="ç‚¹å‡»ç™»å½• ç™»å½•å¾®åš"></p><p>3.ç™»é™†å®Œæˆå æˆ‘ä»¬æ˜¯è¦å»å¼€æ”¾å¹³å°çš„ è€Œä¸æ˜¯åœ¨<a href="https://weibo.com/">å¾®åš</a>é¦–é¡µçš„</p><p><a href="https://open.weibo.com/developers/level">ç‚¹å‡»é‡æ–°è¿›å…¥å¾®åšå¼€æ”¾å¹³å°</a></p><p>4.åŸºæœ¬ä¿¡æ¯è®¤è¯</p><p><img src="https://s3.ax1x.com/2020/12/04/DbPiFS.jpg" alt="åŸºæœ¬ä¿¡æ¯è®¤è¯"></p><p>5.èº«ä»½ä¿¡æ¯è®¤è¯</p><p><img src="https://s3.ax1x.com/2020/12/04/DbPAzj.jpg" alt="èº«ä»½ä¿¡æ¯è®¤è¯"></p><blockquote><p>å½“ç„¶ èº«ä»½è®¤è¯ä¸ç€æ€¥ </p></blockquote><p>6.æ¥å…¥ç½‘é¡µåº”ç”¨</p><p><img src="https://s3.ax1x.com/2020/12/04/DbPeLq.jpg" alt="æ¥å…¥ç½‘é¡µåº”ç”¨"></p><p>7.åˆ›å»ºåº”ç”¨</p><p><img src="https://s3.ax1x.com/2020/12/04/DbiujA.jpg" alt="åˆ›å»ºåº”ç”¨"></p><p>8.æŸ¥çœ‹åº”ç”¨é‡Œé¢çš„ å¯†é’¥ key</p><p><img src="https://s3.ax1x.com/2020/12/04/DbiG4S.md.jpg" alt="æŸ¥çœ‹å¯†é’¥,key"></p><p>9.è®¾ç½®å›è°ƒåœ°å€</p><p><img src="https://s3.ax1x.com/2020/12/04/DbiwBq.jpg" alt="å›è°ƒåœ°å€"></p><p>10.å¯†é’¥çš„æ›´æ”¹</p><p><img src="https://s3.ax1x.com/2020/12/04/Dbis4U.jpg" alt="å¯†é’¥æ›´æ”¹"></p>]]></content>
    
    
    <categories>
      
      <category>Python</category>
      
      <category>æŠ€æœ¯æ‚è°ˆ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>æŠ€æœ¯æ‚è°ˆ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å‰ç«¯è¯·æ±‚ç™»å½• è·å–tokenå­˜å–</title>
    <link href="/2021/03/25/%E5%89%8D%E7%AB%AF%E4%BF%9D%E5%AD%98token/"/>
    <url>/2021/03/25/%E5%89%8D%E7%AB%AF%E4%BF%9D%E5%AD%98token/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h2 id="å…³äºå‰ç«¯è·å–å­˜æ”¾token"><a href="#å…³äºå‰ç«¯è·å–å­˜æ”¾token" class="headerlink" title="å…³äºå‰ç«¯è·å–å­˜æ”¾token"></a><font color="#BBFF00">å…³äºå‰ç«¯è·å–å­˜æ”¾token</font></h2><p><img src="https://ae01.alicdn.com/kf/U2bebf28b35e246579dd1da32dfc16d0co.jpg" alt="æµç¨‹å›¾"></p><p><code>å‰æƒ…æè¦</code></p><figure class="highlight"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs nginx">ç”¨æˆ·è¯·æ±‚ç™»å½•æ¥å£çš„æ—¶å€™ åç«¯è·å–æ•°æ® è®¤è¯ è¿”å›è®¤è¯æ•°æ®åˆ°å‰ç«¯<br>å‰ç«¯æ‹¿åˆ°è®¤è¯æ•°æ®å ç¼“å­˜<br>é€šè¿‡ajaxè·å–è®¤è¯æ•°æ® ç”¨äºéªŒè¯ç”¨æˆ·<br></code></pre></div></td></tr></table></figure><h2 id="ç™»å½•SUCCESSæ—¶å€™-é€šè¿‡è¯·æ±‚è·å–è®¤è¯æ•°æ®"><a href="#ç™»å½•SUCCESSæ—¶å€™-é€šè¿‡è¯·æ±‚è·å–è®¤è¯æ•°æ®" class="headerlink" title="ç™»å½•SUCCESSæ—¶å€™,é€šè¿‡è¯·æ±‚è·å–è®¤è¯æ•°æ®"></a><font color="#BBFF00">ç™»å½•SUCCESSæ—¶å€™,é€šè¿‡è¯·æ±‚è·å–è®¤è¯æ•°æ®</font></h2><figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js">$ajax(&#123;<br>    <span class="hljs-comment">// æµ‹è¯•æ¥å£</span><br>    url:<span class="hljs-string">&quot;pro/user/login&quot;</span>,<br>    data: &#123;<br>        <span class="hljs-string">&quot;uName&quot;</span>: <span class="hljs-string">&quot;wsbg&quot;</span>,<br>        <span class="hljs-string">&quot;pPwd&quot;</span>: <span class="hljs-string">&quot;wdtazbn9527&quot;</span><br>    &#125;,<br>    type: <span class="hljs-string">&quot;post&quot;</span>,<br>    dataType: <span class="hljs-string">&quot;json&quot;</span>,<br>    success: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">data</span>) </span>&#123;<br>        <span class="hljs-comment">// è¿”å›æˆåŠŸçš„æ—¶å€™</span><br>        <span class="hljs-keyword">var</span> uToken = data.uToken;<br>        <span class="hljs-comment">//å­˜æ”¾uToken</span><br>        <span class="hljs-built_in">window</span>.localStorage.setItem(<span class="hljs-string">&#x27;uToken&#x27;</span>,uToken);<br>        <br>        &#125;<br>&#125;)<br></code></pre></div></td></tr></table></figure><h2 id="è¯·æ±‚ä¸»é¡µæˆ–è€…å…¶ä»–æ¥å£çš„æ—¶å€™-æºå¸¦token"><a href="#è¯·æ±‚ä¸»é¡µæˆ–è€…å…¶ä»–æ¥å£çš„æ—¶å€™-æºå¸¦token" class="headerlink" title="è¯·æ±‚ä¸»é¡µæˆ–è€…å…¶ä»–æ¥å£çš„æ—¶å€™ æºå¸¦token"></a><font color="#BBFF00">è¯·æ±‚ä¸»é¡µæˆ–è€…å…¶ä»–æ¥å£çš„æ—¶å€™ æºå¸¦token</font></h2><figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js"><span class="hljs-comment">// æå–è®¤è¯ä¿¡æ¯</span><br><span class="hljs-keyword">var</span>  uToken = <span class="hljs-built_in">window</span>.localStorage.getItem(<span class="hljs-string">&quot;uToken&quot;</span>);<br>$.ajax(&#123;<br>    headers: &#123;<br>        <span class="hljs-string">&quot;token&quot;</span>: uToken <span class="hljs-comment">//ç¼“å­˜çš„token ç”¨äºéªŒè¯ç”¨æˆ·</span><br>    &#125;,<br>    url: <span class="hljs-string">&quot;pro/index/INFO/&quot;</span>, <span class="hljs-comment">//è¯·æ±‚æ¥å£</span><br>    type: <span class="hljs-string">&quot;post&quot;</span>,<br>    dataType: <span class="hljs-string">&#x27;json&#x27;</span>,<br>    data: &#123;<br>    &#125;,<br>    success: <span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> &#123;<br>        <span class="hljs-comment">//è¯·æ±‚æˆåŠŸçš„æ—¶å€™</span><br>    &#125;<br>&#125;)<br></code></pre></div></td></tr></table></figure><h2 id="å‰ç«¯çš„sessionStorage-ä¸-localStorage"><a href="#å‰ç«¯çš„sessionStorage-ä¸-localStorage" class="headerlink" title="å‰ç«¯çš„sessionStorage ä¸ localStorage"></a><font color="#BBFF00">å‰ç«¯çš„sessionStorage ä¸ localStorage</font></h2><p>sessionStorage åªåœ¨å½“å‰çš„çª—å£æœ‰æ•ˆ æµè§ˆå™¨å…³é—­ åˆ™æ¸…é™¤ç¼“å­˜</p><figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js"><span class="hljs-comment">//è®¾ç½®</span><br><span class="hljs-built_in">window</span>.seesionStorage.setItem(<span class="hljs-string">&#x27;token&#x27;</span>,uToken)<br><br><span class="hljs-comment">//è·å–</span><br><span class="hljs-built_in">window</span>.sessionStorage.getItem(<span class="hljs-string">&#x27;token&#x27;</span>);<br><br><span class="hljs-comment">//æ¸…é™¤</span><br><span class="hljs-built_in">window</span>.sessionStorage.clear();<br><span class="hljs-comment">//åˆ é™¤æ•°æ®</span><br><span class="hljs-built_in">window</span>.sessionStorage.removeItem(<span class="hljs-string">&#x27;token&#x27;</span>)<br></code></pre></div></td></tr></table></figure><p>localStorage åœ¨å…³é—­æµè§ˆå™¨åä¾ç„¶æœ‰æ•ˆ</p><figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js"><span class="hljs-comment">//è®¾ç½®</span><br><span class="hljs-built_in">window</span>.localStorage.setItem(<span class="hljs-string">&#x27;token&#x27;</span>, token);<br><br><span class="hljs-comment">//è·å–</span><br><span class="hljs-built_in">window</span>.localStorage.getItem(<span class="hljs-string">&quot;token&quot;</span>)<br></code></pre></div></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Python</category>
      
      <category>æŠ€æœ¯æ‚è°ˆ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>æŠ€æœ¯æ‚è°ˆ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>è‡ªå…³è”åˆ†ç±»çš„äºŒçº§ ä¸‰çº§ç±»ç›®è·å–</title>
    <link href="/2021/03/25/%E5%A4%9A%E9%87%8D%E5%88%86%E7%B1%BB%E8%8E%B7%E5%8F%96/"/>
    <url>/2021/03/25/%E5%A4%9A%E9%87%8D%E5%88%86%E7%B1%BB%E8%8E%B7%E5%8F%96/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h2 id="è‡ªå…³è”åˆ†ç±»è·å–å­çº§åˆ†ç±»â­â­"><a href="#è‡ªå…³è”åˆ†ç±»è·å–å­çº§åˆ†ç±»â­â­" class="headerlink" title="è‡ªå…³è”åˆ†ç±»è·å–å­çº§åˆ†ç±»â­â­"></a><font color="#008080">è‡ªå…³è”åˆ†ç±»è·å–å­çº§åˆ†ç±»â­â­</font></h2><p><code>å‰æƒ…æè¦</code></p><figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">æœ‰è¿™ä¹ˆä¸€ä¸ªè¡¨ è‡ªå…³è”è·å–åˆ†ç±» <br>è·å–é¡¶çº§åˆ†ç±» é€‰æ‹© è¿”å›é¡¶çº§ä¸äºŒçº§åˆ†ç±»<br>è·å–äºŒçº§åˆ†ç±» é€‰æ‹© è¿”å›äºŒçº§ä¸ä¸‰çº§åˆ†ç±»<br>è·å–ä¸‰çº§åˆ†ç±» é€‰æ‹© ...<br></code></pre></div></td></tr></table></figure><h2 id="åˆ›å»ºæ•°æ®è¡¨-æ·»åŠ æµ‹è¯•æ•°æ®â­â­"><a href="#åˆ›å»ºæ•°æ®è¡¨-æ·»åŠ æµ‹è¯•æ•°æ®â­â­" class="headerlink" title="åˆ›å»ºæ•°æ®è¡¨ æ·»åŠ æµ‹è¯•æ•°æ®â­â­"></a><font color="#008080">åˆ›å»ºæ•°æ®è¡¨ æ·»åŠ æµ‹è¯•æ•°æ®â­â­</font></h2><ol><li>å»ºè®® ä½¿ç”¨sqlæ–‡ä»¶</li></ol><figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-comment">/*</span><br><span class="hljs-comment"> Navicat Premium Data Transfer</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"> Source Server         : loacalhost</span><br><span class="hljs-comment"> Source Server Type    : MySQL</span><br><span class="hljs-comment"> Source Server Version : 50732</span><br><span class="hljs-comment"> Source Host           : localhost:3306</span><br><span class="hljs-comment"> Source Schema         : ujedu</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"> Target Server Type    : MySQL</span><br><span class="hljs-comment"> Target Server Version : 50732</span><br><span class="hljs-comment"> File Encoding         : 65001</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"> Date: 23/03/2021 11:30:07</span><br><span class="hljs-comment">*/</span><br><br><span class="hljs-keyword">SET</span> NAMES utf8mb4;<br><span class="hljs-keyword">SET</span> FOREIGN_KEY_CHECKS <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br><br><span class="hljs-comment">-- ----------------------------</span><br><span class="hljs-comment">-- Table structure for search_category</span><br><span class="hljs-comment">-- ----------------------------</span><br><span class="hljs-keyword">DROP</span> <span class="hljs-keyword">TABLE</span> IF <span class="hljs-keyword">EXISTS</span> `search_category`;<br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `search_category`  (<br>  `id` <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) UNSIGNED <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT,<br>  `category_name` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-type">CHARACTER</span> <span class="hljs-keyword">SET</span> utf8 <span class="hljs-keyword">COLLATE</span> utf8_general_ci <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;åˆ†ç±»åå­—&#x27;</span>,<br>  `user_search_foreign` <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>  `create_time` datetime(<span class="hljs-number">6</span>) <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">ON</span> UPDATE <span class="hljs-built_in">CURRENT_TIMESTAMP</span>(<span class="hljs-number">6</span>),<br>  `update_time` datetime(<span class="hljs-number">6</span>) <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">ON</span> UPDATE <span class="hljs-built_in">CURRENT_TIMESTAMP</span>(<span class="hljs-number">6</span>),<br>  `site` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-type">CHARACTER</span> <span class="hljs-keyword">SET</span> utf8 <span class="hljs-keyword">COLLATE</span> utf8_general_ci <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">&#x27;US&#x27;</span>,<br>  `pid` <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>  <span class="hljs-keyword">PRIMARY</span> KEY (`id`) <span class="hljs-keyword">USING</span> BTREE,<br>  INDEX `user_search_id`(`user_search_foreign`) <span class="hljs-keyword">USING</span> BTREE,<br>  <span class="hljs-keyword">CONSTRAINT</span> `user_search_id` <span class="hljs-keyword">FOREIGN</span> KEY (`user_search_foreign`) <span class="hljs-keyword">REFERENCES</span> `tb_users` (`id`) <span class="hljs-keyword">ON</span> <span class="hljs-keyword">DELETE</span> RESTRICT <span class="hljs-keyword">ON</span> UPDATE RESTRICT<br>) ENGINE <span class="hljs-operator">=</span> InnoDB AUTO_INCREMENT <span class="hljs-operator">=</span> <span class="hljs-number">14</span> <span class="hljs-type">CHARACTER</span> <span class="hljs-keyword">SET</span> <span class="hljs-operator">=</span> utf8 <span class="hljs-keyword">COLLATE</span> <span class="hljs-operator">=</span> utf8_general_ci ROW_FORMAT <span class="hljs-operator">=</span> <span class="hljs-keyword">Dynamic</span>;<br><br><span class="hljs-comment">-- ----------------------------</span><br><span class="hljs-comment">-- Records of search_category</span><br><span class="hljs-comment">-- ----------------------------</span><br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> `search_category` <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">1</span>, <span class="hljs-string">&#x27;ceshi01&#x27;</span>, <span class="hljs-number">1</span>, <span class="hljs-string">&#x27;2021-03-16 09:19:55.000000&#x27;</span>, <span class="hljs-string">&#x27;2021-03-16 09:19:57.000000&#x27;</span>, <span class="hljs-string">&#x27;US&#x27;</span>, <span class="hljs-keyword">NULL</span>);<br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> `search_category` <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">2</span>, <span class="hljs-string">&#x27;ceshi02&#x27;</span>, <span class="hljs-number">1</span>, <span class="hljs-string">&#x27;2021-03-16 10:39:14.506797&#x27;</span>, <span class="hljs-string">&#x27;2021-03-16 10:39:14.506797&#x27;</span>, <span class="hljs-string">&#x27;US&#x27;</span>, <span class="hljs-keyword">NULL</span>);<br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> `search_category` <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">3</span>, <span class="hljs-string">&#x27;ceshi03&#x27;</span>, <span class="hljs-number">1</span>, <span class="hljs-string">&#x27;2021-03-17 11:42:02.000000&#x27;</span>, <span class="hljs-string">&#x27;2021-03-17 11:42:04.000000&#x27;</span>, <span class="hljs-string">&#x27;US&#x27;</span>, <span class="hljs-keyword">NULL</span>);<br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> `search_category` <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">4</span>, <span class="hljs-string">&#x27;upload01&#x27;</span>, <span class="hljs-number">1</span>, <span class="hljs-string">&#x27;2021-03-18 16:00:23.422573&#x27;</span>, <span class="hljs-string">&#x27;2021-03-18 16:00:23.422573&#x27;</span>, <span class="hljs-string">&#x27;US&#x27;</span>, <span class="hljs-keyword">NULL</span>);<br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> `search_category` <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">7</span>, <span class="hljs-string">&#x27;ceshi01&#x27;</span>, <span class="hljs-number">1</span>, <span class="hljs-string">&#x27;2021-03-19 10:42:19.054462&#x27;</span>, <span class="hljs-string">&#x27;2021-03-19 10:42:19.054462&#x27;</span>, <span class="hljs-string">&#x27;UK&#x27;</span>, <span class="hljs-keyword">NULL</span>);<br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> `search_category` <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">8</span>, <span class="hljs-string">&#x27;ceshi02&#x27;</span>, <span class="hljs-number">1</span>, <span class="hljs-string">&#x27;2021-03-19 10:43:15.092313&#x27;</span>, <span class="hljs-string">&#x27;2021-03-19 10:43:15.092313&#x27;</span>, <span class="hljs-string">&#x27;UK&#x27;</span>, <span class="hljs-number">7</span>);<br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> `search_category` <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">9</span>, <span class="hljs-string">&#x27;ceshi03&#x27;</span>, <span class="hljs-number">1</span>, <span class="hljs-string">&#x27;2021-03-19 10:58:28.897592&#x27;</span>, <span class="hljs-string">&#x27;2021-03-19 10:58:28.897592&#x27;</span>, <span class="hljs-string">&#x27;UK&#x27;</span>, <span class="hljs-number">7</span>);<br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> `search_category` <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">10</span>, <span class="hljs-string">&#x27;ä¸‰çº§åˆ†ç±»1&#x27;</span>, <span class="hljs-number">1</span>, <span class="hljs-string">&#x27;2021-03-23 09:58:13.728414&#x27;</span>, <span class="hljs-string">&#x27;2021-03-23 09:58:13.728414&#x27;</span>, <span class="hljs-string">&#x27;UK&#x27;</span>, <span class="hljs-number">8</span>);<br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> `search_category` <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">11</span>, <span class="hljs-string">&#x27;ä¸‰çº§åˆ†ç±»2&#x27;</span>, <span class="hljs-number">1</span>, <span class="hljs-keyword">NULL</span>, <span class="hljs-keyword">NULL</span>, <span class="hljs-string">&#x27;UK&#x27;</span>, <span class="hljs-number">8</span>);<br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> `search_category` <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">12</span>, <span class="hljs-string">&#x27;ä¸‰çº§åˆ†ç±»3&#x27;</span>, <span class="hljs-number">1</span>, <span class="hljs-keyword">NULL</span>, <span class="hljs-keyword">NULL</span>, <span class="hljs-string">&#x27;UK&#x27;</span>, <span class="hljs-number">9</span>);<br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> `search_category` <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">13</span>, <span class="hljs-string">&#x27;ceshi04&#x27;</span>, <span class="hljs-number">1</span>, <span class="hljs-keyword">NULL</span>, <span class="hljs-keyword">NULL</span>, <span class="hljs-string">&#x27;UK&#x27;</span>, <span class="hljs-number">7</span>);<br><br><span class="hljs-keyword">SET</span> FOREIGN_KEY_CHECKS <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;<br><br></code></pre></div></td></tr></table></figure><h2 id="æ ¹æ®æ¡ä»¶-è·å–å¯¹åº”çš„åˆ†ç±»â­â­"><a href="#æ ¹æ®æ¡ä»¶-è·å–å¯¹åº”çš„åˆ†ç±»â­â­" class="headerlink" title="æ ¹æ®æ¡ä»¶ è·å–å¯¹åº”çš„åˆ†ç±»â­â­"></a><font color="#008080">æ ¹æ®æ¡ä»¶ è·å–å¯¹åº”çš„åˆ†ç±»â­â­</font></h2><ol><li>è§†å›¾å‡½æ•°</li></ol><blockquote><p>pid çš„ä½œç”¨: pid ä»£è¡¨æ˜¯å¦å­˜åœ¨é¡¶çº§åˆ†ç±»id ä¸å­˜åœ¨åˆ™æ˜¯é¡¶çº§</p></blockquote><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SearchCateGoryView</span>(<span class="hljs-params">APIView</span>):</span><br>    authentication_classes = [MyBaseAuthentication, ]<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get</span>(<span class="hljs-params">self, request</span>):</span><br>        user = is_master(request.user)<br>        site = request.GET.get(<span class="hljs-string">&#x27;site&#x27;</span>, <span class="hljs-string">&#x27;UK&#x27;</span>)<br>        pid = request.GET.get(<span class="hljs-string">&#x27;pid&#x27;</span>)<br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> pid <span class="hljs-keyword">or</span> pid <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:<br>            queryset = SearchCategory.objects.<span class="hljs-built_in">filter</span>(user_search_foreign=user.<span class="hljs-built_in">id</span>, site=site)<br>            category_list = get_sub_category(queryset, <span class="hljs-number">1</span>, user.<span class="hljs-built_in">id</span>, site)<br>            <span class="hljs-keyword">return</span> Response(&#123;<span class="hljs-string">&#x27;code&#x27;</span>: RET.OK, <span class="hljs-string">&quot;cateList&quot;</span>: category_list&#125;)<br>        <span class="hljs-keyword">else</span>:<br>            queryset = SearchCategory.objects.<span class="hljs-built_in">filter</span>(user_search_foreign=user.<span class="hljs-built_in">id</span>, site=site, pid=pid)<br>            category_list = get_sub_category(queryset, <span class="hljs-number">2</span>, user.<span class="hljs-built_in">id</span>, site)<br>            <span class="hljs-keyword">return</span> Response(&#123;<span class="hljs-string">&#x27;code&#x27;</span>: RET.OK, <span class="hljs-string">&quot;cateList&quot;</span>: category_list&#125;)<br></code></pre></div></td></tr></table></figure><ol start="2"><li>è·å–åˆ†ç±»æ•°æ®çš„å‡½æ•° get_sub_category()</li></ol><blockquote><p>filter_sub: ç¡®è®¤è·å–é¡¶çº§ è¿˜æ˜¯ è·å–å­çº§åˆ†ç±»</p></blockquote><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_sub_category</span>(<span class="hljs-params">queryset, filter_sub, uid, site</span>):</span><br>    category_list = []<br>    <span class="hljs-keyword">for</span> info <span class="hljs-keyword">in</span> queryset:<br>        <span class="hljs-keyword">if</span> filter_sub == <span class="hljs-number">1</span>:<br>            <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> info.pid:<br>                d = get_dict_info(info, queryset)<br>                category_list.append(d)<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-comment"># ä¼ é€’pid è·å–è¿™ä¸ªåˆ†ç±»ä¸‹çš„å­çº§åˆ†ç±» å­çº§åˆ†ç±»çš„pidä¸åˆ†ç±»idç›¸åŒçš„ åˆ™æ·»åŠ  å¦åˆ™[]</span><br>            three_queryset = SearchCategory.objects.<span class="hljs-built_in">filter</span>(user_search_foreign=uid, site=site, pid=info.<span class="hljs-built_in">id</span>)<br>            d = get_dict_info(info, three_queryset)<br>            category_list.append(d)<br>    <span class="hljs-keyword">return</span> category_list<br></code></pre></div></td></tr></table></figure><ol start="3"><li>ç»„åˆè¿”å›çš„æ ¼å¼ get_dict_info()</li></ol><blockquote><p>if info.id == info_pid.pid: å¦‚æœå­˜åœ¨å­çº§ å°±æ·»åŠ åˆ°å­—å…¸ å¦åˆ™ä¸º[]</p></blockquote><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_dict_info</span>(<span class="hljs-params">info, queryset</span>):</span><br>    d = &#123;<span class="hljs-string">&#x27;id&#x27;</span>: info.<span class="hljs-built_in">id</span>, <span class="hljs-string">&#x27;categoryName&#x27;</span>: info.category_name&#125;<br>    c = []<br>    <span class="hljs-keyword">if</span> queryset.count() &lt;= <span class="hljs-number">0</span>:<br>        d[<span class="hljs-string">&#x27;children&#x27;</span>] = c<br>    <span class="hljs-keyword">for</span> info_pid <span class="hljs-keyword">in</span> queryset:<br>        <span class="hljs-keyword">if</span> info.<span class="hljs-built_in">id</span> == info_pid.pid:<br>            e = &#123;<span class="hljs-string">&#x27;id&#x27;</span>: info_pid.<span class="hljs-built_in">id</span>, <span class="hljs-string">&#x27;categoryName&#x27;</span>: info_pid.category_name&#125;<br>            c.append(e)<br>        d[<span class="hljs-string">&#x27;children&#x27;</span>] = c<br>    <span class="hljs-keyword">return</span> d<br></code></pre></div></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Python</category>
      
      <category>æŠ€æœ¯æ‚è°ˆ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Django Uwsgi Nginx Https å¤šç«™ç‚¹éƒ¨ç½²é¡¹ç›®</title>
    <link href="/2021/03/25/%E5%A4%9A%E7%AB%99%E7%82%B9%E9%83%A8%E7%BD%B2/"/>
    <url>/2021/03/25/%E5%A4%9A%E7%AB%99%E7%82%B9%E9%83%A8%E7%BD%B2/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h2 id="åŒæœåŠ¡å™¨å†…-å¤šç«™ç‚¹-å¤šé¡¹ç›®-éƒ¨ç½²âœ"><a href="#åŒæœåŠ¡å™¨å†…-å¤šç«™ç‚¹-å¤šé¡¹ç›®-éƒ¨ç½²âœ" class="headerlink" title="åŒæœåŠ¡å™¨å†… å¤šç«™ç‚¹(å¤šé¡¹ç›®)éƒ¨ç½²âœ"></a><font color="#008080">åŒæœåŠ¡å™¨å†… å¤šç«™ç‚¹(å¤šé¡¹ç›®)éƒ¨ç½²âœ</font></h2><p><code>å‰æƒ…æè¦</code></p><figure class="highlight"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs json">æœ¬ç« ä½¿ç”¨çš„SSLè¯ä¹¦ä¸º è…¾è®¯äº‘(ä½†å…¶å®åŸºæœ¬éƒ½ä¸€æ · å°±æ˜¯åç¼€ä¸åŒ)<br>åŒä¸€ä¸ªæœåŠ¡å™¨ä¸‹ å¤šä¸ªç«™ç‚¹(é¡¹ç›®)éƒ¨ç½²<br></code></pre></div></td></tr></table></figure><h2 id="è¿›å…¥-etc-nginx-æ”¹é€ æ–‡ä»¶nginx-confâœ"><a href="#è¿›å…¥-etc-nginx-æ”¹é€ æ–‡ä»¶nginx-confâœ" class="headerlink" title="è¿›å…¥/etc/nginx/ æ”¹é€ æ–‡ä»¶nginx.confâœ"></a><font color="#008080">è¿›å…¥/etc/nginx/ æ”¹é€ æ–‡ä»¶nginx.confâœ</font></h2><p><code>æ–°é¡¹ç›®çš„uwsgi</code></p><figure class="highlight nginx"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs nginx">[uwsgi]<br><span class="hljs-comment">#é…ç½®å’Œnginxè¿æ¥çš„socketè¿æ¥</span><br>socket=127.0.0.1:8888<br><span class="hljs-comment">#é…ç½®é¡¹ç›®è·¯å¾„ï¼Œé¡¹ç›®çš„æ‰€åœ¨ç›®å½•</span><br>chdir=/home/ubuntu/xxx<br><span class="hljs-comment">#é…ç½®wsgiæ¥å£æ¨¡å—æ–‡ä»¶è·¯å¾„,ä¹Ÿå°±æ˜¯wsgi.pyè¿™ä¸ªæ–‡ä»¶æ‰€åœ¨çš„ç›®å½•å</span><br>wsgi-file=xxx/wsgi.py<br><span class="hljs-comment">#é…ç½®å¯åŠ¨çš„è¿›ç¨‹æ•°</span><br>processes=4<br><span class="hljs-comment">#é…ç½®æ¯ä¸ªè¿›ç¨‹çš„çº¿ç¨‹æ•°</span><br>threads=2<br><span class="hljs-comment">#é…ç½®å¯åŠ¨ç®¡ç†ä¸»è¿›ç¨‹</span><br>master=True<br><span class="hljs-comment"># ä¸è®°å½•requestæ—¥å¿—ï¼Œåªè®°å½•é”™è¯¯æ—¥å¿—</span><br>disable-logging=true<br><span class="hljs-comment"># ä¼˜é›…é‡å¯</span><br>lazy-apps=true<br><span class="hljs-comment">#é…ç½®å­˜æ”¾ä¸»è¿›ç¨‹çš„è¿›ç¨‹å·æ–‡ä»¶</span><br>pidfile=uwsgi.pid<br><span class="hljs-comment">#é…ç½®dumpæ—¥å¿—è®°å½•</span><br>daemonize=uwsgi.log<br><br></code></pre></div></td></tr></table></figure><h2 id="è¿›å…¥-etc-nginx-æ”¹é€ æ–‡ä»¶nginx-confâœ-1"><a href="#è¿›å…¥-etc-nginx-æ”¹é€ æ–‡ä»¶nginx-confâœ-1" class="headerlink" title="è¿›å…¥/etc/nginx/ æ”¹é€ æ–‡ä»¶nginx.confâœ"></a><font color="#008080">è¿›å…¥/etc/nginx/ æ”¹é€ æ–‡ä»¶nginx.confâœ</font></h2><table><thead><tr><th>æ·»åŠ </th><th>VALUE</th><th>å¤‡æ³¨</th><th>æ˜¯/å¦</th></tr></thead><tbody><tr><td><strong>include</strong></td><td><strong>/etc/nginx/conf.d/*.conf;</strong></td><td><strong>ç›®çš„:æŠŠæ–°å»ºçš„é…ç½®æ–‡ä»¶åŒ…å«è¿›æ¥</strong></td><td><strong>Y</strong></td></tr></tbody></table><figure class="highlight nginx"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs nginx"><span class="hljs-comment">##### åŸæ–‡ä»¶ nginx.conf çš„æ ·æ¿</span><br><span class="hljs-comment">##### æ³¨æ„éœ€è¦ä¿®æ”¹çš„åœ°æ–¹</span><br><span class="hljs-comment">#server_name</span><br><span class="hljs-comment">#uwsgi_param UWSGI_SCRIPT</span><br><span class="hljs-comment">#uwsgi_param UWSGI_CHDIR</span><br><span class="hljs-comment">#alias</span><br><span class="hljs-comment">#443</span><br><br><span class="hljs-attribute">user</span> root;<br><span class="hljs-section">events</span> &#123;<br><span class="hljs-attribute">worker_connections</span>  <span class="hljs-number">1024</span>;<br>&#125;<br><span class="hljs-section">http</span> &#123;<br>    <span class="hljs-attribute">include</span>       mime.types;<br>    <span class="hljs-attribute">include</span> /etc/nginx/conf.d/<span class="hljs-regexp">*.conf</span>; <span class="hljs-comment">#ä¸»è¦æ˜¯è¿™ä¸ªåœ°æ–¹ï¼ŒæŠŠæ–°å»ºçš„é…ç½®æ–‡ä»¶åŒ…å«è¿›æ¥</span><br>    <span class="hljs-attribute">default_type</span>  application/octet-stream;<br>    <span class="hljs-attribute">sendfile</span>        <span class="hljs-literal">on</span>;<br>    <span class="hljs-section">server</span> &#123;<br>        <span class="hljs-attribute">listen</span>       <span class="hljs-number">80</span>;<br>        <span class="hljs-attribute">server_name</span>  åŸŸå;<br>        <span class="hljs-attribute">charset</span> utf-<span class="hljs-number">8</span>;<br>        <span class="hljs-attribute">location</span> / &#123;<br>           <span class="hljs-attribute">include</span> uwsgi_params;<br>           <span class="hljs-attribute">uwsgi_pass</span> <span class="hljs-number">127.0.0.1:8080</span>;<br>           <span class="hljs-attribute">uwsgi_param</span> UWSGI_SCRIPT xxx.wsgi;<br>           <span class="hljs-attribute">uwsgi_param</span> UWSGI_CHDIR /home/ubuntu/xxx/; <span class="hljs-comment">#é¡¹ç›®è·¯å¾„</span><br>        <span class="hljs-attribute">location</span> /static/ &#123;<br>            <span class="hljs-attribute">alias</span> /home/ubuntu/xxx/static/; <span class="hljs-comment">#é™æ€èµ„æºè·¯å¾„</span><br>            &#125;<br>        &#125;<br>        <span class="hljs-attribute">rewrite</span><span class="hljs-regexp"> ^(.*)$</span>  https://$host<span class="hljs-variable">$1</span> <span class="hljs-literal">permanent</span>;<br>    &#125;<br><br>    <span class="hljs-section">server</span> &#123;<br>      <span class="hljs-attribute">listen</span> <span class="hljs-number">443</span> ssl;<br>      <span class="hljs-attribute">server_name</span> bree.vip;<br>      <span class="hljs-attribute">ssl</span> <span class="hljs-literal">on</span>;<br>      <span class="hljs-attribute">ssl_certificate</span> /etc/nginx/ssl/xxx.crt; <span class="hljs-comment">#è¿™é‡Œæ˜¯ssl keyæ–‡ä»¶å­˜æ”¾çš„ç»å¯¹è·¯å¾„ï¼Œæ ¹æ®è‡ªå·±çš„æ–‡ä»¶åç§°å’Œè·¯å¾„æ¥å†™</span><br>      <span class="hljs-attribute">ssl_certificate_key</span> /etc/nginx/ssl/xxx.key; <span class="hljs-comment">#è¿™é‡Œæ˜¯ssl pemæ–‡ä»¶å­˜æ”¾çš„ç»å¯¹è·¯å¾„ï¼Œæ ¹æ®è‡ªå·±çš„æ–‡ä»¶åç§°å’Œè·¯å¾„æ¥å†™</span><br>      <span class="hljs-attribute">ssl_session_cache</span> shared:SSL:<span class="hljs-number">1m</span>;<br>      <span class="hljs-attribute">ssl_session_timeout</span> <span class="hljs-number">5m</span>;<br>      <span class="hljs-attribute">ssl_ciphers</span> HIGH:!aNULL:!MD5;<br>      <span class="hljs-attribute">ssl_prefer_server_ciphers</span> <span class="hljs-literal">on</span>;<br>      <span class="hljs-attribute">location</span> / &#123;<br>             <span class="hljs-attribute">include</span> uwsgi_params;<br>             <span class="hljs-attribute">uwsgi_pass</span> <span class="hljs-number">127.0.0.1:8080</span>;<br>             <span class="hljs-attribute">uwsgi_param</span> UWSGI_SCRIPT xxx.wsgi;<br>             <span class="hljs-attribute">uwsgi_param</span> UWSGI_CHDIR /home/ubuntu/xxx/; <span class="hljs-comment">#é¡¹ç›®è·¯å¾„</span><br><br>             <span class="hljs-attribute">location</span> /static/ &#123;<br>                 <span class="hljs-attribute">alias</span> /home/ubuntu/xxx/static/; <span class="hljs-comment">#é™æ€èµ„æºè·¯å¾„</span><br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br><br><br></code></pre></div></td></tr></table></figure><h2 id="åœ¨-etc-nginx-ä¸‹æœ‰ä¸ªconf-dæ–‡ä»¶å¤¹-å¯ä»¥åœ¨é‡Œé¢æ”¾å¤šä¸ª-confé…ç½®æ–‡ä»¶âœ"><a href="#åœ¨-etc-nginx-ä¸‹æœ‰ä¸ªconf-dæ–‡ä»¶å¤¹-å¯ä»¥åœ¨é‡Œé¢æ”¾å¤šä¸ª-confé…ç½®æ–‡ä»¶âœ" class="headerlink" title="åœ¨/etc/nginx/ä¸‹æœ‰ä¸ªconf.dæ–‡ä»¶å¤¹ å¯ä»¥åœ¨é‡Œé¢æ”¾å¤šä¸ª*.confé…ç½®æ–‡ä»¶âœ"></a><font color="#008080">åœ¨/etc/nginx/ä¸‹æœ‰ä¸ªconf.dæ–‡ä»¶å¤¹ å¯ä»¥åœ¨é‡Œé¢æ”¾å¤šä¸ª*.confé…ç½®æ–‡ä»¶âœ</font></h2><figure class="highlight nginx"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs nginx"><span class="hljs-comment">##### æ³¨æ„ å½“å‰çš„é…ç½® å°±æ˜¯ç¬¬äºŒä¸ªç«™ç‚¹(é¡¹ç›®)çš„</span><br><span class="hljs-comment">##### å½“å‰åªéœ€è¦ server&#123;&#125; å³å¯ å› nginx.confé‡Œé¢é…ç½®äº†include /etc/nginx/conf.d/*.conf</span><br><br><br><span class="hljs-section">server</span> &#123;<br>        <span class="hljs-attribute">listen</span>       <span class="hljs-number">80</span>;<br>        <span class="hljs-attribute">server_name</span>  ç¬¬äºŒä¸ªé¡¹ç›®çš„åŸŸå;<br>        <span class="hljs-attribute">charset</span> utf-<span class="hljs-number">8</span>;<br>        <span class="hljs-attribute">location</span> / &#123;<br>           <span class="hljs-attribute">include</span> uwsgi_params;<br>           <span class="hljs-attribute">uwsgi_pass</span> <span class="hljs-number">127.0.0.1:8888</span>;<br>           <span class="hljs-attribute">uwsgi_param</span> UWSGI_SCRIPT xxx.wsgi;<br>           <span class="hljs-attribute">uwsgi_param</span> UWSGI_CHDIR /home/ubuntu/xxx/; <span class="hljs-comment">#é¡¹ç›®è·¯å¾„</span><br>        <span class="hljs-attribute">location</span> /static/ &#123;<br>            <span class="hljs-attribute">alias</span> /home/ubuntu/xxx/static/; <span class="hljs-comment">#é™æ€èµ„æºè·¯å¾„</span><br>            &#125;<br>        &#125;<br>        <span class="hljs-attribute">rewrite</span><span class="hljs-regexp"> ^(.*)$</span>  https://$host<span class="hljs-variable">$1</span> <span class="hljs-literal">permanent</span>;<br>    &#125;<br><br>    <span class="hljs-section">server</span> &#123;<br>      <span class="hljs-attribute">listen</span> <span class="hljs-number">443</span> ssl;<br>      <span class="hljs-attribute">server_name</span> ç¬¬äºŒä¸ªé¡¹ç›®çš„åŸŸå;<br>      <span class="hljs-attribute">ssl</span> <span class="hljs-literal">on</span>;<br>      <span class="hljs-attribute">ssl_certificate</span> /etc/nginx/ssl/xxx.crt; <span class="hljs-comment">#è¿™é‡Œæ˜¯ç¬¬äºŒä¸ªé¡¹ç›®çš„sslè¯ä¹¦crt</span><br>      <span class="hljs-attribute">ssl_certificate_key</span> /etc/nginx/ssl/xxx.key; <span class="hljs-comment">#è¿™é‡Œæ˜¯ç¬¬äºŒä¸ªé¡¹ç›®çš„sslè¯ä¹¦key</span><br>      <span class="hljs-attribute">ssl_session_cache</span> shared:SSL:<span class="hljs-number">1m</span>;<br>      <span class="hljs-attribute">ssl_session_timeout</span> <span class="hljs-number">5m</span>;<br>      <span class="hljs-attribute">ssl_ciphers</span> HIGH:!aNULL:!MD5;<br>      <span class="hljs-attribute">ssl_prefer_server_ciphers</span> <span class="hljs-literal">on</span>;<br>      <span class="hljs-attribute">location</span> / &#123;<br>             <span class="hljs-attribute">include</span> uwsgi_params;<br>             <span class="hljs-attribute">uwsgi_pass</span> <span class="hljs-number">127.0.0.1:8888</span>;<br>             <span class="hljs-attribute">uwsgi_param</span> UWSGI_SCRIPT xxx.wsgi;<br>             <span class="hljs-attribute">uwsgi_param</span> UWSGI_CHDIR /home/ubuntu/xxx/; <span class="hljs-comment">#é¡¹ç›®è·¯å¾„</span><br><br>             <span class="hljs-attribute">location</span> /static/ &#123;<br>                 <span class="hljs-attribute">alias</span> /home/ubuntu/xxx/static/; <span class="hljs-comment">#é™æ€èµ„æºè·¯å¾„</span><br>            &#125;<br>        &#125;<br>    &#125;<br></code></pre></div></td></tr></table></figure><h2 id="nginx-amp-uwsgiçš„å¼€å¯âœ"><a href="#nginx-amp-uwsgiçš„å¼€å¯âœ" class="headerlink" title="nginx&amp;uwsgiçš„å¼€å¯âœ"></a><font color="#008080">nginx&amp;uwsgiçš„å¼€å¯âœ</font></h2><p><code>æ£€æµ‹nginxæ˜¯å¦é…ç½®æˆåŠŸ å‘½ä»¤:sudo nginx -t</code></p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash">æ³¨æ„æƒé™</span><br>(django2) ubuntu@VM-8-16-ubuntu:/etc/nginx$ sudo nginx -t<br><br>nginx: the configuration file /etc/nginx/nginx.conf syntax is ok<br>nginx: configuration file /etc/nginx/nginx.conf test is successful<br></code></pre></div></td></tr></table></figure><p><strong><code>é‡å¯æˆ–è€…å¯åŠ¨nginx å‘½ä»¤:sudo /etc/init.d/nginx restart</code></strong></p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash">å¦‚æœä¹‹å‰å¼€å¯ç€nginx</span><br>(django2) ubuntu@VM-8-16-ubuntu:/etc/nginx/conf.d$ sudo /etc/init.d/nginx restart<br><br>[ ok ] Restarting nginx (via systemctl): nginx.service.<br><br><span class="hljs-meta">#</span><span class="bash">å¼€å¯ å‘½ä»¤: sudo /etc/init.d/nginx start</span><br>(django2) ubuntu@VM-8-16-ubuntu:/etc/nginx/conf.d$ sudo /etc/init.d/nginx start<br></code></pre></div></td></tr></table></figure><h2 id="ä¸Šä¼ æ–‡ä»¶çš„å¤§å°é™åˆ¶-Nginxâœ"><a href="#ä¸Šä¼ æ–‡ä»¶çš„å¤§å°é™åˆ¶-Nginxâœ" class="headerlink" title="ä¸Šä¼ æ–‡ä»¶çš„å¤§å°é™åˆ¶-Nginxâœ"></a><font color="#008080">ä¸Šä¼ æ–‡ä»¶çš„å¤§å°é™åˆ¶-Nginxâœ</font></h2><figure class="highlight nginx"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs nginx"><span class="hljs-comment">#åœ¨nginx.confæ–‡ä»¶é‡Œé¢ æ–°å¢é…ç½®</span><br><br>client_max_body_size 8M;(é…ç½®è¯·æ±‚ä½“ç¼“å­˜åŒºå¤§å°, ä¸é…çš„è¯) <br>client_body_buffer_size 128k;(è®¾ç½®å®¢æˆ·ç«¯è¯·æ±‚ä½“æœ€å¤§å€¼) <br><span class="hljs-attribute">fastcgi_intercept_errors</span> <span class="hljs-literal">on</span>;<br><br><span class="hljs-comment">#é‡å¯Nginxå³å¯ sudo /etc/init.d/nginx start</span><br></code></pre></div></td></tr></table></figure><blockquote><p><code>æ³¨æ„å¼€æ”¾ç«¯å£ 8888</code></p></blockquote>]]></content>
    
    
    <categories>
      
      <category>Python</category>
      
      <category>Linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Python SPAPI-Order</title>
    <link href="/2021/03/25/SPAPI-Order/"/>
    <url>/2021/03/25/SPAPI-Order/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h2 id="Oauth-URLâœ"><a href="#Oauth-URLâœ" class="headerlink" title="Oauth URLâœ"></a><font color="#008080">Oauth URLâœ</font></h2><figure class="highlight"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs nginx">è¯·æ±‚â€œä½¿ç”¨äºšé©¬é€Šè´¦æˆ·ç™»å½•â€è®¿é—®ä»¤ç‰Œ<br>â€œä½¿ç”¨äºšé©¬é€Šè´¦æˆ·ç™»å½•â€(LWA) è®¿é—®ä»¤ç‰Œæˆæƒæ‚¨çš„åº”ç”¨ç¨‹åºä»£è¡¨å–å®¶æ‰§è¡ŒæŸäº›æ“ä½œã€‚LWA è®¿é—®ä»¤ç‰Œåœ¨å‘å‡ºåä¸€å°æ—¶è¿‡æœŸï¼Œå¹¶ä¸”å¿…é¡»åŒ…å«åœ¨é”€å”®ä¼™ä¼´ API çš„æ¯ä¸ªè¯·æ±‚ä¸­ã€‚<br>è¦è¯·æ±‚ LWA è®¿é—®ä»¤ç‰Œï¼Œè¯·ä½¿ç”¨ä»¥ä¸‹å‚æ•°å‘ LWA èº«ä»½éªŒè¯æœåŠ¡å™¨ (https://api.amazon.com/auth/o2/token) åˆ›å»ºä¸€ä¸ªå®‰å…¨çš„ HTTP POSTï¼š<br>å½“å‰ä½¿ç”¨çš„postmanæµ‹è¯•æ¥å£<br>postmané‡Œé¢çš„ Authorization --&gt; é€‰æ‹© AWS Signature --&gt; è¾“å…¥ ARNç”¨æˆ·çš„å¯†é’¥<br></code></pre></div></td></tr></table></figure><p><strong>Request:â˜Ÿ</strong></p><table><thead><tr><th>URL</th><th><a href="https://api.amazon.com/auth/o2/token">https://api.amazon.com/auth/o2/token</a></th></tr></thead><tbody><tr><td><strong>Message</strong></td><td>LWA è®¿é—®ä»¤ç‰Œ æˆæƒæ‚¨çš„é”€å”®ä¼™ä¼´APIçš„è¯·æ±‚</td></tr><tr><td><strong>Request</strong></td><td><strong>POST</strong></td></tr><tr><td><strong>URI</strong></td><td><strong>/api.amazon.com/auth/o2/token</strong></td></tr></tbody></table><p><strong>Parameters:â˜Ÿ</strong></p><table><thead><tr><th>KEY</th><th align="left">VALUE</th></tr></thead><tbody><tr><td>grant_type</td><td align="left">refresh_token</td></tr><tr><td>refresh_token</td><td align="left">Atzr|IwEBIFNEIiJG5i3qh6b_J</td></tr><tr><td>client_id</td><td align="left">amzn1.application-oa2-xxxxxxxxxxxxxx</td></tr><tr><td>client_secret</td><td align="left">3e43xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxa0</td></tr></tbody></table><p><strong>Information to be added to the header:â˜Ÿ</strong></p><table><thead><tr><th>KEY</th><th>VALUE</th></tr></thead><tbody><tr><td>Host</td><td>api.amazon.com</td></tr><tr><td>Content-Type</td><td>application/x-www-form-urlencoded;charset=UTF-8</td></tr></tbody></table><p><strong>Example of operating vendor authorization:â˜Ÿ</strong></p><figure class="highlight"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs json">POST /auth/o2/token HTTP/l.l<br>Host: api.amazon.com<br>Content-Type: application/x-www-form-urlencoded;charset=UTF-8<br>grant_type=refresh_token<br>&amp;refresh_token=Aztr|...<br>&amp;client_id=foodevxxxxxxx<br>&amp;client_secret=Y76SDl2Fxxxxx<br></code></pre></div></td></tr></table></figure><p><strong>Return:â˜Ÿ</strong></p><figure class="highlight json"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs json">&#123;<br>    <span class="hljs-attr">&quot;access_token&quot;</span>: <span class="hljs-string">&quot;Atza|IwEBIBHQIw0KdZGloxE8u&quot;</span>,<br>    <span class="hljs-attr">&quot;refresh_token&quot;</span>: <span class="hljs-string">&quot;Atzr|IwEBIFNEIiJG5i3qh6b_&quot;</span>,<br>    <span class="hljs-attr">&quot;token_type&quot;</span>: <span class="hljs-string">&quot;bearer&quot;</span>,<br>    <span class="hljs-attr">&quot;expires_in&quot;</span>: <span class="hljs-number">3600</span><br>&#125;<br></code></pre></div></td></tr></table></figure><h2 id="æ„é€ é”€å”®ä¼™ä¼´api-URLå¸¸ç”¨åŒºåŸŸâœ"><a href="#æ„é€ é”€å”®ä¼™ä¼´api-URLå¸¸ç”¨åŒºåŸŸâœ" class="headerlink" title="æ„é€ é”€å”®ä¼™ä¼´api URLå¸¸ç”¨åŒºåŸŸâœ"></a><font color="#008080">æ„é€ é”€å”®ä¼™ä¼´api URLå¸¸ç”¨åŒºåŸŸâœ</font></h2><figure class="highlight"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs nginx">é”€å”®ä¼™ä¼´ API ç«¯ç‚¹ä¸ç‰¹å®š AWS åŒºåŸŸç›¸å…³è”ã€‚AWS åŒºåŸŸéå¸¸é‡è¦ï¼Œå› ä¸ºå®ƒæ˜¯å‡­è¯èŒƒå›´çš„ä¸€éƒ¨åˆ†ï¼Œæ˜¯åœ¨è°ƒç”¨é”€å”®ä¼™ä¼´ API æ—¶è®¡ç®—ç­¾åæ‰€å¿…éœ€çš„ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œ<br></code></pre></div></td></tr></table></figure><table><thead><tr><th><strong>é”€å”®åŒºåŸŸ</strong></th><th><strong>ç«¯ç‚¹</strong></th><th><strong>AWS åŒºåŸŸ</strong></th></tr></thead><tbody><tr><td>åŒ—ç¾ï¼ˆåŠ æ‹¿å¤§ã€ç¾å›½ã€å¢¨è¥¿å“¥å’Œå·´è¥¿å•†åŸï¼‰</td><td><a href="https://sellingpartnerapi-na.amazon.com/">https://sellingpartnerapi-na.amazon.com</a></td><td>us-east-1</td></tr><tr><td>æ¬§æ´²ï¼ˆè¥¿ç­ç‰™ã€è‹±å›½ã€æ³•å›½ã€è·å…°ã€å¾·å›½ã€æ„å¤§åˆ©ã€åœŸè€³å…¶ã€é˜¿è”é…‹å’Œå°åº¦å•†åŸï¼‰</td><td><a href="https://sellingpartnerapi-eu.amazon.com/">https://sellingpartnerapi-eu.amazon.com</a></td><td>eu-west-1</td></tr><tr><td>è¿œä¸œï¼ˆæ–°åŠ å¡ã€æ¾³å¤§åˆ©äºšå’Œæ—¥æœ¬å•†åŸï¼‰</td><td><a href="https://sellingpartnerapi-fe.amazon.com/">https://sellingpartnerapi-fe.amazon.com</a></td><td>us-west-2</td></tr></tbody></table><p><strong>marketplaceId æ ‡è¯†äº†è¯·æ±‚çš„åœ°åŸŸã€‚â˜Ÿ</strong></p><p><strong>North America(åŒ—ç¾)â˜Ÿ</strong></p><table><thead><tr><th><strong>å›½å®¶/åœ°åŒº</strong></th><th><strong>marketplaceId</strong></th><th><strong>å›½å®¶/åœ°åŒºä»£ç </strong></th></tr></thead><tbody><tr><td>åŠ æ‹¿å¤§(Canada)</td><td>A2EUQ1WTGCTBG2</td><td>CA</td></tr><tr><td>ç¾å›½(United States of America)</td><td>ATVPDKIKX0DER</td><td>US</td></tr><tr><td>å¢¨è¥¿å“¥(Mexico)</td><td>A1AM78C64UM0Y8</td><td>MX</td></tr><tr><td>å·´è¥¿(Brazil)</td><td>A2Q3Y263D00KWC</td><td>BR</td></tr></tbody></table><p><strong>Europe(æ¬§æ´²)â˜Ÿ</strong></p><table><thead><tr><th><strong>å›½å®¶/åœ°åŒº</strong></th><th><strong>marketplaceId</strong></th><th><strong>å›½å®¶/åœ°åŒºä»£ç </strong></th></tr></thead><tbody><tr><td>è¥¿ç­ç‰™(Spain)</td><td>A1RKKUPIHCS9HS</td><td>ES</td></tr><tr><td>è‹±å›½(United Kingdom)</td><td>A1F83G8C2ARO7P</td><td>GB</td></tr><tr><td>æ³•å›½(France)</td><td>A13V1IB3VIYZZH</td><td>FR</td></tr><tr><td>è·å…°(Netherlands)</td><td>A1805IZSGTT6HS</td><td>NL</td></tr><tr><td>å¾·å›½(Germany)</td><td>A1PA6795UKMFR9</td><td>DE</td></tr><tr><td>æ„å¤§åˆ©(Italy)</td><td>APJ6JRA9NG5V4</td><td>IT</td></tr><tr><td>åœŸè€³å…¶(Turkey)</td><td>A33AVAJ2PDY3EV</td><td>TR</td></tr><tr><td>é˜¿æ‹‰ä¼¯è”åˆé…‹é•¿å›½(United Arab Emirates)</td><td>A2VIGQ35RCS4UG</td><td>AE</td></tr><tr><td>å°åº¦(India)</td><td>A21TJRUUN4KGV</td><td>IN</td></tr></tbody></table><p><strong>Far East(è¿œä¸œ)â˜Ÿ</strong></p><table><thead><tr><th><strong>å›½å®¶/åœ°åŒº</strong></th><th><strong>marketplaceId</strong></th><th><strong>å›½å®¶/åœ°åŒºä»£ç </strong></th></tr></thead><tbody><tr><td>æ–°åŠ å¡(Singapore)</td><td>A19VAU5U5O7RUS</td><td>SG</td></tr><tr><td>æ¾³å¤§åˆ©äºš(Australia)</td><td>A39IBJ37TRP1C6</td><td>AU</td></tr><tr><td>æ—¥æœ¬(Japan)</td><td>A1VC38T7YXB528</td><td>JP</td></tr></tbody></table><p><strong>Build the HTTP header contained in the request in the sales partner API URI(æ„é€ è¯·æ±‚)â˜Ÿ</strong></p><table><thead><tr><th><strong>name</strong></th><th><strong>describe</strong></th></tr></thead><tbody><tr><td>host</td><td>å•†åŸç«¯ç‚¹ ä¾‹å¦‚: sellingpartnerapi-na.amazon.com</td></tr><tr><td>x-amz-access-token</td><td>Atza|IwEBIET96fwHjZPkFq8BrGjIKNN9UuqxCluunâ€¦..</td></tr><tr><td>x-amz-date</td><td>è¯·æ±‚çš„æ—¥æœŸå’Œæ—¶é—´ã€‚</td></tr><tr><td>user-agent</td><td>My Selling Tool/2.0 (Language=Java/1.8.0.221;Platform=Windows/10)</td></tr></tbody></table><p><strong>Example of sales partner API request data(è¯·æ±‚ç¤ºä¾‹)â˜Ÿ</strong></p><figure class="highlight"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs json">host: sellingpartnerapi-na.amazon.com<br>user-agentï¼š My Selling Tool/2.0 (Language=Java/1.8.0.221;Platform=Windows/10)<br>x-amz-access-token=Atza|IQEBLjAsAhRmHjNgHpi0U-Dme37rR6CuUpSREXAMPLE<br>x-amz-date: 20201225T123600Z<br></code></pre></div></td></tr></table></figure><h2 id="ç¤ºä¾‹è¯·æ±‚-Order-URLâœ"><a href="#ç¤ºä¾‹è¯·æ±‚-Order-URLâœ" class="headerlink" title="ç¤ºä¾‹è¯·æ±‚ Order URLâœ"></a><font color="#008080">ç¤ºä¾‹è¯·æ±‚ Order URLâœ</font></h2><figure class="highlight"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs nginx">è¿”å›åœ¨æŒ‡å®šå‚æ•°æŒ‡ç¤ºçš„æ—¶é—´èŒƒå›´å†…åˆ›å»ºæˆ–æ›´æ–°çš„è®¢å•ã€‚æ‚¨è¿˜å¯ä»¥åº”ç”¨ä¸€ç³»åˆ—è¿‡æ»¤æ¡ä»¶æ¥ç¼©å°è¿”å›çš„è®¢å•åˆ—è¡¨ã€‚å¦‚æœå­˜åœ¨NextTokenï¼Œå®ƒå°†ç”¨äºæ£€ç´¢è®¢å•è€Œä¸æ˜¯å…¶ä»–æ¡ä»¶ã€‚<br></code></pre></div></td></tr></table></figure><p><strong>Request:â˜Ÿ</strong></p><table><thead><tr><th>URL</th><th><a href="https://sellingpartnerapi-na.amazon.com/orders/v0/orders?MarketplaceIds=ATVPDKIKX0DER&amp;CreatedAfter=2020-06-06">https://sellingpartnerapi-na.amazon.com/orders/v0/orders?MarketplaceIds=ATVPDKIKX0DER&amp;CreatedAfter=2020-06-06</a></th></tr></thead><tbody><tr><td><strong>Message</strong></td><td>è¿”å›æŸæ—¶é—´æ®µå¼€å§‹ä¹‹å æˆ–è€…ä¹‹å‰çš„è®¢å•</td></tr><tr><td><strong>Request</strong></td><td><strong>GET</strong></td></tr><tr><td><strong>URI</strong></td><td><strong>/orders/v0/orders</strong></td></tr></tbody></table><p><strong>Parameter:â˜Ÿ</strong></p><table><thead><tr><th>key</th><th>value</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td>MarketplaceIds</td><td>ATVPDKIKX0DER</td><td>å¸‚åœºç¼–å· MarketplaceIdå€¼çš„åˆ—è¡¨ã€‚ç”¨äºé€‰æ‹©æ”¾ç½®åœ¨æŒ‡å®šå¸‚åœºä¸­çš„è®¢å•ã€‚</td></tr></tbody></table><p><strong>Optional parameters:â˜Ÿ</strong></p><table><thead><tr><th>key</th><th align="center">value</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td><strong>CreatedAfter</strong></td><td align="center">2020-12-25</td><td>ç”¨äºé€‰æ‹©åœ¨æŒ‡å®šæ—¶é—´ä¹‹åï¼ˆæˆ–ä¹‹åï¼‰åˆ›å»ºçš„è®¢å•çš„æ—¥æœŸã€‚ä»…è¿”å›æŒ‡å®šæ—¶é—´ä¹‹åä¸‹çš„è®¢å•ã€‚éœ€è¦CreatedAfterå‚æ•°æˆ–LastUpdatedAfterå‚æ•°ã€‚ä¸¤è€…éƒ½ä¸èƒ½ä¸ºç©ºã€‚æ—¥æœŸå¿…é¡»ä¸ºISO 8601æ ¼å¼ã€‚</td></tr><tr><td><strong>CreatedBefore</strong></td><td align="center">2020-12-25</td><td>ç”¨äºé€‰æ‹©åœ¨æŒ‡å®šæ—¶é—´ä¹‹å‰ï¼ˆæˆ–æŒ‡å®šæ—¶é—´ï¼‰åˆ›å»ºçš„è®¢å•çš„æ—¥æœŸã€‚ä»…è¿”å›æŒ‡å®šæ—¶é—´ä¹‹å‰ä¸‹çš„è®¢å•ã€‚æ—¥æœŸå¿…é¡»ä¸ºISO 8601æ ¼å¼ã€‚</td></tr><tr><td><strong>LastUpdatedAfter</strong></td><td align="center">2020-12-25</td><td>ç”¨äºé€‰æ‹©åœ¨æŒ‡å®šæ—¶é—´ï¼ˆæˆ–ä¹‹åï¼‰æœ€åæ›´æ–°çš„è®¢å•çš„æ—¥æœŸã€‚æ›´æ–°è¢«å®šä¹‰ä¸ºè®¢å•çŠ¶æ€çš„ä»»ä½•æ›´æ”¹ï¼ŒåŒ…æ‹¬åˆ›å»ºæ–°è®¢å•ã€‚åŒ…æ‹¬äºšé©¬é€Šå’Œå–æ–¹æ‰€åšçš„æ›´æ–°ã€‚æ—¥æœŸå¿…é¡»ä¸ºISO 8601æ ¼å¼ã€‚</td></tr><tr><td><strong>LastUpdatedBefore</strong></td><td align="center">2020-12-25</td><td>ç”¨äºé€‰æ‹©åœ¨æŒ‡å®šæ—¶é—´ä¹‹å‰ï¼ˆæˆ–æŒ‡å®šæ—¶é—´ï¼‰æœ€åæ›´æ–°çš„è®¢å•çš„æ—¥æœŸã€‚æ›´æ–°è¢«å®šä¹‰ä¸ºè®¢å•çŠ¶æ€çš„ä»»ä½•æ›´æ”¹ï¼ŒåŒ…æ‹¬åˆ›å»ºæ–°è®¢å•ã€‚åŒ…æ‹¬äºšé©¬é€Šå’Œå–æ–¹æ‰€åšçš„æ›´æ–°ã€‚æ—¥æœŸå¿…é¡»ä¸ºISO 8601æ ¼å¼ã€‚</td></tr><tr><td><strong>OrderStatuses</strong></td><td align="center">Shipped(å·²å‘è´§)</td><td>ç”¨äºè¿‡æ»¤ç»“æœçš„OrderStatuså€¼åˆ—è¡¨ã€‚å¯èƒ½çš„å€¼ï¼šPendingAvailabilityï¼ˆæ­¤çŠ¶æ€ä»…é€‚ç”¨äºé¢„è´­ã€‚å·²ä¸‹è¾¾è®¢å•ï¼Œæœªæˆæƒä»˜æ¬¾ï¼Œå¹¶ä¸”è¯¥å•†å“çš„å‘å¸ƒæ—¥æœŸåœ¨å°†æ¥ã€‚ï¼‰å¾…å¤„ç†ï¼ˆå·²ä¸‹è¾¾è®¢å•ï¼Œä½†æœªæˆæƒä»˜æ¬¾ï¼‰ï¼›æœªå‘è´§ï¼ˆä»˜æ¬¾å·²è¢«æˆæƒä¸”è®¢å•å·²å‡†å¤‡å¥½å‘è´§ï¼Œä½†è®¢å•ä¸­æ²¡æœ‰ä»»ä½•ç‰©å“å·²å‘è´§ï¼‰ï¼›éƒ¨åˆ†å‘è´§ï¼ˆè®¢å•ä¸­çš„ä¸€ä¸ªæˆ–å¤šä¸ªï¼ˆä½†ä¸æ˜¯å…¨éƒ¨ï¼‰ç‰©å“å·²å‘è´§ï¼‰ï¼›å·²å‘è´§ï¼ˆè®¢å•ä¸­çš„æ‰€æœ‰ç‰©å“å‡å·²å‘è´§ï¼‰ï¼›æœªç¡®è®¤çš„å‘ç¥¨ï¼ˆè®¢å•ä¸­çš„æ‰€æœ‰ç‰©å“å‡å·²å‘è´§ã€‚å–æ–¹å°šæœªå‘äºšé©¬é€Šç¡®è®¤å·²å°†å‘ç¥¨å·²å‘è´§ç»™ä¹°æ–¹ã€‚ï¼‰ï¼›å·²å–æ¶ˆï¼ˆè®¢å•å·²è¢«å–æ¶ˆï¼‰ï¼›å’Œæ— æ³•å®ç°ï¼ˆæ— æ³•å®Œæˆè®¢å•ã€‚</td></tr></tbody></table><p><strong>Information to be added to the header:â˜Ÿ</strong></p><table><thead><tr><th>key</th><th>value</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td>x-amz-access-token</td><td>Atza|IwEBIET96fwHjZPkFq8BrGjIKNN</td><td>oauthè®¤è¯åè¿”å›çš„access_token</td></tr><tr><td>Content-Type</td><td>application/json</td><td>jsonæ ¼å¼</td></tr><tr><td>host</td><td>sellingpartnerapi-na.amazon.com</td><td>ç«¯ç‚¹ è¡¨ç¤ºæ˜¯åœ¨æŸåœ°åŒºçš„æ•°æ®</td></tr><tr><td>user-agent</td><td>My Selling Tool/2.0 (Language=Java/1.8.0.221;Platform=Windows/10)</td><td>è¯·æ±‚å¤´ä¿¡æ¯</td></tr></tbody></table><p><strong>403 appears because the server rejected your request:â˜Ÿ</strong></p><figure class="highlight json"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs json">&#123;<br>  <span class="hljs-attr">&quot;errors&quot;</span>: [<br>    &#123;<br>      <span class="hljs-attr">&quot;message&quot;</span>: <span class="hljs-string">&quot;Access to requested resource is denied.&quot;</span>,<br>     <span class="hljs-attr">&quot;code&quot;</span>: <span class="hljs-string">&quot;MissingAuthenticationToken&quot;</span><br>    &#125;<br>  ]<br>&#125;<br></code></pre></div></td></tr></table></figure><p><strong>Return:â˜Ÿ</strong></p><figure class="highlight json"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs json">&#123;<br>    <span class="hljs-attr">&quot;payload&quot;</span>: &#123;<br>        <span class="hljs-attr">&quot;NextToken&quot;</span>: <span class="hljs-string">&quot;w1/DnkAmSzGaJqJYLDm0ZAmQazDrhw3Cfm9r&quot;</span>,<br>        <span class="hljs-attr">&quot;CreatedBefore&quot;</span>: <span class="hljs-string">&quot;2020-12-25T08:54:39Z&quot;</span>,<br>        <span class="hljs-attr">&quot;Orders&quot;</span>: [<br>            &#123;<br>                <span class="hljs-attr">&quot;AmazonOrderId&quot;</span>: <span class="hljs-string">&quot;123-1234567-1234567&quot;</span>,<br>                <span class="hljs-attr">&quot;PurchaseDate&quot;</span>: <span class="hljs-string">&quot;2020-05-30T18:37:46Z&quot;</span>,<br>                <span class="hljs-attr">&quot;LastUpdateDate&quot;</span>: <span class="hljs-string">&quot;2020-06-04T14:58:04Z&quot;</span>,<br>                <span class="hljs-attr">&quot;OrderStatus&quot;</span>: <span class="hljs-string">&quot;Shipped&quot;</span>,<br>                <span class="hljs-attr">&quot;SellerOrderId&quot;</span>: <span class="hljs-string">&quot;123-1234567-1234567&quot;</span>,<br>                <span class="hljs-attr">&quot;FulfillmentChannel&quot;</span>: <span class="hljs-string">&quot;AFN&quot;</span>,<br>                <span class="hljs-attr">&quot;SalesChannel&quot;</span>: <span class="hljs-string">&quot;Amazon.com&quot;</span>,<br>                <span class="hljs-attr">&quot;ShipServiceLevel&quot;</span>: <span class="hljs-string">&quot;Expedited&quot;</span>,<br>                <span class="hljs-attr">&quot;OrderTotal&quot;</span>: &#123;<br>                    <span class="hljs-attr">&quot;CurrencyCode&quot;</span>: <span class="hljs-string">&quot;USD&quot;</span>,<br>                    <span class="hljs-attr">&quot;Amount&quot;</span>: <span class="hljs-string">&quot;7.41&quot;</span><br>                &#125;,<br>                <span class="hljs-attr">&quot;NumberOfItemsShipped&quot;</span>: <span class="hljs-number">1</span>,<br>                <span class="hljs-attr">&quot;NumberOfItemsUnshipped&quot;</span>: <span class="hljs-number">0</span>,<br>                <span class="hljs-attr">&quot;PaymentMethod&quot;</span>: <span class="hljs-string">&quot;Other&quot;</span>,<br>                <span class="hljs-attr">&quot;PaymentMethodDetails&quot;</span>: [<br>                    <span class="hljs-string">&quot;Standard&quot;</span><br>                ],<br>                <span class="hljs-attr">&quot;IsReplacementOrder&quot;</span>: <span class="hljs-string">&quot;false&quot;</span>,<br>                <span class="hljs-attr">&quot;MarketplaceId&quot;</span>: <span class="hljs-string">&quot;ATVPDKIKX0DER&quot;</span>,<br>                <span class="hljs-attr">&quot;ShipmentServiceLevelCategory&quot;</span>: <span class="hljs-string">&quot;Expedited&quot;</span>,<br>                <span class="hljs-attr">&quot;OrderType&quot;</span>: <span class="hljs-string">&quot;StandardOrder&quot;</span>,<br>                <span class="hljs-attr">&quot;EarliestShipDate&quot;</span>: <span class="hljs-string">&quot;2020-06-05T06:59:59Z&quot;</span>,<br>                <span class="hljs-attr">&quot;LatestShipDate&quot;</span>: <span class="hljs-string">&quot;2020-06-05T06:59:59Z&quot;</span>,<br>                <span class="hljs-attr">&quot;IsBusinessOrder&quot;</span>: <span class="hljs-literal">false</span>,<br>                <span class="hljs-attr">&quot;IsSoldByAB&quot;</span>: <span class="hljs-literal">false</span>,<br>                <span class="hljs-attr">&quot;IsPrime&quot;</span>: <span class="hljs-literal">false</span>,<br>                <span class="hljs-attr">&quot;IsGlobalExpressEnabled&quot;</span>: <span class="hljs-literal">false</span>,<br>                <span class="hljs-attr">&quot;IsPremiumOrder&quot;</span>: <span class="hljs-literal">false</span>,<br>                <span class="hljs-attr">&quot;IsISPU&quot;</span>: <span class="hljs-literal">false</span><br>            &#125;,<br>        ]<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><h2 id="æµ‹è¯•-è·å–æŸä¸€ä¸ªè®¢å•çš„è·¯ç”±âœ"><a href="#æµ‹è¯•-è·å–æŸä¸€ä¸ªè®¢å•çš„è·¯ç”±âœ" class="headerlink" title="æµ‹è¯• è·å–æŸä¸€ä¸ªè®¢å•çš„è·¯ç”±âœ"></a><font color="#008080">æµ‹è¯• è·å–æŸä¸€ä¸ªè®¢å•çš„è·¯ç”±âœ</font></h2><p><strong>Request:â˜Ÿ</strong></p><table><thead><tr><th>URL</th><th><a href="https://sellingpartnerapi-na.amazon.com/orders/v0/orders/123-1234567-1234567">https://sellingpartnerapi-na.amazon.com/orders/v0/orders/123-1234567-1234567</a></th></tr></thead><tbody><tr><td><strong>Message</strong></td><td>è¿”å›æŒ‡å®šè®¢å•IDæŒ‡ç¤ºçš„è®¢å•ã€‚</td></tr><tr><td><strong>Request</strong></td><td><strong>GET</strong></td></tr><tr><td><strong>URI</strong></td><td><strong>/orders/v0/orders/{orderId}</strong></td></tr></tbody></table><p><strong>Parameter:â˜Ÿ</strong></p><table><thead><tr><th>key</th><th>value</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td><strong>orderId</strong></td><td>ä¾‹å¦‚: 123-1234567-1234567</td><td>orderIdæ˜¯Amazonå®šä¹‰çš„è®¢å•æ ‡è¯†ç¬¦ï¼Œæ ¼å¼ä¸º3-7-7ã€‚</td></tr></tbody></table><p><strong>403 appears because the server rejected your request:â˜Ÿ</strong></p><figure class="highlight json"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs json">&#123;<br>  <span class="hljs-attr">&quot;errors&quot;</span>: [<br>    &#123;<br>      <span class="hljs-attr">&quot;message&quot;</span>: <span class="hljs-string">&quot;Access to requested resource is denied.&quot;</span>,<br>     <span class="hljs-attr">&quot;code&quot;</span>: <span class="hljs-string">&quot;MissingAuthenticationToken&quot;</span><br>    &#125;<br>  ]<br>&#125;<br></code></pre></div></td></tr></table></figure><p><strong>RETURN:â˜Ÿ</strong></p><figure class="highlight json"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs json">&#123;<br>    <span class="hljs-attr">&quot;payload&quot;</span>: &#123;<br>        <span class="hljs-attr">&quot;AmazonOrderId&quot;</span>: <span class="hljs-string">&quot;114-8958394-7225852&quot;</span>,<br>        <span class="hljs-attr">&quot;PurchaseDate&quot;</span>: <span class="hljs-string">&quot;2020-06-06T00:52:43Z&quot;</span>,<br>        <span class="hljs-attr">&quot;LastUpdateDate&quot;</span>: <span class="hljs-string">&quot;2020-06-08T15:29:12Z&quot;</span>,<br>        <span class="hljs-attr">&quot;OrderStatus&quot;</span>: <span class="hljs-string">&quot;Shipped&quot;</span>,<br>        <span class="hljs-attr">&quot;SellerOrderId&quot;</span>: <span class="hljs-string">&quot;114-8958394-7225852&quot;</span>,<br>        <span class="hljs-attr">&quot;FulfillmentChannel&quot;</span>: <span class="hljs-string">&quot;AFN&quot;</span>,<br>        <span class="hljs-attr">&quot;SalesChannel&quot;</span>: <span class="hljs-string">&quot;Amazon.com&quot;</span>,<br>        <span class="hljs-attr">&quot;ShipServiceLevel&quot;</span>: <span class="hljs-string">&quot;Expedited&quot;</span>,<br>        <span class="hljs-attr">&quot;OrderTotal&quot;</span>: &#123;<br>            <span class="hljs-attr">&quot;CurrencyCode&quot;</span>: <span class="hljs-string">&quot;USD&quot;</span>,<br>            <span class="hljs-attr">&quot;Amount&quot;</span>: <span class="hljs-string">&quot;7.45&quot;</span><br>        &#125;,<br>        <span class="hljs-attr">&quot;NumberOfItemsShipped&quot;</span>: <span class="hljs-number">1</span>,<br>        <span class="hljs-attr">&quot;NumberOfItemsUnshipped&quot;</span>: <span class="hljs-number">0</span>,<br>        <span class="hljs-attr">&quot;PaymentMethod&quot;</span>: <span class="hljs-string">&quot;Other&quot;</span>,<br>        <span class="hljs-attr">&quot;PaymentMethodDetails&quot;</span>: [<br>            <span class="hljs-string">&quot;Standard&quot;</span><br>        ],<br>        <span class="hljs-attr">&quot;IsReplacementOrder&quot;</span>: <span class="hljs-literal">false</span>,<br>        <span class="hljs-attr">&quot;MarketplaceId&quot;</span>: <span class="hljs-string">&quot;ATVPDKIKX0DER&quot;</span>,<br>        <span class="hljs-attr">&quot;ShipmentServiceLevelCategory&quot;</span>: <span class="hljs-string">&quot;Expedited&quot;</span>,<br>        <span class="hljs-attr">&quot;OrderType&quot;</span>: <span class="hljs-string">&quot;StandardOrder&quot;</span>,<br>        <span class="hljs-attr">&quot;EarliestShipDate&quot;</span>: <span class="hljs-string">&quot;2020-06-09T06:59:59Z&quot;</span>,<br>        <span class="hljs-attr">&quot;LatestShipDate&quot;</span>: <span class="hljs-string">&quot;2020-06-09T06:59:59Z&quot;</span>,<br>        <span class="hljs-attr">&quot;IsBusinessOrder&quot;</span>: <span class="hljs-literal">false</span>,<br>        <span class="hljs-attr">&quot;IsPrime&quot;</span>: <span class="hljs-literal">false</span>,<br>        <span class="hljs-attr">&quot;IsGlobalExpressEnabled&quot;</span>: <span class="hljs-literal">false</span>,<br>        <span class="hljs-attr">&quot;IsPremiumOrder&quot;</span>: <span class="hljs-literal">false</span>,<br>        <span class="hljs-attr">&quot;IsSoldByAB&quot;</span>: <span class="hljs-literal">false</span>,<br>        <span class="hljs-attr">&quot;IsISPU&quot;</span>: <span class="hljs-literal">false</span><br>    &#125;<br>&#125;<br><br></code></pre></div></td></tr></table></figure><h2 id="æµ‹è¯•-æŸä¸€ä¸ªè®¢å•çš„-ä¹°å®¶ä¿¡æ¯âœ"><a href="#æµ‹è¯•-æŸä¸€ä¸ªè®¢å•çš„-ä¹°å®¶ä¿¡æ¯âœ" class="headerlink" title="æµ‹è¯• æŸä¸€ä¸ªè®¢å•çš„ ä¹°å®¶ä¿¡æ¯âœ"></a><font color="#008080">æµ‹è¯• æŸä¸€ä¸ªè®¢å•çš„ ä¹°å®¶ä¿¡æ¯âœ</font></h2><p><strong>Request:â˜Ÿ</strong></p><table><thead><tr><th>URL</th><th><a href="https://sellingpartnerapi-na.amazon.com/orders/v0/orders/123-1234567-1234567/buyerInfo">https://sellingpartnerapi-na.amazon.com/orders/v0/orders/123-1234567-1234567/buyerInfo</a></th></tr></thead><tbody><tr><td><strong>Message</strong></td><td>è¿”å›æŒ‡å®šè®¢å•IDæŒ‡ç¤ºçš„è®¢å•çš„ä¹°å®¶ä¿¡æ¯ã€‚</td></tr><tr><td><strong>Request</strong></td><td><strong>GET</strong></td></tr><tr><td><strong>URI</strong></td><td><strong>/orders/v0/orders/{orderId}/buyerInfo</strong></td></tr></tbody></table><p><strong>Parameter:â˜Ÿ</strong></p><table><thead><tr><th>key</th><th>value</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td><strong>orderId</strong></td><td>ä¾‹å¦‚: 123-1234567-1234567</td><td>orderIdæ˜¯Amazonå®šä¹‰çš„è®¢å•æ ‡è¯†ç¬¦ï¼Œæ ¼å¼ä¸º3-7-7ã€‚</td></tr></tbody></table><p><strong>403 appears because the server rejected your request:â˜Ÿ</strong></p><figure class="highlight json"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs json">&#123;<br>  <span class="hljs-attr">&quot;errors&quot;</span>: [<br>    &#123;<br>      <span class="hljs-attr">&quot;message&quot;</span>: <span class="hljs-string">&quot;Access to requested resource is denied.&quot;</span>,<br>     <span class="hljs-attr">&quot;code&quot;</span>: <span class="hljs-string">&quot;MissingAuthenticationToken&quot;</span><br>    &#125;<br>  ]<br>&#125;<br></code></pre></div></td></tr></table></figure><p><strong>RETURN:â˜Ÿ</strong></p><figure class="highlight json"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs json">&#123;<br>    <span class="hljs-attr">&quot;payload&quot;</span>: &#123;<br>        <span class="hljs-attr">&quot;AmazonOrderId&quot;</span>: <span class="hljs-string">&quot;123-1234567-1234567&quot;</span>,<br>        <span class="hljs-attr">&quot;BuyerEmail&quot;</span>: <span class="hljs-string">&quot;*********@marketplace.amazon.com&quot;</span><br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><h2 id="æµ‹è¯•è¯·æ±‚-æŸä¸€ä¸ªè®¢å•çš„é€è´§åœ°å€âœ"><a href="#æµ‹è¯•è¯·æ±‚-æŸä¸€ä¸ªè®¢å•çš„é€è´§åœ°å€âœ" class="headerlink" title="æµ‹è¯•è¯·æ±‚ æŸä¸€ä¸ªè®¢å•çš„é€è´§åœ°å€âœ"></a><font color="#008080">æµ‹è¯•è¯·æ±‚ æŸä¸€ä¸ªè®¢å•çš„é€è´§åœ°å€âœ</font></h2><p><strong>Request:â˜Ÿ</strong></p><table><thead><tr><th>URL</th><th><a href="https://sellingpartnerapi-na.amazon.com/orders/v0/orders/123-1234567-1234567/address">https://sellingpartnerapi-na.amazon.com/orders/v0/orders/123-1234567-1234567/address</a></th></tr></thead><tbody><tr><td><strong>Message</strong></td><td>è¿”å›æŒ‡å®šè®¢å•IDæŒ‡ç¤ºçš„è®¢å•çš„é€è´§åœ°å€ã€‚</td></tr><tr><td><strong>Request</strong></td><td><strong>GET</strong></td></tr><tr><td><strong>URI</strong></td><td><strong>/orders/v0/orders/{orderId}/address</strong></td></tr></tbody></table><p><strong>Parameter:â˜Ÿ</strong></p><table><thead><tr><th>key</th><th>value</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td><strong>orderId</strong></td><td>ä¾‹å¦‚: 123-1234567-1234567</td><td>orderIdæ˜¯Amazonå®šä¹‰çš„è®¢å•æ ‡è¯†ç¬¦ï¼Œæ ¼å¼ä¸º3-7-7ã€‚</td></tr></tbody></table><p><strong>403 appears because the server rejected your request:â˜Ÿ</strong></p><figure class="highlight json"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs json">&#123;<br>  <span class="hljs-attr">&quot;errors&quot;</span>: [<br>    &#123;<br>      <span class="hljs-attr">&quot;message&quot;</span>: <span class="hljs-string">&quot;Access to requested resource is denied.&quot;</span>,<br>     <span class="hljs-attr">&quot;code&quot;</span>: <span class="hljs-string">&quot;MissingAuthenticationToken&quot;</span><br>    &#125;<br>  ]<br>&#125;<br></code></pre></div></td></tr></table></figure><p><strong>RETURN:â˜Ÿ</strong></p><figure class="highlight json"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs json">&#123;<br>    <span class="hljs-attr">&quot;payload&quot;</span>: &#123;<br>        <span class="hljs-attr">&quot;AmazonOrderId&quot;</span>: <span class="hljs-string">&quot;123-1234567-1234567&quot;</span>,<br>        <span class="hljs-attr">&quot;ShippingAddress&quot;</span>: &#123;<br>            <span class="hljs-attr">&quot;StateOrRegion&quot;</span>: <span class="hljs-string">&quot;TX&quot;</span>,<br>            <span class="hljs-attr">&quot;PostalCode&quot;</span>: <span class="hljs-string">&quot;xxxx-xxx&quot;</span>,<br>            <span class="hljs-attr">&quot;City&quot;</span>: <span class="hljs-string">&quot;DALLAS&quot;</span>,<br>            <span class="hljs-attr">&quot;CountryCode&quot;</span>: <span class="hljs-string">&quot;US&quot;</span>,<br>            <span class="hljs-attr">&quot;Name&quot;</span>: <span class="hljs-string">&quot;&quot;</span><br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><h2 id="æµ‹è¯•è¯·æ±‚-æŸä¸ªè®¢å•çš„-å•†å“ä¿¡æ¯âœ"><a href="#æµ‹è¯•è¯·æ±‚-æŸä¸ªè®¢å•çš„-å•†å“ä¿¡æ¯âœ" class="headerlink" title="æµ‹è¯•è¯·æ±‚ æŸä¸ªè®¢å•çš„ å•†å“ä¿¡æ¯âœ"></a><font color="#008080">æµ‹è¯•è¯·æ±‚ æŸä¸ªè®¢å•çš„ å•†å“ä¿¡æ¯âœ</font></h2><figure class="highlight"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs nginx">æ³¨æ„ï¼šå½“è®¢å•å¤„äºå¾…å¤„ç†çŠ¶æ€ï¼ˆå·²ä¸‹è¾¾è®¢å•ä½†æœªæˆæƒä»˜æ¬¾ï¼‰æ—¶ï¼ŒgetOrderItemsæ“ä½œä¸ä¼šè¿”å›æœ‰å…³è®¢å•ä¸­è®¢å•é¡¹çš„ä»·æ ¼ï¼Œç¨é‡‘ï¼Œè¿è´¹ï¼Œç¤¼å“çŠ¶æ€æˆ–ä¿ƒé”€çš„ä¿¡æ¯ã€‚è®¢å•ç¦»å¼€å¾…å¤„ç†çŠ¶æ€ï¼ˆæˆæƒä»˜æ¬¾åä¼šå‘ç”Ÿï¼‰å¹¶è¿›å…¥æœªå‘è´§ï¼Œéƒ¨åˆ†å‘è´§æˆ–å·²å‘è´§çŠ¶æ€åï¼ŒgetOrderItemsæ“ä½œå°†è¿”å›æœ‰å…³ä»¥ä¸‹å•†å“çš„ä»·æ ¼ï¼Œç¨é‡‘ï¼Œè¿è´¹ï¼Œç¤¼å“çŠ¶æ€å’Œä¿ƒé”€çš„ä¿¡æ¯å‘½ä»¤ã€‚<br></code></pre></div></td></tr></table></figure><p><strong>Request:â˜Ÿ</strong></p><table><thead><tr><th>URL</th><th><a href="https://sellingpartnerapi-na.amazon.com/orders/v0/orders/123-1234567-1234567/orderItems">https://sellingpartnerapi-na.amazon.com/orders/v0/orders/123-1234567-1234567/orderItems</a></th></tr></thead><tbody><tr><td><strong>Message</strong></td><td>è¿”å›æŒ‡å®šè®¢å•IDæŒ‡ç¤ºçš„è®¢å•çš„è¯¦ç»†è®¢å•å•†å“ä¿¡æ¯ã€‚å¦‚æœæä¾›äº†NextTokenï¼Œåˆ™ç”¨äºæ£€ç´¢è®¢å•é¡¹çš„ä¸‹ä¸€é¡µã€‚</td></tr><tr><td><strong>Request</strong></td><td><strong>GET</strong></td></tr><tr><td><strong>URI</strong></td><td><strong>/ orders / v0 / orders / {orderId} / orderItems</strong></td></tr></tbody></table><p><strong>Parameter:â˜Ÿ</strong></p><table><thead><tr><th>Type</th><th>Name</th><th>Description</th><th>Schema</th></tr></thead><tbody><tr><td><strong>Path</strong></td><td><strong>orderId</strong> <em>required</em></td><td>Amazonå®šä¹‰çš„è®¢å•æ ‡è¯†ç¬¦ï¼Œæ ¼å¼ä¸º3-7-7ã€‚ä¾‹å¦‚: 123-1234567-1234567</td><td>string</td></tr><tr><td><strong>Query</strong></td><td><strong>NextToken</strong> <em>optional</em></td><td>æ‚¨å…ˆå‰è¯·æ±‚çš„å“åº”ä¸­è¿”å›çš„å­—ç¬¦ä¸²ä»¤ç‰Œã€‚</td><td>string</td></tr></tbody></table><p><strong>403 appears because the server rejected your request:â˜Ÿ</strong></p><figure class="highlight json"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs json">&#123;<br>  <span class="hljs-attr">&quot;errors&quot;</span>: [<br>    &#123;<br>      <span class="hljs-attr">&quot;message&quot;</span>: <span class="hljs-string">&quot;Access to requested resource is denied.&quot;</span>,<br>     <span class="hljs-attr">&quot;code&quot;</span>: <span class="hljs-string">&quot;MissingAuthenticationToken&quot;</span><br>    &#125;<br>  ]<br>&#125;<br></code></pre></div></td></tr></table></figure><p><strong>RETURN:â˜Ÿ</strong></p><figure class="highlight json"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs json">&#123;<br>    <span class="hljs-attr">&quot;payload&quot;</span>: &#123;<br>        <span class="hljs-attr">&quot;AmazonOrderId&quot;</span>: <span class="hljs-string">&quot;113-*******-*******&quot;</span>,<br>        <span class="hljs-attr">&quot;OrderItems&quot;</span>: [<br>            &#123;<br>                <span class="hljs-attr">&quot;ASIN&quot;</span>: <span class="hljs-string">&quot;B088KFYF3X&quot;</span>,<br>                <span class="hljs-attr">&quot;OrderItemId&quot;</span>: <span class="hljs-string">&quot;32********&quot;</span>,<br>                <span class="hljs-attr">&quot;SellerSKU&quot;</span>: <span class="hljs-string">&quot;KFK-3&quot;</span>,<br>                <span class="hljs-attr">&quot;Title&quot;</span>: <span class="hljs-string">&quot;Ldealpro message&quot;</span>,<br>                <span class="hljs-attr">&quot;QuantityOrdered&quot;</span>: <span class="hljs-number">1</span>,<br>                <span class="hljs-attr">&quot;QuantityShipped&quot;</span>: <span class="hljs-number">1</span>,<br>                <span class="hljs-attr">&quot;ProductInfo&quot;</span>: &#123;<br>                    <span class="hljs-attr">&quot;NumberOfItems&quot;</span>: <span class="hljs-string">&quot;1&quot;</span><br>                &#125;,<br>                <span class="hljs-attr">&quot;ItemPrice&quot;</span>: &#123;<br>                    <span class="hljs-attr">&quot;CurrencyCode&quot;</span>: <span class="hljs-string">&quot;USD&quot;</span>,<br>                    <span class="hljs-attr">&quot;Amount&quot;</span>: <span class="hljs-string">&quot;6.99&quot;</span><br>                &#125;,<br>                <span class="hljs-attr">&quot;TaxCollection&quot;</span>: &#123;<br>                    <span class="hljs-attr">&quot;Model&quot;</span>: <span class="hljs-string">&quot;MarketplaceFacilitator&quot;</span>,<br>                    <span class="hljs-attr">&quot;ResponsibleParty&quot;</span>: <span class="hljs-string">&quot;Amazon Services, Inc.&quot;</span><br>                &#125;,<br>                <span class="hljs-attr">&quot;ItemTax&quot;</span>: &#123;<br>                    <span class="hljs-attr">&quot;CurrencyCode&quot;</span>: <span class="hljs-string">&quot;USD&quot;</span>,<br>                    <span class="hljs-attr">&quot;Amount&quot;</span>: <span class="hljs-string">&quot;0.58&quot;</span><br>                &#125;,<br>                <span class="hljs-attr">&quot;PromotionDiscount&quot;</span>: &#123;<br>                    <span class="hljs-attr">&quot;CurrencyCode&quot;</span>: <span class="hljs-string">&quot;USD&quot;</span>,<br>                    <span class="hljs-attr">&quot;Amount&quot;</span>: <span class="hljs-string">&quot;0.00&quot;</span><br>                &#125;,<br>                <span class="hljs-attr">&quot;PromotionDiscountTax&quot;</span>: &#123;<br>                    <span class="hljs-attr">&quot;CurrencyCode&quot;</span>: <span class="hljs-string">&quot;USD&quot;</span>,<br>                    <span class="hljs-attr">&quot;Amount&quot;</span>: <span class="hljs-string">&quot;0.00&quot;</span><br>                &#125;,<br>                <span class="hljs-attr">&quot;IsGift&quot;</span>: <span class="hljs-string">&quot;false&quot;</span>,<br>                <span class="hljs-attr">&quot;IsTransparency&quot;</span>: <span class="hljs-literal">false</span>,<br>                <span class="hljs-attr">&quot;SerialNumberRequired&quot;</span>: <span class="hljs-literal">false</span><br>            &#125;<br>        ]<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><h2 id="æµ‹è¯•è¯·æ±‚æŸä¸ªè®¢å•çš„è®¢å•é¡¹ä¸­çš„ä¹°å®¶ä¿¡æ¯âœ"><a href="#æµ‹è¯•è¯·æ±‚æŸä¸ªè®¢å•çš„è®¢å•é¡¹ä¸­çš„ä¹°å®¶ä¿¡æ¯âœ" class="headerlink" title="æµ‹è¯•è¯·æ±‚æŸä¸ªè®¢å•çš„è®¢å•é¡¹ä¸­çš„ä¹°å®¶ä¿¡æ¯âœ"></a><font color="#008080">æµ‹è¯•è¯·æ±‚æŸä¸ªè®¢å•çš„è®¢å•é¡¹ä¸­çš„ä¹°å®¶ä¿¡æ¯âœ</font></h2><p><strong>Request:â˜Ÿ</strong></p><table><thead><tr><th>URL</th><th><a href="https://sellingpartnerapi-na.amazon.com/orders/v0/orders/113-1234567-1234567/orderItems/buyerInfo">https://sellingpartnerapi-na.amazon.com/orders/v0/orders/113-1234567-1234567/orderItems/buyerInfo</a></th></tr></thead><tbody><tr><td><strong>Message</strong></td><td>è¿”å›æŒ‡å®šè®¢å•IDæŒ‡ç¤ºçš„è®¢å•çš„è®¢å•é¡¹ä¸­çš„ä¹°å®¶ä¿¡æ¯ã€‚</td></tr><tr><td><strong>Request</strong></td><td><strong>GET</strong></td></tr><tr><td><strong>URI</strong></td><td><strong>/orders/v0/orders/{orderId}/orderItems/buyerInfo</strong></td></tr></tbody></table><p><strong>Parameter:â˜Ÿ</strong></p><table><thead><tr><th>Type</th><th>Name</th><th>Description</th><th>Schema</th></tr></thead><tbody><tr><td><strong>Path</strong></td><td><strong>orderId</strong> <em>required</em></td><td>Amazonå®šä¹‰çš„è®¢å•æ ‡è¯†ç¬¦ï¼Œæ ¼å¼ä¸º3-7-7ã€‚ä¾‹å¦‚: 123-1234567-1234567</td><td>string</td></tr><tr><td><strong>Query</strong></td><td><strong>NextToken</strong> <em>optional</em></td><td>æ‚¨å…ˆå‰è¯·æ±‚çš„å“åº”ä¸­è¿”å›çš„å­—ç¬¦ä¸²ä»¤ç‰Œã€‚</td><td>string</td></tr></tbody></table><p><strong>403 appears because the server rejected your request:â˜Ÿ</strong></p><figure class="highlight json"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs json">&#123;<br>  <span class="hljs-attr">&quot;errors&quot;</span>: [<br>    &#123;<br>      <span class="hljs-attr">&quot;message&quot;</span>: <span class="hljs-string">&quot;Access to requested resource is denied.&quot;</span>,<br>     <span class="hljs-attr">&quot;code&quot;</span>: <span class="hljs-string">&quot;MissingAuthenticationToken&quot;</span><br>    &#125;<br>  ]<br>&#125;<br></code></pre></div></td></tr></table></figure><p><strong>RETURN:â˜Ÿ</strong></p><figure class="highlight json"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs json">&#123;<br>    <span class="hljs-attr">&quot;payload&quot;</span>: &#123;<br>        <span class="hljs-attr">&quot;OrderItems&quot;</span>: [<br>            &#123;<br>                <span class="hljs-attr">&quot;OrderItemId&quot;</span>: <span class="hljs-string">&quot;3277********&quot;</span><br>            &#125;<br>        ],<br>        <span class="hljs-attr">&quot;AmazonOrderId&quot;</span>: <span class="hljs-string">&quot;113-*******-*******&quot;</span><br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Python</category>
      
      <category>SPAPI</category>
      
    </categories>
    
    
    <tags>
      
      <tag>spapi</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Python SPAPI-OAUTHè®¤è¯</title>
    <link href="/2021/03/25/spapi-OAUTH%E8%AE%A4%E8%AF%81/"/>
    <url>/2021/03/25/spapi-OAUTH%E8%AE%A4%E8%AF%81/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h2 id="Oauth-è®¤è¯Amazon-access-tokenâ˜Ÿ"><a href="#Oauth-è®¤è¯Amazon-access-tokenâ˜Ÿ" class="headerlink" title="Oauth è®¤è¯Amazon access_tokenâ˜Ÿ"></a><font color="#008080">Oauth è®¤è¯Amazon access_tokenâ˜Ÿ</font></h2><p><code>å‰æƒ…æè¦</code></p><figure class="highlight"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs nginx">é”€å”®ä¼™ä¼´ API æ˜¯ä¸€ä¸ªåŸºäº REST çš„ APIï¼Œäºšé©¬é€Šå–å®¶å¯ä»¥ä½¿ç”¨è¿™äº›æ¥å£ï¼Œä»¥ç¼–ç¨‹æ–¹å¼è®¿é—®ä»–ä»¬æœ‰å…³å•†å“ã€è®¢å•ã€ä»˜æ¬¾ã€æŠ¥å‘Šç­‰çš„æ•°æ®ã€‚ä½¿ç”¨é”€å”®ä¼™ä¼´ API çš„åº”ç”¨ç¨‹åºå¯ä»¥æé«˜é”€å”®æ•ˆç‡ï¼Œå‡å°‘äººåŠ›éœ€æ±‚å¹¶ç¼©çŸ­å“åº”å®¢æˆ·çš„æ—¶é—´ï¼Œä»è€Œå¸®åŠ©å–å®¶å‘å±•ä¸šåŠ¡ã€‚é”€å”®ä¼™ä¼´ API åŸºäºäºšé©¬é€Šå•†åŸç½‘ç»œæœåŠ¡ï¼ˆäºšé©¬é€Š MWSï¼‰çš„åŠŸèƒ½æ„å»ºï¼Œä½†æä¾›äº†ä¸€äº›åŠŸèƒ½ï¼Œå¸®åŠ©å¼€å‘è€…åŠå…¶å–å®¶åˆä½œä¼™ä¼´æé«˜å¯ç”¨æ€§å’Œå®‰å…¨æ€§ã€‚<br></code></pre></div></td></tr></table></figure><blockquote><p>æœ¬ç«  åªä½œä¸ºä¸€äº›è®°å½•</p></blockquote><h3 id="â˜›ç‚¹å‡»æŸ¥çœ‹SP-APIæ–‡æ¡£"><a href="#â˜›ç‚¹å‡»æŸ¥çœ‹SP-APIæ–‡æ¡£" class="headerlink" title="â˜›ç‚¹å‡»æŸ¥çœ‹SP-APIæ–‡æ¡£"></a><a href="https://github.com/amzn/selling-partner-api-docs/tree/main/guides/developer-guide">â˜›ç‚¹å‡»æŸ¥çœ‹SP-APIæ–‡æ¡£</a></h3><h3 id="â˜›ç‚¹å‡»è·å–postman"><a href="#â˜›ç‚¹å‡»è·å–postman" class="headerlink" title="â˜›ç‚¹å‡»è·å–postman"></a><a href="https://www.postman.com/downloads/">â˜›ç‚¹å‡»è·å–postman</a></h3><h2 id="è·å–Access-token"><a href="#è·å–Access-token" class="headerlink" title="è·å–Access_token"></a><font color="#008080">è·å–Access_token</font></h2><p><code>å‰æƒ…æè¦</code></p><figure class="highlight"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs nginx">é€šè¿‡æˆæƒå è·å–è¿”å›çš„å€¼é‡Œé¢ ä¼šå¸¦æœ‰ access_token å‚æ•°çš„å€¼<br>sp-apiæ–‡æ¡£é‡Œé¢å·²ç»ç»™å‡ºäº†ä¸€äº›éœ€è¦çš„å‚æ•°<br></code></pre></div></td></tr></table></figure><h2 id="è¯·æ±‚â€œä½¿ç”¨äºšé©¬é€Šè´¦æˆ·ç™»å½•â€è®¿é—®ä»¤ç‰Œ"><a href="#è¯·æ±‚â€œä½¿ç”¨äºšé©¬é€Šè´¦æˆ·ç™»å½•â€è®¿é—®ä»¤ç‰Œ" class="headerlink" title="è¯·æ±‚â€œä½¿ç”¨äºšé©¬é€Šè´¦æˆ·ç™»å½•â€è®¿é—®ä»¤ç‰Œ"></a><font color="#008080">è¯·æ±‚â€œä½¿ç”¨äºšé©¬é€Šè´¦æˆ·ç™»å½•â€è®¿é—®ä»¤ç‰Œ</font></h2><p><code>è¦è¯·æ±‚ LWA è®¿é—®ä»¤ç‰Œï¼Œè¯·ä½¿ç”¨ä»¥ä¸‹å‚æ•°å‘ LWA èº«ä»½éªŒè¯æœåŠ¡å™¨ åˆ›å»ºä¸€ä¸ªå®‰å…¨çš„è¯·æ±‚</code></p><table><thead><tr><th align="center"><strong>åç§°</strong></th><th align="center"><strong>æè¿°</strong></th><th align="center"><strong>å¿…é¡»é¡¹</strong></th></tr></thead><tbody><tr><td align="center">URL</td><td align="center"><a href="https://api.amazon.com/auth/o2/token">https://api.amazon.com/auth/o2/token</a></td><td align="center">è·å–access_tokençš„URL</td></tr><tr><td align="center"><strong>grant_type</strong></td><td align="center">è¯·æ±‚çš„è®¿é—®æˆæƒç±»å‹ã€‚å€¼ï¼š<br /><em>refresh_token</em>ã€‚è¿™ç”¨äºè°ƒç”¨éœ€è¦å–å®¶æˆæƒçš„æ“ä½œã€‚æ‰€æœ‰é<a href="https://github.com/amzn/selling-partner-api-docs/blob/main/guides/developer-guide/SellingPartnerApiDeveloperGuide(%E4%B8%AD%E6%96%87).md#grantless-operations-1">å…æˆæƒæ“ä½œ</a>çš„æ“ä½œéƒ½éœ€è¦å–å®¶æˆæƒã€‚æŒ‡å®šæ­¤å€¼æ—¶ï¼Œè¯·åŒ…æ‹¬ <em>refresh_token</em> å‚æ•°ã€‚ <em>client_credentials</em>ã€‚è¿™ç”¨äºè°ƒç”¨<a href="https://github.com/amzn/selling-partner-api-docs/blob/main/guides/developer-guide/SellingPartnerApiDeveloperGuide(%E4%B8%AD%E6%96%87).md#grantless-operations-1">å…æˆæƒæ“ä½œ</a>ã€‚æŒ‡å®šæ­¤å€¼æ—¶ï¼Œè¯·åŒ…æ‹¬ <code>scope</code> å‚æ•°ã€‚</td><td align="center">æ˜¯</td></tr><tr><td align="center"><strong>refresh_token</strong></td><td align="center">LWA åˆ·æ–°ä»¤ç‰Œã€‚å½“å–å®¶æˆæƒæ‚¨çš„åº”ç”¨ç¨‹åºæ—¶ï¼Œå¯ä»¥è·å¾—è¯¥å€¼ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…<a href="https://github.com/amzn/selling-partner-api-docs/blob/main/guides/developer-guide/SellingPartnerApiDeveloperGuide(%E4%B8%AD%E6%96%87).md#authorizing-selling-partner-api-applications">æˆæƒé”€å”®ä¼™ä¼´ API åº”ç”¨ç¨‹åº</a>ã€‚</td><td align="center">å¦ã€‚åŒ…æ‹¬ç”¨äºè°ƒç”¨éœ€è¦å–å®¶æˆæƒçš„æ“ä½œçš„ refresh_tokenã€‚å¦‚æœåŒ…å« refresh_tokenï¼Œè¯·ä¸è¦åŒ…å« scopeã€‚</td></tr><tr><td align="center"><strong>scope</strong></td><td align="center">LWA æˆæƒèŒƒå›´ã€‚å€¼ï¼š<br /><em>sellingpartnerapi::notifications</em>ã€‚å¯¹äºé€šçŸ¥ APIã€‚ <em>sellingpartnerapi::migration</em>ã€‚å¯¹äºæˆæƒ APIã€‚</td><td align="center">å¦ã€‚åŒ…å« scope ä»¥è°ƒç”¨ <a href="https://github.com/amzn/selling-partner-api-docs/blob/main/guides/developer-guide/SellingPartnerApiDeveloperGuide(%E4%B8%AD%E6%96%87).md#grantless-operations-1">å…æˆæƒ</a><a href="https://github.com/amzn/selling-partner-api-docs/blob/main/guides/developer-guide/SellingPartnerApiDeveloperGuide(%E4%B8%AD%E6%96%87).md#grantless-operations-1">æ“ä½œ</a>ã€‚å¦‚æœåŒ…å« scopeï¼Œè¯·ä¸è¦åŒ…å« refresh_tokenã€‚</td></tr><tr><td align="center"><strong>client_id</strong></td><td align="center">æ³¨å†Œåº”ç”¨ç¨‹åºæ—¶è·å–è¯¥å€¼ã€‚è¯·å‚é˜…<a href="https://github.com/amzn/selling-partner-api-docs/blob/main/guides/developer-guide/SellingPartnerApiDeveloperGuide(%E4%B8%AD%E6%96%87).md#viewing-your-developer-information">æŸ¥çœ‹æ‚¨çš„å¼€å‘è€…ä¿¡æ¯</a>ã€‚</td><td align="center">æ˜¯</td></tr><tr><td align="center"><strong>client_secret</strong></td><td align="center">æ³¨å†Œåº”ç”¨ç¨‹åºæ—¶è·å–è¯¥å€¼ã€‚è¯·å‚é˜…<a href="https://github.com/amzn/selling-partner-api-docs/blob/main/guides/developer-guide/SellingPartnerApiDeveloperGuide(%E4%B8%AD%E6%96%87).md#viewing-your-developer-information">æŸ¥çœ‹æ‚¨çš„å¼€å‘è€…ä¿¡æ¯</a>ã€‚</td><td align="center">æ˜¯</td></tr></tbody></table><p><code>è°ƒç”¨æˆæƒçš„ç¤ºä¾‹</code></p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">POST /auth/o2/token HTTP/l.l<br>Host: api.amazon.com<br>Content-Type: application/x-www-form-urlencoded;charset=UTF-<span class="hljs-number">8</span><br>grant_type=refresh_token<br>&amp;refresh_token=Aztr|...<br>&amp;client_id=foodev<br>&amp;client_secret=Y76SDl2F<br></code></pre></div></td></tr></table></figure><p><code>æˆåŠŸçš„å“åº”åŒ…æ‹¬ä»¥ä¸‹å€¼ã€‚</code></p><table><thead><tr><th><strong>åç§°</strong></th><th><strong>æè¿°</strong></th></tr></thead><tbody><tr><td><strong>access_token</strong></td><td>LWA è®¿é—®ä»¤ç‰Œã€‚æœ€å¤§å¤§å°ï¼š 2048 å­—èŠ‚ã€‚</td></tr><tr><td><strong>token_type</strong></td><td>è¿”å›çš„ä»¤ç‰Œç±»å‹ã€‚å¿…é¡»æ˜¯ <em>bearer</em>ã€‚</td></tr><tr><td><strong>expires_in</strong></td><td>LWA è®¿é—®ä»¤ç‰Œå¤±æ•ˆä¹‹å‰çš„ç§’æ•°ã€‚</td></tr><tr><td><strong>refresh_token</strong></td><td>æ‚¨åœ¨è¯·æ±‚ä¸­æäº¤çš„ LWA è®¿é—®ä»¤ç‰Œã€‚æœ€å¤§å¤§å°ï¼š 2048 å­—èŠ‚ã€‚</td></tr></tbody></table><figure class="highlight json"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs json">HTTP/l.l 200 OK<br>Content-Type: application/json;charset UTF-8<br>Cache-Control: no-store<br>Pragma:no-cache<br>&#123;<br>  <span class="hljs-attr">&quot;access_token&quot;</span>:<span class="hljs-string">&quot;Atza|IQEBLjAsAhRmHjNgHpi0U-Dme37rR6CuUpSREXAMPLE&quot;</span>,<br>  <span class="hljs-attr">&quot;token_type&quot;</span>:<span class="hljs-string">&quot;bearer&quot;</span>,<br>  <span class="hljs-attr">&quot;expires_in&quot;</span>:<span class="hljs-number">3600</span>,<br>  <span class="hljs-attr">&quot;refresh_token&quot;</span>:<span class="hljs-string">&quot;Atzr|IQEBLzAtAhRPpMJxdwVz2Nn6f2y-tpJX2DeXEXAMPLE&quot;</span><br>&#125;<br></code></pre></div></td></tr></table></figure><blockquote><p>æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·è®¿é—®ã€Šä½¿ç”¨äºšé©¬é€Šè´¦æˆ·ç™»å½•ã€‹æ–‡æ¡£ä¸­çš„<a href="https://developer.amazon.com/docs/login-with-amazon/authorization-code-grant.html">æˆæƒä»£ç æˆæƒ</a>é¡µé¢</p></blockquote><h2 id="æ„é€ é”€å”®ä¼™ä¼´API-URLâ˜Ÿ"><a href="#æ„é€ é”€å”®ä¼™ä¼´API-URLâ˜Ÿ" class="headerlink" title="æ„é€ é”€å”®ä¼™ä¼´API URLâ˜Ÿ"></a><font color="#008080">æ„é€ é”€å”®ä¼™ä¼´API URLâ˜Ÿ</font></h2><p><code>ä»¥ä¸‹ä¸º é”€å”®ä¼™ä¼´api URLçš„å‚æ•°</code></p><table><thead><tr><th><strong>åç§°</strong></th><th><strong>æè¿°</strong></th><th><strong>ç¤ºä¾‹</strong></th></tr></thead><tbody><tr><td>HTTP æ–¹æ³•</td><td><a href="https://github.com/amzn/selling-partner-api-docs/blob/main/guides/developer-guide/SellingPartnerApiDeveloperGuide(%E4%B8%AD%E6%96%87).md#selling-partner-api-http-methods">é”€å”®ä¼™ä¼´ API HTTP æ–¹æ³•</a>ä¹‹ä¸€ã€‚</td><td><code>GET</code></td></tr><tr><td>ç«¯ç‚¹</td><td><a href="https://github.com/amzn/selling-partner-api-docs/blob/main/guides/developer-guide/SellingPartnerApiDeveloperGuide(%E4%B8%AD%E6%96%87).md#Selling_Partner_API_endpoints">é”€å”®ä¼™ä¼´ API ç«¯ç‚¹</a>ã€‚</td><td><code>https://sellingpartnerapi-na.amazon.com</code></td></tr><tr><td>è·¯å¾„</td><td>é”€å”®ä¼™ä¼´ API éƒ¨åˆ†/è¯¥éƒ¨åˆ†çš„ç‰ˆæœ¬å·/èµ„æºã€‚</td><td><code>/fba/inbound/v0/shipments/&#123;shipmentId&#125;/preorder/confirm</code></td></tr><tr><td>æŸ¥è¯¢å­—ç¬¦ä¸²</td><td>æŸ¥è¯¢å‚æ•°ã€‚</td><td><code>?marketplace=ATVPDKIKX0DER</code></td></tr><tr><td>è·¯å¾„å‚æ•°</td><td>è·¯å¾„å‚æ•°</td><td><code>shipmentId1</code></td></tr></tbody></table><p><code>ä¾‹å¦‚:</code></p><figure class="highlight"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">https://sellingpartnerapi-na.amazon.com/orders/v0/orders?MarketplaceIds=ATVPDKIKX0DER&amp;CreatedAfter=2020-06-06<br></code></pre></div></td></tr></table></figure><h2 id="å°†æ ‡å¤´æ·»åŠ åˆ°-URLâ˜Ÿ"><a href="#å°†æ ‡å¤´æ·»åŠ åˆ°-URLâ˜Ÿ" class="headerlink" title="å°†æ ‡å¤´æ·»åŠ åˆ° URLâ˜Ÿ"></a><font color="#008080">å°†æ ‡å¤´æ·»åŠ åˆ° URLâ˜Ÿ</font></h2><p><code>è¯·æ±‚çš„æ ‡å¤´</code></p><table><thead><tr><th><strong>åç§°</strong></th><th><strong>æè¿°</strong></th></tr></thead><tbody><tr><td>host</td><td>å•†åŸç«¯ç‚¹ã€‚è¯·å‚é˜…<a href="https://github.com/amzn/selling-partner-api-docs/blob/main/guides/developer-guide/SellingPartnerApiDeveloperGuide(%E4%B8%AD%E6%96%87).md#selling-partner-api-http-methods">é”€å”®ä¼™ä¼´ API HTTP æ–¹æ³•</a>ã€‚</td></tr><tr><td>x-amz-access-token</td><td>LWA è®¿é—®ä»¤ç‰Œã€‚è¯·å‚é˜…<a href="https://github.com/amzn/selling-partner-api-docs/blob/main/guides/developer-guide/SellingPartnerApiDeveloperGuide(%E4%B8%AD%E6%96%87).md#step-1-request-a-login-with-amazon-access-token">æ­¥éª¤ 1ï¼šè¯·æ±‚â€œä½¿ç”¨äºšé©¬é€Šè´¦æˆ·ç™»å½•â€è®¿é—®ä»¤ç‰Œ</a>ã€‚</td></tr><tr><td>x-amz-date</td><td>è¯·æ±‚çš„æ—¥æœŸå’Œæ—¶é—´ã€‚</td></tr><tr><td>user-agent</td><td>æ‚¨çš„åº”ç”¨ç¨‹åºåç§°å’Œç‰ˆæœ¬å·ã€å¹³å°å’Œç¼–ç¨‹è¯­è¨€ã€‚è¿™äº›å†…å®¹å¯å¸®åŠ©äºšé©¬é€Šè¯Šæ–­å’Œä¿®å¤æ‚¨å¯èƒ½é‡åˆ°çš„æœåŠ¡é—®é¢˜ã€‚è¯·å‚é˜…<a href="https://github.com/amzn/selling-partner-api-docs/blob/main/guides/developer-guide/SellingPartnerApiDeveloperGuide(%E4%B8%AD%E6%96%87).md#include-a-user-agent-header-in-all-requests">åœ¨æ‰€æœ‰è¯·æ±‚ä¸­</a><a href="https://github.com/amzn/selling-partner-api-docs/blob/main/guides/developer-guide/SellingPartnerApiDeveloperGuide(%E4%B8%AD%E6%96%87).md#include-a-user-agent-header-in-all-requests">åŒ…å« User-Agent æ ‡å¤´</a>ã€‚</td></tr></tbody></table><p><code>è¯·æ±‚ç¤ºä¾‹:</code></p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">host: sellingpartnerapi-na.amazon.com<br>user-agentï¼š My Selling Tool/<span class="hljs-number">2.0</span> (Language=Java/<span class="hljs-number">1.8</span><span class="hljs-number">.0</span><span class="hljs-number">.221</span>;Platform=Windows/<span class="hljs-number">10</span>)<br>x-amz-access-token=Atza|IQEBLjAsAhRmHjNgHpi0U-Dme37rR6CuUpSREXAMPLE<br>x-amz-date: 20201224T123600Z<br></code></pre></div></td></tr></table></figure><p><code>è¿”å›å€¼:</code></p><figure class="highlight json"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs json">&#123;<br>    <span class="hljs-attr">&quot;payload&quot;</span>: &#123;<br>        <span class="hljs-attr">&quot;NextToken&quot;</span>: <span class="hljs-string">&quot;MN0DDzXxPWeaJxxx&quot;</span>,<br>        <span class="hljs-attr">&quot;CreatedBefore&quot;</span>: <span class="hljs-string">&quot;2020-12-24T08:09:05Z&quot;</span>,<br>        <span class="hljs-attr">&quot;Orders&quot;</span>: [<br>            &#123;<br>                <span class="hljs-attr">&quot;AmazonOrderId&quot;</span>: <span class="hljs-string">&quot;123-1234567-1234567&quot;</span>,<br>                <span class="hljs-attr">&quot;....&quot;</span><br>            &#125;,<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Python</category>
      
      <category>SPAPI</category>
      
    </categories>
    
    
    <tags>
      
      <tag>spapi</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Python SPAPI-Order</title>
    <link href="/2021/03/25/SPAPI-OAUTH/"/>
    <url>/2021/03/25/SPAPI-OAUTH/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h2 id="Python-AWS-OAuthâœ"><a href="#Python-AWS-OAuthâœ" class="headerlink" title="Python-AWS-OAuthâœ"></a><font color="#008080">Python-AWS-OAuthâœ</font></h2><h2 id="ä½¿ç”¨Pythonç¼–å†™ä¸€ä¸ªè¯·æ±‚è®¤è¯â˜Ÿ"><a href="#ä½¿ç”¨Pythonç¼–å†™ä¸€ä¸ªè¯·æ±‚è®¤è¯â˜Ÿ" class="headerlink" title="ä½¿ç”¨Pythonç¼–å†™ä¸€ä¸ªè¯·æ±‚è®¤è¯â˜Ÿ"></a><font color="#008080">ä½¿ç”¨Pythonç¼–å†™ä¸€ä¸ªè¯·æ±‚è®¤è¯â˜Ÿ</font></h2><figure class="highlight"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs nginx">å‰é¢å·²ç»ä½¿ç”¨PostManæµ‹è¯•æ¥å£<br>æ¥ä¸‹æ¥ä½¿ç”¨Python3.6 Windows-10 ä»¥åŠPythonä¸­çš„æ¨¡å— requests json urllibå®ç°è®¤è¯ç±»æ–¹æ³•<br></code></pre></div></td></tr></table></figure><h2 id="æ ¹æ®æ¥å£æ–‡æ¡£çš„æç¤º-è¯·æ±‚å¤´é¡»æ˜¯x-www-form-urlencoded-charset-UTF-8â˜Ÿ"><a href="#æ ¹æ®æ¥å£æ–‡æ¡£çš„æç¤º-è¯·æ±‚å¤´é¡»æ˜¯x-www-form-urlencoded-charset-UTF-8â˜Ÿ" class="headerlink" title="æ ¹æ®æ¥å£æ–‡æ¡£çš„æç¤º è¯·æ±‚å¤´é¡»æ˜¯x-www-form-urlencoded;charset=UTF-8â˜Ÿ"></a><font color="#008080">æ ¹æ®æ¥å£æ–‡æ¡£çš„æç¤º è¯·æ±‚å¤´é¡»æ˜¯x-www-form-urlencoded;charset=UTF-8â˜Ÿ</font></h2><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment">######### Alex #########</span><br><span class="hljs-comment">######### 2020-12-28 ###</span><br><span class="hljs-comment">######### Python3.6 ####</span><br><br><span class="hljs-comment"># Import package</span><br><span class="hljs-keyword">import</span> requests  <span class="hljs-comment"># pip install requests</span><br><span class="hljs-keyword">import</span> json  <span class="hljs-comment"># pip install json</span><br><span class="hljs-keyword">from</span> urllib <span class="hljs-keyword">import</span> parse  <span class="hljs-comment"># pip install urllib</span><br><br><span class="hljs-comment"># Creation class method</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AWSOauthToToken</span>:</span><br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    Get access_token</span><br><span class="hljs-string">    * Create a class property and call it directly with the class name</span><br><span class="hljs-string">    * headers Custom request header information</span><br><span class="hljs-string">    * host Must be api.amazon.com</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    headers = &#123;<span class="hljs-string">&#x27;Content-Type&#x27;</span>: <span class="hljs-string">&#x27;application/x-www-form-urlencoded;charset=UTF-8&#x27;</span>,<br>               <span class="hljs-string">&#x27;host&#x27;</span>: <span class="hljs-string">&#x27;api.amazon.com&#x27;</span>,<br>               <span class="hljs-string">&#x27;Connection&#x27;</span>: <span class="hljs-string">&#x27;keep-alive&#x27;</span>,<br>               <span class="hljs-string">&#x27;Accept-Encoding&#x27;</span>: <span class="hljs-string">&#x27;gzip, deflate, br&#x27;</span>,<br>               <span class="hljs-string">&#x27;Accept&#x27;</span>: <span class="hljs-string">&#x27;*/*&#x27;</span>&#125;<br>    form_data = &#123;<br>        <span class="hljs-string">&#x27;grant_type&#x27;</span>: <span class="hljs-string">&#x27;refresh_token&#x27;</span>,<br>        <span class="hljs-string">&#x27;refresh_token&#x27;</span>: <span class="hljs-string">&#x27;Atzr|IwEBIFNEIiJG5i3qh6b_xxxxx&#x27;</span>,<br>        <span class="hljs-string">&#x27;client_id&#x27;</span>: <span class="hljs-string">&#x27;amzn1.application-oa2-client.XXXXXXXX&#x27;</span>,<br>        <span class="hljs-string">&#x27;client_secret&#x27;</span>: <span class="hljs-string">&#x27;3eXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX0&#x27;</span><br>    &#125;<br>    url = <span class="hljs-string">&#x27;https://api.amazon.com/auth/o2/token&#x27;</span><br><br></code></pre></div></td></tr></table></figure><h2 id="å®šä¹‰è·å–æ•°æ®çš„æ–¹æ³•å‡½æ•°â˜Ÿ"><a href="#å®šä¹‰è·å–æ•°æ®çš„æ–¹æ³•å‡½æ•°â˜Ÿ" class="headerlink" title="å®šä¹‰è·å–æ•°æ®çš„æ–¹æ³•å‡½æ•°â˜Ÿ"></a><font color="#008080">å®šä¹‰è·å–æ•°æ®çš„æ–¹æ³•å‡½æ•°â˜Ÿ</font></h2><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_content</span>(<span class="hljs-params">self</span>):</span><br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    GET DATA</span><br><span class="hljs-string">    :return:&#123;</span><br><span class="hljs-string">        &#x27;access_token&#x27;:&#x27;Atza|IwEBIP9cKbepuWrnuFpI2jo3hWFRWy....&#x27;,</span><br><span class="hljs-string">        &#x27;refresh_token&#x27;: &#x27;Atzr|IwEBIFNEIiJG5i3qh6b_JqJRmg5e....&#x27;,</span><br><span class="hljs-string">        &#x27;token_type&#x27;: &#x27;bearer&#x27;,</span><br><span class="hljs-string">        &#x27;expires_in&#x27;: 3600</span><br><span class="hljs-string">    &#125;</span><br><span class="hljs-string">    token_type Must be bearer</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    data = parse.urlencode(AWSOauthToToken.form_data)<br>    content = requests.post(url=AWSOauthToToken.url, headers=AWSOauthToToken.headers, data=data).text<br>    content = json.loads(content)<br>    <span class="hljs-keyword">return</span> content<br></code></pre></div></td></tr></table></figure><h2 id="è°ƒç”¨å¹¶æ‰“å°â˜Ÿ"><a href="#è°ƒç”¨å¹¶æ‰“å°â˜Ÿ" class="headerlink" title="è°ƒç”¨å¹¶æ‰“å°â˜Ÿ"></a><font color="#008080">è°ƒç”¨å¹¶æ‰“å°â˜Ÿ</font></h2><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">aws_info = AWSOauthToToken().get_content()<br>print(aws_info)<br><br>---&gt;&gt;&gt;Print<br>&#123;<span class="hljs-string">&#x27;access_token&#x27;</span>: <span class="hljs-string">&#x27;Atza|IwEBIP9cKbepuWrnuFpI2j&#x27;</span>, <br><span class="hljs-string">&#x27;refresh_token&#x27;</span>: <span class="hljs-string">&#x27;Atzr|IwEBIFNEIiJG5i3qh6b_Jq&#x27;</span>, <br><span class="hljs-string">&#x27;token_type&#x27;</span>: <span class="hljs-string">&#x27;bearer&#x27;</span>, <br><span class="hljs-string">&#x27;expires_in&#x27;</span>: <span class="hljs-number">3600</span>&#125;<br></code></pre></div></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Python</category>
      
      <category>SPAPI</category>
      
    </categories>
    
    
    <tags>
      
      <tag>spapi</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>hexo Githubé‡Œé¢Pagesé…ç½®åŸŸå</title>
    <link href="/2021/03/25/pages%E9%85%8D%E7%BD%AE%E5%9F%9F%E5%90%8D/"/>
    <url>/2021/03/25/pages%E9%85%8D%E7%BD%AE%E5%9F%9F%E5%90%8D/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h2 id="Githubé‡Œé¢Pagesé…ç½®åŸŸå"><a href="#Githubé‡Œé¢Pagesé…ç½®åŸŸå" class="headerlink" title="Githubé‡Œé¢Pagesé…ç½®åŸŸå"></a><font color="#027cd8">Githubé‡Œé¢Pagesé…ç½®åŸŸå</font></h2><p><code>å‰æƒ…æè¦</code></p><figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">ä½¿ç”¨hexoæ­å»ºçš„ä¸ªäººåšå®¢ å°†å…¶éƒ¨ç½²åˆ° GitHub Pagesä¸Š<br>ä½¿ç”¨xxx.github.ioå³å¯è®¿é—®åˆ°<br>ç°æ›´æ”¹ ç»‘å®šåŸŸå<br>æºåŸŸå: papyboy.github.io<br>ç°åŸŸå: bree.vip<br>æ³¨æ„: ç äº‘çš„ç»‘å®šåŸŸåéœ€è¦ä»˜è´¹å•Š æ‰€ä»¥é€‰æ‹©æ›´æ”¹ä¸ºGitHub(è®¿é—®å¤ªæ…¢)<br></code></pre></div></td></tr></table></figure><h2 id="1-åœ¨GitHubä¸Šåˆ›å»ºä¸€ä¸ªä»“åº“"><a href="#1-åœ¨GitHubä¸Šåˆ›å»ºä¸€ä¸ªä»“åº“" class="headerlink" title="1. åœ¨GitHubä¸Šåˆ›å»ºä¸€ä¸ªä»“åº“"></a><font color="#027cd8">1. åœ¨GitHubä¸Šåˆ›å»ºä¸€ä¸ªä»“åº“</font></h2><p>å³ä¸Šè§’ new repository ç‚¹å‡»åå¦‚ä¸‹å›¾</p><p><img src="https://ps.ssl.qhmsg.com/t023f7556d0434efc92.jpg" alt="new repository"></p><p>åˆ›å»ºå¥½å å¦‚ä¸‹å›¾ å¤åˆ¶ä»“åº“åœ°å€</p><p><img src="https://ps.ssl.qhmsg.com/t024e56b25facdf0e07.jpg" alt="è·å–åœ°å€"></p><h2 id="2-åŸŸåè§£æ-CNAME"><a href="#2-åŸŸåè§£æ-CNAME" class="headerlink" title="2. åŸŸåè§£æ CNAME"></a><font color="#027cd8">2. åŸŸåè§£æ CNAME</font></h2><blockquote><p>è¿™é‡Œä½¿ç”¨è…¾è®¯äº‘åšç¤ºä¾‹ è®°å½•ç±»å‹éœ€è¦é€‰æ‹©ä¸º CNAME</p></blockquote><h5 id="æ‰¾åˆ°äº‘è§£æ-æ³¨æ„-åŸŸåéœ€è¦å¤‡æ¡ˆ"><a href="#æ‰¾åˆ°äº‘è§£æ-æ³¨æ„-åŸŸåéœ€è¦å¤‡æ¡ˆ" class="headerlink" title="æ‰¾åˆ°äº‘è§£æ æ³¨æ„:åŸŸåéœ€è¦å¤‡æ¡ˆ"></a>æ‰¾åˆ°äº‘è§£æ æ³¨æ„:åŸŸåéœ€è¦å¤‡æ¡ˆ</h5><p><img src="https://ps.ssl.qhmsg.com/t02a91b0679e0044520.jpg" alt="äº‘è§£æ"></p><h5 id="ç‚¹å‡»è§£æ"><a href="#ç‚¹å‡»è§£æ" class="headerlink" title="ç‚¹å‡»è§£æ"></a>ç‚¹å‡»è§£æ</h5><p><img src="https://ae01.alicdn.com/kf/U2e5a22fe9c28412f89be694155dbb44eX.jpg" alt="è§£æ"></p><h5 id="ç‚¹å‡»æ·»åŠ è®°å½•"><a href="#ç‚¹å‡»æ·»åŠ è®°å½•" class="headerlink" title="ç‚¹å‡»æ·»åŠ è®°å½•"></a>ç‚¹å‡»æ·»åŠ è®°å½•</h5><p><img src="https://ae01.alicdn.com/kf/U0e06dac75f05475fa719195b3bb54e91r.jpg" alt="æ·»åŠ è®°å½•"></p><h5 id="æ³¨æ„-å½“å‰ä¸ºå°†åŸŸåæŒ‡å‘å¦ä¸€ä¸ªåŸŸå-æ‰€ä»¥è®°å½•ç±»å‹è¦é€‰æ‹©CNAME"><a href="#æ³¨æ„-å½“å‰ä¸ºå°†åŸŸåæŒ‡å‘å¦ä¸€ä¸ªåŸŸå-æ‰€ä»¥è®°å½•ç±»å‹è¦é€‰æ‹©CNAME" class="headerlink" title="æ³¨æ„ å½“å‰ä¸ºå°†åŸŸåæŒ‡å‘å¦ä¸€ä¸ªåŸŸå æ‰€ä»¥è®°å½•ç±»å‹è¦é€‰æ‹©CNAME"></a>æ³¨æ„ å½“å‰ä¸ºå°†åŸŸåæŒ‡å‘å¦ä¸€ä¸ªåŸŸå æ‰€ä»¥è®°å½•ç±»å‹è¦é€‰æ‹©CNAME</h5><p><img src="https://ae01.alicdn.com/kf/U0fa317dc25da45f2a26098052f5ce07fj.jpg" alt="CNAME"></p><blockquote><p>è®°å½•å€¼ä¸ºxxx.github.io è§£æéœ€è¦ç­‰å¾…10-15åˆ†é’Ÿå·¦å³</p></blockquote><h2 id="3-ä»“åº“é‡Œé¢æ·»åŠ æ–‡ä»¶CNAME"><a href="#3-ä»“åº“é‡Œé¢æ·»åŠ æ–‡ä»¶CNAME" class="headerlink" title="3. ä»“åº“é‡Œé¢æ·»åŠ æ–‡ä»¶CNAME"></a><font color="#027cd8">3. ä»“åº“é‡Œé¢æ·»åŠ æ–‡ä»¶CNAME</font></h2><h5 id="åœ¨settingé‡Œé¢-æ‰¾åˆ°GitHub-Pages-é…ç½®åŸŸåè¿™æ ·ä¼šè‡ªåŠ¨ç”Ÿæˆ-CNAMEæ–‡ä»¶"><a href="#åœ¨settingé‡Œé¢-æ‰¾åˆ°GitHub-Pages-é…ç½®åŸŸåè¿™æ ·ä¼šè‡ªåŠ¨ç”Ÿæˆ-CNAMEæ–‡ä»¶" class="headerlink" title="åœ¨settingé‡Œé¢ æ‰¾åˆ°GitHub Pages é…ç½®åŸŸåè¿™æ ·ä¼šè‡ªåŠ¨ç”Ÿæˆ CNAMEæ–‡ä»¶"></a>åœ¨settingé‡Œé¢ æ‰¾åˆ°GitHub Pages é…ç½®åŸŸåè¿™æ ·ä¼šè‡ªåŠ¨ç”Ÿæˆ CNAMEæ–‡ä»¶</h5><p><img src="https://ae01.alicdn.com/kf/Uc9a7cb9745354b83a7860873588ded36X.jpg" alt="é…ç½®CNAMEæ–‡ä»¶"></p><h2 id="4-hexoé™æ€åšå®¢æäº¤"><a href="#4-hexoé™æ€åšå®¢æäº¤" class="headerlink" title="4. hexoé™æ€åšå®¢æäº¤"></a><font color="#027cd8">4. hexoé™æ€åšå®¢æäº¤</font></h2><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> æ›¿æ¢ä»“åº“åœ°å€å ä¾æ¬¡æ‰§è¡Œå‘½ä»¤</span><br>hexo g<br>hexo d<br><span class="hljs-meta">#</span><span class="bash"> åæ‰“å¼€åŸŸå å°±èƒ½è®¿é—®å•¦</span><br></code></pre></div></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Hexo</category>
      
      <category>Themes</category>
      
    </categories>
    
    
    <tags>
      
      <tag>hexo</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Nginxéƒ¨ç½²SSLè¯ä¹¦</title>
    <link href="/2021/03/25/nginx%E9%85%8D%E7%BD%AEhttps%E8%AF%81%E4%B9%A6/"/>
    <url>/2021/03/25/nginx%E9%85%8D%E7%BD%AEhttps%E8%AF%81%E4%B9%A6/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h2 id="æ ¹æ®å‰æ–‡-å°†SSLè¯ä¹¦éƒ¨ç½²è‡³Nginx"><a href="#æ ¹æ®å‰æ–‡-å°†SSLè¯ä¹¦éƒ¨ç½²è‡³Nginx" class="headerlink" title="æ ¹æ®å‰æ–‡ å°†SSLè¯ä¹¦éƒ¨ç½²è‡³Nginx"></a><font color="#008080">æ ¹æ®å‰æ–‡ å°†SSLè¯ä¹¦éƒ¨ç½²è‡³Nginx</font></h2><p><code>å‰æƒ…æè¦</code></p><figure class="highlight"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs nginx">æœ¬ç« ä½¿ç”¨çš„SSLè¯ä¹¦ä¸º è…¾è®¯äº‘(ä½†å…¶å®åŸºæœ¬éƒ½ä¸€æ · å°±æ˜¯åç¼€ä¸åŒ)<br>åœ¨ä½¿ç”¨æˆ‘è¿™ä¸ªéƒ¨ç½²æ•™ç¨‹çš„åŸºç¡€ä¸Šéƒ¨ç½²SSLè¯ä¹¦ï¼Œæ€»æ˜¯é‡åˆ°ä¸å°‘å‘ã€‚æˆ‘åœ¨è¿™è¡¥å……ä¸€ä¸‹é…ç½®SSLè¯ä¹¦çš„æ–¹æ³•ï¼Œä¾›å¤§å®¶å‚è€ƒã€‚<br></code></pre></div></td></tr></table></figure><h3 id="åœ¨-etc-nginx-æ–‡ä»¶å¤¹ä¸‹-æ–°å»ºä¸€ä¸ªå‚¨å­˜SSLè¯ä¹¦çš„æ–‡ä»¶å¤¹"><a href="#åœ¨-etc-nginx-æ–‡ä»¶å¤¹ä¸‹-æ–°å»ºä¸€ä¸ªå‚¨å­˜SSLè¯ä¹¦çš„æ–‡ä»¶å¤¹" class="headerlink" title="åœ¨ /etc/nginx/ æ–‡ä»¶å¤¹ä¸‹ æ–°å»ºä¸€ä¸ªå‚¨å­˜SSLè¯ä¹¦çš„æ–‡ä»¶å¤¹"></a>åœ¨ /etc/nginx/ æ–‡ä»¶å¤¹ä¸‹ æ–°å»ºä¸€ä¸ªå‚¨å­˜SSLè¯ä¹¦çš„æ–‡ä»¶å¤¹</h3><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">uuu@u:/etc/nginx$ mkdir ssl<br><span class="hljs-meta">&gt;</span><span class="bash"> æ³¨æ„æƒé™ sudo mkdir ssl</span><br></code></pre></div></td></tr></table></figure><h3 id="å°†è…¾è®¯äº‘ä¸Šä¸‹è½½çš„è¯ä¹¦-æ‰¾åˆ°nginxçš„-ä¸Šä¼ åˆ°sslæ–‡ä»¶å¤¹é‡Œé¢-å¦‚æœæƒé™ä¸å¤Ÿ-å°±æ”¾åœ¨-home-ä¸‹-ç„¶åå‰ªåˆ‡è¿‡å»å°±è¡Œäº†"><a href="#å°†è…¾è®¯äº‘ä¸Šä¸‹è½½çš„è¯ä¹¦-æ‰¾åˆ°nginxçš„-ä¸Šä¼ åˆ°sslæ–‡ä»¶å¤¹é‡Œé¢-å¦‚æœæƒé™ä¸å¤Ÿ-å°±æ”¾åœ¨-home-ä¸‹-ç„¶åå‰ªåˆ‡è¿‡å»å°±è¡Œäº†" class="headerlink" title="å°†è…¾è®¯äº‘ä¸Šä¸‹è½½çš„è¯ä¹¦ æ‰¾åˆ°nginxçš„ ä¸Šä¼ åˆ°sslæ–‡ä»¶å¤¹é‡Œé¢ å¦‚æœæƒé™ä¸å¤Ÿ å°±æ”¾åœ¨/home/ä¸‹ ç„¶åå‰ªåˆ‡è¿‡å»å°±è¡Œäº†"></a>å°†è…¾è®¯äº‘ä¸Šä¸‹è½½çš„è¯ä¹¦ æ‰¾åˆ°nginxçš„ ä¸Šä¼ åˆ°sslæ–‡ä»¶å¤¹é‡Œé¢ å¦‚æœæƒé™ä¸å¤Ÿ å°±æ”¾åœ¨/home/ä¸‹ ç„¶åå‰ªåˆ‡è¿‡å»å°±è¡Œäº†</h3><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">uuu@u:/etc/nginx$ sudo mv ./xxx.key xxx.crt åé¢è·Ÿsslæ–‡ä»¶å¤¹è·¯å¾„ ä¾‹å¦‚ /etc/nginx/ssl/<br></code></pre></div></td></tr></table></figure><h3 id="ä¸Šè¿°æ­¥éª¤å®Œæˆå-å°±å¯ä»¥é‡æ–°æ„é€ ä½ çš„nginx-confæ–‡ä»¶äº†-å…ˆå±•ç¤ºä¸€ä¸‹ä¹‹å‰çš„nginxé…ç½®æ–‡ä»¶"><a href="#ä¸Šè¿°æ­¥éª¤å®Œæˆå-å°±å¯ä»¥é‡æ–°æ„é€ ä½ çš„nginx-confæ–‡ä»¶äº†-å…ˆå±•ç¤ºä¸€ä¸‹ä¹‹å‰çš„nginxé…ç½®æ–‡ä»¶" class="headerlink" title="ä¸Šè¿°æ­¥éª¤å®Œæˆå å°±å¯ä»¥é‡æ–°æ„é€ ä½ çš„nginx.confæ–‡ä»¶äº† å…ˆå±•ç¤ºä¸€ä¸‹ä¹‹å‰çš„nginxé…ç½®æ–‡ä»¶"></a>ä¸Šè¿°æ­¥éª¤å®Œæˆå å°±å¯ä»¥é‡æ–°æ„é€ ä½ çš„nginx.confæ–‡ä»¶äº† å…ˆå±•ç¤ºä¸€ä¸‹ä¹‹å‰çš„nginxé…ç½®æ–‡ä»¶</h3><figure class="highlight nginx"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs nginx">uuu@u:/etc/nginx$ sudo vim nginx.conf<br><br><br><span class="hljs-comment"># ä¹‹å‰çš„nginxé…ç½®</span><br><span class="hljs-attribute">user</span> root;<br><span class="hljs-section">events</span> &#123;<br><span class="hljs-attribute">worker_connections</span>  <span class="hljs-number">1024</span>;<br>&#125;<br><span class="hljs-section">http</span> &#123;<br>    <span class="hljs-attribute">include</span>       mime.types;<br>    <span class="hljs-attribute">default_type</span>  application/octet-stream;<br>    <span class="hljs-attribute">sendfile</span>        <span class="hljs-literal">on</span>;<br>    <span class="hljs-section">server</span> &#123;<br>        <span class="hljs-attribute">listen</span>       <span class="hljs-number">80</span>;<br>        <span class="hljs-attribute">server_name</span>  åŸŸå/ip;<br>        <span class="hljs-attribute">charset</span> utf-<span class="hljs-number">8</span>;<br>        <span class="hljs-attribute">location</span> / &#123;<br>           <span class="hljs-attribute">include</span> uwsgi_params;<br>           <span class="hljs-attribute">uwsgi_pass</span> <span class="hljs-number">127.0.0.1:8080</span>;<br>           <span class="hljs-attribute">uwsgi_param</span> UWSGI_SCRIPT é¡¹ç›®åç§°.wsgi;<br>           <span class="hljs-attribute">uwsgi_param</span> UWSGI_CHDIR /home/ubuntu/xxx/xxx/; <span class="hljs-comment">#é¡¹ç›®è·¯å¾„</span><br>        <span class="hljs-attribute">location</span> /static/ &#123;<br>            <span class="hljs-attribute">alias</span> /home/ubuntu/xxx/xxx/static/; <span class="hljs-comment">#é™æ€èµ„æºè·¯å¾„</span><br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><h3 id="å¼€å§‹æ”¹é€ æ–‡ä»¶"><a href="#å¼€å§‹æ”¹é€ æ–‡ä»¶" class="headerlink" title="å¼€å§‹æ”¹é€ æ–‡ä»¶"></a>å¼€å§‹æ”¹é€ æ–‡ä»¶</h3><figure class="highlight nginx"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs nginx"><span class="hljs-attribute">user</span> root; <span class="hljs-comment">#åŠ ä¸Šè¯¥å¥ é˜²æ­¢403</span><br><span class="hljs-section">events</span> &#123;<br><span class="hljs-attribute">worker_connections</span>  <span class="hljs-number">1024</span>;<br>&#125;<br><span class="hljs-section">http</span> &#123;<br>    <span class="hljs-attribute">include</span>       mime.types;<br>    <span class="hljs-attribute">default_type</span>  application/octet-stream;<br>    <span class="hljs-attribute">sendfile</span>        <span class="hljs-literal">on</span>;<br>    <span class="hljs-section">server</span> &#123;<br>        <span class="hljs-attribute">listen</span>       <span class="hljs-number">80</span>;<br>        <span class="hljs-attribute">server_name</span>  åŸŸå/ip;<br>        <span class="hljs-attribute">charset</span> utf-<span class="hljs-number">8</span>;<br>        <span class="hljs-attribute">location</span> / &#123;<br>           <span class="hljs-attribute">include</span> uwsgi_params;<br>           <span class="hljs-attribute">uwsgi_pass</span> <span class="hljs-number">127.0.0.1:8080</span>;<br>           <span class="hljs-attribute">uwsgi_param</span> UWSGI_SCRIPT xxx.wsgi;<br>           <span class="hljs-attribute">uwsgi_param</span> UWSGI_CHDIR /home/ubuntu/xxx/xxx/; <span class="hljs-comment">#é¡¹ç›®è·¯å¾„</span><br>           <span class="hljs-attribute">location</span> /static/ &#123;<br>               <span class="hljs-attribute">alias</span> /home/ubuntu/xxx/xxx/static/; <span class="hljs-comment">#é™æ€èµ„æºè·¯å¾„</span><br>            &#125;<br>        &#125;<br>        <span class="hljs-attribute">rewrite</span><span class="hljs-regexp"> ^(.*)$</span>  https://$host<span class="hljs-variable">$1</span> <span class="hljs-literal">permanent</span>; <span class="hljs-comment">#æ­¤å¤„ä¸ºæ–°å¢çš„ æ„å‘³ç€è·å–åˆ°httpçš„è¯·æ±‚ è½¬å‘ç»™https</span><br>    &#125;<br><span class="hljs-comment">#ä»¥ä¸‹ä¸ºæ–°å¢çš„server ä¸»è¦ä¸º443 è·å–SSLè¯ä¹¦</span><br>    <span class="hljs-section">server</span> &#123;<br>      <span class="hljs-attribute">listen</span> <span class="hljs-number">443</span> ssl;<br>      <span class="hljs-attribute">server_name</span> åŸŸå/ip;<br>      <span class="hljs-attribute">ssl</span> <span class="hljs-literal">on</span>;<br>      <span class="hljs-attribute">ssl_certificate</span> /etc/nginx/ssl/xxx.crt; <span class="hljs-comment">#è¿™é‡Œæ˜¯ssl crt(key)æ–‡ä»¶å­˜æ”¾çš„ç»å¯¹è·¯å¾„ ä¸åŒæœåŠ¡å•†è·å–çš„åç¼€ä¸åŒ</span><br>      <span class="hljs-attribute">ssl_certificate_key</span> /etc/nginx/ssl/xxx.key; <span class="hljs-comment">#è¿™é‡Œæ˜¯ssl key(pem)æ–‡ä»¶å­˜æ”¾çš„ç»å¯¹è·¯å¾„ ä¸åŒæœåŠ¡å•†è·å–çš„åç¼€ä¸åŒ</span><br>      <span class="hljs-attribute">ssl_session_cache</span> shared:SSL:<span class="hljs-number">1m</span>;<br>      <span class="hljs-attribute">ssl_session_timeout</span> <span class="hljs-number">5m</span>;<br>      <span class="hljs-attribute">ssl_ciphers</span> HIGH:!aNULL:!MD5;<br>      <span class="hljs-attribute">ssl_prefer_server_ciphers</span> <span class="hljs-literal">on</span>;<br>      <span class="hljs-comment">#ä»¥ä¸‹ è¿™ä¸€æ®µlocationä¹Ÿæ˜¯è¦åŠ çš„ ä¸åŠ çš„è¯ é‡å®šå‘åˆ°nginxçš„ welcomeé¡µé¢å»äº†</span><br>      <span class="hljs-attribute">location</span> / &#123;<br>             <span class="hljs-attribute">include</span> uwsgi_params;<br>             <span class="hljs-attribute">uwsgi_pass</span> <span class="hljs-number">127.0.0.1:8080</span>;<br>             <span class="hljs-attribute">uwsgi_param</span> UWSGI_SCRIPT xxx.wsgi;<br>             <span class="hljs-attribute">uwsgi_param</span> UWSGI_CHDIR /home/ubuntu/xxx/xxx/; <span class="hljs-comment">#é¡¹ç›®è·¯å¾„</span><br>             <span class="hljs-attribute">location</span> /static/ &#123;<br>                 <span class="hljs-attribute">alias</span> /home/ubuntu/xxx/xxx/static/; <span class="hljs-comment">#é™æ€èµ„æºè·¯å¾„</span><br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br><br></code></pre></div></td></tr></table></figure><h3 id="éœ€è¦æ³¨æ„çš„åœ°æ–¹"><a href="#éœ€è¦æ³¨æ„çš„åœ°æ–¹" class="headerlink" title="éœ€è¦æ³¨æ„çš„åœ°æ–¹"></a>éœ€è¦æ³¨æ„çš„åœ°æ–¹</h3><figure class="highlight"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs nginx">ä½¿ç”¨https éœ€è¦ç«¯å£443å¼€æ”¾æ‰èƒ½è®¿é—®çš„ å¦‚æœæœªå¼€å¯ åˆ™éœ€è¦åœ¨æœåŠ¡å™¨æä¾›å•†åå°å®‰å…¨ç»„é‡Œé¢ å°†443æœåŠ¡ç«¯å£å¼€æ”¾å‡ºæ¥<br></code></pre></div></td></tr></table></figure><h4 id="å…³äºSSLè¯ä¹¦çš„ç”³è¯·-å…¶å®å¾ˆç®€å•-å¦‚ä¸ä¼šè·å–-å¯è”ç³»åšä¸»â˜-ç‚¹å‡»è·³è½¬-æˆ–åœ¨ä¸‹æ–¹ç•™è¨€"><a href="#å…³äºSSLè¯ä¹¦çš„ç”³è¯·-å…¶å®å¾ˆç®€å•-å¦‚ä¸ä¼šè·å–-å¯è”ç³»åšä¸»â˜-ç‚¹å‡»è·³è½¬-æˆ–åœ¨ä¸‹æ–¹ç•™è¨€" class="headerlink" title="å…³äºSSLè¯ä¹¦çš„ç”³è¯· å…¶å®å¾ˆç®€å• å¦‚ä¸ä¼šè·å– å¯è”ç³»åšä¸»â˜ ç‚¹å‡»è·³è½¬ æˆ–åœ¨ä¸‹æ–¹ç•™è¨€"></a>å…³äºSSLè¯ä¹¦çš„ç”³è¯· å…¶å®å¾ˆç®€å• å¦‚ä¸ä¼šè·å– å¯è”ç³»åšä¸»<a href="https://bree.vip/about/">â˜ ç‚¹å‡»è·³è½¬</a> æˆ–åœ¨ä¸‹æ–¹ç•™è¨€</h4>]]></content>
    
    
    <categories>
      
      <category>Python</category>
      
      <category>Linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Redis è®¾ç½®å¯†ç </title>
    <link href="/2021/03/25/Redis%E8%AE%BE%E7%BD%AE%E5%AF%86%E7%A0%81/"/>
    <url>/2021/03/25/Redis%E8%AE%BE%E7%BD%AE%E5%AF%86%E7%A0%81/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h2 id="è®°ä¸€æ¬¡è¿œç¨‹è¿æ¥redisçš„æ—¶å€™-è¿æ¥ä¸ä¸Š"><a href="#è®°ä¸€æ¬¡è¿œç¨‹è¿æ¥redisçš„æ—¶å€™-è¿æ¥ä¸ä¸Š" class="headerlink" title="è®°ä¸€æ¬¡è¿œç¨‹è¿æ¥redisçš„æ—¶å€™ è¿æ¥ä¸ä¸Š"></a><font color=" #008080">è®°ä¸€æ¬¡è¿œç¨‹è¿æ¥redisçš„æ—¶å€™ è¿æ¥ä¸ä¸Š</font></h2><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">å°±å¾ˆå¥‡æ€ª, æ˜æ˜æœåŠ¡å™¨é‡Œé¢çš„redisæ²¡æœ‰è®¾ç½®è¿‡å¯†ç  å°±è¿ä½¿ç”¨pythonè¿æ¥çš„æ—¶å€™éƒ½æ²¡æœ‰è¾“å…¥è¿‡å¯†ç è¿æ¥redis è«åå…¶å¦™ä»Šå¤©/<span class="hljs-number">12</span>-07è¿æ¥å‡ºé”™<br></code></pre></div></td></tr></table></figure><p><code>æŠ¥é”™æè¦</code></p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">AUTH ERROR<br>æŠ¥é”™ä¿¡æ¯å·²åˆ é™¤...<br>çœ‹åˆ°è¿™é‡Œ è«åå…¶å¦™ ä»¥å‰è¿æ¥çš„å¥½å¥½çš„ ä¹Ÿæ²¡ä¿®æ”¹è¿‡ä»€ä¹ˆé…ç½®æ–‡ä»¶...<br>Aå›: çœ‹ä¸€ä¸‹èƒ½ä¸èƒ½è¿æ¥ä¸Š?<br>Bå›: ä¸èƒ½ è¿˜æ˜¯ä¸€æ ·çš„é—®é¢˜ AUTH ERROR...<br>Aå›: æˆ‘å»è¿œç¨‹æ£€æŸ¥ä¸€ä¸‹<br></code></pre></div></td></tr></table></figure><p><img src="https://ae01.alicdn.com/kf/U2fd4d49566cf4a07a70b163d790dbb57u.jpg" alt="bugç‹"></p><h2 id="éšå-Aå›-æ¥åˆ°è¿œç¨‹-æŸ¥çœ‹äº†ä¸€ä¸‹redisçš„è¿›ç¨‹ä¸æ˜¯å¦è¿è¡ŒçŠ¶æ€"><a href="#éšå-Aå›-æ¥åˆ°è¿œç¨‹-æŸ¥çœ‹äº†ä¸€ä¸‹redisçš„è¿›ç¨‹ä¸æ˜¯å¦è¿è¡ŒçŠ¶æ€" class="headerlink" title="éšå Aå› æ¥åˆ°è¿œç¨‹ æŸ¥çœ‹äº†ä¸€ä¸‹redisçš„è¿›ç¨‹ä¸æ˜¯å¦è¿è¡ŒçŠ¶æ€"></a><font color=" #3CB371">éšå Aå› æ¥åˆ°è¿œç¨‹ æŸ¥çœ‹äº†ä¸€ä¸‹redisçš„è¿›ç¨‹ä¸æ˜¯å¦è¿è¡ŒçŠ¶æ€</font></h2><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> service  redis status</span><br>è¿è¡ŒçŠ¶æ€æ•ˆæœå¦‚ä¸‹:<br>â— redis-server.service - Advanced key-value store<br>   Loaded: loaded (/lib/systemd/system/redis-server.service; enabled; vendor preset: enabled)<br>   Active: active (running) since Mon 2020-12-07 11:19:27 CST; 3h 27min ago<br>     Docs: http://redis.io/documentation,<br>           man:redis-server(1)<br><br><span class="hljs-meta">$</span><span class="bash"> systemctl restart redis.service <span class="hljs-comment"># æ³¨æ„è¿™å¥ å¯¹äºæˆ‘çš„redisä¸å¤ªå‹å¥½...ä¸€ç›´æ²¡æœ‰é‡å¯æˆåŠŸ.. æ‰€ä»¥æ²¡å¿…è¦</span></span><br><br>éšå Aå› åˆæŸ¥çœ‹ä¸€ä¸‹redisçš„è¿›ç¨‹<br><span class="hljs-meta">$</span><span class="bash"> ps -ef|grep redis</span><br>redis    10571     1  0 11:19 ?        00:00:11 /usr/bin/redis-server 0.0.0.0:6379<br>root     13533 13490  0 14:48 pts/2    00:00:00 grep --color=auto redis<br><br>éƒ½æ²¡å•¥é—®é¢˜ é‚£ä¹ˆé—®é¢˜æ¥äº† è¿™æ˜¯ä»€ä¹ˆé—®é¢˜?...<br></code></pre></div></td></tr></table></figure><h2 id="æ’é™¤redis-confæ–‡ä»¶çš„ä¿®æ”¹é—®é¢˜"><a href="#æ’é™¤redis-confæ–‡ä»¶çš„ä¿®æ”¹é—®é¢˜" class="headerlink" title="æ’é™¤redis.confæ–‡ä»¶çš„ä¿®æ”¹é—®é¢˜"></a><font color="#3CB371">æ’é™¤redis.confæ–‡ä»¶çš„ä¿®æ”¹é—®é¢˜</font></h2><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">å› ä¸ºä»¥å‰åœ¨è®¾ç½®redisçš„æ—¶å€™ å°±å·²ç»æŠŠ bind <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span> ä¿®æ”¹è¿‡äº†<br>å…·ä½“æ“ä½œ:<br>    <span class="hljs-number">1.</span> è¿›å…¥redisçš„æ–‡ä»¶ä¸‹ ubuntuä¸‹çš„redis<br>    cd /etc/redis/<br>    <span class="hljs-number">2.</span> ä¿®æ”¹redis.confæ–‡ä»¶ å°†bind <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span> æ”¹æˆ bind <span class="hljs-number">0.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span><br>    vim redis.conf <span class="hljs-comment"># æ³¨æ„å¦‚æœéœ€è¦æƒé™ åˆ™éœ€è¦åœ¨vim å‰é¢åŠ  sudo</span><br></code></pre></div></td></tr></table></figure><h2 id="killæ‰redis-serverè¿›ç¨‹"><a href="#killæ‰redis-serverè¿›ç¨‹" class="headerlink" title="killæ‰redis-serverè¿›ç¨‹"></a><font color="#3CB371">killæ‰redis-serverè¿›ç¨‹</font></h2><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">1. å…ˆæŸ¥çœ‹ä¸€ä¸‹è¿›ç¨‹å·<br><span class="hljs-meta">$</span><span class="bash"> ps -ef|grep redis</span><br>redis    10571     1  0 11:19 ?        00:00:11 /usr/bin/redis-server 0.0.0.0:6379<br>root     13533 13490  0 14:48 pts/2    00:00:00 grep --color=auto redis<br><br>2. killè¿›ç¨‹å· æ³¨æ„æƒé™é—®é¢˜ sudo<br><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">kill</span> -9 l0571</span><br></code></pre></div></td></tr></table></figure><h2 id="åœ¨redisç›®å½•ä¸‹-é‡æ–°å¯åŠ¨redis"><a href="#åœ¨redisç›®å½•ä¸‹-é‡æ–°å¯åŠ¨redis" class="headerlink" title="åœ¨redisç›®å½•ä¸‹ é‡æ–°å¯åŠ¨redis"></a><font color="#3CB371">åœ¨redisç›®å½•ä¸‹ é‡æ–°å¯åŠ¨redis</font></h2><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> /etc/redis<span class="hljs-comment"># redis-server ./redis.conf</span></span><br>é…ç½®äº†redis.conf é‡å¯ä¸€ä¸‹ç”Ÿæ•ˆ<br></code></pre></div></td></tr></table></figure><blockquote><p><font color="#3CB371">å…¶å® é‡å¯ä¸€ä¸‹å°±å¯ä»¥è¿æ¥åˆ°redisçš„ ä½†æ˜¯é˜¿é‡Œäº‘ä¸€ç›´åœ¨æç¤º æœåŠ¡å™¨ä¸å®‰å…¨-redisæ²¡æœ‰è®¾ç½®å¯†ç è¿æ¥é‚£äº›..æ‰€ä»¥ ç´¢æ€§è¿™æ¬¡å°±é…ç½®ä¸Š</font></p></blockquote><h2 id="æ­¤æ—¶-ä½¿ç”¨redis-cli-è¿›å…¥rediså®¢æˆ·ç«¯-è®¾ç½®ä¸ªå¯†ç â€¦"><a href="#æ­¤æ—¶-ä½¿ç”¨redis-cli-è¿›å…¥rediså®¢æˆ·ç«¯-è®¾ç½®ä¸ªå¯†ç â€¦" class="headerlink" title="æ­¤æ—¶ ä½¿ç”¨redis-cli è¿›å…¥rediså®¢æˆ·ç«¯ è®¾ç½®ä¸ªå¯†ç â€¦"></a><font color="#3CB371">æ­¤æ—¶ ä½¿ç”¨redis-cli è¿›å…¥rediså®¢æˆ·ç«¯ è®¾ç½®ä¸ªå¯†ç â€¦</font></h2><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">è¿›å…¥å®¢æˆ·ç«¯å ç›´æ¥æ‰§è¡Œconfig set requirepass XXXXXXX<br>redis-cli<br>127.0.0.1:6379&gt; config set requirepass å¯†ç <br>127.0.0.1:6379&gt; exit é€€å‡º<br></code></pre></div></td></tr></table></figure><h2 id="æœ€å-ä½¿ç”¨djangoè¿æ¥redis-åŠ ä¸ªå¯†ç "><a href="#æœ€å-ä½¿ç”¨djangoè¿æ¥redis-åŠ ä¸ªå¯†ç " class="headerlink" title="æœ€å ä½¿ç”¨djangoè¿æ¥redis åŠ ä¸ªå¯†ç "></a><font color="#3CB371">æœ€å ä½¿ç”¨djangoè¿æ¥redis åŠ ä¸ªå¯†ç </font></h2><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-string">&#x27;default&#x27;</span>: &#123;<br>        <span class="hljs-string">&#x27;BACKEND&#x27;</span>: <span class="hljs-string">&#x27;django_redis.cache.RedisCache&#x27;</span>,<br>        <span class="hljs-string">&#x27;LOCATION&#x27;</span>: <span class="hljs-string">&#x27;redis://:ä½ çš„å¯†ç @127.0.0.1:6379/0&#x27;</span>,<br>        <span class="hljs-string">&#x27;OPTIONS&#x27;</span>: &#123;<br>            <span class="hljs-string">&#x27;CLIENT_CLASS&#x27;</span>: <span class="hljs-string">&#x27;django_redis.client.DefaultClient&#x27;</span>,<br>        &#125;<br>    &#125;,<br><br>æ³¨æ„å¯†ç å‰é¢çš„ : å·ä¸åé¢çš„ @<br></code></pre></div></td></tr></table></figure><h5 id="å–æ¶ˆè®¾ç½®å¯†ç "><a href="#å–æ¶ˆè®¾ç½®å¯†ç " class="headerlink" title="å–æ¶ˆè®¾ç½®å¯†ç "></a><strong><code>å–æ¶ˆè®¾ç½®å¯†ç </code></strong></h5><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">è¿›å…¥redis-cli å®¢æˆ·ç«¯<br>1. auth å¯†ç <br>2. config set requirepass &#x27;&#x27;<br>3. exit<br></code></pre></div></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Python</category>
      
      <category>Linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Windowsä¸‹è¿œç¨‹è¿æ¥MySQL</title>
    <link href="/2021/03/25/mysql%E8%BF%9C%E7%A8%8B%E8%BF%9E%E6%8E%A5/"/>
    <url>/2021/03/25/mysql%E8%BF%9C%E7%A8%8B%E8%BF%9E%E6%8E%A5/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h2 id="windowsä¸‹è¿æ¥è¿œç¨‹MySQL"><a href="#windowsä¸‹è¿æ¥è¿œç¨‹MySQL" class="headerlink" title="windowsä¸‹è¿æ¥è¿œç¨‹MySQL"></a><font color="#00BBFF">windowsä¸‹è¿æ¥è¿œç¨‹MySQL</font></h2><p><code>æŠ¥é”™æè¦</code></p><figure class="highlight powershell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs powershell">å•çº¯æƒ³è®°å½•ä¸€ä¸‹<br></code></pre></div></td></tr></table></figure><p><img src="https://ae01.alicdn.com/kf/U2fd4d49566cf4a07a70b163d790dbb57u.jpg" alt="bugç‹"></p><h2 id="ç™»å…¥MySQL-è¾“å…¥ä»¥ä¸‹å‘½ä»¤"><a href="#ç™»å…¥MySQL-è¾“å…¥ä»¥ä¸‹å‘½ä»¤" class="headerlink" title="ç™»å…¥MySQL è¾“å…¥ä»¥ä¸‹å‘½ä»¤"></a><font color="#00BBFF">ç™»å…¥MySQL è¾“å…¥ä»¥ä¸‹å‘½ä»¤</font></h2><figure class="highlight powershell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs powershell">(python36) root@xeswsd:<span class="hljs-comment"># mysql -uroot -pwodaonimade</span><br>mysql: [<span class="hljs-type">Warning</span>] <span class="hljs-keyword">Using</span> a password on the <span class="hljs-keyword">command</span> line interface can be insecure.<br>Welcome to the MySQL monitor.  Commands <span class="hljs-keyword">end</span> with ; or \g.<br>Your MySQL connection id is <span class="hljs-number">743</span><br>Server version: <span class="hljs-number">5.7</span>.<span class="hljs-number">30</span><span class="hljs-literal">-0ubuntu0</span>.<span class="hljs-number">16.04</span>.<span class="hljs-number">1</span><span class="hljs-literal">-log</span> (Ubuntu)<br><br>Copyright (c) <span class="hljs-number">2000</span>, <span class="hljs-number">2020</span>, Oracle and/or its affiliates. All rights reserved.<br><br>Oracle is a registered trademark of Oracle Corporation and/or its<br>affiliates. Other names may be trademarks of their respective<br>owners.<br><br><span class="hljs-built_in">Type</span> <span class="hljs-string">&#x27;help;&#x27;</span> or <span class="hljs-string">&#x27;\h&#x27;</span> <span class="hljs-keyword">for</span> help. <span class="hljs-built_in">Type</span> <span class="hljs-string">&#x27;\c&#x27;</span> to <span class="hljs-built_in">clear</span> the current input statement.<br><br>mysql&gt; GRANT all privileges on *.* TO <span class="hljs-string">&#x27;root&#x27;</span><span class="hljs-string">@&#x27;%&#x27; identified by &#x27;wodaonimade&#x27; WITH GRANT OPTION;</span><br><span class="hljs-string">Query OK, 0 rows affected, 1 warning (0.00 sec)</span><br><span class="hljs-string"></span><br><span class="hljs-string">mysql&gt; FLUSH PRIVILEGES;</span><br><span class="hljs-string">Query OK, 0 rows affected (0.00 sec)</span><br><span class="hljs-string"></span><br><span class="hljs-string">mysql&gt; quit;</span><br><span class="hljs-string">Bye</span><br></code></pre></div></td></tr></table></figure><ol><li>å‘½ä»¤ä¸€ å°†æœ¬åœ°localhost æ›´æ”¹æˆ %</li></ol><figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">all</span> privileges <span class="hljs-keyword">on</span> <span class="hljs-operator">*</span>.<span class="hljs-operator">*</span> <span class="hljs-keyword">TO</span> <span class="hljs-string">&#x27;root&#x27;</span>@<span class="hljs-string">&#x27;%&#x27;</span> identified <span class="hljs-keyword">by</span> <span class="hljs-string">&#x27;wodaonimade&#x27;</span> <span class="hljs-keyword">WITH</span> <span class="hljs-keyword">GRANT</span> OPTION;<br></code></pre></div></td></tr></table></figure><ol start="2"><li>å‘½ä»¤äºŒ åˆ·æ–°æƒé™</li></ol><figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql">FLUSH PRIVILEGES;<br></code></pre></div></td></tr></table></figure><ol start="3"><li>æ³¨æ„å¦‚æœä¸æ˜¯ä»¥ä¸Šé—®é¢˜ è¯·æ£€æŸ¥å®‰å…¨ç»„ 3306 æ˜¯å¦æ‰“å¼€</li></ol>]]></content>
    
    
    <categories>
      
      <category>Python</category>
      
      <category>MySQL</category>
      
    </categories>
    
    
    <tags>
      
      <tag>MySQL</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
